{"version":3,"file":"index.es.js","sources":["../../../node_modules/three/examples/jsm/renderers/CSS3DRenderer.js","../../../node_modules/three/examples/jsm/controls/TrackballControls.js","../../../node_modules/three/examples/jsm/controls/TransformControls.js","../../../node_modules/three/examples/jsm/libs/fflate.module.js","../../../node_modules/three/examples/jsm/curves/NURBSUtils.js","../../../node_modules/three/examples/jsm/curves/NURBSCurve.js","../../../node_modules/three/examples/jsm/loaders/FBXLoader.js","../../../node_modules/three/examples/jsm/loaders/GLTFLoader.js","../../../node_modules/three/examples/jsm/shaders/CopyShader.js","../../../node_modules/three/examples/jsm/postprocessing/Pass.js","../../../node_modules/three/examples/jsm/postprocessing/ShaderPass.js","../../../node_modules/three/examples/jsm/postprocessing/MaskPass.js","../../../node_modules/three/examples/jsm/postprocessing/EffectComposer.js","../../../node_modules/three/examples/jsm/postprocessing/OutlinePass.js","../src/BaseThree.ts","../../../node_modules/three/examples/jsm/postprocessing/RenderPass.js","../../../node_modules/three/examples/jsm/shaders/FXAAShader.js","../src/LoadGlb.ts","../src/Light.ts","../src/CssRender.ts","../src/index.ts"],"sourcesContent":["import {\n\tMatrix4,\n\tObject3D,\n\tQuaternion,\n\tVector3\n} from 'three';\n\n/**\n * Based on http://www.emagix.net/academic/mscs-project/item/camera-sync-with-css3-and-webgl-threejs\n */\n\nconst _position = new Vector3();\nconst _quaternion = new Quaternion();\nconst _scale = new Vector3();\n\nclass CSS3DObject extends Object3D {\n\n\tconstructor( element = document.createElement( 'div' ) ) {\n\n\t\tsuper();\n\n\t\tthis.element = element;\n\t\tthis.element.style.position = 'absolute';\n\t\tthis.element.style.pointerEvents = 'auto';\n\t\tthis.element.style.userSelect = 'none';\n\n\t\tthis.element.setAttribute( 'draggable', false );\n\n\t\tthis.addEventListener( 'removed', function () {\n\n\t\t\tthis.traverse( function ( object ) {\n\n\t\t\t\tif ( object.element instanceof Element && object.element.parentNode !== null ) {\n\n\t\t\t\t\tobject.element.parentNode.removeChild( object.element );\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t} );\n\n\t}\n\n\tcopy( source, recursive ) {\n\n\t\tsuper.copy( source, recursive );\n\n\t\tthis.element = source.element.cloneNode( true );\n\n\t\treturn this;\n\n\t}\n\n}\n\nCSS3DObject.prototype.isCSS3DObject = true;\n\nclass CSS3DSprite extends CSS3DObject {\n\n\tconstructor( element ) {\n\n\t\tsuper( element );\n\n\t\tthis.rotation2D = 0;\n\n\t}\n\n\tcopy( source, recursive ) {\n\n\t\tsuper.copy( source, recursive );\n\n\t\tthis.rotation2D = source.rotation2D;\n\n\t\treturn this;\n\n\t}\n\n}\n\nCSS3DSprite.prototype.isCSS3DSprite = true;\n\n//\n\nconst _matrix = new Matrix4();\nconst _matrix2 = new Matrix4();\n\nclass CSS3DRenderer {\n\n\tconstructor( parameters = {} ) {\n\n\t\tconst _this = this;\n\n\t\tlet _width, _height;\n\t\tlet _widthHalf, _heightHalf;\n\n\t\tconst cache = {\n\t\t\tcamera: { fov: 0, style: '' },\n\t\t\tobjects: new WeakMap()\n\t\t};\n\n\t\tconst domElement = parameters.element !== undefined ? parameters.element : document.createElement( 'div' );\n\n\t\tdomElement.style.overflow = 'hidden';\n\n\t\tthis.domElement = domElement;\n\n\t\tconst cameraElement = document.createElement( 'div' );\n\n\t\tcameraElement.style.transformStyle = 'preserve-3d';\n\t\tcameraElement.style.pointerEvents = 'none';\n\n\t\tdomElement.appendChild( cameraElement );\n\n\t\tthis.getSize = function () {\n\n\t\t\treturn {\n\t\t\t\twidth: _width,\n\t\t\t\theight: _height\n\t\t\t};\n\n\t\t};\n\n\t\tthis.render = function ( scene, camera ) {\n\n\t\t\tconst fov = camera.projectionMatrix.elements[ 5 ] * _heightHalf;\n\n\t\t\tif ( cache.camera.fov !== fov ) {\n\n\t\t\t\tdomElement.style.perspective = camera.isPerspectiveCamera ? fov + 'px' : '';\n\t\t\t\tcache.camera.fov = fov;\n\n\t\t\t}\n\n\t\t\tif ( scene.autoUpdate === true ) scene.updateMatrixWorld();\n\t\t\tif ( camera.parent === null ) camera.updateMatrixWorld();\n\n\t\t\tlet tx, ty;\n\n\t\t\tif ( camera.isOrthographicCamera ) {\n\n\t\t\t\ttx = - ( camera.right + camera.left ) / 2;\n\t\t\t\tty = ( camera.top + camera.bottom ) / 2;\n\n\t\t\t}\n\n\t\t\tconst cameraCSSMatrix = camera.isOrthographicCamera ?\n\t\t\t\t'scale(' + fov + ')' + 'translate(' + epsilon( tx ) + 'px,' + epsilon( ty ) + 'px)' + getCameraCSSMatrix( camera.matrixWorldInverse ) :\n\t\t\t\t'translateZ(' + fov + 'px)' + getCameraCSSMatrix( camera.matrixWorldInverse );\n\n\t\t\tconst style = cameraCSSMatrix +\n\t\t\t\t'translate(' + _widthHalf + 'px,' + _heightHalf + 'px)';\n\n\t\t\tif ( cache.camera.style !== style ) {\n\n\t\t\t\tcameraElement.style.transform = style;\n\n\t\t\t\tcache.camera.style = style;\n\n\t\t\t}\n\n\t\t\trenderObject( scene, scene, camera, cameraCSSMatrix );\n\n\t\t};\n\n\t\tthis.setSize = function ( width, height ) {\n\n\t\t\t_width = width;\n\t\t\t_height = height;\n\t\t\t_widthHalf = _width / 2;\n\t\t\t_heightHalf = _height / 2;\n\n\t\t\tdomElement.style.width = width + 'px';\n\t\t\tdomElement.style.height = height + 'px';\n\n\t\t\tcameraElement.style.width = width + 'px';\n\t\t\tcameraElement.style.height = height + 'px';\n\n\t\t};\n\n\t\tfunction epsilon( value ) {\n\n\t\t\treturn Math.abs( value ) < 1e-10 ? 0 : value;\n\n\t\t}\n\n\t\tfunction getCameraCSSMatrix( matrix ) {\n\n\t\t\tconst elements = matrix.elements;\n\n\t\t\treturn 'matrix3d(' +\n\t\t\t\tepsilon( elements[ 0 ] ) + ',' +\n\t\t\t\tepsilon( - elements[ 1 ] ) + ',' +\n\t\t\t\tepsilon( elements[ 2 ] ) + ',' +\n\t\t\t\tepsilon( elements[ 3 ] ) + ',' +\n\t\t\t\tepsilon( elements[ 4 ] ) + ',' +\n\t\t\t\tepsilon( - elements[ 5 ] ) + ',' +\n\t\t\t\tepsilon( elements[ 6 ] ) + ',' +\n\t\t\t\tepsilon( elements[ 7 ] ) + ',' +\n\t\t\t\tepsilon( elements[ 8 ] ) + ',' +\n\t\t\t\tepsilon( - elements[ 9 ] ) + ',' +\n\t\t\t\tepsilon( elements[ 10 ] ) + ',' +\n\t\t\t\tepsilon( elements[ 11 ] ) + ',' +\n\t\t\t\tepsilon( elements[ 12 ] ) + ',' +\n\t\t\t\tepsilon( - elements[ 13 ] ) + ',' +\n\t\t\t\tepsilon( elements[ 14 ] ) + ',' +\n\t\t\t\tepsilon( elements[ 15 ] ) +\n\t\t\t')';\n\n\t\t}\n\n\t\tfunction getObjectCSSMatrix( matrix ) {\n\n\t\t\tconst elements = matrix.elements;\n\t\t\tconst matrix3d = 'matrix3d(' +\n\t\t\t\tepsilon( elements[ 0 ] ) + ',' +\n\t\t\t\tepsilon( elements[ 1 ] ) + ',' +\n\t\t\t\tepsilon( elements[ 2 ] ) + ',' +\n\t\t\t\tepsilon( elements[ 3 ] ) + ',' +\n\t\t\t\tepsilon( - elements[ 4 ] ) + ',' +\n\t\t\t\tepsilon( - elements[ 5 ] ) + ',' +\n\t\t\t\tepsilon( - elements[ 6 ] ) + ',' +\n\t\t\t\tepsilon( - elements[ 7 ] ) + ',' +\n\t\t\t\tepsilon( elements[ 8 ] ) + ',' +\n\t\t\t\tepsilon( elements[ 9 ] ) + ',' +\n\t\t\t\tepsilon( elements[ 10 ] ) + ',' +\n\t\t\t\tepsilon( elements[ 11 ] ) + ',' +\n\t\t\t\tepsilon( elements[ 12 ] ) + ',' +\n\t\t\t\tepsilon( elements[ 13 ] ) + ',' +\n\t\t\t\tepsilon( elements[ 14 ] ) + ',' +\n\t\t\t\tepsilon( elements[ 15 ] ) +\n\t\t\t')';\n\n\t\t\treturn 'translate(-50%,-50%)' + matrix3d;\n\n\t\t}\n\n\t\tfunction renderObject( object, scene, camera, cameraCSSMatrix ) {\n\n\t\t\tif ( object.isCSS3DObject ) {\n\n\t\t\t\tconst visible = object.visible && object.layers.test( camera.layers );\n\t\t\t\tobject.element.style.display = visible ? '' : 'none';\n\n\t\t\t\t// only getObjectCSSMatrix when object.visible\n\t\t\t\tif ( visible ) {\n\n\t\t\t\t\tobject.onBeforeRender( _this, scene, camera );\n\n\t\t\t\t\tlet style;\n\n\t\t\t\t\tif ( object.isCSS3DSprite ) {\n\n\t\t\t\t\t\t// http://swiftcoder.wordpress.com/2008/11/25/constructing-a-billboard-matrix/\n\n\t\t\t\t\t\t_matrix.copy( camera.matrixWorldInverse );\n\t\t\t\t\t\t_matrix.transpose();\n\n\t\t\t\t\t\tif ( object.rotation2D !== 0 ) _matrix.multiply( _matrix2.makeRotationZ( object.rotation2D ) );\n\n\t\t\t\t\t\tobject.matrixWorld.decompose( _position, _quaternion, _scale );\n\t\t\t\t\t\t_matrix.setPosition( _position );\n\t\t\t\t\t\t_matrix.scale( _scale );\n\n\t\t\t\t\t\t_matrix.elements[ 3 ] = 0;\n\t\t\t\t\t\t_matrix.elements[ 7 ] = 0;\n\t\t\t\t\t\t_matrix.elements[ 11 ] = 0;\n\t\t\t\t\t\t_matrix.elements[ 15 ] = 1;\n\n\t\t\t\t\t\tstyle = getObjectCSSMatrix( _matrix );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tstyle = getObjectCSSMatrix( object.matrixWorld );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tconst element = object.element;\n\t\t\t\t\tconst cachedObject = cache.objects.get( object );\n\n\t\t\t\t\tif ( cachedObject === undefined || cachedObject.style !== style ) {\n\n\t\t\t\t\t\telement.style.transform = style;\n\n\t\t\t\t\t\tconst objectData = { style: style };\n\t\t\t\t\t\tcache.objects.set( object, objectData );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( element.parentNode !== cameraElement ) {\n\n\t\t\t\t\t\tcameraElement.appendChild( element );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tobject.onAfterRender( _this, scene, camera );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tfor ( let i = 0, l = object.children.length; i < l; i ++ ) {\n\n\t\t\t\trenderObject( object.children[ i ], scene, camera, cameraCSSMatrix );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n}\n\nexport { CSS3DObject, CSS3DSprite, CSS3DRenderer };\n","import {\n\tEventDispatcher,\n\tMOUSE,\n\tQuaternion,\n\tVector2,\n\tVector3\n} from 'three';\n\nconst _changeEvent = { type: 'change' };\nconst _startEvent = { type: 'start' };\nconst _endEvent = { type: 'end' };\n\nclass TrackballControls extends EventDispatcher {\n\n\tconstructor( object, domElement ) {\n\n\t\tsuper();\n\n\t\tif ( domElement === undefined ) console.warn( 'THREE.TrackballControls: The second parameter \"domElement\" is now mandatory.' );\n\t\tif ( domElement === document ) console.error( 'THREE.TrackballControls: \"document\" should not be used as the target \"domElement\". Please use \"renderer.domElement\" instead.' );\n\n\t\tconst scope = this;\n\t\tconst STATE = { NONE: - 1, ROTATE: 0, ZOOM: 1, PAN: 2, TOUCH_ROTATE: 3, TOUCH_ZOOM_PAN: 4 };\n\n\t\tthis.object = object;\n\t\tthis.domElement = domElement;\n\t\tthis.domElement.style.touchAction = 'none'; // disable touch scroll\n\n\t\t// API\n\n\t\tthis.enabled = true;\n\n\t\tthis.screen = { left: 0, top: 0, width: 0, height: 0 };\n\n\t\tthis.rotateSpeed = 1.0;\n\t\tthis.zoomSpeed = 1.2;\n\t\tthis.panSpeed = 0.3;\n\n\t\tthis.noRotate = false;\n\t\tthis.noZoom = false;\n\t\tthis.noPan = false;\n\n\t\tthis.staticMoving = false;\n\t\tthis.dynamicDampingFactor = 0.2;\n\n\t\tthis.minDistance = 0;\n\t\tthis.maxDistance = Infinity;\n\n\t\tthis.keys = [ 'KeyA' /*A*/, 'KeyS' /*S*/, 'KeyD' /*D*/ ];\n\n\t\tthis.mouseButtons = { LEFT: MOUSE.ROTATE, MIDDLE: MOUSE.DOLLY, RIGHT: MOUSE.PAN };\n\n\t\t// internals\n\n\t\tthis.target = new Vector3();\n\n\t\tconst EPS = 0.000001;\n\n\t\tconst lastPosition = new Vector3();\n\t\tlet lastZoom = 1;\n\n\t\tlet _state = STATE.NONE,\n\t\t\t_keyState = STATE.NONE,\n\n\t\t\t_touchZoomDistanceStart = 0,\n\t\t\t_touchZoomDistanceEnd = 0,\n\n\t\t\t_lastAngle = 0;\n\n\t\tconst _eye = new Vector3(),\n\n\t\t\t_movePrev = new Vector2(),\n\t\t\t_moveCurr = new Vector2(),\n\n\t\t\t_lastAxis = new Vector3(),\n\n\t\t\t_zoomStart = new Vector2(),\n\t\t\t_zoomEnd = new Vector2(),\n\n\t\t\t_panStart = new Vector2(),\n\t\t\t_panEnd = new Vector2(),\n\n\t\t\t_pointers = [],\n\t\t\t_pointerPositions = {};\n\n\t\t// for reset\n\n\t\tthis.target0 = this.target.clone();\n\t\tthis.position0 = this.object.position.clone();\n\t\tthis.up0 = this.object.up.clone();\n\t\tthis.zoom0 = this.object.zoom;\n\n\t\t// methods\n\n\t\tthis.handleResize = function () {\n\n\t\t\tconst box = scope.domElement.getBoundingClientRect();\n\t\t\t// adjustments come from similar code in the jquery offset() function\n\t\t\tconst d = scope.domElement.ownerDocument.documentElement;\n\t\t\tscope.screen.left = box.left + window.pageXOffset - d.clientLeft;\n\t\t\tscope.screen.top = box.top + window.pageYOffset - d.clientTop;\n\t\t\tscope.screen.width = box.width;\n\t\t\tscope.screen.height = box.height;\n\n\t\t};\n\n\t\tconst getMouseOnScreen = ( function () {\n\n\t\t\tconst vector = new Vector2();\n\n\t\t\treturn function getMouseOnScreen( pageX, pageY ) {\n\n\t\t\t\tvector.set(\n\t\t\t\t\t( pageX - scope.screen.left ) / scope.screen.width,\n\t\t\t\t\t( pageY - scope.screen.top ) / scope.screen.height\n\t\t\t\t);\n\n\t\t\t\treturn vector;\n\n\t\t\t};\n\n\t\t}() );\n\n\t\tconst getMouseOnCircle = ( function () {\n\n\t\t\tconst vector = new Vector2();\n\n\t\t\treturn function getMouseOnCircle( pageX, pageY ) {\n\n\t\t\t\tvector.set(\n\t\t\t\t\t( ( pageX - scope.screen.width * 0.5 - scope.screen.left ) / ( scope.screen.width * 0.5 ) ),\n\t\t\t\t\t( ( scope.screen.height + 2 * ( scope.screen.top - pageY ) ) / scope.screen.width ) // screen.width intentional\n\t\t\t\t);\n\n\t\t\t\treturn vector;\n\n\t\t\t};\n\n\t\t}() );\n\n\t\tthis.rotateCamera = ( function () {\n\n\t\t\tconst axis = new Vector3(),\n\t\t\t\tquaternion = new Quaternion(),\n\t\t\t\teyeDirection = new Vector3(),\n\t\t\t\tobjectUpDirection = new Vector3(),\n\t\t\t\tobjectSidewaysDirection = new Vector3(),\n\t\t\t\tmoveDirection = new Vector3();\n\n\t\t\treturn function rotateCamera() {\n\n\t\t\t\tmoveDirection.set( _moveCurr.x - _movePrev.x, _moveCurr.y - _movePrev.y, 0 );\n\t\t\t\tlet angle = moveDirection.length();\n\n\t\t\t\tif ( angle ) {\n\n\t\t\t\t\t_eye.copy( scope.object.position ).sub( scope.target );\n\n\t\t\t\t\teyeDirection.copy( _eye ).normalize();\n\t\t\t\t\tobjectUpDirection.copy( scope.object.up ).normalize();\n\t\t\t\t\tobjectSidewaysDirection.crossVectors( objectUpDirection, eyeDirection ).normalize();\n\n\t\t\t\t\tobjectUpDirection.setLength( _moveCurr.y - _movePrev.y );\n\t\t\t\t\tobjectSidewaysDirection.setLength( _moveCurr.x - _movePrev.x );\n\n\t\t\t\t\tmoveDirection.copy( objectUpDirection.add( objectSidewaysDirection ) );\n\n\t\t\t\t\taxis.crossVectors( moveDirection, _eye ).normalize();\n\n\t\t\t\t\tangle *= scope.rotateSpeed;\n\t\t\t\t\tquaternion.setFromAxisAngle( axis, angle );\n\n\t\t\t\t\t_eye.applyQuaternion( quaternion );\n\t\t\t\t\tscope.object.up.applyQuaternion( quaternion );\n\n\t\t\t\t\t_lastAxis.copy( axis );\n\t\t\t\t\t_lastAngle = angle;\n\n\t\t\t\t} else if ( ! scope.staticMoving && _lastAngle ) {\n\n\t\t\t\t\t_lastAngle *= Math.sqrt( 1.0 - scope.dynamicDampingFactor );\n\t\t\t\t\t_eye.copy( scope.object.position ).sub( scope.target );\n\t\t\t\t\tquaternion.setFromAxisAngle( _lastAxis, _lastAngle );\n\t\t\t\t\t_eye.applyQuaternion( quaternion );\n\t\t\t\t\tscope.object.up.applyQuaternion( quaternion );\n\n\t\t\t\t}\n\n\t\t\t\t_movePrev.copy( _moveCurr );\n\n\t\t\t};\n\n\t\t}() );\n\n\n\t\tthis.zoomCamera = function () {\n\n\t\t\tlet factor;\n\n\t\t\tif ( _state === STATE.TOUCH_ZOOM_PAN ) {\n\n\t\t\t\tfactor = _touchZoomDistanceStart / _touchZoomDistanceEnd;\n\t\t\t\t_touchZoomDistanceStart = _touchZoomDistanceEnd;\n\n\t\t\t\tif ( scope.object.isPerspectiveCamera ) {\n\n\t\t\t\t\t_eye.multiplyScalar( factor );\n\n\t\t\t\t} else if ( scope.object.isOrthographicCamera ) {\n\n\t\t\t\t\tscope.object.zoom /= factor;\n\t\t\t\t\tscope.object.updateProjectionMatrix();\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconsole.warn( 'THREE.TrackballControls: Unsupported camera type' );\n\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\tfactor = 1.0 + ( _zoomEnd.y - _zoomStart.y ) * scope.zoomSpeed;\n\n\t\t\t\tif ( factor !== 1.0 && factor > 0.0 ) {\n\n\t\t\t\t\tif ( scope.object.isPerspectiveCamera ) {\n\n\t\t\t\t\t\t_eye.multiplyScalar( factor );\n\n\t\t\t\t\t} else if ( scope.object.isOrthographicCamera ) {\n\n\t\t\t\t\t\tscope.object.zoom /= factor;\n\t\t\t\t\t\tscope.object.updateProjectionMatrix();\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tconsole.warn( 'THREE.TrackballControls: Unsupported camera type' );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tif ( scope.staticMoving ) {\n\n\t\t\t\t\t_zoomStart.copy( _zoomEnd );\n\n\t\t\t\t} else {\n\n\t\t\t\t\t_zoomStart.y += ( _zoomEnd.y - _zoomStart.y ) * this.dynamicDampingFactor;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t};\n\n\t\tthis.panCamera = ( function () {\n\n\t\t\tconst mouseChange = new Vector2(),\n\t\t\t\tobjectUp = new Vector3(),\n\t\t\t\tpan = new Vector3();\n\n\t\t\treturn function panCamera() {\n\n\t\t\t\tmouseChange.copy( _panEnd ).sub( _panStart );\n\n\t\t\t\tif ( mouseChange.lengthSq() ) {\n\n\t\t\t\t\tif ( scope.object.isOrthographicCamera ) {\n\n\t\t\t\t\t\tconst scale_x = ( scope.object.right - scope.object.left ) / scope.object.zoom / scope.domElement.clientWidth;\n\t\t\t\t\t\tconst scale_y = ( scope.object.top - scope.object.bottom ) / scope.object.zoom / scope.domElement.clientWidth;\n\n\t\t\t\t\t\tmouseChange.x *= scale_x;\n\t\t\t\t\t\tmouseChange.y *= scale_y;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tmouseChange.multiplyScalar( _eye.length() * scope.panSpeed );\n\n\t\t\t\t\tpan.copy( _eye ).cross( scope.object.up ).setLength( mouseChange.x );\n\t\t\t\t\tpan.add( objectUp.copy( scope.object.up ).setLength( mouseChange.y ) );\n\n\t\t\t\t\tscope.object.position.add( pan );\n\t\t\t\t\tscope.target.add( pan );\n\n\t\t\t\t\tif ( scope.staticMoving ) {\n\n\t\t\t\t\t\t_panStart.copy( _panEnd );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\t_panStart.add( mouseChange.subVectors( _panEnd, _panStart ).multiplyScalar( scope.dynamicDampingFactor ) );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t};\n\n\t\t}() );\n\n\t\tthis.checkDistances = function () {\n\n\t\t\tif ( ! scope.noZoom || ! scope.noPan ) {\n\n\t\t\t\tif ( _eye.lengthSq() > scope.maxDistance * scope.maxDistance ) {\n\n\t\t\t\t\tscope.object.position.addVectors( scope.target, _eye.setLength( scope.maxDistance ) );\n\t\t\t\t\t_zoomStart.copy( _zoomEnd );\n\n\t\t\t\t}\n\n\t\t\t\tif ( _eye.lengthSq() < scope.minDistance * scope.minDistance ) {\n\n\t\t\t\t\tscope.object.position.addVectors( scope.target, _eye.setLength( scope.minDistance ) );\n\t\t\t\t\t_zoomStart.copy( _zoomEnd );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t};\n\n\t\tthis.update = function () {\n\n\t\t\t_eye.subVectors( scope.object.position, scope.target );\n\n\t\t\tif ( ! scope.noRotate ) {\n\n\t\t\t\tscope.rotateCamera();\n\n\t\t\t}\n\n\t\t\tif ( ! scope.noZoom ) {\n\n\t\t\t\tscope.zoomCamera();\n\n\t\t\t}\n\n\t\t\tif ( ! scope.noPan ) {\n\n\t\t\t\tscope.panCamera();\n\n\t\t\t}\n\n\t\t\tscope.object.position.addVectors( scope.target, _eye );\n\n\t\t\tif ( scope.object.isPerspectiveCamera ) {\n\n\t\t\t\tscope.checkDistances();\n\n\t\t\t\tscope.object.lookAt( scope.target );\n\n\t\t\t\tif ( lastPosition.distanceToSquared( scope.object.position ) > EPS ) {\n\n\t\t\t\t\tscope.dispatchEvent( _changeEvent );\n\n\t\t\t\t\tlastPosition.copy( scope.object.position );\n\n\t\t\t\t}\n\n\t\t\t} else if ( scope.object.isOrthographicCamera ) {\n\n\t\t\t\tscope.object.lookAt( scope.target );\n\n\t\t\t\tif ( lastPosition.distanceToSquared( scope.object.position ) > EPS || lastZoom !== scope.object.zoom ) {\n\n\t\t\t\t\tscope.dispatchEvent( _changeEvent );\n\n\t\t\t\t\tlastPosition.copy( scope.object.position );\n\t\t\t\t\tlastZoom = scope.object.zoom;\n\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\tconsole.warn( 'THREE.TrackballControls: Unsupported camera type' );\n\n\t\t\t}\n\n\t\t};\n\n\t\tthis.reset = function () {\n\n\t\t\t_state = STATE.NONE;\n\t\t\t_keyState = STATE.NONE;\n\n\t\t\tscope.target.copy( scope.target0 );\n\t\t\tscope.object.position.copy( scope.position0 );\n\t\t\tscope.object.up.copy( scope.up0 );\n\t\t\tscope.object.zoom = scope.zoom0;\n\n\t\t\tscope.object.updateProjectionMatrix();\n\n\t\t\t_eye.subVectors( scope.object.position, scope.target );\n\n\t\t\tscope.object.lookAt( scope.target );\n\n\t\t\tscope.dispatchEvent( _changeEvent );\n\n\t\t\tlastPosition.copy( scope.object.position );\n\t\t\tlastZoom = scope.object.zoom;\n\n\t\t};\n\n\t\t// listeners\n\n\t\tfunction onPointerDown( event ) {\n\n\t\t\tif ( scope.enabled === false ) return;\n\n\t\t\tif ( _pointers.length === 0 ) {\n\n\t\t\t\tscope.domElement.setPointerCapture( event.pointerId );\n\n\t\t\t\tscope.domElement.addEventListener( 'pointermove', onPointerMove );\n\t\t\t\tscope.domElement.addEventListener( 'pointerup', onPointerUp );\n\n\t\t\t}\n\n\t\t\t//\n\n\t\t\taddPointer( event );\n\n\t\t\tif ( event.pointerType === 'touch' ) {\n\n\t\t\t\tonTouchStart( event );\n\n\t\t\t} else {\n\n\t\t\t\tonMouseDown( event );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction onPointerMove( event ) {\n\n\t\t\tif ( scope.enabled === false ) return;\n\n\t\t\tif ( event.pointerType === 'touch' ) {\n\n\t\t\t\tonTouchMove( event );\n\n\t\t\t} else {\n\n\t\t\t\tonMouseMove( event );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction onPointerUp( event ) {\n\n\t\t\tif ( scope.enabled === false ) return;\n\n\t\t\tif ( event.pointerType === 'touch' ) {\n\n\t\t\t\tonTouchEnd( event );\n\n\t\t\t} else {\n\n\t\t\t\tonMouseUp();\n\n\t\t\t}\n\n\t\t\t//\n\n\t\t\tremovePointer( event );\n\n\t\t\tif ( _pointers.length === 0 ) {\n\n\t\t\t\tscope.domElement.releasePointerCapture( event.pointerId );\n\n\t\t\t\tscope.domElement.removeEventListener( 'pointermove', onPointerMove );\n\t\t\t\tscope.domElement.removeEventListener( 'pointerup', onPointerUp );\n\n\t\t\t}\n\n\n\t\t}\n\n\t\tfunction onPointerCancel( event ) {\n\n\t\t\tremovePointer( event );\n\n\t\t}\n\n\t\tfunction keydown( event ) {\n\n\t\t\tif ( scope.enabled === false ) return;\n\n\t\t\twindow.removeEventListener( 'keydown', keydown );\n\n\t\t\tif ( _keyState !== STATE.NONE ) {\n\n\t\t\t\treturn;\n\n\t\t\t} else if ( event.code === scope.keys[ STATE.ROTATE ] && ! scope.noRotate ) {\n\n\t\t\t\t_keyState = STATE.ROTATE;\n\n\t\t\t} else if ( event.code === scope.keys[ STATE.ZOOM ] && ! scope.noZoom ) {\n\n\t\t\t\t_keyState = STATE.ZOOM;\n\n\t\t\t} else if ( event.code === scope.keys[ STATE.PAN ] && ! scope.noPan ) {\n\n\t\t\t\t_keyState = STATE.PAN;\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction keyup() {\n\n\t\t\tif ( scope.enabled === false ) return;\n\n\t\t\t_keyState = STATE.NONE;\n\n\t\t\twindow.addEventListener( 'keydown', keydown );\n\n\t\t}\n\n\t\tfunction onMouseDown( event ) {\n\n\t\t\tif ( _state === STATE.NONE ) {\n\n\t\t\t\tswitch ( event.button ) {\n\n\t\t\t\t\tcase scope.mouseButtons.LEFT:\n\t\t\t\t\t\t_state = STATE.ROTATE;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase scope.mouseButtons.MIDDLE:\n\t\t\t\t\t\t_state = STATE.ZOOM;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase scope.mouseButtons.RIGHT:\n\t\t\t\t\t\t_state = STATE.PAN;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\t_state = STATE.NONE;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tconst state = ( _keyState !== STATE.NONE ) ? _keyState : _state;\n\n\t\t\tif ( state === STATE.ROTATE && ! scope.noRotate ) {\n\n\t\t\t\t_moveCurr.copy( getMouseOnCircle( event.pageX, event.pageY ) );\n\t\t\t\t_movePrev.copy( _moveCurr );\n\n\t\t\t} else if ( state === STATE.ZOOM && ! scope.noZoom ) {\n\n\t\t\t\t_zoomStart.copy( getMouseOnScreen( event.pageX, event.pageY ) );\n\t\t\t\t_zoomEnd.copy( _zoomStart );\n\n\t\t\t} else if ( state === STATE.PAN && ! scope.noPan ) {\n\n\t\t\t\t_panStart.copy( getMouseOnScreen( event.pageX, event.pageY ) );\n\t\t\t\t_panEnd.copy( _panStart );\n\n\t\t\t}\n\n\t\t\tscope.dispatchEvent( _startEvent );\n\n\t\t}\n\n\t\tfunction onMouseMove( event ) {\n\n\t\t\tconst state = ( _keyState !== STATE.NONE ) ? _keyState : _state;\n\n\t\t\tif ( state === STATE.ROTATE && ! scope.noRotate ) {\n\n\t\t\t\t_movePrev.copy( _moveCurr );\n\t\t\t\t_moveCurr.copy( getMouseOnCircle( event.pageX, event.pageY ) );\n\n\t\t\t} else if ( state === STATE.ZOOM && ! scope.noZoom ) {\n\n\t\t\t\t_zoomEnd.copy( getMouseOnScreen( event.pageX, event.pageY ) );\n\n\t\t\t} else if ( state === STATE.PAN && ! scope.noPan ) {\n\n\t\t\t\t_panEnd.copy( getMouseOnScreen( event.pageX, event.pageY ) );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction onMouseUp() {\n\n\t\t\t_state = STATE.NONE;\n\n\t\t\tscope.dispatchEvent( _endEvent );\n\n\t\t}\n\n\t\tfunction onMouseWheel( event ) {\n\n\t\t\tif ( scope.enabled === false ) return;\n\n\t\t\tif ( scope.noZoom === true ) return;\n\n\t\t\tevent.preventDefault();\n\n\t\t\tswitch ( event.deltaMode ) {\n\n\t\t\t\tcase 2:\n\t\t\t\t\t// Zoom in pages\n\t\t\t\t\t_zoomStart.y -= event.deltaY * 0.025;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 1:\n\t\t\t\t\t// Zoom in lines\n\t\t\t\t\t_zoomStart.y -= event.deltaY * 0.01;\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\t// undefined, 0, assume pixels\n\t\t\t\t\t_zoomStart.y -= event.deltaY * 0.00025;\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t\tscope.dispatchEvent( _startEvent );\n\t\t\tscope.dispatchEvent( _endEvent );\n\n\t\t}\n\n\t\tfunction onTouchStart( event ) {\n\n\t\t\ttrackPointer( event );\n\n\t\t\tswitch ( _pointers.length ) {\n\n\t\t\t\tcase 1:\n\t\t\t\t\t_state = STATE.TOUCH_ROTATE;\n\t\t\t\t\t_moveCurr.copy( getMouseOnCircle( _pointers[ 0 ].pageX, _pointers[ 0 ].pageY ) );\n\t\t\t\t\t_movePrev.copy( _moveCurr );\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault: // 2 or more\n\t\t\t\t\t_state = STATE.TOUCH_ZOOM_PAN;\n\t\t\t\t\tconst dx = _pointers[ 0 ].pageX - _pointers[ 1 ].pageX;\n\t\t\t\t\tconst dy = _pointers[ 0 ].pageY - _pointers[ 1 ].pageY;\n\t\t\t\t\t_touchZoomDistanceEnd = _touchZoomDistanceStart = Math.sqrt( dx * dx + dy * dy );\n\n\t\t\t\t\tconst x = ( _pointers[ 0 ].pageX + _pointers[ 1 ].pageX ) / 2;\n\t\t\t\t\tconst y = ( _pointers[ 0 ].pageY + _pointers[ 1 ].pageY ) / 2;\n\t\t\t\t\t_panStart.copy( getMouseOnScreen( x, y ) );\n\t\t\t\t\t_panEnd.copy( _panStart );\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t\tscope.dispatchEvent( _startEvent );\n\n\t\t}\n\n\t\tfunction onTouchMove( event ) {\n\n\t\t\ttrackPointer( event );\n\n\t\t\tswitch ( _pointers.length ) {\n\n\t\t\t\tcase 1:\n\t\t\t\t\t_movePrev.copy( _moveCurr );\n\t\t\t\t\t_moveCurr.copy( getMouseOnCircle( event.pageX, event.pageY ) );\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault: // 2 or more\n\n\t\t\t\t\tconst position = getSecondPointerPosition( event );\n\n\t\t\t\t\tconst dx = event.pageX - position.x;\n\t\t\t\t\tconst dy = event.pageY - position.y;\n\t\t\t\t\t_touchZoomDistanceEnd = Math.sqrt( dx * dx + dy * dy );\n\n\t\t\t\t\tconst x = ( event.pageX + position.x ) / 2;\n\t\t\t\t\tconst y = ( event.pageY + position.y ) / 2;\n\t\t\t\t\t_panEnd.copy( getMouseOnScreen( x, y ) );\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction onTouchEnd( event ) {\n\n\t\t\tswitch ( _pointers.length ) {\n\n\t\t\t\tcase 0:\n\t\t\t\t\t_state = STATE.NONE;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 1:\n\t\t\t\t\t_state = STATE.TOUCH_ROTATE;\n\t\t\t\t\t_moveCurr.copy( getMouseOnCircle( event.pageX, event.pageY ) );\n\t\t\t\t\t_movePrev.copy( _moveCurr );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 2:\n\t\t\t\t\t_state = STATE.TOUCH_ZOOM_PAN;\n\t\t\t\t\t_moveCurr.copy( getMouseOnCircle( event.pageX - _movePrev.pageX, event.pageY - _movePrev.pageY ) );\n\t\t\t\t\t_movePrev.copy( _moveCurr );\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t\tscope.dispatchEvent( _endEvent );\n\n\t\t}\n\n\t\tfunction contextmenu( event ) {\n\n\t\t\tif ( scope.enabled === false ) return;\n\n\t\t\tevent.preventDefault();\n\n\t\t}\n\n\t\tfunction addPointer( event ) {\n\n\t\t\t_pointers.push( event );\n\n\t\t}\n\n\t\tfunction removePointer( event ) {\n\n\t\t\tdelete _pointerPositions[ event.pointerId ];\n\n\t\t\tfor ( let i = 0; i < _pointers.length; i ++ ) {\n\n\t\t\t\tif ( _pointers[ i ].pointerId == event.pointerId ) {\n\n\t\t\t\t\t_pointers.splice( i, 1 );\n\t\t\t\t\treturn;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction trackPointer( event ) {\n\n\t\t\tlet position = _pointerPositions[ event.pointerId ];\n\n\t\t\tif ( position === undefined ) {\n\n\t\t\t\tposition = new Vector2();\n\t\t\t\t_pointerPositions[ event.pointerId ] = position;\n\n\t\t\t}\n\n\t\t\tposition.set( event.pageX, event.pageY );\n\n\t\t}\n\n\t\tfunction getSecondPointerPosition( event ) {\n\n\t\t\tconst pointer = ( event.pointerId === _pointers[ 0 ].pointerId ) ? _pointers[ 1 ] : _pointers[ 0 ];\n\n\t\t\treturn _pointerPositions[ pointer.pointerId ];\n\n\t\t}\n\n\t\tthis.dispose = function () {\n\n\t\t\tscope.domElement.removeEventListener( 'contextmenu', contextmenu );\n\n\t\t\tscope.domElement.removeEventListener( 'pointerdown', onPointerDown );\n\t\t\tscope.domElement.removeEventListener( 'pointercancel', onPointerCancel );\n\t\t\tscope.domElement.removeEventListener( 'wheel', onMouseWheel );\n\n\t\t\tscope.domElement.removeEventListener( 'pointermove', onPointerMove );\n\t\t\tscope.domElement.removeEventListener( 'pointerup', onPointerUp );\n\n\t\t\twindow.removeEventListener( 'keydown', keydown );\n\t\t\twindow.removeEventListener( 'keyup', keyup );\n\n\t\t};\n\n\t\tthis.domElement.addEventListener( 'contextmenu', contextmenu );\n\n\t\tthis.domElement.addEventListener( 'pointerdown', onPointerDown );\n\t\tthis.domElement.addEventListener( 'pointercancel', onPointerCancel );\n\t\tthis.domElement.addEventListener( 'wheel', onMouseWheel, { passive: false } );\n\n\n\t\twindow.addEventListener( 'keydown', keydown );\n\t\twindow.addEventListener( 'keyup', keyup );\n\n\t\tthis.handleResize();\n\n\t\t// force an update at start\n\t\tthis.update();\n\n\t}\n\n}\n\nexport { TrackballControls };\n","import {\n\tBoxGeometry,\n\tBufferGeometry,\n\tCylinderGeometry,\n\tDoubleSide,\n\tEuler,\n\tFloat32BufferAttribute,\n\tLine,\n\tLineBasicMaterial,\n\tMatrix4,\n\tMesh,\n\tMeshBasicMaterial,\n\tObject3D,\n\tOctahedronGeometry,\n\tPlaneGeometry,\n\tQuaternion,\n\tRaycaster,\n\tSphereGeometry,\n\tTorusGeometry,\n\tVector3\n} from 'three';\n\nconst _raycaster = new Raycaster();\n\nconst _tempVector = new Vector3();\nconst _tempVector2 = new Vector3();\nconst _tempQuaternion = new Quaternion();\nconst _unit = {\n\tX: new Vector3( 1, 0, 0 ),\n\tY: new Vector3( 0, 1, 0 ),\n\tZ: new Vector3( 0, 0, 1 )\n};\n\nconst _changeEvent = { type: 'change' };\nconst _mouseDownEvent = { type: 'mouseDown' };\nconst _mouseUpEvent = { type: 'mouseUp', mode: null };\nconst _objectChangeEvent = { type: 'objectChange' };\n\nclass TransformControls extends Object3D {\n\n\tconstructor( camera, domElement ) {\n\n\t\tsuper();\n\n\t\tif ( domElement === undefined ) {\n\n\t\t\tconsole.warn( 'THREE.TransformControls: The second parameter \"domElement\" is now mandatory.' );\n\t\t\tdomElement = document;\n\n\t\t}\n\n\t\tthis.visible = false;\n\t\tthis.domElement = domElement;\n\t\tthis.domElement.style.touchAction = 'none'; // disable touch scroll\n\n\t\tconst _gizmo = new TransformControlsGizmo();\n\t\tthis._gizmo = _gizmo;\n\t\tthis.add( _gizmo );\n\n\t\tconst _plane = new TransformControlsPlane();\n\t\tthis._plane = _plane;\n\t\tthis.add( _plane );\n\n\t\tconst scope = this;\n\n\t\t// Defined getter, setter and store for a property\n\t\tfunction defineProperty( propName, defaultValue ) {\n\n\t\t\tlet propValue = defaultValue;\n\n\t\t\tObject.defineProperty( scope, propName, {\n\n\t\t\t\tget: function () {\n\n\t\t\t\t\treturn propValue !== undefined ? propValue : defaultValue;\n\n\t\t\t\t},\n\n\t\t\t\tset: function ( value ) {\n\n\t\t\t\t\tif ( propValue !== value ) {\n\n\t\t\t\t\t\tpropValue = value;\n\t\t\t\t\t\t_plane[ propName ] = value;\n\t\t\t\t\t\t_gizmo[ propName ] = value;\n\n\t\t\t\t\t\tscope.dispatchEvent( { type: propName + '-changed', value: value } );\n\t\t\t\t\t\tscope.dispatchEvent( _changeEvent );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t\tscope[ propName ] = defaultValue;\n\t\t\t_plane[ propName ] = defaultValue;\n\t\t\t_gizmo[ propName ] = defaultValue;\n\n\t\t}\n\n\t\t// Define properties with getters/setter\n\t\t// Setting the defined property will automatically trigger change event\n\t\t// Defined properties are passed down to gizmo and plane\n\n\t\tdefineProperty( 'camera', camera );\n\t\tdefineProperty( 'object', undefined );\n\t\tdefineProperty( 'enabled', true );\n\t\tdefineProperty( 'axis', null );\n\t\tdefineProperty( 'mode', 'translate' );\n\t\tdefineProperty( 'translationSnap', null );\n\t\tdefineProperty( 'rotationSnap', null );\n\t\tdefineProperty( 'scaleSnap', null );\n\t\tdefineProperty( 'space', 'world' );\n\t\tdefineProperty( 'size', 1 );\n\t\tdefineProperty( 'dragging', false );\n\t\tdefineProperty( 'showX', true );\n\t\tdefineProperty( 'showY', true );\n\t\tdefineProperty( 'showZ', true );\n\n\t\t// Reusable utility variables\n\n\t\tconst worldPosition = new Vector3();\n\t\tconst worldPositionStart = new Vector3();\n\t\tconst worldQuaternion = new Quaternion();\n\t\tconst worldQuaternionStart = new Quaternion();\n\t\tconst cameraPosition = new Vector3();\n\t\tconst cameraQuaternion = new Quaternion();\n\t\tconst pointStart = new Vector3();\n\t\tconst pointEnd = new Vector3();\n\t\tconst rotationAxis = new Vector3();\n\t\tconst rotationAngle = 0;\n\t\tconst eye = new Vector3();\n\n\t\t// TODO: remove properties unused in plane and gizmo\n\n\t\tdefineProperty( 'worldPosition', worldPosition );\n\t\tdefineProperty( 'worldPositionStart', worldPositionStart );\n\t\tdefineProperty( 'worldQuaternion', worldQuaternion );\n\t\tdefineProperty( 'worldQuaternionStart', worldQuaternionStart );\n\t\tdefineProperty( 'cameraPosition', cameraPosition );\n\t\tdefineProperty( 'cameraQuaternion', cameraQuaternion );\n\t\tdefineProperty( 'pointStart', pointStart );\n\t\tdefineProperty( 'pointEnd', pointEnd );\n\t\tdefineProperty( 'rotationAxis', rotationAxis );\n\t\tdefineProperty( 'rotationAngle', rotationAngle );\n\t\tdefineProperty( 'eye', eye );\n\n\t\tthis._offset = new Vector3();\n\t\tthis._startNorm = new Vector3();\n\t\tthis._endNorm = new Vector3();\n\t\tthis._cameraScale = new Vector3();\n\n\t\tthis._parentPosition = new Vector3();\n\t\tthis._parentQuaternion = new Quaternion();\n\t\tthis._parentQuaternionInv = new Quaternion();\n\t\tthis._parentScale = new Vector3();\n\n\t\tthis._worldScaleStart = new Vector3();\n\t\tthis._worldQuaternionInv = new Quaternion();\n\t\tthis._worldScale = new Vector3();\n\n\t\tthis._positionStart = new Vector3();\n\t\tthis._quaternionStart = new Quaternion();\n\t\tthis._scaleStart = new Vector3();\n\n\t\tthis._getPointer = getPointer.bind( this );\n\t\tthis._onPointerDown = onPointerDown.bind( this );\n\t\tthis._onPointerHover = onPointerHover.bind( this );\n\t\tthis._onPointerMove = onPointerMove.bind( this );\n\t\tthis._onPointerUp = onPointerUp.bind( this );\n\n\t\tthis.domElement.addEventListener( 'pointerdown', this._onPointerDown );\n\t\tthis.domElement.addEventListener( 'pointermove', this._onPointerHover );\n\t\tthis.domElement.addEventListener( 'pointerup', this._onPointerUp );\n\n\t}\n\n\t// updateMatrixWorld  updates key transformation variables\n\tupdateMatrixWorld() {\n\n\t\tif ( this.object !== undefined ) {\n\n\t\t\tthis.object.updateMatrixWorld();\n\n\t\t\tif ( this.object.parent === null ) {\n\n\t\t\t\tconsole.error( 'TransformControls: The attached 3D object must be a part of the scene graph.' );\n\n\t\t\t} else {\n\n\t\t\t\tthis.object.parent.matrixWorld.decompose( this._parentPosition, this._parentQuaternion, this._parentScale );\n\n\t\t\t}\n\n\t\t\tthis.object.matrixWorld.decompose( this.worldPosition, this.worldQuaternion, this._worldScale );\n\n\t\t\tthis._parentQuaternionInv.copy( this._parentQuaternion ).invert();\n\t\t\tthis._worldQuaternionInv.copy( this.worldQuaternion ).invert();\n\n\t\t}\n\n\t\tthis.camera.updateMatrixWorld();\n\t\tthis.camera.matrixWorld.decompose( this.cameraPosition, this.cameraQuaternion, this._cameraScale );\n\n\t\tthis.eye.copy( this.cameraPosition ).sub( this.worldPosition ).normalize();\n\n\t\tsuper.updateMatrixWorld( this );\n\n\t}\n\n\tpointerHover( pointer ) {\n\n\t\tif ( this.object === undefined || this.dragging === true ) return;\n\n\t\t_raycaster.setFromCamera( pointer, this.camera );\n\n\t\tconst intersect = intersectObjectWithRay( this._gizmo.picker[ this.mode ], _raycaster );\n\n\t\tif ( intersect ) {\n\n\t\t\tthis.axis = intersect.object.name;\n\n\t\t} else {\n\n\t\t\tthis.axis = null;\n\n\t\t}\n\n\t}\n\n\tpointerDown( pointer ) {\n\n\t\tif ( this.object === undefined || this.dragging === true || pointer.button !== 0 ) return;\n\n\t\tif ( this.axis !== null ) {\n\n\t\t\t_raycaster.setFromCamera( pointer, this.camera );\n\n\t\t\tconst planeIntersect = intersectObjectWithRay( this._plane, _raycaster, true );\n\n\t\t\tif ( planeIntersect ) {\n\n\t\t\t\tthis.object.updateMatrixWorld();\n\t\t\t\tthis.object.parent.updateMatrixWorld();\n\n\t\t\t\tthis._positionStart.copy( this.object.position );\n\t\t\t\tthis._quaternionStart.copy( this.object.quaternion );\n\t\t\t\tthis._scaleStart.copy( this.object.scale );\n\n\t\t\t\tthis.object.matrixWorld.decompose( this.worldPositionStart, this.worldQuaternionStart, this._worldScaleStart );\n\n\t\t\t\tthis.pointStart.copy( planeIntersect.point ).sub( this.worldPositionStart );\n\n\t\t\t}\n\n\t\t\tthis.dragging = true;\n\t\t\t_mouseDownEvent.mode = this.mode;\n\t\t\tthis.dispatchEvent( _mouseDownEvent );\n\n\t\t}\n\n\t}\n\n\tpointerMove( pointer ) {\n\n\t\tconst axis = this.axis;\n\t\tconst mode = this.mode;\n\t\tconst object = this.object;\n\t\tlet space = this.space;\n\n\t\tif ( mode === 'scale' ) {\n\n\t\t\tspace = 'local';\n\n\t\t} else if ( axis === 'E' || axis === 'XYZE' || axis === 'XYZ' ) {\n\n\t\t\tspace = 'world';\n\n\t\t}\n\n\t\tif ( object === undefined || axis === null || this.dragging === false || pointer.button !== - 1 ) return;\n\n\t\t_raycaster.setFromCamera( pointer, this.camera );\n\n\t\tconst planeIntersect = intersectObjectWithRay( this._plane, _raycaster, true );\n\n\t\tif ( ! planeIntersect ) return;\n\n\t\tthis.pointEnd.copy( planeIntersect.point ).sub( this.worldPositionStart );\n\n\t\tif ( mode === 'translate' ) {\n\n\t\t\t// Apply translate\n\n\t\t\tthis._offset.copy( this.pointEnd ).sub( this.pointStart );\n\n\t\t\tif ( space === 'local' && axis !== 'XYZ' ) {\n\n\t\t\t\tthis._offset.applyQuaternion( this._worldQuaternionInv );\n\n\t\t\t}\n\n\t\t\tif ( axis.indexOf( 'X' ) === - 1 ) this._offset.x = 0;\n\t\t\tif ( axis.indexOf( 'Y' ) === - 1 ) this._offset.y = 0;\n\t\t\tif ( axis.indexOf( 'Z' ) === - 1 ) this._offset.z = 0;\n\n\t\t\tif ( space === 'local' && axis !== 'XYZ' ) {\n\n\t\t\t\tthis._offset.applyQuaternion( this._quaternionStart ).divide( this._parentScale );\n\n\t\t\t} else {\n\n\t\t\t\tthis._offset.applyQuaternion( this._parentQuaternionInv ).divide( this._parentScale );\n\n\t\t\t}\n\n\t\t\tobject.position.copy( this._offset ).add( this._positionStart );\n\n\t\t\t// Apply translation snap\n\n\t\t\tif ( this.translationSnap ) {\n\n\t\t\t\tif ( space === 'local' ) {\n\n\t\t\t\t\tobject.position.applyQuaternion( _tempQuaternion.copy( this._quaternionStart ).invert() );\n\n\t\t\t\t\tif ( axis.search( 'X' ) !== - 1 ) {\n\n\t\t\t\t\t\tobject.position.x = Math.round( object.position.x / this.translationSnap ) * this.translationSnap;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( axis.search( 'Y' ) !== - 1 ) {\n\n\t\t\t\t\t\tobject.position.y = Math.round( object.position.y / this.translationSnap ) * this.translationSnap;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( axis.search( 'Z' ) !== - 1 ) {\n\n\t\t\t\t\t\tobject.position.z = Math.round( object.position.z / this.translationSnap ) * this.translationSnap;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tobject.position.applyQuaternion( this._quaternionStart );\n\n\t\t\t\t}\n\n\t\t\t\tif ( space === 'world' ) {\n\n\t\t\t\t\tif ( object.parent ) {\n\n\t\t\t\t\t\tobject.position.add( _tempVector.setFromMatrixPosition( object.parent.matrixWorld ) );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( axis.search( 'X' ) !== - 1 ) {\n\n\t\t\t\t\t\tobject.position.x = Math.round( object.position.x / this.translationSnap ) * this.translationSnap;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( axis.search( 'Y' ) !== - 1 ) {\n\n\t\t\t\t\t\tobject.position.y = Math.round( object.position.y / this.translationSnap ) * this.translationSnap;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( axis.search( 'Z' ) !== - 1 ) {\n\n\t\t\t\t\t\tobject.position.z = Math.round( object.position.z / this.translationSnap ) * this.translationSnap;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( object.parent ) {\n\n\t\t\t\t\t\tobject.position.sub( _tempVector.setFromMatrixPosition( object.parent.matrixWorld ) );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t} else if ( mode === 'scale' ) {\n\n\t\t\tif ( axis.search( 'XYZ' ) !== - 1 ) {\n\n\t\t\t\tlet d = this.pointEnd.length() / this.pointStart.length();\n\n\t\t\t\tif ( this.pointEnd.dot( this.pointStart ) < 0 ) d *= - 1;\n\n\t\t\t\t_tempVector2.set( d, d, d );\n\n\t\t\t} else {\n\n\t\t\t\t_tempVector.copy( this.pointStart );\n\t\t\t\t_tempVector2.copy( this.pointEnd );\n\n\t\t\t\t_tempVector.applyQuaternion( this._worldQuaternionInv );\n\t\t\t\t_tempVector2.applyQuaternion( this._worldQuaternionInv );\n\n\t\t\t\t_tempVector2.divide( _tempVector );\n\n\t\t\t\tif ( axis.search( 'X' ) === - 1 ) {\n\n\t\t\t\t\t_tempVector2.x = 1;\n\n\t\t\t\t}\n\n\t\t\t\tif ( axis.search( 'Y' ) === - 1 ) {\n\n\t\t\t\t\t_tempVector2.y = 1;\n\n\t\t\t\t}\n\n\t\t\t\tif ( axis.search( 'Z' ) === - 1 ) {\n\n\t\t\t\t\t_tempVector2.z = 1;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// Apply scale\n\n\t\t\tobject.scale.copy( this._scaleStart ).multiply( _tempVector2 );\n\n\t\t\tif ( this.scaleSnap ) {\n\n\t\t\t\tif ( axis.search( 'X' ) !== - 1 ) {\n\n\t\t\t\t\tobject.scale.x = Math.round( object.scale.x / this.scaleSnap ) * this.scaleSnap || this.scaleSnap;\n\n\t\t\t\t}\n\n\t\t\t\tif ( axis.search( 'Y' ) !== - 1 ) {\n\n\t\t\t\t\tobject.scale.y = Math.round( object.scale.y / this.scaleSnap ) * this.scaleSnap || this.scaleSnap;\n\n\t\t\t\t}\n\n\t\t\t\tif ( axis.search( 'Z' ) !== - 1 ) {\n\n\t\t\t\t\tobject.scale.z = Math.round( object.scale.z / this.scaleSnap ) * this.scaleSnap || this.scaleSnap;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t} else if ( mode === 'rotate' ) {\n\n\t\t\tthis._offset.copy( this.pointEnd ).sub( this.pointStart );\n\n\t\t\tconst ROTATION_SPEED = 20 / this.worldPosition.distanceTo( _tempVector.setFromMatrixPosition( this.camera.matrixWorld ) );\n\n\t\t\tif ( axis === 'E' ) {\n\n\t\t\t\tthis.rotationAxis.copy( this.eye );\n\t\t\t\tthis.rotationAngle = this.pointEnd.angleTo( this.pointStart );\n\n\t\t\t\tthis._startNorm.copy( this.pointStart ).normalize();\n\t\t\t\tthis._endNorm.copy( this.pointEnd ).normalize();\n\n\t\t\t\tthis.rotationAngle *= ( this._endNorm.cross( this._startNorm ).dot( this.eye ) < 0 ? 1 : - 1 );\n\n\t\t\t} else if ( axis === 'XYZE' ) {\n\n\t\t\t\tthis.rotationAxis.copy( this._offset ).cross( this.eye ).normalize();\n\t\t\t\tthis.rotationAngle = this._offset.dot( _tempVector.copy( this.rotationAxis ).cross( this.eye ) ) * ROTATION_SPEED;\n\n\t\t\t} else if ( axis === 'X' || axis === 'Y' || axis === 'Z' ) {\n\n\t\t\t\tthis.rotationAxis.copy( _unit[ axis ] );\n\n\t\t\t\t_tempVector.copy( _unit[ axis ] );\n\n\t\t\t\tif ( space === 'local' ) {\n\n\t\t\t\t\t_tempVector.applyQuaternion( this.worldQuaternion );\n\n\t\t\t\t}\n\n\t\t\t\tthis.rotationAngle = this._offset.dot( _tempVector.cross( this.eye ).normalize() ) * ROTATION_SPEED;\n\n\t\t\t}\n\n\t\t\t// Apply rotation snap\n\n\t\t\tif ( this.rotationSnap ) this.rotationAngle = Math.round( this.rotationAngle / this.rotationSnap ) * this.rotationSnap;\n\n\t\t\t// Apply rotate\n\t\t\tif ( space === 'local' && axis !== 'E' && axis !== 'XYZE' ) {\n\n\t\t\t\tobject.quaternion.copy( this._quaternionStart );\n\t\t\t\tobject.quaternion.multiply( _tempQuaternion.setFromAxisAngle( this.rotationAxis, this.rotationAngle ) ).normalize();\n\n\t\t\t} else {\n\n\t\t\t\tthis.rotationAxis.applyQuaternion( this._parentQuaternionInv );\n\t\t\t\tobject.quaternion.copy( _tempQuaternion.setFromAxisAngle( this.rotationAxis, this.rotationAngle ) );\n\t\t\t\tobject.quaternion.multiply( this._quaternionStart ).normalize();\n\n\t\t\t}\n\n\t\t}\n\n\t\tthis.dispatchEvent( _changeEvent );\n\t\tthis.dispatchEvent( _objectChangeEvent );\n\n\t}\n\n\tpointerUp( pointer ) {\n\n\t\tif ( pointer.button !== 0 ) return;\n\n\t\tif ( this.dragging && ( this.axis !== null ) ) {\n\n\t\t\t_mouseUpEvent.mode = this.mode;\n\t\t\tthis.dispatchEvent( _mouseUpEvent );\n\n\t\t}\n\n\t\tthis.dragging = false;\n\t\tthis.axis = null;\n\n\t}\n\n\tdispose() {\n\n\t\tthis.domElement.removeEventListener( 'pointerdown', this._onPointerDown );\n\t\tthis.domElement.removeEventListener( 'pointermove', this._onPointerHover );\n\t\tthis.domElement.removeEventListener( 'pointermove', this._onPointerMove );\n\t\tthis.domElement.removeEventListener( 'pointerup', this._onPointerUp );\n\n\t\tthis.traverse( function ( child ) {\n\n\t\t\tif ( child.geometry ) child.geometry.dispose();\n\t\t\tif ( child.material ) child.material.dispose();\n\n\t\t} );\n\n\t}\n\n\t// Set current object\n\tattach( object ) {\n\n\t\tthis.object = object;\n\t\tthis.visible = true;\n\n\t\treturn this;\n\n\t}\n\n\t// Detatch from object\n\tdetach() {\n\n\t\tthis.object = undefined;\n\t\tthis.visible = false;\n\t\tthis.axis = null;\n\n\t\treturn this;\n\n\t}\n\n\treset() {\n\n\t\tif ( ! this.enabled ) return;\n\n\t\tif ( this.dragging ) {\n\n\t\t\tthis.object.position.copy( this._positionStart );\n\t\t\tthis.object.quaternion.copy( this._quaternionStart );\n\t\t\tthis.object.scale.copy( this._scaleStart );\n\n\t\t\tthis.dispatchEvent( _changeEvent );\n\t\t\tthis.dispatchEvent( _objectChangeEvent );\n\n\t\t\tthis.pointStart.copy( this.pointEnd );\n\n\t\t}\n\n\t}\n\n\tgetRaycaster() {\n\n\t\treturn _raycaster;\n\n\t}\n\n\t// TODO: deprecate\n\n\tgetMode() {\n\n\t\treturn this.mode;\n\n\t}\n\n\tsetMode( mode ) {\n\n\t\tthis.mode = mode;\n\n\t}\n\n\tsetTranslationSnap( translationSnap ) {\n\n\t\tthis.translationSnap = translationSnap;\n\n\t}\n\n\tsetRotationSnap( rotationSnap ) {\n\n\t\tthis.rotationSnap = rotationSnap;\n\n\t}\n\n\tsetScaleSnap( scaleSnap ) {\n\n\t\tthis.scaleSnap = scaleSnap;\n\n\t}\n\n\tsetSize( size ) {\n\n\t\tthis.size = size;\n\n\t}\n\n\tsetSpace( space ) {\n\n\t\tthis.space = space;\n\n\t}\n\n\tupdate() {\n\n\t\tconsole.warn( 'THREE.TransformControls: update function has no more functionality and therefore has been deprecated.' );\n\n\t}\n\n}\n\nTransformControls.prototype.isTransformControls = true;\n\n// mouse / touch event handlers\n\nfunction getPointer( event ) {\n\n\tif ( this.domElement.ownerDocument.pointerLockElement ) {\n\n\t\treturn {\n\t\t\tx: 0,\n\t\t\ty: 0,\n\t\t\tbutton: event.button\n\t\t};\n\n\t} else {\n\n\t\tconst rect = this.domElement.getBoundingClientRect();\n\n\t\treturn {\n\t\t\tx: ( event.clientX - rect.left ) / rect.width * 2 - 1,\n\t\t\ty: - ( event.clientY - rect.top ) / rect.height * 2 + 1,\n\t\t\tbutton: event.button\n\t\t};\n\n\t}\n\n}\n\nfunction onPointerHover( event ) {\n\n\tif ( ! this.enabled ) return;\n\n\tswitch ( event.pointerType ) {\n\n\t\tcase 'mouse':\n\t\tcase 'pen':\n\t\t\tthis.pointerHover( this._getPointer( event ) );\n\t\t\tbreak;\n\n\t}\n\n}\n\nfunction onPointerDown( event ) {\n\n\tif ( ! this.enabled ) return;\n\n\tif ( ! document.pointerLockElement ) {\n\n\t\tthis.domElement.setPointerCapture( event.pointerId );\n\n\t}\n\n\tthis.domElement.addEventListener( 'pointermove', this._onPointerMove );\n\n\tthis.pointerHover( this._getPointer( event ) );\n\tthis.pointerDown( this._getPointer( event ) );\n\n}\n\nfunction onPointerMove( event ) {\n\n\tif ( ! this.enabled ) return;\n\n\tthis.pointerMove( this._getPointer( event ) );\n\n}\n\nfunction onPointerUp( event ) {\n\n\tif ( ! this.enabled ) return;\n\n\tthis.domElement.releasePointerCapture( event.pointerId );\n\n\tthis.domElement.removeEventListener( 'pointermove', this._onPointerMove );\n\n\tthis.pointerUp( this._getPointer( event ) );\n\n}\n\nfunction intersectObjectWithRay( object, raycaster, includeInvisible ) {\n\n\tconst allIntersections = raycaster.intersectObject( object, true );\n\n\tfor ( let i = 0; i < allIntersections.length; i ++ ) {\n\n\t\tif ( allIntersections[ i ].object.visible || includeInvisible ) {\n\n\t\t\treturn allIntersections[ i ];\n\n\t\t}\n\n\t}\n\n\treturn false;\n\n}\n\n//\n\n// Reusable utility variables\n\nconst _tempEuler = new Euler();\nconst _alignVector = new Vector3( 0, 1, 0 );\nconst _zeroVector = new Vector3( 0, 0, 0 );\nconst _lookAtMatrix = new Matrix4();\nconst _tempQuaternion2 = new Quaternion();\nconst _identityQuaternion = new Quaternion();\nconst _dirVector = new Vector3();\nconst _tempMatrix = new Matrix4();\n\nconst _unitX = new Vector3( 1, 0, 0 );\nconst _unitY = new Vector3( 0, 1, 0 );\nconst _unitZ = new Vector3( 0, 0, 1 );\n\nconst _v1 = new Vector3();\nconst _v2 = new Vector3();\nconst _v3 = new Vector3();\n\nclass TransformControlsGizmo extends Object3D {\n\n\tconstructor() {\n\n\t\tsuper();\n\n\t\tthis.type = 'TransformControlsGizmo';\n\n\t\t// shared materials\n\n\t\tconst gizmoMaterial = new MeshBasicMaterial( {\n\t\t\tdepthTest: false,\n\t\t\tdepthWrite: false,\n\t\t\tfog: false,\n\t\t\ttoneMapped: false,\n\t\t\ttransparent: true\n\t\t} );\n\n\t\tconst gizmoLineMaterial = new LineBasicMaterial( {\n\t\t\tdepthTest: false,\n\t\t\tdepthWrite: false,\n\t\t\tfog: false,\n\t\t\ttoneMapped: false,\n\t\t\ttransparent: true\n\t\t} );\n\n\t\t// Make unique material for each axis/color\n\n\t\tconst matInvisible = gizmoMaterial.clone();\n\t\tmatInvisible.opacity = 0.15;\n\n\t\tconst matHelper = gizmoLineMaterial.clone();\n\t\tmatHelper.opacity = 0.5;\n\n\t\tconst matRed = gizmoMaterial.clone();\n\t\tmatRed.color.setHex( 0xff0000 );\n\n\t\tconst matGreen = gizmoMaterial.clone();\n\t\tmatGreen.color.setHex( 0x00ff00 );\n\n\t\tconst matBlue = gizmoMaterial.clone();\n\t\tmatBlue.color.setHex( 0x0000ff );\n\n\t\tconst matRedTransparent = gizmoMaterial.clone();\n\t\tmatRedTransparent.color.setHex( 0xff0000 );\n\t\tmatRedTransparent.opacity = 0.5;\n\n\t\tconst matGreenTransparent = gizmoMaterial.clone();\n\t\tmatGreenTransparent.color.setHex( 0x00ff00 );\n\t\tmatGreenTransparent.opacity = 0.5;\n\n\t\tconst matBlueTransparent = gizmoMaterial.clone();\n\t\tmatBlueTransparent.color.setHex( 0x0000ff );\n\t\tmatBlueTransparent.opacity = 0.5;\n\n\t\tconst matWhiteTransparent = gizmoMaterial.clone();\n\t\tmatWhiteTransparent.opacity = 0.25;\n\n\t\tconst matYellowTransparent = gizmoMaterial.clone();\n\t\tmatYellowTransparent.color.setHex( 0xffff00 );\n\t\tmatYellowTransparent.opacity = 0.25;\n\n\t\tconst matYellow = gizmoMaterial.clone();\n\t\tmatYellow.color.setHex( 0xffff00 );\n\n\t\tconst matGray = gizmoMaterial.clone();\n\t\tmatGray.color.setHex( 0x787878 );\n\n\t\t// reusable geometry\n\n\t\tconst arrowGeometry = new CylinderGeometry( 0, 0.04, 0.1, 12 );\n\t\tarrowGeometry.translate( 0, 0.05, 0 );\n\n\t\tconst scaleHandleGeometry = new BoxGeometry( 0.08, 0.08, 0.08 );\n\t\tscaleHandleGeometry.translate( 0, 0.04, 0 );\n\n\t\tconst lineGeometry = new BufferGeometry();\n\t\tlineGeometry.setAttribute( 'position', new Float32BufferAttribute( [ 0, 0, 0,\t1, 0, 0 ], 3 ) );\n\n\t\tconst lineGeometry2 = new CylinderGeometry( 0.0075, 0.0075, 0.5, 3 );\n\t\tlineGeometry2.translate( 0, 0.25, 0 );\n\n\t\tfunction CircleGeometry( radius, arc ) {\n\n\t\t\tconst geometry = new TorusGeometry( radius, 0.0075, 3, 64, arc * Math.PI * 2 );\n\t\t\tgeometry.rotateY( Math.PI / 2 );\n\t\t\tgeometry.rotateX( Math.PI / 2 );\n\t\t\treturn geometry;\n\n\t\t}\n\n\t\t// Special geometry for transform helper. If scaled with position vector it spans from [0,0,0] to position\n\n\t\tfunction TranslateHelperGeometry() {\n\n\t\t\tconst geometry = new BufferGeometry();\n\n\t\t\tgeometry.setAttribute( 'position', new Float32BufferAttribute( [ 0, 0, 0, 1, 1, 1 ], 3 ) );\n\n\t\t\treturn geometry;\n\n\t\t}\n\n\t\t// Gizmo definitions - custom hierarchy definitions for setupGizmo() function\n\n\t\tconst gizmoTranslate = {\n\t\t\tX: [\n\t\t\t\t[ new Mesh( arrowGeometry, matRed ), [ 0.5, 0, 0 ], [ 0, 0, - Math.PI / 2 ]],\n\t\t\t\t[ new Mesh( arrowGeometry, matRed ), [ - 0.5, 0, 0 ], [ 0, 0, Math.PI / 2 ]],\n\t\t\t\t[ new Mesh( lineGeometry2, matRed ), [ 0, 0, 0 ], [ 0, 0, - Math.PI / 2 ]]\n\t\t\t],\n\t\t\tY: [\n\t\t\t\t[ new Mesh( arrowGeometry, matGreen ), [ 0, 0.5, 0 ]],\n\t\t\t\t[ new Mesh( arrowGeometry, matGreen ), [ 0, - 0.5, 0 ], [ Math.PI, 0, 0 ]],\n\t\t\t\t[ new Mesh( lineGeometry2, matGreen ) ]\n\t\t\t],\n\t\t\tZ: [\n\t\t\t\t[ new Mesh( arrowGeometry, matBlue ), [ 0, 0, 0.5 ], [ Math.PI / 2, 0, 0 ]],\n\t\t\t\t[ new Mesh( arrowGeometry, matBlue ), [ 0, 0, - 0.5 ], [ - Math.PI / 2, 0, 0 ]],\n\t\t\t\t[ new Mesh( lineGeometry2, matBlue ), null, [ Math.PI / 2, 0, 0 ]]\n\t\t\t],\n\t\t\tXYZ: [\n\t\t\t\t[ new Mesh( new OctahedronGeometry( 0.1, 0 ), matWhiteTransparent.clone() ), [ 0, 0, 0 ]]\n\t\t\t],\n\t\t\tXY: [\n\t\t\t\t[ new Mesh( new BoxGeometry( 0.15, 0.15, 0.01 ), matBlueTransparent.clone() ), [ 0.15, 0.15, 0 ]]\n\t\t\t],\n\t\t\tYZ: [\n\t\t\t\t[ new Mesh( new BoxGeometry( 0.15, 0.15, 0.01 ), matRedTransparent.clone() ), [ 0, 0.15, 0.15 ], [ 0, Math.PI / 2, 0 ]]\n\t\t\t],\n\t\t\tXZ: [\n\t\t\t\t[ new Mesh( new BoxGeometry( 0.15, 0.15, 0.01 ), matGreenTransparent.clone() ), [ 0.15, 0, 0.15 ], [ - Math.PI / 2, 0, 0 ]]\n\t\t\t]\n\t\t};\n\n\t\tconst pickerTranslate = {\n\t\t\tX: [\n\t\t\t\t[ new Mesh( new CylinderGeometry( 0.2, 0, 0.6, 4 ), matInvisible ), [ 0.3, 0, 0 ], [ 0, 0, - Math.PI / 2 ]],\n\t\t\t\t[ new Mesh( new CylinderGeometry( 0.2, 0, 0.6, 4 ), matInvisible ), [ - 0.3, 0, 0 ], [ 0, 0, Math.PI / 2 ]]\n\t\t\t],\n\t\t\tY: [\n\t\t\t\t[ new Mesh( new CylinderGeometry( 0.2, 0, 0.6, 4 ), matInvisible ), [ 0, 0.3, 0 ]],\n\t\t\t\t[ new Mesh( new CylinderGeometry( 0.2, 0, 0.6, 4 ), matInvisible ), [ 0, - 0.3, 0 ], [ 0, 0, Math.PI ]]\n\t\t\t],\n\t\t\tZ: [\n\t\t\t\t[ new Mesh( new CylinderGeometry( 0.2, 0, 0.6, 4 ), matInvisible ), [ 0, 0, 0.3 ], [ Math.PI / 2, 0, 0 ]],\n\t\t\t\t[ new Mesh( new CylinderGeometry( 0.2, 0, 0.6, 4 ), matInvisible ), [ 0, 0, - 0.3 ], [ - Math.PI / 2, 0, 0 ]]\n\t\t\t],\n\t\t\tXYZ: [\n\t\t\t\t[ new Mesh( new OctahedronGeometry( 0.2, 0 ), matInvisible ) ]\n\t\t\t],\n\t\t\tXY: [\n\t\t\t\t[ new Mesh( new BoxGeometry( 0.2, 0.2, 0.01 ), matInvisible ), [ 0.15, 0.15, 0 ]]\n\t\t\t],\n\t\t\tYZ: [\n\t\t\t\t[ new Mesh( new BoxGeometry( 0.2, 0.2, 0.01 ), matInvisible ), [ 0, 0.15, 0.15 ], [ 0, Math.PI / 2, 0 ]]\n\t\t\t],\n\t\t\tXZ: [\n\t\t\t\t[ new Mesh( new BoxGeometry( 0.2, 0.2, 0.01 ), matInvisible ), [ 0.15, 0, 0.15 ], [ - Math.PI / 2, 0, 0 ]]\n\t\t\t]\n\t\t};\n\n\t\tconst helperTranslate = {\n\t\t\tSTART: [\n\t\t\t\t[ new Mesh( new OctahedronGeometry( 0.01, 2 ), matHelper ), null, null, null, 'helper' ]\n\t\t\t],\n\t\t\tEND: [\n\t\t\t\t[ new Mesh( new OctahedronGeometry( 0.01, 2 ), matHelper ), null, null, null, 'helper' ]\n\t\t\t],\n\t\t\tDELTA: [\n\t\t\t\t[ new Line( TranslateHelperGeometry(), matHelper ), null, null, null, 'helper' ]\n\t\t\t],\n\t\t\tX: [\n\t\t\t\t[ new Line( lineGeometry, matHelper.clone() ), [ - 1e3, 0, 0 ], null, [ 1e6, 1, 1 ], 'helper' ]\n\t\t\t],\n\t\t\tY: [\n\t\t\t\t[ new Line( lineGeometry, matHelper.clone() ), [ 0, - 1e3, 0 ], [ 0, 0, Math.PI / 2 ], [ 1e6, 1, 1 ], 'helper' ]\n\t\t\t],\n\t\t\tZ: [\n\t\t\t\t[ new Line( lineGeometry, matHelper.clone() ), [ 0, 0, - 1e3 ], [ 0, - Math.PI / 2, 0 ], [ 1e6, 1, 1 ], 'helper' ]\n\t\t\t]\n\t\t};\n\n\t\tconst gizmoRotate = {\n\t\t\tXYZE: [\n\t\t\t\t[ new Mesh( CircleGeometry( 0.5, 1 ), matGray ), null, [ 0, Math.PI / 2, 0 ]]\n\t\t\t],\n\t\t\tX: [\n\t\t\t\t[ new Mesh( CircleGeometry( 0.5, 0.5 ), matRed ) ]\n\t\t\t],\n\t\t\tY: [\n\t\t\t\t[ new Mesh( CircleGeometry( 0.5, 0.5 ), matGreen ), null, [ 0, 0, - Math.PI / 2 ]]\n\t\t\t],\n\t\t\tZ: [\n\t\t\t\t[ new Mesh( CircleGeometry( 0.5, 0.5 ), matBlue ), null, [ 0, Math.PI / 2, 0 ]]\n\t\t\t],\n\t\t\tE: [\n\t\t\t\t[ new Mesh( CircleGeometry( 0.75, 1 ), matYellowTransparent ), null, [ 0, Math.PI / 2, 0 ]]\n\t\t\t]\n\t\t};\n\n\t\tconst helperRotate = {\n\t\t\tAXIS: [\n\t\t\t\t[ new Line( lineGeometry, matHelper.clone() ), [ - 1e3, 0, 0 ], null, [ 1e6, 1, 1 ], 'helper' ]\n\t\t\t]\n\t\t};\n\n\t\tconst pickerRotate = {\n\t\t\tXYZE: [\n\t\t\t\t[ new Mesh( new SphereGeometry( 0.25, 10, 8 ), matInvisible ) ]\n\t\t\t],\n\t\t\tX: [\n\t\t\t\t[ new Mesh( new TorusGeometry( 0.5, 0.1, 4, 24 ), matInvisible ), [ 0, 0, 0 ], [ 0, - Math.PI / 2, - Math.PI / 2 ]],\n\t\t\t],\n\t\t\tY: [\n\t\t\t\t[ new Mesh( new TorusGeometry( 0.5, 0.1, 4, 24 ), matInvisible ), [ 0, 0, 0 ], [ Math.PI / 2, 0, 0 ]],\n\t\t\t],\n\t\t\tZ: [\n\t\t\t\t[ new Mesh( new TorusGeometry( 0.5, 0.1, 4, 24 ), matInvisible ), [ 0, 0, 0 ], [ 0, 0, - Math.PI / 2 ]],\n\t\t\t],\n\t\t\tE: [\n\t\t\t\t[ new Mesh( new TorusGeometry( 0.75, 0.1, 2, 24 ), matInvisible ) ]\n\t\t\t]\n\t\t};\n\n\t\tconst gizmoScale = {\n\t\t\tX: [\n\t\t\t\t[ new Mesh( scaleHandleGeometry, matRed ), [ 0.5, 0, 0 ], [ 0, 0, - Math.PI / 2 ]],\n\t\t\t\t[ new Mesh( lineGeometry2, matRed ), [ 0, 0, 0 ], [ 0, 0, - Math.PI / 2 ]],\n\t\t\t\t[ new Mesh( scaleHandleGeometry, matRed ), [ - 0.5, 0, 0 ], [ 0, 0, Math.PI / 2 ]],\n\t\t\t],\n\t\t\tY: [\n\t\t\t\t[ new Mesh( scaleHandleGeometry, matGreen ), [ 0, 0.5, 0 ]],\n\t\t\t\t[ new Mesh( lineGeometry2, matGreen ) ],\n\t\t\t\t[ new Mesh( scaleHandleGeometry, matGreen ), [ 0, - 0.5, 0 ], [ 0, 0, Math.PI ]],\n\t\t\t],\n\t\t\tZ: [\n\t\t\t\t[ new Mesh( scaleHandleGeometry, matBlue ), [ 0, 0, 0.5 ], [ Math.PI / 2, 0, 0 ]],\n\t\t\t\t[ new Mesh( lineGeometry2, matBlue ), [ 0, 0, 0 ], [ Math.PI / 2, 0, 0 ]],\n\t\t\t\t[ new Mesh( scaleHandleGeometry, matBlue ), [ 0, 0, - 0.5 ], [ - Math.PI / 2, 0, 0 ]]\n\t\t\t],\n\t\t\tXY: [\n\t\t\t\t[ new Mesh( new BoxGeometry( 0.15, 0.15, 0.01 ), matBlueTransparent ), [ 0.15, 0.15, 0 ]]\n\t\t\t],\n\t\t\tYZ: [\n\t\t\t\t[ new Mesh( new BoxGeometry( 0.15, 0.15, 0.01 ), matRedTransparent ), [ 0, 0.15, 0.15 ], [ 0, Math.PI / 2, 0 ]]\n\t\t\t],\n\t\t\tXZ: [\n\t\t\t\t[ new Mesh( new BoxGeometry( 0.15, 0.15, 0.01 ), matGreenTransparent ), [ 0.15, 0, 0.15 ], [ - Math.PI / 2, 0, 0 ]]\n\t\t\t],\n\t\t\tXYZ: [\n\t\t\t\t[ new Mesh( new BoxGeometry( 0.1, 0.1, 0.1 ), matWhiteTransparent.clone() ) ],\n\t\t\t]\n\t\t};\n\n\t\tconst pickerScale = {\n\t\t\tX: [\n\t\t\t\t[ new Mesh( new CylinderGeometry( 0.2, 0, 0.6, 4 ), matInvisible ), [ 0.3, 0, 0 ], [ 0, 0, - Math.PI / 2 ]],\n\t\t\t\t[ new Mesh( new CylinderGeometry( 0.2, 0, 0.6, 4 ), matInvisible ), [ - 0.3, 0, 0 ], [ 0, 0, Math.PI / 2 ]]\n\t\t\t],\n\t\t\tY: [\n\t\t\t\t[ new Mesh( new CylinderGeometry( 0.2, 0, 0.6, 4 ), matInvisible ), [ 0, 0.3, 0 ]],\n\t\t\t\t[ new Mesh( new CylinderGeometry( 0.2, 0, 0.6, 4 ), matInvisible ), [ 0, - 0.3, 0 ], [ 0, 0, Math.PI ]]\n\t\t\t],\n\t\t\tZ: [\n\t\t\t\t[ new Mesh( new CylinderGeometry( 0.2, 0, 0.6, 4 ), matInvisible ), [ 0, 0, 0.3 ], [ Math.PI / 2, 0, 0 ]],\n\t\t\t\t[ new Mesh( new CylinderGeometry( 0.2, 0, 0.6, 4 ), matInvisible ), [ 0, 0, - 0.3 ], [ - Math.PI / 2, 0, 0 ]]\n\t\t\t],\n\t\t\tXY: [\n\t\t\t\t[ new Mesh( new BoxGeometry( 0.2, 0.2, 0.01 ), matInvisible ), [ 0.15, 0.15, 0 ]],\n\t\t\t],\n\t\t\tYZ: [\n\t\t\t\t[ new Mesh( new BoxGeometry( 0.2, 0.2, 0.01 ), matInvisible ), [ 0, 0.15, 0.15 ], [ 0, Math.PI / 2, 0 ]],\n\t\t\t],\n\t\t\tXZ: [\n\t\t\t\t[ new Mesh( new BoxGeometry( 0.2, 0.2, 0.01 ), matInvisible ), [ 0.15, 0, 0.15 ], [ - Math.PI / 2, 0, 0 ]],\n\t\t\t],\n\t\t\tXYZ: [\n\t\t\t\t[ new Mesh( new BoxGeometry( 0.2, 0.2, 0.2 ), matInvisible ), [ 0, 0, 0 ]],\n\t\t\t]\n\t\t};\n\n\t\tconst helperScale = {\n\t\t\tX: [\n\t\t\t\t[ new Line( lineGeometry, matHelper.clone() ), [ - 1e3, 0, 0 ], null, [ 1e6, 1, 1 ], 'helper' ]\n\t\t\t],\n\t\t\tY: [\n\t\t\t\t[ new Line( lineGeometry, matHelper.clone() ), [ 0, - 1e3, 0 ], [ 0, 0, Math.PI / 2 ], [ 1e6, 1, 1 ], 'helper' ]\n\t\t\t],\n\t\t\tZ: [\n\t\t\t\t[ new Line( lineGeometry, matHelper.clone() ), [ 0, 0, - 1e3 ], [ 0, - Math.PI / 2, 0 ], [ 1e6, 1, 1 ], 'helper' ]\n\t\t\t]\n\t\t};\n\n\t\t// Creates an Object3D with gizmos described in custom hierarchy definition.\n\n\t\tfunction setupGizmo( gizmoMap ) {\n\n\t\t\tconst gizmo = new Object3D();\n\n\t\t\tfor ( const name in gizmoMap ) {\n\n\t\t\t\tfor ( let i = gizmoMap[ name ].length; i --; ) {\n\n\t\t\t\t\tconst object = gizmoMap[ name ][ i ][ 0 ].clone();\n\t\t\t\t\tconst position = gizmoMap[ name ][ i ][ 1 ];\n\t\t\t\t\tconst rotation = gizmoMap[ name ][ i ][ 2 ];\n\t\t\t\t\tconst scale = gizmoMap[ name ][ i ][ 3 ];\n\t\t\t\t\tconst tag = gizmoMap[ name ][ i ][ 4 ];\n\n\t\t\t\t\t// name and tag properties are essential for picking and updating logic.\n\t\t\t\t\tobject.name = name;\n\t\t\t\t\tobject.tag = tag;\n\n\t\t\t\t\tif ( position ) {\n\n\t\t\t\t\t\tobject.position.set( position[ 0 ], position[ 1 ], position[ 2 ] );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( rotation ) {\n\n\t\t\t\t\t\tobject.rotation.set( rotation[ 0 ], rotation[ 1 ], rotation[ 2 ] );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( scale ) {\n\n\t\t\t\t\t\tobject.scale.set( scale[ 0 ], scale[ 1 ], scale[ 2 ] );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tobject.updateMatrix();\n\n\t\t\t\t\tconst tempGeometry = object.geometry.clone();\n\t\t\t\t\ttempGeometry.applyMatrix4( object.matrix );\n\t\t\t\t\tobject.geometry = tempGeometry;\n\t\t\t\t\tobject.renderOrder = Infinity;\n\n\t\t\t\t\tobject.position.set( 0, 0, 0 );\n\t\t\t\t\tobject.rotation.set( 0, 0, 0 );\n\t\t\t\t\tobject.scale.set( 1, 1, 1 );\n\n\t\t\t\t\tgizmo.add( object );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn gizmo;\n\n\t\t}\n\n\t\t// Gizmo creation\n\n\t\tthis.gizmo = {};\n\t\tthis.picker = {};\n\t\tthis.helper = {};\n\n\t\tthis.add( this.gizmo[ 'translate' ] = setupGizmo( gizmoTranslate ) );\n\t\tthis.add( this.gizmo[ 'rotate' ] = setupGizmo( gizmoRotate ) );\n\t\tthis.add( this.gizmo[ 'scale' ] = setupGizmo( gizmoScale ) );\n\t\tthis.add( this.picker[ 'translate' ] = setupGizmo( pickerTranslate ) );\n\t\tthis.add( this.picker[ 'rotate' ] = setupGizmo( pickerRotate ) );\n\t\tthis.add( this.picker[ 'scale' ] = setupGizmo( pickerScale ) );\n\t\tthis.add( this.helper[ 'translate' ] = setupGizmo( helperTranslate ) );\n\t\tthis.add( this.helper[ 'rotate' ] = setupGizmo( helperRotate ) );\n\t\tthis.add( this.helper[ 'scale' ] = setupGizmo( helperScale ) );\n\n\t\t// Pickers should be hidden always\n\n\t\tthis.picker[ 'translate' ].visible = false;\n\t\tthis.picker[ 'rotate' ].visible = false;\n\t\tthis.picker[ 'scale' ].visible = false;\n\n\t}\n\n\t// updateMatrixWorld will update transformations and appearance of individual handles\n\n\tupdateMatrixWorld( force ) {\n\n\t\tconst space = ( this.mode === 'scale' ) ? 'local' : this.space; // scale always oriented to local rotation\n\n\t\tconst quaternion = ( space === 'local' ) ? this.worldQuaternion : _identityQuaternion;\n\n\t\t// Show only gizmos for current transform mode\n\n\t\tthis.gizmo[ 'translate' ].visible = this.mode === 'translate';\n\t\tthis.gizmo[ 'rotate' ].visible = this.mode === 'rotate';\n\t\tthis.gizmo[ 'scale' ].visible = this.mode === 'scale';\n\n\t\tthis.helper[ 'translate' ].visible = this.mode === 'translate';\n\t\tthis.helper[ 'rotate' ].visible = this.mode === 'rotate';\n\t\tthis.helper[ 'scale' ].visible = this.mode === 'scale';\n\n\n\t\tlet handles = [];\n\t\thandles = handles.concat( this.picker[ this.mode ].children );\n\t\thandles = handles.concat( this.gizmo[ this.mode ].children );\n\t\thandles = handles.concat( this.helper[ this.mode ].children );\n\n\t\tfor ( let i = 0; i < handles.length; i ++ ) {\n\n\t\t\tconst handle = handles[ i ];\n\n\t\t\t// hide aligned to camera\n\n\t\t\thandle.visible = true;\n\t\t\thandle.rotation.set( 0, 0, 0 );\n\t\t\thandle.position.copy( this.worldPosition );\n\n\t\t\tlet factor;\n\n\t\t\tif ( this.camera.isOrthographicCamera ) {\n\n\t\t\t\tfactor = ( this.camera.top - this.camera.bottom ) / this.camera.zoom;\n\n\t\t\t} else {\n\n\t\t\t\tfactor = this.worldPosition.distanceTo( this.cameraPosition ) * Math.min( 1.9 * Math.tan( Math.PI * this.camera.fov / 360 ) / this.camera.zoom, 7 );\n\n\t\t\t}\n\n\t\t\thandle.scale.set( 1, 1, 1 ).multiplyScalar( factor * this.size / 4 );\n\n\t\t\t// TODO: simplify helpers and consider decoupling from gizmo\n\n\t\t\tif ( handle.tag === 'helper' ) {\n\n\t\t\t\thandle.visible = false;\n\n\t\t\t\tif ( handle.name === 'AXIS' ) {\n\n\t\t\t\t\thandle.position.copy( this.worldPositionStart );\n\t\t\t\t\thandle.visible = !! this.axis;\n\n\t\t\t\t\tif ( this.axis === 'X' ) {\n\n\t\t\t\t\t\t_tempQuaternion.setFromEuler( _tempEuler.set( 0, 0, 0 ) );\n\t\t\t\t\t\thandle.quaternion.copy( quaternion ).multiply( _tempQuaternion );\n\n\t\t\t\t\t\tif ( Math.abs( _alignVector.copy( _unitX ).applyQuaternion( quaternion ).dot( this.eye ) ) > 0.9 ) {\n\n\t\t\t\t\t\t\thandle.visible = false;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( this.axis === 'Y' ) {\n\n\t\t\t\t\t\t_tempQuaternion.setFromEuler( _tempEuler.set( 0, 0, Math.PI / 2 ) );\n\t\t\t\t\t\thandle.quaternion.copy( quaternion ).multiply( _tempQuaternion );\n\n\t\t\t\t\t\tif ( Math.abs( _alignVector.copy( _unitY ).applyQuaternion( quaternion ).dot( this.eye ) ) > 0.9 ) {\n\n\t\t\t\t\t\t\thandle.visible = false;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( this.axis === 'Z' ) {\n\n\t\t\t\t\t\t_tempQuaternion.setFromEuler( _tempEuler.set( 0, Math.PI / 2, 0 ) );\n\t\t\t\t\t\thandle.quaternion.copy( quaternion ).multiply( _tempQuaternion );\n\n\t\t\t\t\t\tif ( Math.abs( _alignVector.copy( _unitZ ).applyQuaternion( quaternion ).dot( this.eye ) ) > 0.9 ) {\n\n\t\t\t\t\t\t\thandle.visible = false;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( this.axis === 'XYZE' ) {\n\n\t\t\t\t\t\t_tempQuaternion.setFromEuler( _tempEuler.set( 0, Math.PI / 2, 0 ) );\n\t\t\t\t\t\t_alignVector.copy( this.rotationAxis );\n\t\t\t\t\t\thandle.quaternion.setFromRotationMatrix( _lookAtMatrix.lookAt( _zeroVector, _alignVector, _unitY ) );\n\t\t\t\t\t\thandle.quaternion.multiply( _tempQuaternion );\n\t\t\t\t\t\thandle.visible = this.dragging;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( this.axis === 'E' ) {\n\n\t\t\t\t\t\thandle.visible = false;\n\n\t\t\t\t\t}\n\n\n\t\t\t\t} else if ( handle.name === 'START' ) {\n\n\t\t\t\t\thandle.position.copy( this.worldPositionStart );\n\t\t\t\t\thandle.visible = this.dragging;\n\n\t\t\t\t} else if ( handle.name === 'END' ) {\n\n\t\t\t\t\thandle.position.copy( this.worldPosition );\n\t\t\t\t\thandle.visible = this.dragging;\n\n\t\t\t\t} else if ( handle.name === 'DELTA' ) {\n\n\t\t\t\t\thandle.position.copy( this.worldPositionStart );\n\t\t\t\t\thandle.quaternion.copy( this.worldQuaternionStart );\n\t\t\t\t\t_tempVector.set( 1e-10, 1e-10, 1e-10 ).add( this.worldPositionStart ).sub( this.worldPosition ).multiplyScalar( - 1 );\n\t\t\t\t\t_tempVector.applyQuaternion( this.worldQuaternionStart.clone().invert() );\n\t\t\t\t\thandle.scale.copy( _tempVector );\n\t\t\t\t\thandle.visible = this.dragging;\n\n\t\t\t\t} else {\n\n\t\t\t\t\thandle.quaternion.copy( quaternion );\n\n\t\t\t\t\tif ( this.dragging ) {\n\n\t\t\t\t\t\thandle.position.copy( this.worldPositionStart );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\thandle.position.copy( this.worldPosition );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( this.axis ) {\n\n\t\t\t\t\t\thandle.visible = this.axis.search( handle.name ) !== - 1;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\t// If updating helper, skip rest of the loop\n\t\t\t\tcontinue;\n\n\t\t\t}\n\n\t\t\t// Align handles to current local or world rotation\n\n\t\t\thandle.quaternion.copy( quaternion );\n\n\t\t\tif ( this.mode === 'translate' || this.mode === 'scale' ) {\n\n\t\t\t\t// Hide translate and scale axis facing the camera\n\n\t\t\t\tconst AXIS_HIDE_TRESHOLD = 0.99;\n\t\t\t\tconst PLANE_HIDE_TRESHOLD = 0.2;\n\n\t\t\t\tif ( handle.name === 'X' ) {\n\n\t\t\t\t\tif ( Math.abs( _alignVector.copy( _unitX ).applyQuaternion( quaternion ).dot( this.eye ) ) > AXIS_HIDE_TRESHOLD ) {\n\n\t\t\t\t\t\thandle.scale.set( 1e-10, 1e-10, 1e-10 );\n\t\t\t\t\t\thandle.visible = false;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tif ( handle.name === 'Y' ) {\n\n\t\t\t\t\tif ( Math.abs( _alignVector.copy( _unitY ).applyQuaternion( quaternion ).dot( this.eye ) ) > AXIS_HIDE_TRESHOLD ) {\n\n\t\t\t\t\t\thandle.scale.set( 1e-10, 1e-10, 1e-10 );\n\t\t\t\t\t\thandle.visible = false;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tif ( handle.name === 'Z' ) {\n\n\t\t\t\t\tif ( Math.abs( _alignVector.copy( _unitZ ).applyQuaternion( quaternion ).dot( this.eye ) ) > AXIS_HIDE_TRESHOLD ) {\n\n\t\t\t\t\t\thandle.scale.set( 1e-10, 1e-10, 1e-10 );\n\t\t\t\t\t\thandle.visible = false;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tif ( handle.name === 'XY' ) {\n\n\t\t\t\t\tif ( Math.abs( _alignVector.copy( _unitZ ).applyQuaternion( quaternion ).dot( this.eye ) ) < PLANE_HIDE_TRESHOLD ) {\n\n\t\t\t\t\t\thandle.scale.set( 1e-10, 1e-10, 1e-10 );\n\t\t\t\t\t\thandle.visible = false;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tif ( handle.name === 'YZ' ) {\n\n\t\t\t\t\tif ( Math.abs( _alignVector.copy( _unitX ).applyQuaternion( quaternion ).dot( this.eye ) ) < PLANE_HIDE_TRESHOLD ) {\n\n\t\t\t\t\t\thandle.scale.set( 1e-10, 1e-10, 1e-10 );\n\t\t\t\t\t\thandle.visible = false;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tif ( handle.name === 'XZ' ) {\n\n\t\t\t\t\tif ( Math.abs( _alignVector.copy( _unitY ).applyQuaternion( quaternion ).dot( this.eye ) ) < PLANE_HIDE_TRESHOLD ) {\n\n\t\t\t\t\t\thandle.scale.set( 1e-10, 1e-10, 1e-10 );\n\t\t\t\t\t\thandle.visible = false;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t} else if ( this.mode === 'rotate' ) {\n\n\t\t\t\t// Align handles to current local or world rotation\n\n\t\t\t\t_tempQuaternion2.copy( quaternion );\n\t\t\t\t_alignVector.copy( this.eye ).applyQuaternion( _tempQuaternion.copy( quaternion ).invert() );\n\n\t\t\t\tif ( handle.name.search( 'E' ) !== - 1 ) {\n\n\t\t\t\t\thandle.quaternion.setFromRotationMatrix( _lookAtMatrix.lookAt( this.eye, _zeroVector, _unitY ) );\n\n\t\t\t\t}\n\n\t\t\t\tif ( handle.name === 'X' ) {\n\n\t\t\t\t\t_tempQuaternion.setFromAxisAngle( _unitX, Math.atan2( - _alignVector.y, _alignVector.z ) );\n\t\t\t\t\t_tempQuaternion.multiplyQuaternions( _tempQuaternion2, _tempQuaternion );\n\t\t\t\t\thandle.quaternion.copy( _tempQuaternion );\n\n\t\t\t\t}\n\n\t\t\t\tif ( handle.name === 'Y' ) {\n\n\t\t\t\t\t_tempQuaternion.setFromAxisAngle( _unitY, Math.atan2( _alignVector.x, _alignVector.z ) );\n\t\t\t\t\t_tempQuaternion.multiplyQuaternions( _tempQuaternion2, _tempQuaternion );\n\t\t\t\t\thandle.quaternion.copy( _tempQuaternion );\n\n\t\t\t\t}\n\n\t\t\t\tif ( handle.name === 'Z' ) {\n\n\t\t\t\t\t_tempQuaternion.setFromAxisAngle( _unitZ, Math.atan2( _alignVector.y, _alignVector.x ) );\n\t\t\t\t\t_tempQuaternion.multiplyQuaternions( _tempQuaternion2, _tempQuaternion );\n\t\t\t\t\thandle.quaternion.copy( _tempQuaternion );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// Hide disabled axes\n\t\t\thandle.visible = handle.visible && ( handle.name.indexOf( 'X' ) === - 1 || this.showX );\n\t\t\thandle.visible = handle.visible && ( handle.name.indexOf( 'Y' ) === - 1 || this.showY );\n\t\t\thandle.visible = handle.visible && ( handle.name.indexOf( 'Z' ) === - 1 || this.showZ );\n\t\t\thandle.visible = handle.visible && ( handle.name.indexOf( 'E' ) === - 1 || ( this.showX && this.showY && this.showZ ) );\n\n\t\t\t// highlight selected axis\n\n\t\t\thandle.material._color = handle.material._color || handle.material.color.clone();\n\t\t\thandle.material._opacity = handle.material._opacity || handle.material.opacity;\n\n\t\t\thandle.material.color.copy( handle.material._color );\n\t\t\thandle.material.opacity = handle.material._opacity;\n\n\t\t\tif ( this.enabled && this.axis ) {\n\n\t\t\t\tif ( handle.name === this.axis ) {\n\n\t\t\t\t\thandle.material.color.setHex( 0xffff00 );\n\t\t\t\t\thandle.material.opacity = 1.0;\n\n\t\t\t\t} else if ( this.axis.split( '' ).some( function ( a ) {\n\n\t\t\t\t\treturn handle.name === a;\n\n\t\t\t\t} ) ) {\n\n\t\t\t\t\thandle.material.color.setHex( 0xffff00 );\n\t\t\t\t\thandle.material.opacity = 1.0;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tsuper.updateMatrixWorld( force );\n\n\t}\n\n}\n\nTransformControlsGizmo.prototype.isTransformControlsGizmo = true;\n\n//\n\nclass TransformControlsPlane extends Mesh {\n\n\tconstructor() {\n\n\t\tsuper(\n\t\t\tnew PlaneGeometry( 100000, 100000, 2, 2 ),\n\t\t\tnew MeshBasicMaterial( { visible: false, wireframe: true, side: DoubleSide, transparent: true, opacity: 0.1, toneMapped: false } )\n\t\t);\n\n\t\tthis.type = 'TransformControlsPlane';\n\n\t}\n\n\tupdateMatrixWorld( force ) {\n\n\t\tlet space = this.space;\n\n\t\tthis.position.copy( this.worldPosition );\n\n\t\tif ( this.mode === 'scale' ) space = 'local'; // scale always oriented to local rotation\n\n\t\t_v1.copy( _unitX ).applyQuaternion( space === 'local' ? this.worldQuaternion : _identityQuaternion );\n\t\t_v2.copy( _unitY ).applyQuaternion( space === 'local' ? this.worldQuaternion : _identityQuaternion );\n\t\t_v3.copy( _unitZ ).applyQuaternion( space === 'local' ? this.worldQuaternion : _identityQuaternion );\n\n\t\t// Align the plane for current transform mode, axis and space.\n\n\t\t_alignVector.copy( _v2 );\n\n\t\tswitch ( this.mode ) {\n\n\t\t\tcase 'translate':\n\t\t\tcase 'scale':\n\t\t\t\tswitch ( this.axis ) {\n\n\t\t\t\t\tcase 'X':\n\t\t\t\t\t\t_alignVector.copy( this.eye ).cross( _v1 );\n\t\t\t\t\t\t_dirVector.copy( _v1 ).cross( _alignVector );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'Y':\n\t\t\t\t\t\t_alignVector.copy( this.eye ).cross( _v2 );\n\t\t\t\t\t\t_dirVector.copy( _v2 ).cross( _alignVector );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'Z':\n\t\t\t\t\t\t_alignVector.copy( this.eye ).cross( _v3 );\n\t\t\t\t\t\t_dirVector.copy( _v3 ).cross( _alignVector );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'XY':\n\t\t\t\t\t\t_dirVector.copy( _v3 );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'YZ':\n\t\t\t\t\t\t_dirVector.copy( _v1 );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'XZ':\n\t\t\t\t\t\t_alignVector.copy( _v3 );\n\t\t\t\t\t\t_dirVector.copy( _v2 );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'XYZ':\n\t\t\t\t\tcase 'E':\n\t\t\t\t\t\t_dirVector.set( 0, 0, 0 );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t\tcase 'rotate':\n\t\t\tdefault:\n\t\t\t\t// special case for rotate\n\t\t\t\t_dirVector.set( 0, 0, 0 );\n\n\t\t}\n\n\t\tif ( _dirVector.length() === 0 ) {\n\n\t\t\t// If in rotate mode, make the plane parallel to camera\n\t\t\tthis.quaternion.copy( this.cameraQuaternion );\n\n\t\t} else {\n\n\t\t\t_tempMatrix.lookAt( _tempVector.set( 0, 0, 0 ), _dirVector, _alignVector );\n\n\t\t\tthis.quaternion.setFromRotationMatrix( _tempMatrix );\n\n\t\t}\n\n\t\tsuper.updateMatrixWorld( force );\n\n\t}\n\n}\n\nTransformControlsPlane.prototype.isTransformControlsPlane = true;\n\nexport { TransformControls, TransformControlsGizmo, TransformControlsPlane };\n","/*!\nfflate - fast JavaScript compression/decompression\n<https://101arrowz.github.io/fflate>\nLicensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE\nversion 0.6.9\n*/\n\n// DEFLATE is a complex format; to read this code, you should probably check the RFC first:\n// https://tools.ietf.org/html/rfc1951\n// You may also wish to take a look at the guide I made about this program:\n// https://gist.github.com/101arrowz/253f31eb5abc3d9275ab943003ffecad\n// Some of the following code is similar to that of UZIP.js:\n// https://github.com/photopea/UZIP.js\n// However, the vast majority of the codebase has diverged from UZIP.js to increase performance and reduce bundle size.\n// Sometimes 0 will appear where -1 would be more appropriate. This is because using a uint\n// is better for memory in most engines (I *think*).\nvar ch2 = {};\nvar durl = function (c) { return URL.createObjectURL(new Blob([c], { type: 'text/javascript' })); };\nvar cwk = function (u) { return new Worker(u); };\ntry {\n    URL.revokeObjectURL(durl(''));\n}\ncatch (e) {\n    // We're in Deno or a very old browser\n    durl = function (c) { return 'data:application/javascript;charset=UTF-8,' + encodeURI(c); };\n    // If Deno, this is necessary; if not, this changes nothing\n    cwk = function (u) { return new Worker(u, { type: 'module' }); };\n}\nvar wk = (function (c, id, msg, transfer, cb) {\n    var w = cwk(ch2[id] || (ch2[id] = durl(c)));\n    w.onerror = function (e) { return cb(e.error, null); };\n    w.onmessage = function (e) { return cb(null, e.data); };\n    w.postMessage(msg, transfer);\n    return w;\n});\n\n// aliases for shorter compressed code (most minifers don't do this)\nvar u8 = Uint8Array, u16 = Uint16Array, u32 = Uint32Array;\n// fixed length extra bits\nvar fleb = new u8([0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, 0, /* unused */ 0, 0, /* impossible */ 0]);\n// fixed distance extra bits\n// see fleb note\nvar fdeb = new u8([0, 0, 0, 0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 9, 10, 10, 11, 11, 12, 12, 13, 13, /* unused */ 0, 0]);\n// code length index map\nvar clim = new u8([16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15]);\n// get base, reverse index map from extra bits\nvar freb = function (eb, start) {\n    var b = new u16(31);\n    for (var i = 0; i < 31; ++i) {\n        b[i] = start += 1 << eb[i - 1];\n    }\n    // numbers here are at max 18 bits\n    var r = new u32(b[30]);\n    for (var i = 1; i < 30; ++i) {\n        for (var j = b[i]; j < b[i + 1]; ++j) {\n            r[j] = ((j - b[i]) << 5) | i;\n        }\n    }\n    return [b, r];\n};\nvar _a = freb(fleb, 2), fl = _a[0], revfl = _a[1];\n// we can ignore the fact that the other numbers are wrong; they never happen anyway\nfl[28] = 258, revfl[258] = 28;\nvar _b = freb(fdeb, 0), fd = _b[0], revfd = _b[1];\n// map of value to reverse (assuming 16 bits)\nvar rev = new u16(32768);\nfor (var i = 0; i < 32768; ++i) {\n    // reverse table algorithm from SO\n    var x = ((i & 0xAAAA) >>> 1) | ((i & 0x5555) << 1);\n    x = ((x & 0xCCCC) >>> 2) | ((x & 0x3333) << 2);\n    x = ((x & 0xF0F0) >>> 4) | ((x & 0x0F0F) << 4);\n    rev[i] = (((x & 0xFF00) >>> 8) | ((x & 0x00FF) << 8)) >>> 1;\n}\n// create huffman tree from u8 \"map\": index -> code length for code index\n// mb (max bits) must be at most 15\n// TODO: optimize/split up?\nvar hMap = (function (cd, mb, r) {\n    var s = cd.length;\n    // index\n    var i = 0;\n    // u16 \"map\": index -> # of codes with bit length = index\n    var l = new u16(mb);\n    // length of cd must be 288 (total # of codes)\n    for (; i < s; ++i)\n        ++l[cd[i] - 1];\n    // u16 \"map\": index -> minimum code for bit length = index\n    var le = new u16(mb);\n    for (i = 0; i < mb; ++i) {\n        le[i] = (le[i - 1] + l[i - 1]) << 1;\n    }\n    var co;\n    if (r) {\n        // u16 \"map\": index -> number of actual bits, symbol for code\n        co = new u16(1 << mb);\n        // bits to remove for reverser\n        var rvb = 15 - mb;\n        for (i = 0; i < s; ++i) {\n            // ignore 0 lengths\n            if (cd[i]) {\n                // num encoding both symbol and bits read\n                var sv = (i << 4) | cd[i];\n                // free bits\n                var r_1 = mb - cd[i];\n                // start value\n                var v = le[cd[i] - 1]++ << r_1;\n                // m is end value\n                for (var m = v | ((1 << r_1) - 1); v <= m; ++v) {\n                    // every 16 bit value starting with the code yields the same result\n                    co[rev[v] >>> rvb] = sv;\n                }\n            }\n        }\n    }\n    else {\n        co = new u16(s);\n        for (i = 0; i < s; ++i) {\n            if (cd[i]) {\n                co[i] = rev[le[cd[i] - 1]++] >>> (15 - cd[i]);\n            }\n        }\n    }\n    return co;\n});\n// fixed length tree\nvar flt = new u8(288);\nfor (var i = 0; i < 144; ++i)\n    flt[i] = 8;\nfor (var i = 144; i < 256; ++i)\n    flt[i] = 9;\nfor (var i = 256; i < 280; ++i)\n    flt[i] = 7;\nfor (var i = 280; i < 288; ++i)\n    flt[i] = 8;\n// fixed distance tree\nvar fdt = new u8(32);\nfor (var i = 0; i < 32; ++i)\n    fdt[i] = 5;\n// fixed length map\nvar flm = /*#__PURE__*/ hMap(flt, 9, 0), flrm = /*#__PURE__*/ hMap(flt, 9, 1);\n// fixed distance map\nvar fdm = /*#__PURE__*/ hMap(fdt, 5, 0), fdrm = /*#__PURE__*/ hMap(fdt, 5, 1);\n// find max of array\nvar max = function (a) {\n    var m = a[0];\n    for (var i = 1; i < a.length; ++i) {\n        if (a[i] > m)\n            m = a[i];\n    }\n    return m;\n};\n// read d, starting at bit p and mask with m\nvar bits = function (d, p, m) {\n    var o = (p / 8) | 0;\n    return ((d[o] | (d[o + 1] << 8)) >> (p & 7)) & m;\n};\n// read d, starting at bit p continuing for at least 16 bits\nvar bits16 = function (d, p) {\n    var o = (p / 8) | 0;\n    return ((d[o] | (d[o + 1] << 8) | (d[o + 2] << 16)) >> (p & 7));\n};\n// get end of byte\nvar shft = function (p) { return ((p / 8) | 0) + (p & 7 && 1); };\n// typed array slice - allows garbage collector to free original reference,\n// while being more compatible than .slice\nvar slc = function (v, s, e) {\n    if (s == null || s < 0)\n        s = 0;\n    if (e == null || e > v.length)\n        e = v.length;\n    // can't use .constructor in case user-supplied\n    var n = new (v instanceof u16 ? u16 : v instanceof u32 ? u32 : u8)(e - s);\n    n.set(v.subarray(s, e));\n    return n;\n};\n// expands raw DEFLATE data\nvar inflt = function (dat, buf, st) {\n    // source length\n    var sl = dat.length;\n    if (!sl || (st && !st.l && sl < 5))\n        return buf || new u8(0);\n    // have to estimate size\n    var noBuf = !buf || st;\n    // no state\n    var noSt = !st || st.i;\n    if (!st)\n        st = {};\n    // Assumes roughly 33% compression ratio average\n    if (!buf)\n        buf = new u8(sl * 3);\n    // ensure buffer can fit at least l elements\n    var cbuf = function (l) {\n        var bl = buf.length;\n        // need to increase size to fit\n        if (l > bl) {\n            // Double or set to necessary, whichever is greater\n            var nbuf = new u8(Math.max(bl * 2, l));\n            nbuf.set(buf);\n            buf = nbuf;\n        }\n    };\n    //  last chunk         bitpos           bytes\n    var final = st.f || 0, pos = st.p || 0, bt = st.b || 0, lm = st.l, dm = st.d, lbt = st.m, dbt = st.n;\n    // total bits\n    var tbts = sl * 8;\n    do {\n        if (!lm) {\n            // BFINAL - this is only 1 when last chunk is next\n            st.f = final = bits(dat, pos, 1);\n            // type: 0 = no compression, 1 = fixed huffman, 2 = dynamic huffman\n            var type = bits(dat, pos + 1, 3);\n            pos += 3;\n            if (!type) {\n                // go to end of byte boundary\n                var s = shft(pos) + 4, l = dat[s - 4] | (dat[s - 3] << 8), t = s + l;\n                if (t > sl) {\n                    if (noSt)\n                        throw 'unexpected EOF';\n                    break;\n                }\n                // ensure size\n                if (noBuf)\n                    cbuf(bt + l);\n                // Copy over uncompressed data\n                buf.set(dat.subarray(s, t), bt);\n                // Get new bitpos, update byte count\n                st.b = bt += l, st.p = pos = t * 8;\n                continue;\n            }\n            else if (type == 1)\n                lm = flrm, dm = fdrm, lbt = 9, dbt = 5;\n            else if (type == 2) {\n                //  literal                            lengths\n                var hLit = bits(dat, pos, 31) + 257, hcLen = bits(dat, pos + 10, 15) + 4;\n                var tl = hLit + bits(dat, pos + 5, 31) + 1;\n                pos += 14;\n                // length+distance tree\n                var ldt = new u8(tl);\n                // code length tree\n                var clt = new u8(19);\n                for (var i = 0; i < hcLen; ++i) {\n                    // use index map to get real code\n                    clt[clim[i]] = bits(dat, pos + i * 3, 7);\n                }\n                pos += hcLen * 3;\n                // code lengths bits\n                var clb = max(clt), clbmsk = (1 << clb) - 1;\n                // code lengths map\n                var clm = hMap(clt, clb, 1);\n                for (var i = 0; i < tl;) {\n                    var r = clm[bits(dat, pos, clbmsk)];\n                    // bits read\n                    pos += r & 15;\n                    // symbol\n                    var s = r >>> 4;\n                    // code length to copy\n                    if (s < 16) {\n                        ldt[i++] = s;\n                    }\n                    else {\n                        //  copy   count\n                        var c = 0, n = 0;\n                        if (s == 16)\n                            n = 3 + bits(dat, pos, 3), pos += 2, c = ldt[i - 1];\n                        else if (s == 17)\n                            n = 3 + bits(dat, pos, 7), pos += 3;\n                        else if (s == 18)\n                            n = 11 + bits(dat, pos, 127), pos += 7;\n                        while (n--)\n                            ldt[i++] = c;\n                    }\n                }\n                //    length tree                 distance tree\n                var lt = ldt.subarray(0, hLit), dt = ldt.subarray(hLit);\n                // max length bits\n                lbt = max(lt);\n                // max dist bits\n                dbt = max(dt);\n                lm = hMap(lt, lbt, 1);\n                dm = hMap(dt, dbt, 1);\n            }\n            else\n                throw 'invalid block type';\n            if (pos > tbts) {\n                if (noSt)\n                    throw 'unexpected EOF';\n                break;\n            }\n        }\n        // Make sure the buffer can hold this + the largest possible addition\n        // Maximum chunk size (practically, theoretically infinite) is 2^17;\n        if (noBuf)\n            cbuf(bt + 131072);\n        var lms = (1 << lbt) - 1, dms = (1 << dbt) - 1;\n        var lpos = pos;\n        for (;; lpos = pos) {\n            // bits read, code\n            var c = lm[bits16(dat, pos) & lms], sym = c >>> 4;\n            pos += c & 15;\n            if (pos > tbts) {\n                if (noSt)\n                    throw 'unexpected EOF';\n                break;\n            }\n            if (!c)\n                throw 'invalid length/literal';\n            if (sym < 256)\n                buf[bt++] = sym;\n            else if (sym == 256) {\n                lpos = pos, lm = null;\n                break;\n            }\n            else {\n                var add = sym - 254;\n                // no extra bits needed if less\n                if (sym > 264) {\n                    // index\n                    var i = sym - 257, b = fleb[i];\n                    add = bits(dat, pos, (1 << b) - 1) + fl[i];\n                    pos += b;\n                }\n                // dist\n                var d = dm[bits16(dat, pos) & dms], dsym = d >>> 4;\n                if (!d)\n                    throw 'invalid distance';\n                pos += d & 15;\n                var dt = fd[dsym];\n                if (dsym > 3) {\n                    var b = fdeb[dsym];\n                    dt += bits16(dat, pos) & ((1 << b) - 1), pos += b;\n                }\n                if (pos > tbts) {\n                    if (noSt)\n                        throw 'unexpected EOF';\n                    break;\n                }\n                if (noBuf)\n                    cbuf(bt + 131072);\n                var end = bt + add;\n                for (; bt < end; bt += 4) {\n                    buf[bt] = buf[bt - dt];\n                    buf[bt + 1] = buf[bt + 1 - dt];\n                    buf[bt + 2] = buf[bt + 2 - dt];\n                    buf[bt + 3] = buf[bt + 3 - dt];\n                }\n                bt = end;\n            }\n        }\n        st.l = lm, st.p = lpos, st.b = bt;\n        if (lm)\n            final = 1, st.m = lbt, st.d = dm, st.n = dbt;\n    } while (!final);\n    return bt == buf.length ? buf : slc(buf, 0, bt);\n};\n// starting at p, write the minimum number of bits that can hold v to d\nvar wbits = function (d, p, v) {\n    v <<= p & 7;\n    var o = (p / 8) | 0;\n    d[o] |= v;\n    d[o + 1] |= v >>> 8;\n};\n// starting at p, write the minimum number of bits (>8) that can hold v to d\nvar wbits16 = function (d, p, v) {\n    v <<= p & 7;\n    var o = (p / 8) | 0;\n    d[o] |= v;\n    d[o + 1] |= v >>> 8;\n    d[o + 2] |= v >>> 16;\n};\n// creates code lengths from a frequency table\nvar hTree = function (d, mb) {\n    // Need extra info to make a tree\n    var t = [];\n    for (var i = 0; i < d.length; ++i) {\n        if (d[i])\n            t.push({ s: i, f: d[i] });\n    }\n    var s = t.length;\n    var t2 = t.slice();\n    if (!s)\n        return [et, 0];\n    if (s == 1) {\n        var v = new u8(t[0].s + 1);\n        v[t[0].s] = 1;\n        return [v, 1];\n    }\n    t.sort(function (a, b) { return a.f - b.f; });\n    // after i2 reaches last ind, will be stopped\n    // freq must be greater than largest possible number of symbols\n    t.push({ s: -1, f: 25001 });\n    var l = t[0], r = t[1], i0 = 0, i1 = 1, i2 = 2;\n    t[0] = { s: -1, f: l.f + r.f, l: l, r: r };\n    // efficient algorithm from UZIP.js\n    // i0 is lookbehind, i2 is lookahead - after processing two low-freq\n    // symbols that combined have high freq, will start processing i2 (high-freq,\n    // non-composite) symbols instead\n    // see https://reddit.com/r/photopea/comments/ikekht/uzipjs_questions/\n    while (i1 != s - 1) {\n        l = t[t[i0].f < t[i2].f ? i0++ : i2++];\n        r = t[i0 != i1 && t[i0].f < t[i2].f ? i0++ : i2++];\n        t[i1++] = { s: -1, f: l.f + r.f, l: l, r: r };\n    }\n    var maxSym = t2[0].s;\n    for (var i = 1; i < s; ++i) {\n        if (t2[i].s > maxSym)\n            maxSym = t2[i].s;\n    }\n    // code lengths\n    var tr = new u16(maxSym + 1);\n    // max bits in tree\n    var mbt = ln(t[i1 - 1], tr, 0);\n    if (mbt > mb) {\n        // more algorithms from UZIP.js\n        // TODO: find out how this code works (debt)\n        //  ind    debt\n        var i = 0, dt = 0;\n        //    left            cost\n        var lft = mbt - mb, cst = 1 << lft;\n        t2.sort(function (a, b) { return tr[b.s] - tr[a.s] || a.f - b.f; });\n        for (; i < s; ++i) {\n            var i2_1 = t2[i].s;\n            if (tr[i2_1] > mb) {\n                dt += cst - (1 << (mbt - tr[i2_1]));\n                tr[i2_1] = mb;\n            }\n            else\n                break;\n        }\n        dt >>>= lft;\n        while (dt > 0) {\n            var i2_2 = t2[i].s;\n            if (tr[i2_2] < mb)\n                dt -= 1 << (mb - tr[i2_2]++ - 1);\n            else\n                ++i;\n        }\n        for (; i >= 0 && dt; --i) {\n            var i2_3 = t2[i].s;\n            if (tr[i2_3] == mb) {\n                --tr[i2_3];\n                ++dt;\n            }\n        }\n        mbt = mb;\n    }\n    return [new u8(tr), mbt];\n};\n// get the max length and assign length codes\nvar ln = function (n, l, d) {\n    return n.s == -1\n        ? Math.max(ln(n.l, l, d + 1), ln(n.r, l, d + 1))\n        : (l[n.s] = d);\n};\n// length codes generation\nvar lc = function (c) {\n    var s = c.length;\n    // Note that the semicolon was intentional\n    while (s && !c[--s])\n        ;\n    var cl = new u16(++s);\n    //  ind      num         streak\n    var cli = 0, cln = c[0], cls = 1;\n    var w = function (v) { cl[cli++] = v; };\n    for (var i = 1; i <= s; ++i) {\n        if (c[i] == cln && i != s)\n            ++cls;\n        else {\n            if (!cln && cls > 2) {\n                for (; cls > 138; cls -= 138)\n                    w(32754);\n                if (cls > 2) {\n                    w(cls > 10 ? ((cls - 11) << 5) | 28690 : ((cls - 3) << 5) | 12305);\n                    cls = 0;\n                }\n            }\n            else if (cls > 3) {\n                w(cln), --cls;\n                for (; cls > 6; cls -= 6)\n                    w(8304);\n                if (cls > 2)\n                    w(((cls - 3) << 5) | 8208), cls = 0;\n            }\n            while (cls--)\n                w(cln);\n            cls = 1;\n            cln = c[i];\n        }\n    }\n    return [cl.subarray(0, cli), s];\n};\n// calculate the length of output from tree, code lengths\nvar clen = function (cf, cl) {\n    var l = 0;\n    for (var i = 0; i < cl.length; ++i)\n        l += cf[i] * cl[i];\n    return l;\n};\n// writes a fixed block\n// returns the new bit pos\nvar wfblk = function (out, pos, dat) {\n    // no need to write 00 as type: TypedArray defaults to 0\n    var s = dat.length;\n    var o = shft(pos + 2);\n    out[o] = s & 255;\n    out[o + 1] = s >>> 8;\n    out[o + 2] = out[o] ^ 255;\n    out[o + 3] = out[o + 1] ^ 255;\n    for (var i = 0; i < s; ++i)\n        out[o + i + 4] = dat[i];\n    return (o + 4 + s) * 8;\n};\n// writes a block\nvar wblk = function (dat, out, final, syms, lf, df, eb, li, bs, bl, p) {\n    wbits(out, p++, final);\n    ++lf[256];\n    var _a = hTree(lf, 15), dlt = _a[0], mlb = _a[1];\n    var _b = hTree(df, 15), ddt = _b[0], mdb = _b[1];\n    var _c = lc(dlt), lclt = _c[0], nlc = _c[1];\n    var _d = lc(ddt), lcdt = _d[0], ndc = _d[1];\n    var lcfreq = new u16(19);\n    for (var i = 0; i < lclt.length; ++i)\n        lcfreq[lclt[i] & 31]++;\n    for (var i = 0; i < lcdt.length; ++i)\n        lcfreq[lcdt[i] & 31]++;\n    var _e = hTree(lcfreq, 7), lct = _e[0], mlcb = _e[1];\n    var nlcc = 19;\n    for (; nlcc > 4 && !lct[clim[nlcc - 1]]; --nlcc)\n        ;\n    var flen = (bl + 5) << 3;\n    var ftlen = clen(lf, flt) + clen(df, fdt) + eb;\n    var dtlen = clen(lf, dlt) + clen(df, ddt) + eb + 14 + 3 * nlcc + clen(lcfreq, lct) + (2 * lcfreq[16] + 3 * lcfreq[17] + 7 * lcfreq[18]);\n    if (flen <= ftlen && flen <= dtlen)\n        return wfblk(out, p, dat.subarray(bs, bs + bl));\n    var lm, ll, dm, dl;\n    wbits(out, p, 1 + (dtlen < ftlen)), p += 2;\n    if (dtlen < ftlen) {\n        lm = hMap(dlt, mlb, 0), ll = dlt, dm = hMap(ddt, mdb, 0), dl = ddt;\n        var llm = hMap(lct, mlcb, 0);\n        wbits(out, p, nlc - 257);\n        wbits(out, p + 5, ndc - 1);\n        wbits(out, p + 10, nlcc - 4);\n        p += 14;\n        for (var i = 0; i < nlcc; ++i)\n            wbits(out, p + 3 * i, lct[clim[i]]);\n        p += 3 * nlcc;\n        var lcts = [lclt, lcdt];\n        for (var it = 0; it < 2; ++it) {\n            var clct = lcts[it];\n            for (var i = 0; i < clct.length; ++i) {\n                var len = clct[i] & 31;\n                wbits(out, p, llm[len]), p += lct[len];\n                if (len > 15)\n                    wbits(out, p, (clct[i] >>> 5) & 127), p += clct[i] >>> 12;\n            }\n        }\n    }\n    else {\n        lm = flm, ll = flt, dm = fdm, dl = fdt;\n    }\n    for (var i = 0; i < li; ++i) {\n        if (syms[i] > 255) {\n            var len = (syms[i] >>> 18) & 31;\n            wbits16(out, p, lm[len + 257]), p += ll[len + 257];\n            if (len > 7)\n                wbits(out, p, (syms[i] >>> 23) & 31), p += fleb[len];\n            var dst = syms[i] & 31;\n            wbits16(out, p, dm[dst]), p += dl[dst];\n            if (dst > 3)\n                wbits16(out, p, (syms[i] >>> 5) & 8191), p += fdeb[dst];\n        }\n        else {\n            wbits16(out, p, lm[syms[i]]), p += ll[syms[i]];\n        }\n    }\n    wbits16(out, p, lm[256]);\n    return p + ll[256];\n};\n// deflate options (nice << 13) | chain\nvar deo = /*#__PURE__*/ new u32([65540, 131080, 131088, 131104, 262176, 1048704, 1048832, 2114560, 2117632]);\n// empty\nvar et = /*#__PURE__*/ new u8(0);\n// compresses data into a raw DEFLATE buffer\nvar dflt = function (dat, lvl, plvl, pre, post, lst) {\n    var s = dat.length;\n    var o = new u8(pre + s + 5 * (1 + Math.ceil(s / 7000)) + post);\n    // writing to this writes to the output buffer\n    var w = o.subarray(pre, o.length - post);\n    var pos = 0;\n    if (!lvl || s < 8) {\n        for (var i = 0; i <= s; i += 65535) {\n            // end\n            var e = i + 65535;\n            if (e < s) {\n                // write full block\n                pos = wfblk(w, pos, dat.subarray(i, e));\n            }\n            else {\n                // write final block\n                w[i] = lst;\n                pos = wfblk(w, pos, dat.subarray(i, s));\n            }\n        }\n    }\n    else {\n        var opt = deo[lvl - 1];\n        var n = opt >>> 13, c = opt & 8191;\n        var msk_1 = (1 << plvl) - 1;\n        //    prev 2-byte val map    curr 2-byte val map\n        var prev = new u16(32768), head = new u16(msk_1 + 1);\n        var bs1_1 = Math.ceil(plvl / 3), bs2_1 = 2 * bs1_1;\n        var hsh = function (i) { return (dat[i] ^ (dat[i + 1] << bs1_1) ^ (dat[i + 2] << bs2_1)) & msk_1; };\n        // 24576 is an arbitrary number of maximum symbols per block\n        // 424 buffer for last block\n        var syms = new u32(25000);\n        // length/literal freq   distance freq\n        var lf = new u16(288), df = new u16(32);\n        //  l/lcnt  exbits  index  l/lind  waitdx  bitpos\n        var lc_1 = 0, eb = 0, i = 0, li = 0, wi = 0, bs = 0;\n        for (; i < s; ++i) {\n            // hash value\n            // deopt when i > s - 3 - at end, deopt acceptable\n            var hv = hsh(i);\n            // index mod 32768    previous index mod\n            var imod = i & 32767, pimod = head[hv];\n            prev[imod] = pimod;\n            head[hv] = imod;\n            // We always should modify head and prev, but only add symbols if\n            // this data is not yet processed (\"wait\" for wait index)\n            if (wi <= i) {\n                // bytes remaining\n                var rem = s - i;\n                if ((lc_1 > 7000 || li > 24576) && rem > 423) {\n                    pos = wblk(dat, w, 0, syms, lf, df, eb, li, bs, i - bs, pos);\n                    li = lc_1 = eb = 0, bs = i;\n                    for (var j = 0; j < 286; ++j)\n                        lf[j] = 0;\n                    for (var j = 0; j < 30; ++j)\n                        df[j] = 0;\n                }\n                //  len    dist   chain\n                var l = 2, d = 0, ch_1 = c, dif = (imod - pimod) & 32767;\n                if (rem > 2 && hv == hsh(i - dif)) {\n                    var maxn = Math.min(n, rem) - 1;\n                    var maxd = Math.min(32767, i);\n                    // max possible length\n                    // not capped at dif because decompressors implement \"rolling\" index population\n                    var ml = Math.min(258, rem);\n                    while (dif <= maxd && --ch_1 && imod != pimod) {\n                        if (dat[i + l] == dat[i + l - dif]) {\n                            var nl = 0;\n                            for (; nl < ml && dat[i + nl] == dat[i + nl - dif]; ++nl)\n                                ;\n                            if (nl > l) {\n                                l = nl, d = dif;\n                                // break out early when we reach \"nice\" (we are satisfied enough)\n                                if (nl > maxn)\n                                    break;\n                                // now, find the rarest 2-byte sequence within this\n                                // length of literals and search for that instead.\n                                // Much faster than just using the start\n                                var mmd = Math.min(dif, nl - 2);\n                                var md = 0;\n                                for (var j = 0; j < mmd; ++j) {\n                                    var ti = (i - dif + j + 32768) & 32767;\n                                    var pti = prev[ti];\n                                    var cd = (ti - pti + 32768) & 32767;\n                                    if (cd > md)\n                                        md = cd, pimod = ti;\n                                }\n                            }\n                        }\n                        // check the previous match\n                        imod = pimod, pimod = prev[imod];\n                        dif += (imod - pimod + 32768) & 32767;\n                    }\n                }\n                // d will be nonzero only when a match was found\n                if (d) {\n                    // store both dist and len data in one Uint32\n                    // Make sure this is recognized as a len/dist with 28th bit (2^28)\n                    syms[li++] = 268435456 | (revfl[l] << 18) | revfd[d];\n                    var lin = revfl[l] & 31, din = revfd[d] & 31;\n                    eb += fleb[lin] + fdeb[din];\n                    ++lf[257 + lin];\n                    ++df[din];\n                    wi = i + l;\n                    ++lc_1;\n                }\n                else {\n                    syms[li++] = dat[i];\n                    ++lf[dat[i]];\n                }\n            }\n        }\n        pos = wblk(dat, w, lst, syms, lf, df, eb, li, bs, i - bs, pos);\n        // this is the easiest way to avoid needing to maintain state\n        if (!lst && pos & 7)\n            pos = wfblk(w, pos + 1, et);\n    }\n    return slc(o, 0, pre + shft(pos) + post);\n};\n// CRC32 table\nvar crct = /*#__PURE__*/ (function () {\n    var t = new u32(256);\n    for (var i = 0; i < 256; ++i) {\n        var c = i, k = 9;\n        while (--k)\n            c = ((c & 1) && 0xEDB88320) ^ (c >>> 1);\n        t[i] = c;\n    }\n    return t;\n})();\n// CRC32\nvar crc = function () {\n    var c = -1;\n    return {\n        p: function (d) {\n            // closures have awful performance\n            var cr = c;\n            for (var i = 0; i < d.length; ++i)\n                cr = crct[(cr & 255) ^ d[i]] ^ (cr >>> 8);\n            c = cr;\n        },\n        d: function () { return ~c; }\n    };\n};\n// Alder32\nvar adler = function () {\n    var a = 1, b = 0;\n    return {\n        p: function (d) {\n            // closures have awful performance\n            var n = a, m = b;\n            var l = d.length;\n            for (var i = 0; i != l;) {\n                var e = Math.min(i + 2655, l);\n                for (; i < e; ++i)\n                    m += n += d[i];\n                n = (n & 65535) + 15 * (n >> 16), m = (m & 65535) + 15 * (m >> 16);\n            }\n            a = n, b = m;\n        },\n        d: function () {\n            a %= 65521, b %= 65521;\n            return (a & 255) << 24 | (a >>> 8) << 16 | (b & 255) << 8 | (b >>> 8);\n        }\n    };\n};\n;\n// deflate with opts\nvar dopt = function (dat, opt, pre, post, st) {\n    return dflt(dat, opt.level == null ? 6 : opt.level, opt.mem == null ? Math.ceil(Math.max(8, Math.min(13, Math.log(dat.length))) * 1.5) : (12 + opt.mem), pre, post, !st);\n};\n// Walmart object spread\nvar mrg = function (a, b) {\n    var o = {};\n    for (var k in a)\n        o[k] = a[k];\n    for (var k in b)\n        o[k] = b[k];\n    return o;\n};\n// worker clone\n// This is possibly the craziest part of the entire codebase, despite how simple it may seem.\n// The only parameter to this function is a closure that returns an array of variables outside of the function scope.\n// We're going to try to figure out the variable names used in the closure as strings because that is crucial for workerization.\n// We will return an object mapping of true variable name to value (basically, the current scope as a JS object).\n// The reason we can't just use the original variable names is minifiers mangling the toplevel scope.\n// This took me three weeks to figure out how to do.\nvar wcln = function (fn, fnStr, td) {\n    var dt = fn();\n    var st = fn.toString();\n    var ks = st.slice(st.indexOf('[') + 1, st.lastIndexOf(']')).replace(/ /g, '').split(',');\n    for (var i = 0; i < dt.length; ++i) {\n        var v = dt[i], k = ks[i];\n        if (typeof v == 'function') {\n            fnStr += ';' + k + '=';\n            var st_1 = v.toString();\n            if (v.prototype) {\n                // for global objects\n                if (st_1.indexOf('[native code]') != -1) {\n                    var spInd = st_1.indexOf(' ', 8) + 1;\n                    fnStr += st_1.slice(spInd, st_1.indexOf('(', spInd));\n                }\n                else {\n                    fnStr += st_1;\n                    for (var t in v.prototype)\n                        fnStr += ';' + k + '.prototype.' + t + '=' + v.prototype[t].toString();\n                }\n            }\n            else\n                fnStr += st_1;\n        }\n        else\n            td[k] = v;\n    }\n    return [fnStr, td];\n};\nvar ch = [];\n// clone bufs\nvar cbfs = function (v) {\n    var tl = [];\n    for (var k in v) {\n        if (v[k] instanceof u8 || v[k] instanceof u16 || v[k] instanceof u32)\n            tl.push((v[k] = new v[k].constructor(v[k])).buffer);\n    }\n    return tl;\n};\n// use a worker to execute code\nvar wrkr = function (fns, init, id, cb) {\n    var _a;\n    if (!ch[id]) {\n        var fnStr = '', td_1 = {}, m = fns.length - 1;\n        for (var i = 0; i < m; ++i)\n            _a = wcln(fns[i], fnStr, td_1), fnStr = _a[0], td_1 = _a[1];\n        ch[id] = wcln(fns[m], fnStr, td_1);\n    }\n    var td = mrg({}, ch[id][1]);\n    return wk(ch[id][0] + ';onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage=' + init.toString() + '}', id, td, cbfs(td), cb);\n};\n// base async inflate fn\nvar bInflt = function () { return [u8, u16, u32, fleb, fdeb, clim, fl, fd, flrm, fdrm, rev, hMap, max, bits, bits16, shft, slc, inflt, inflateSync, pbf, gu8]; };\nvar bDflt = function () { return [u8, u16, u32, fleb, fdeb, clim, revfl, revfd, flm, flt, fdm, fdt, rev, deo, et, hMap, wbits, wbits16, hTree, ln, lc, clen, wfblk, wblk, shft, slc, dflt, dopt, deflateSync, pbf]; };\n// gzip extra\nvar gze = function () { return [gzh, gzhl, wbytes, crc, crct]; };\n// gunzip extra\nvar guze = function () { return [gzs, gzl]; };\n// zlib extra\nvar zle = function () { return [zlh, wbytes, adler]; };\n// unzlib extra\nvar zule = function () { return [zlv]; };\n// post buf\nvar pbf = function (msg) { return postMessage(msg, [msg.buffer]); };\n// get u8\nvar gu8 = function (o) { return o && o.size && new u8(o.size); };\n// async helper\nvar cbify = function (dat, opts, fns, init, id, cb) {\n    var w = wrkr(fns, init, id, function (err, dat) {\n        w.terminate();\n        cb(err, dat);\n    });\n    w.postMessage([dat, opts], opts.consume ? [dat.buffer] : []);\n    return function () { w.terminate(); };\n};\n// auto stream\nvar astrm = function (strm) {\n    strm.ondata = function (dat, final) { return postMessage([dat, final], [dat.buffer]); };\n    return function (ev) { return strm.push(ev.data[0], ev.data[1]); };\n};\n// async stream attach\nvar astrmify = function (fns, strm, opts, init, id) {\n    var t;\n    var w = wrkr(fns, init, id, function (err, dat) {\n        if (err)\n            w.terminate(), strm.ondata.call(strm, err);\n        else {\n            if (dat[1])\n                w.terminate();\n            strm.ondata.call(strm, err, dat[0], dat[1]);\n        }\n    });\n    w.postMessage(opts);\n    strm.push = function (d, f) {\n        if (t)\n            throw 'stream finished';\n        if (!strm.ondata)\n            throw 'no stream handler';\n        w.postMessage([d, t = f], [d.buffer]);\n    };\n    strm.terminate = function () { w.terminate(); };\n};\n// read 2 bytes\nvar b2 = function (d, b) { return d[b] | (d[b + 1] << 8); };\n// read 4 bytes\nvar b4 = function (d, b) { return (d[b] | (d[b + 1] << 8) | (d[b + 2] << 16) | (d[b + 3] << 24)) >>> 0; };\nvar b8 = function (d, b) { return b4(d, b) + (b4(d, b + 4) * 4294967296); };\n// write bytes\nvar wbytes = function (d, b, v) {\n    for (; v; ++b)\n        d[b] = v, v >>>= 8;\n};\n// gzip header\nvar gzh = function (c, o) {\n    var fn = o.filename;\n    c[0] = 31, c[1] = 139, c[2] = 8, c[8] = o.level < 2 ? 4 : o.level == 9 ? 2 : 0, c[9] = 3; // assume Unix\n    if (o.mtime != 0)\n        wbytes(c, 4, Math.floor(new Date(o.mtime || Date.now()) / 1000));\n    if (fn) {\n        c[3] = 8;\n        for (var i = 0; i <= fn.length; ++i)\n            c[i + 10] = fn.charCodeAt(i);\n    }\n};\n// gzip footer: -8 to -4 = CRC, -4 to -0 is length\n// gzip start\nvar gzs = function (d) {\n    if (d[0] != 31 || d[1] != 139 || d[2] != 8)\n        throw 'invalid gzip data';\n    var flg = d[3];\n    var st = 10;\n    if (flg & 4)\n        st += d[10] | (d[11] << 8) + 2;\n    for (var zs = (flg >> 3 & 1) + (flg >> 4 & 1); zs > 0; zs -= !d[st++])\n        ;\n    return st + (flg & 2);\n};\n// gzip length\nvar gzl = function (d) {\n    var l = d.length;\n    return ((d[l - 4] | d[l - 3] << 8 | d[l - 2] << 16) | (d[l - 1] << 24)) >>> 0;\n};\n// gzip header length\nvar gzhl = function (o) { return 10 + ((o.filename && (o.filename.length + 1)) || 0); };\n// zlib header\nvar zlh = function (c, o) {\n    var lv = o.level, fl = lv == 0 ? 0 : lv < 6 ? 1 : lv == 9 ? 3 : 2;\n    c[0] = 120, c[1] = (fl << 6) | (fl ? (32 - 2 * fl) : 1);\n};\n// zlib valid\nvar zlv = function (d) {\n    if ((d[0] & 15) != 8 || (d[0] >>> 4) > 7 || ((d[0] << 8 | d[1]) % 31))\n        throw 'invalid zlib data';\n    if (d[1] & 32)\n        throw 'invalid zlib data: preset dictionaries not supported';\n};\nfunction AsyncCmpStrm(opts, cb) {\n    if (!cb && typeof opts == 'function')\n        cb = opts, opts = {};\n    this.ondata = cb;\n    return opts;\n}\n// zlib footer: -4 to -0 is Adler32\n/**\n * Streaming DEFLATE compression\n */\nvar Deflate = /*#__PURE__*/ (function () {\n    function Deflate(opts, cb) {\n        if (!cb && typeof opts == 'function')\n            cb = opts, opts = {};\n        this.ondata = cb;\n        this.o = opts || {};\n    }\n    Deflate.prototype.p = function (c, f) {\n        this.ondata(dopt(c, this.o, 0, 0, !f), f);\n    };\n    /**\n     * Pushes a chunk to be deflated\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Deflate.prototype.push = function (chunk, final) {\n        if (this.d)\n            throw 'stream finished';\n        if (!this.ondata)\n            throw 'no stream handler';\n        this.d = final;\n        this.p(chunk, final || false);\n    };\n    return Deflate;\n}());\nexport { Deflate };\n/**\n * Asynchronous streaming DEFLATE compression\n */\nvar AsyncDeflate = /*#__PURE__*/ (function () {\n    function AsyncDeflate(opts, cb) {\n        astrmify([\n            bDflt,\n            function () { return [astrm, Deflate]; }\n        ], this, AsyncCmpStrm.call(this, opts, cb), function (ev) {\n            var strm = new Deflate(ev.data);\n            onmessage = astrm(strm);\n        }, 6);\n    }\n    return AsyncDeflate;\n}());\nexport { AsyncDeflate };\nexport function deflate(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        throw 'no callback';\n    return cbify(data, opts, [\n        bDflt,\n    ], function (ev) { return pbf(deflateSync(ev.data[0], ev.data[1])); }, 0, cb);\n}\n/**\n * Compresses data with DEFLATE without any wrapper\n * @param data The data to compress\n * @param opts The compression options\n * @returns The deflated version of the data\n */\nexport function deflateSync(data, opts) {\n    return dopt(data, opts || {}, 0, 0);\n}\n/**\n * Streaming DEFLATE decompression\n */\nvar Inflate = /*#__PURE__*/ (function () {\n    /**\n     * Creates an inflation stream\n     * @param cb The callback to call whenever data is inflated\n     */\n    function Inflate(cb) {\n        this.s = {};\n        this.p = new u8(0);\n        this.ondata = cb;\n    }\n    Inflate.prototype.e = function (c) {\n        if (this.d)\n            throw 'stream finished';\n        if (!this.ondata)\n            throw 'no stream handler';\n        var l = this.p.length;\n        var n = new u8(l + c.length);\n        n.set(this.p), n.set(c, l), this.p = n;\n    };\n    Inflate.prototype.c = function (final) {\n        this.d = this.s.i = final || false;\n        var bts = this.s.b;\n        var dt = inflt(this.p, this.o, this.s);\n        this.ondata(slc(dt, bts, this.s.b), this.d);\n        this.o = slc(dt, this.s.b - 32768), this.s.b = this.o.length;\n        this.p = slc(this.p, (this.s.p / 8) | 0), this.s.p &= 7;\n    };\n    /**\n     * Pushes a chunk to be inflated\n     * @param chunk The chunk to push\n     * @param final Whether this is the final chunk\n     */\n    Inflate.prototype.push = function (chunk, final) {\n        this.e(chunk), this.c(final);\n    };\n    return Inflate;\n}());\nexport { Inflate };\n/**\n * Asynchronous streaming DEFLATE decompression\n */\nvar AsyncInflate = /*#__PURE__*/ (function () {\n    /**\n     * Creates an asynchronous inflation stream\n     * @param cb The callback to call whenever data is deflated\n     */\n    function AsyncInflate(cb) {\n        this.ondata = cb;\n        astrmify([\n            bInflt,\n            function () { return [astrm, Inflate]; }\n        ], this, 0, function () {\n            var strm = new Inflate();\n            onmessage = astrm(strm);\n        }, 7);\n    }\n    return AsyncInflate;\n}());\nexport { AsyncInflate };\nexport function inflate(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        throw 'no callback';\n    return cbify(data, opts, [\n        bInflt\n    ], function (ev) { return pbf(inflateSync(ev.data[0], gu8(ev.data[1]))); }, 1, cb);\n}\n/**\n * Expands DEFLATE data with no wrapper\n * @param data The data to decompress\n * @param out Where to write the data. Saves memory if you know the decompressed size and provide an output buffer of that length.\n * @returns The decompressed version of the data\n */\nexport function inflateSync(data, out) {\n    return inflt(data, out);\n}\n// before you yell at me for not just using extends, my reason is that TS inheritance is hard to workerize.\n/**\n * Streaming GZIP compression\n */\nvar Gzip = /*#__PURE__*/ (function () {\n    function Gzip(opts, cb) {\n        this.c = crc();\n        this.l = 0;\n        this.v = 1;\n        Deflate.call(this, opts, cb);\n    }\n    /**\n     * Pushes a chunk to be GZIPped\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Gzip.prototype.push = function (chunk, final) {\n        Deflate.prototype.push.call(this, chunk, final);\n    };\n    Gzip.prototype.p = function (c, f) {\n        this.c.p(c);\n        this.l += c.length;\n        var raw = dopt(c, this.o, this.v && gzhl(this.o), f && 8, !f);\n        if (this.v)\n            gzh(raw, this.o), this.v = 0;\n        if (f)\n            wbytes(raw, raw.length - 8, this.c.d()), wbytes(raw, raw.length - 4, this.l);\n        this.ondata(raw, f);\n    };\n    return Gzip;\n}());\nexport { Gzip };\n/**\n * Asynchronous streaming GZIP compression\n */\nvar AsyncGzip = /*#__PURE__*/ (function () {\n    function AsyncGzip(opts, cb) {\n        astrmify([\n            bDflt,\n            gze,\n            function () { return [astrm, Deflate, Gzip]; }\n        ], this, AsyncCmpStrm.call(this, opts, cb), function (ev) {\n            var strm = new Gzip(ev.data);\n            onmessage = astrm(strm);\n        }, 8);\n    }\n    return AsyncGzip;\n}());\nexport { AsyncGzip };\nexport function gzip(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        throw 'no callback';\n    return cbify(data, opts, [\n        bDflt,\n        gze,\n        function () { return [gzipSync]; }\n    ], function (ev) { return pbf(gzipSync(ev.data[0], ev.data[1])); }, 2, cb);\n}\n/**\n * Compresses data with GZIP\n * @param data The data to compress\n * @param opts The compression options\n * @returns The gzipped version of the data\n */\nexport function gzipSync(data, opts) {\n    if (!opts)\n        opts = {};\n    var c = crc(), l = data.length;\n    c.p(data);\n    var d = dopt(data, opts, gzhl(opts), 8), s = d.length;\n    return gzh(d, opts), wbytes(d, s - 8, c.d()), wbytes(d, s - 4, l), d;\n}\n/**\n * Streaming GZIP decompression\n */\nvar Gunzip = /*#__PURE__*/ (function () {\n    /**\n     * Creates a GUNZIP stream\n     * @param cb The callback to call whenever data is inflated\n     */\n    function Gunzip(cb) {\n        this.v = 1;\n        Inflate.call(this, cb);\n    }\n    /**\n     * Pushes a chunk to be GUNZIPped\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Gunzip.prototype.push = function (chunk, final) {\n        Inflate.prototype.e.call(this, chunk);\n        if (this.v) {\n            var s = this.p.length > 3 ? gzs(this.p) : 4;\n            if (s >= this.p.length && !final)\n                return;\n            this.p = this.p.subarray(s), this.v = 0;\n        }\n        if (final) {\n            if (this.p.length < 8)\n                throw 'invalid gzip stream';\n            this.p = this.p.subarray(0, -8);\n        }\n        // necessary to prevent TS from using the closure value\n        // This allows for workerization to function correctly\n        Inflate.prototype.c.call(this, final);\n    };\n    return Gunzip;\n}());\nexport { Gunzip };\n/**\n * Asynchronous streaming GZIP decompression\n */\nvar AsyncGunzip = /*#__PURE__*/ (function () {\n    /**\n     * Creates an asynchronous GUNZIP stream\n     * @param cb The callback to call whenever data is deflated\n     */\n    function AsyncGunzip(cb) {\n        this.ondata = cb;\n        astrmify([\n            bInflt,\n            guze,\n            function () { return [astrm, Inflate, Gunzip]; }\n        ], this, 0, function () {\n            var strm = new Gunzip();\n            onmessage = astrm(strm);\n        }, 9);\n    }\n    return AsyncGunzip;\n}());\nexport { AsyncGunzip };\nexport function gunzip(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        throw 'no callback';\n    return cbify(data, opts, [\n        bInflt,\n        guze,\n        function () { return [gunzipSync]; }\n    ], function (ev) { return pbf(gunzipSync(ev.data[0])); }, 3, cb);\n}\n/**\n * Expands GZIP data\n * @param data The data to decompress\n * @param out Where to write the data. GZIP already encodes the output size, so providing this doesn't save memory.\n * @returns The decompressed version of the data\n */\nexport function gunzipSync(data, out) {\n    return inflt(data.subarray(gzs(data), -8), out || new u8(gzl(data)));\n}\n/**\n * Streaming Zlib compression\n */\nvar Zlib = /*#__PURE__*/ (function () {\n    function Zlib(opts, cb) {\n        this.c = adler();\n        this.v = 1;\n        Deflate.call(this, opts, cb);\n    }\n    /**\n     * Pushes a chunk to be zlibbed\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Zlib.prototype.push = function (chunk, final) {\n        Deflate.prototype.push.call(this, chunk, final);\n    };\n    Zlib.prototype.p = function (c, f) {\n        this.c.p(c);\n        var raw = dopt(c, this.o, this.v && 2, f && 4, !f);\n        if (this.v)\n            zlh(raw, this.o), this.v = 0;\n        if (f)\n            wbytes(raw, raw.length - 4, this.c.d());\n        this.ondata(raw, f);\n    };\n    return Zlib;\n}());\nexport { Zlib };\n/**\n * Asynchronous streaming Zlib compression\n */\nvar AsyncZlib = /*#__PURE__*/ (function () {\n    function AsyncZlib(opts, cb) {\n        astrmify([\n            bDflt,\n            zle,\n            function () { return [astrm, Deflate, Zlib]; }\n        ], this, AsyncCmpStrm.call(this, opts, cb), function (ev) {\n            var strm = new Zlib(ev.data);\n            onmessage = astrm(strm);\n        }, 10);\n    }\n    return AsyncZlib;\n}());\nexport { AsyncZlib };\nexport function zlib(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        throw 'no callback';\n    return cbify(data, opts, [\n        bDflt,\n        zle,\n        function () { return [zlibSync]; }\n    ], function (ev) { return pbf(zlibSync(ev.data[0], ev.data[1])); }, 4, cb);\n}\n/**\n * Compress data with Zlib\n * @param data The data to compress\n * @param opts The compression options\n * @returns The zlib-compressed version of the data\n */\nexport function zlibSync(data, opts) {\n    if (!opts)\n        opts = {};\n    var a = adler();\n    a.p(data);\n    var d = dopt(data, opts, 2, 4);\n    return zlh(d, opts), wbytes(d, d.length - 4, a.d()), d;\n}\n/**\n * Streaming Zlib decompression\n */\nvar Unzlib = /*#__PURE__*/ (function () {\n    /**\n     * Creates a Zlib decompression stream\n     * @param cb The callback to call whenever data is inflated\n     */\n    function Unzlib(cb) {\n        this.v = 1;\n        Inflate.call(this, cb);\n    }\n    /**\n     * Pushes a chunk to be unzlibbed\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Unzlib.prototype.push = function (chunk, final) {\n        Inflate.prototype.e.call(this, chunk);\n        if (this.v) {\n            if (this.p.length < 2 && !final)\n                return;\n            this.p = this.p.subarray(2), this.v = 0;\n        }\n        if (final) {\n            if (this.p.length < 4)\n                throw 'invalid zlib stream';\n            this.p = this.p.subarray(0, -4);\n        }\n        // necessary to prevent TS from using the closure value\n        // This allows for workerization to function correctly\n        Inflate.prototype.c.call(this, final);\n    };\n    return Unzlib;\n}());\nexport { Unzlib };\n/**\n * Asynchronous streaming Zlib decompression\n */\nvar AsyncUnzlib = /*#__PURE__*/ (function () {\n    /**\n     * Creates an asynchronous Zlib decompression stream\n     * @param cb The callback to call whenever data is deflated\n     */\n    function AsyncUnzlib(cb) {\n        this.ondata = cb;\n        astrmify([\n            bInflt,\n            zule,\n            function () { return [astrm, Inflate, Unzlib]; }\n        ], this, 0, function () {\n            var strm = new Unzlib();\n            onmessage = astrm(strm);\n        }, 11);\n    }\n    return AsyncUnzlib;\n}());\nexport { AsyncUnzlib };\nexport function unzlib(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        throw 'no callback';\n    return cbify(data, opts, [\n        bInflt,\n        zule,\n        function () { return [unzlibSync]; }\n    ], function (ev) { return pbf(unzlibSync(ev.data[0], gu8(ev.data[1]))); }, 5, cb);\n}\n/**\n * Expands Zlib data\n * @param data The data to decompress\n * @param out Where to write the data. Saves memory if you know the decompressed size and provide an output buffer of that length.\n * @returns The decompressed version of the data\n */\nexport function unzlibSync(data, out) {\n    return inflt((zlv(data), data.subarray(2, -4)), out);\n}\n// Default algorithm for compression (used because having a known output size allows faster decompression)\nexport { gzip as compress, AsyncGzip as AsyncCompress };\n// Default algorithm for compression (used because having a known output size allows faster decompression)\nexport { gzipSync as compressSync, Gzip as Compress };\n/**\n * Streaming GZIP, Zlib, or raw DEFLATE decompression\n */\nvar Decompress = /*#__PURE__*/ (function () {\n    /**\n     * Creates a decompression stream\n     * @param cb The callback to call whenever data is decompressed\n     */\n    function Decompress(cb) {\n        this.G = Gunzip;\n        this.I = Inflate;\n        this.Z = Unzlib;\n        this.ondata = cb;\n    }\n    /**\n     * Pushes a chunk to be decompressed\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Decompress.prototype.push = function (chunk, final) {\n        if (!this.ondata)\n            throw 'no stream handler';\n        if (!this.s) {\n            if (this.p && this.p.length) {\n                var n = new u8(this.p.length + chunk.length);\n                n.set(this.p), n.set(chunk, this.p.length);\n            }\n            else\n                this.p = chunk;\n            if (this.p.length > 2) {\n                var _this_1 = this;\n                var cb = function () { _this_1.ondata.apply(_this_1, arguments); };\n                this.s = (this.p[0] == 31 && this.p[1] == 139 && this.p[2] == 8)\n                    ? new this.G(cb)\n                    : ((this.p[0] & 15) != 8 || (this.p[0] >> 4) > 7 || ((this.p[0] << 8 | this.p[1]) % 31))\n                        ? new this.I(cb)\n                        : new this.Z(cb);\n                this.s.push(this.p, final);\n                this.p = null;\n            }\n        }\n        else\n            this.s.push(chunk, final);\n    };\n    return Decompress;\n}());\nexport { Decompress };\n/**\n * Asynchronous streaming GZIP, Zlib, or raw DEFLATE decompression\n */\nvar AsyncDecompress = /*#__PURE__*/ (function () {\n    /**\n   * Creates an asynchronous decompression stream\n   * @param cb The callback to call whenever data is decompressed\n   */\n    function AsyncDecompress(cb) {\n        this.G = AsyncGunzip;\n        this.I = AsyncInflate;\n        this.Z = AsyncUnzlib;\n        this.ondata = cb;\n    }\n    /**\n     * Pushes a chunk to be decompressed\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    AsyncDecompress.prototype.push = function (chunk, final) {\n        Decompress.prototype.push.call(this, chunk, final);\n    };\n    return AsyncDecompress;\n}());\nexport { AsyncDecompress };\nexport function decompress(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        throw 'no callback';\n    return (data[0] == 31 && data[1] == 139 && data[2] == 8)\n        ? gunzip(data, opts, cb)\n        : ((data[0] & 15) != 8 || (data[0] >> 4) > 7 || ((data[0] << 8 | data[1]) % 31))\n            ? inflate(data, opts, cb)\n            : unzlib(data, opts, cb);\n}\n/**\n * Expands compressed GZIP, Zlib, or raw DEFLATE data, automatically detecting the format\n * @param data The data to decompress\n * @param out Where to write the data. Saves memory if you know the decompressed size and provide an output buffer of that length.\n * @returns The decompressed version of the data\n */\nexport function decompressSync(data, out) {\n    return (data[0] == 31 && data[1] == 139 && data[2] == 8)\n        ? gunzipSync(data, out)\n        : ((data[0] & 15) != 8 || (data[0] >> 4) > 7 || ((data[0] << 8 | data[1]) % 31))\n            ? inflateSync(data, out)\n            : unzlibSync(data, out);\n}\n// flatten a directory structure\nvar fltn = function (d, p, t, o) {\n    for (var k in d) {\n        var val = d[k], n = p + k;\n        if (val instanceof u8)\n            t[n] = [val, o];\n        else if (Array.isArray(val))\n            t[n] = [val[0], mrg(o, val[1])];\n        else\n            fltn(val, n + '/', t, o);\n    }\n};\n// text encoder\nvar te = typeof TextEncoder != 'undefined' && /*#__PURE__*/ new TextEncoder();\n// text decoder\nvar td = typeof TextDecoder != 'undefined' && /*#__PURE__*/ new TextDecoder();\n// text decoder stream\nvar tds = 0;\ntry {\n    td.decode(et, { stream: true });\n    tds = 1;\n}\ncatch (e) { }\n// decode UTF8\nvar dutf8 = function (d) {\n    for (var r = '', i = 0;;) {\n        var c = d[i++];\n        var eb = (c > 127) + (c > 223) + (c > 239);\n        if (i + eb > d.length)\n            return [r, slc(d, i - 1)];\n        if (!eb)\n            r += String.fromCharCode(c);\n        else if (eb == 3) {\n            c = ((c & 15) << 18 | (d[i++] & 63) << 12 | (d[i++] & 63) << 6 | (d[i++] & 63)) - 65536,\n                r += String.fromCharCode(55296 | (c >> 10), 56320 | (c & 1023));\n        }\n        else if (eb & 1)\n            r += String.fromCharCode((c & 31) << 6 | (d[i++] & 63));\n        else\n            r += String.fromCharCode((c & 15) << 12 | (d[i++] & 63) << 6 | (d[i++] & 63));\n    }\n};\n/**\n * Streaming UTF-8 decoding\n */\nvar DecodeUTF8 = /*#__PURE__*/ (function () {\n    /**\n     * Creates a UTF-8 decoding stream\n     * @param cb The callback to call whenever data is decoded\n     */\n    function DecodeUTF8(cb) {\n        this.ondata = cb;\n        if (tds)\n            this.t = new TextDecoder();\n        else\n            this.p = et;\n    }\n    /**\n     * Pushes a chunk to be decoded from UTF-8 binary\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    DecodeUTF8.prototype.push = function (chunk, final) {\n        if (!this.ondata)\n            throw 'no callback';\n        final = !!final;\n        if (this.t) {\n            this.ondata(this.t.decode(chunk, { stream: true }), final);\n            if (final) {\n                if (this.t.decode().length)\n                    throw 'invalid utf-8 data';\n                this.t = null;\n            }\n            return;\n        }\n        if (!this.p)\n            throw 'stream finished';\n        var dat = new u8(this.p.length + chunk.length);\n        dat.set(this.p);\n        dat.set(chunk, this.p.length);\n        var _a = dutf8(dat), ch = _a[0], np = _a[1];\n        if (final) {\n            if (np.length)\n                throw 'invalid utf-8 data';\n            this.p = null;\n        }\n        else\n            this.p = np;\n        this.ondata(ch, final);\n    };\n    return DecodeUTF8;\n}());\nexport { DecodeUTF8 };\n/**\n * Streaming UTF-8 encoding\n */\nvar EncodeUTF8 = /*#__PURE__*/ (function () {\n    /**\n     * Creates a UTF-8 decoding stream\n     * @param cb The callback to call whenever data is encoded\n     */\n    function EncodeUTF8(cb) {\n        this.ondata = cb;\n    }\n    /**\n     * Pushes a chunk to be encoded to UTF-8\n     * @param chunk The string data to push\n     * @param final Whether this is the last chunk\n     */\n    EncodeUTF8.prototype.push = function (chunk, final) {\n        if (!this.ondata)\n            throw 'no callback';\n        if (this.d)\n            throw 'stream finished';\n        this.ondata(strToU8(chunk), this.d = final || false);\n    };\n    return EncodeUTF8;\n}());\nexport { EncodeUTF8 };\n/**\n * Converts a string into a Uint8Array for use with compression/decompression methods\n * @param str The string to encode\n * @param latin1 Whether or not to interpret the data as Latin-1. This should\n *               not need to be true unless decoding a binary string.\n * @returns The string encoded in UTF-8/Latin-1 binary\n */\nexport function strToU8(str, latin1) {\n    if (latin1) {\n        var ar_1 = new u8(str.length);\n        for (var i = 0; i < str.length; ++i)\n            ar_1[i] = str.charCodeAt(i);\n        return ar_1;\n    }\n    if (te)\n        return te.encode(str);\n    var l = str.length;\n    var ar = new u8(str.length + (str.length >> 1));\n    var ai = 0;\n    var w = function (v) { ar[ai++] = v; };\n    for (var i = 0; i < l; ++i) {\n        if (ai + 5 > ar.length) {\n            var n = new u8(ai + 8 + ((l - i) << 1));\n            n.set(ar);\n            ar = n;\n        }\n        var c = str.charCodeAt(i);\n        if (c < 128 || latin1)\n            w(c);\n        else if (c < 2048)\n            w(192 | (c >> 6)), w(128 | (c & 63));\n        else if (c > 55295 && c < 57344)\n            c = 65536 + (c & 1023 << 10) | (str.charCodeAt(++i) & 1023),\n                w(240 | (c >> 18)), w(128 | ((c >> 12) & 63)), w(128 | ((c >> 6) & 63)), w(128 | (c & 63));\n        else\n            w(224 | (c >> 12)), w(128 | ((c >> 6) & 63)), w(128 | (c & 63));\n    }\n    return slc(ar, 0, ai);\n}\n/**\n * Converts a Uint8Array to a string\n * @param dat The data to decode to string\n * @param latin1 Whether or not to interpret the data as Latin-1. This should\n *               not need to be true unless encoding to binary string.\n * @returns The original UTF-8/Latin-1 string\n */\nexport function strFromU8(dat, latin1) {\n    if (latin1) {\n        var r = '';\n        for (var i = 0; i < dat.length; i += 16384)\n            r += String.fromCharCode.apply(null, dat.subarray(i, i + 16384));\n        return r;\n    }\n    else if (td)\n        return td.decode(dat);\n    else {\n        var _a = dutf8(dat), out = _a[0], ext = _a[1];\n        if (ext.length)\n            throw 'invalid utf-8 data';\n        return out;\n    }\n}\n;\n// deflate bit flag\nvar dbf = function (l) { return l == 1 ? 3 : l < 6 ? 2 : l == 9 ? 1 : 0; };\n// skip local zip header\nvar slzh = function (d, b) { return b + 30 + b2(d, b + 26) + b2(d, b + 28); };\n// read zip header\nvar zh = function (d, b, z) {\n    var fnl = b2(d, b + 28), fn = strFromU8(d.subarray(b + 46, b + 46 + fnl), !(b2(d, b + 8) & 2048)), es = b + 46 + fnl, bs = b4(d, b + 20);\n    var _a = z && bs == 4294967295 ? z64e(d, es) : [bs, b4(d, b + 24), b4(d, b + 42)], sc = _a[0], su = _a[1], off = _a[2];\n    return [b2(d, b + 10), sc, su, fn, es + b2(d, b + 30) + b2(d, b + 32), off];\n};\n// read zip64 extra field\nvar z64e = function (d, b) {\n    for (; b2(d, b) != 1; b += 4 + b2(d, b + 2))\n        ;\n    return [b8(d, b + 12), b8(d, b + 4), b8(d, b + 20)];\n};\n// extra field length\nvar exfl = function (ex) {\n    var le = 0;\n    if (ex) {\n        for (var k in ex) {\n            var l = ex[k].length;\n            if (l > 65535)\n                throw 'extra field too long';\n            le += l + 4;\n        }\n    }\n    return le;\n};\n// write zip header\nvar wzh = function (d, b, f, fn, u, c, ce, co) {\n    var fl = fn.length, ex = f.extra, col = co && co.length;\n    var exl = exfl(ex);\n    wbytes(d, b, ce != null ? 0x2014B50 : 0x4034B50), b += 4;\n    if (ce != null)\n        d[b++] = 20, d[b++] = f.os;\n    d[b] = 20, b += 2; // spec compliance? what's that?\n    d[b++] = (f.flag << 1) | (c == null && 8), d[b++] = u && 8;\n    d[b++] = f.compression & 255, d[b++] = f.compression >> 8;\n    var dt = new Date(f.mtime == null ? Date.now() : f.mtime), y = dt.getFullYear() - 1980;\n    if (y < 0 || y > 119)\n        throw 'date not in range 1980-2099';\n    wbytes(d, b, (y << 25) | ((dt.getMonth() + 1) << 21) | (dt.getDate() << 16) | (dt.getHours() << 11) | (dt.getMinutes() << 5) | (dt.getSeconds() >>> 1)), b += 4;\n    if (c != null) {\n        wbytes(d, b, f.crc);\n        wbytes(d, b + 4, c);\n        wbytes(d, b + 8, f.size);\n    }\n    wbytes(d, b + 12, fl);\n    wbytes(d, b + 14, exl), b += 16;\n    if (ce != null) {\n        wbytes(d, b, col);\n        wbytes(d, b + 6, f.attrs);\n        wbytes(d, b + 10, ce), b += 14;\n    }\n    d.set(fn, b);\n    b += fl;\n    if (exl) {\n        for (var k in ex) {\n            var exf = ex[k], l = exf.length;\n            wbytes(d, b, +k);\n            wbytes(d, b + 2, l);\n            d.set(exf, b + 4), b += 4 + l;\n        }\n    }\n    if (col)\n        d.set(co, b), b += col;\n    return b;\n};\n// write zip footer (end of central directory)\nvar wzf = function (o, b, c, d, e) {\n    wbytes(o, b, 0x6054B50); // skip disk\n    wbytes(o, b + 8, c);\n    wbytes(o, b + 10, c);\n    wbytes(o, b + 12, d);\n    wbytes(o, b + 16, e);\n};\n/**\n * A pass-through stream to keep data uncompressed in a ZIP archive.\n */\nvar ZipPassThrough = /*#__PURE__*/ (function () {\n    /**\n     * Creates a pass-through stream that can be added to ZIP archives\n     * @param filename The filename to associate with this data stream\n     */\n    function ZipPassThrough(filename) {\n        this.filename = filename;\n        this.c = crc();\n        this.size = 0;\n        this.compression = 0;\n    }\n    /**\n     * Processes a chunk and pushes to the output stream. You can override this\n     * method in a subclass for custom behavior, but by default this passes\n     * the data through. You must call this.ondata(err, chunk, final) at some\n     * point in this method.\n     * @param chunk The chunk to process\n     * @param final Whether this is the last chunk\n     */\n    ZipPassThrough.prototype.process = function (chunk, final) {\n        this.ondata(null, chunk, final);\n    };\n    /**\n     * Pushes a chunk to be added. If you are subclassing this with a custom\n     * compression algorithm, note that you must push data from the source\n     * file only, pre-compression.\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    ZipPassThrough.prototype.push = function (chunk, final) {\n        if (!this.ondata)\n            throw 'no callback - add to ZIP archive before pushing';\n        this.c.p(chunk);\n        this.size += chunk.length;\n        if (final)\n            this.crc = this.c.d();\n        this.process(chunk, final || false);\n    };\n    return ZipPassThrough;\n}());\nexport { ZipPassThrough };\n// I don't extend because TypeScript extension adds 1kB of runtime bloat\n/**\n * Streaming DEFLATE compression for ZIP archives. Prefer using AsyncZipDeflate\n * for better performance\n */\nvar ZipDeflate = /*#__PURE__*/ (function () {\n    /**\n     * Creates a DEFLATE stream that can be added to ZIP archives\n     * @param filename The filename to associate with this data stream\n     * @param opts The compression options\n     */\n    function ZipDeflate(filename, opts) {\n        var _this_1 = this;\n        if (!opts)\n            opts = {};\n        ZipPassThrough.call(this, filename);\n        this.d = new Deflate(opts, function (dat, final) {\n            _this_1.ondata(null, dat, final);\n        });\n        this.compression = 8;\n        this.flag = dbf(opts.level);\n    }\n    ZipDeflate.prototype.process = function (chunk, final) {\n        try {\n            this.d.push(chunk, final);\n        }\n        catch (e) {\n            this.ondata(e, null, final);\n        }\n    };\n    /**\n     * Pushes a chunk to be deflated\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    ZipDeflate.prototype.push = function (chunk, final) {\n        ZipPassThrough.prototype.push.call(this, chunk, final);\n    };\n    return ZipDeflate;\n}());\nexport { ZipDeflate };\n/**\n * Asynchronous streaming DEFLATE compression for ZIP archives\n */\nvar AsyncZipDeflate = /*#__PURE__*/ (function () {\n    /**\n     * Creates a DEFLATE stream that can be added to ZIP archives\n     * @param filename The filename to associate with this data stream\n     * @param opts The compression options\n     */\n    function AsyncZipDeflate(filename, opts) {\n        var _this_1 = this;\n        if (!opts)\n            opts = {};\n        ZipPassThrough.call(this, filename);\n        this.d = new AsyncDeflate(opts, function (err, dat, final) {\n            _this_1.ondata(err, dat, final);\n        });\n        this.compression = 8;\n        this.flag = dbf(opts.level);\n        this.terminate = this.d.terminate;\n    }\n    AsyncZipDeflate.prototype.process = function (chunk, final) {\n        this.d.push(chunk, final);\n    };\n    /**\n     * Pushes a chunk to be deflated\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    AsyncZipDeflate.prototype.push = function (chunk, final) {\n        ZipPassThrough.prototype.push.call(this, chunk, final);\n    };\n    return AsyncZipDeflate;\n}());\nexport { AsyncZipDeflate };\n// TODO: Better tree shaking\n/**\n * A zippable archive to which files can incrementally be added\n */\nvar Zip = /*#__PURE__*/ (function () {\n    /**\n     * Creates an empty ZIP archive to which files can be added\n     * @param cb The callback to call whenever data for the generated ZIP archive\n     *           is available\n     */\n    function Zip(cb) {\n        this.ondata = cb;\n        this.u = [];\n        this.d = 1;\n    }\n    /**\n     * Adds a file to the ZIP archive\n     * @param file The file stream to add\n     */\n    Zip.prototype.add = function (file) {\n        var _this_1 = this;\n        if (this.d & 2)\n            throw 'stream finished';\n        var f = strToU8(file.filename), fl = f.length;\n        var com = file.comment, o = com && strToU8(com);\n        var u = fl != file.filename.length || (o && (com.length != o.length));\n        var hl = fl + exfl(file.extra) + 30;\n        if (fl > 65535)\n            throw 'filename too long';\n        var header = new u8(hl);\n        wzh(header, 0, file, f, u);\n        var chks = [header];\n        var pAll = function () {\n            for (var _i = 0, chks_1 = chks; _i < chks_1.length; _i++) {\n                var chk = chks_1[_i];\n                _this_1.ondata(null, chk, false);\n            }\n            chks = [];\n        };\n        var tr = this.d;\n        this.d = 0;\n        var ind = this.u.length;\n        var uf = mrg(file, {\n            f: f,\n            u: u,\n            o: o,\n            t: function () {\n                if (file.terminate)\n                    file.terminate();\n            },\n            r: function () {\n                pAll();\n                if (tr) {\n                    var nxt = _this_1.u[ind + 1];\n                    if (nxt)\n                        nxt.r();\n                    else\n                        _this_1.d = 1;\n                }\n                tr = 1;\n            }\n        });\n        var cl = 0;\n        file.ondata = function (err, dat, final) {\n            if (err) {\n                _this_1.ondata(err, dat, final);\n                _this_1.terminate();\n            }\n            else {\n                cl += dat.length;\n                chks.push(dat);\n                if (final) {\n                    var dd = new u8(16);\n                    wbytes(dd, 0, 0x8074B50);\n                    wbytes(dd, 4, file.crc);\n                    wbytes(dd, 8, cl);\n                    wbytes(dd, 12, file.size);\n                    chks.push(dd);\n                    uf.c = cl, uf.b = hl + cl + 16, uf.crc = file.crc, uf.size = file.size;\n                    if (tr)\n                        uf.r();\n                    tr = 1;\n                }\n                else if (tr)\n                    pAll();\n            }\n        };\n        this.u.push(uf);\n    };\n    /**\n     * Ends the process of adding files and prepares to emit the final chunks.\n     * This *must* be called after adding all desired files for the resulting\n     * ZIP file to work properly.\n     */\n    Zip.prototype.end = function () {\n        var _this_1 = this;\n        if (this.d & 2) {\n            if (this.d & 1)\n                throw 'stream finishing';\n            throw 'stream finished';\n        }\n        if (this.d)\n            this.e();\n        else\n            this.u.push({\n                r: function () {\n                    if (!(_this_1.d & 1))\n                        return;\n                    _this_1.u.splice(-1, 1);\n                    _this_1.e();\n                },\n                t: function () { }\n            });\n        this.d = 3;\n    };\n    Zip.prototype.e = function () {\n        var bt = 0, l = 0, tl = 0;\n        for (var _i = 0, _a = this.u; _i < _a.length; _i++) {\n            var f = _a[_i];\n            tl += 46 + f.f.length + exfl(f.extra) + (f.o ? f.o.length : 0);\n        }\n        var out = new u8(tl + 22);\n        for (var _b = 0, _c = this.u; _b < _c.length; _b++) {\n            var f = _c[_b];\n            wzh(out, bt, f, f.f, f.u, f.c, l, f.o);\n            bt += 46 + f.f.length + exfl(f.extra) + (f.o ? f.o.length : 0), l += f.b;\n        }\n        wzf(out, bt, this.u.length, tl, l);\n        this.ondata(null, out, true);\n        this.d = 2;\n    };\n    /**\n     * A method to terminate any internal workers used by the stream. Subsequent\n     * calls to add() will fail.\n     */\n    Zip.prototype.terminate = function () {\n        for (var _i = 0, _a = this.u; _i < _a.length; _i++) {\n            var f = _a[_i];\n            f.t();\n        }\n        this.d = 2;\n    };\n    return Zip;\n}());\nexport { Zip };\nexport function zip(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        throw 'no callback';\n    var r = {};\n    fltn(data, '', r, opts);\n    var k = Object.keys(r);\n    var lft = k.length, o = 0, tot = 0;\n    var slft = lft, files = new Array(lft);\n    var term = [];\n    var tAll = function () {\n        for (var i = 0; i < term.length; ++i)\n            term[i]();\n    };\n    var cbf = function () {\n        var out = new u8(tot + 22), oe = o, cdl = tot - o;\n        tot = 0;\n        for (var i = 0; i < slft; ++i) {\n            var f = files[i];\n            try {\n                var l = f.c.length;\n                wzh(out, tot, f, f.f, f.u, l);\n                var badd = 30 + f.f.length + exfl(f.extra);\n                var loc = tot + badd;\n                out.set(f.c, loc);\n                wzh(out, o, f, f.f, f.u, l, tot, f.m), o += 16 + badd + (f.m ? f.m.length : 0), tot = loc + l;\n            }\n            catch (e) {\n                return cb(e, null);\n            }\n        }\n        wzf(out, o, files.length, cdl, oe);\n        cb(null, out);\n    };\n    if (!lft)\n        cbf();\n    var _loop_1 = function (i) {\n        var fn = k[i];\n        var _a = r[fn], file = _a[0], p = _a[1];\n        var c = crc(), size = file.length;\n        c.p(file);\n        var f = strToU8(fn), s = f.length;\n        var com = p.comment, m = com && strToU8(com), ms = m && m.length;\n        var exl = exfl(p.extra);\n        var compression = p.level == 0 ? 0 : 8;\n        var cbl = function (e, d) {\n            if (e) {\n                tAll();\n                cb(e, null);\n            }\n            else {\n                var l = d.length;\n                files[i] = mrg(p, {\n                    size: size,\n                    crc: c.d(),\n                    c: d,\n                    f: f,\n                    m: m,\n                    u: s != fn.length || (m && (com.length != ms)),\n                    compression: compression\n                });\n                o += 30 + s + exl + l;\n                tot += 76 + 2 * (s + exl) + (ms || 0) + l;\n                if (!--lft)\n                    cbf();\n            }\n        };\n        if (s > 65535)\n            cbl('filename too long', null);\n        if (!compression)\n            cbl(null, file);\n        else if (size < 160000) {\n            try {\n                cbl(null, deflateSync(file, p));\n            }\n            catch (e) {\n                cbl(e, null);\n            }\n        }\n        else\n            term.push(deflate(file, p, cbl));\n    };\n    // Cannot use lft because it can decrease\n    for (var i = 0; i < slft; ++i) {\n        _loop_1(i);\n    }\n    return tAll;\n}\n/**\n * Synchronously creates a ZIP file. Prefer using `zip` for better performance\n * with more than one file.\n * @param data The directory structure for the ZIP archive\n * @param opts The main options, merged with per-file options\n * @returns The generated ZIP archive\n */\nexport function zipSync(data, opts) {\n    if (!opts)\n        opts = {};\n    var r = {};\n    var files = [];\n    fltn(data, '', r, opts);\n    var o = 0;\n    var tot = 0;\n    for (var fn in r) {\n        var _a = r[fn], file = _a[0], p = _a[1];\n        var compression = p.level == 0 ? 0 : 8;\n        var f = strToU8(fn), s = f.length;\n        var com = p.comment, m = com && strToU8(com), ms = m && m.length;\n        var exl = exfl(p.extra);\n        if (s > 65535)\n            throw 'filename too long';\n        var d = compression ? deflateSync(file, p) : file, l = d.length;\n        var c = crc();\n        c.p(file);\n        files.push(mrg(p, {\n            size: file.length,\n            crc: c.d(),\n            c: d,\n            f: f,\n            m: m,\n            u: s != fn.length || (m && (com.length != ms)),\n            o: o,\n            compression: compression\n        }));\n        o += 30 + s + exl + l;\n        tot += 76 + 2 * (s + exl) + (ms || 0) + l;\n    }\n    var out = new u8(tot + 22), oe = o, cdl = tot - o;\n    for (var i = 0; i < files.length; ++i) {\n        var f = files[i];\n        wzh(out, f.o, f, f.f, f.u, f.c.length);\n        var badd = 30 + f.f.length + exfl(f.extra);\n        out.set(f.c, f.o + badd);\n        wzh(out, o, f, f.f, f.u, f.c.length, f.o, f.m), o += 16 + badd + (f.m ? f.m.length : 0);\n    }\n    wzf(out, o, files.length, cdl, oe);\n    return out;\n}\n/**\n * Streaming pass-through decompression for ZIP archives\n */\nvar UnzipPassThrough = /*#__PURE__*/ (function () {\n    function UnzipPassThrough() {\n    }\n    UnzipPassThrough.prototype.push = function (data, final) {\n        this.ondata(null, data, final);\n    };\n    UnzipPassThrough.compression = 0;\n    return UnzipPassThrough;\n}());\nexport { UnzipPassThrough };\n/**\n * Streaming DEFLATE decompression for ZIP archives. Prefer AsyncZipInflate for\n * better performance.\n */\nvar UnzipInflate = /*#__PURE__*/ (function () {\n    /**\n     * Creates a DEFLATE decompression that can be used in ZIP archives\n     */\n    function UnzipInflate() {\n        var _this_1 = this;\n        this.i = new Inflate(function (dat, final) {\n            _this_1.ondata(null, dat, final);\n        });\n    }\n    UnzipInflate.prototype.push = function (data, final) {\n        try {\n            this.i.push(data, final);\n        }\n        catch (e) {\n            this.ondata(e, data, final);\n        }\n    };\n    UnzipInflate.compression = 8;\n    return UnzipInflate;\n}());\nexport { UnzipInflate };\n/**\n * Asynchronous streaming DEFLATE decompression for ZIP archives\n */\nvar AsyncUnzipInflate = /*#__PURE__*/ (function () {\n    /**\n     * Creates a DEFLATE decompression that can be used in ZIP archives\n     */\n    function AsyncUnzipInflate(_, sz) {\n        var _this_1 = this;\n        if (sz < 320000) {\n            this.i = new Inflate(function (dat, final) {\n                _this_1.ondata(null, dat, final);\n            });\n        }\n        else {\n            this.i = new AsyncInflate(function (err, dat, final) {\n                _this_1.ondata(err, dat, final);\n            });\n            this.terminate = this.i.terminate;\n        }\n    }\n    AsyncUnzipInflate.prototype.push = function (data, final) {\n        if (this.i.terminate)\n            data = slc(data, 0);\n        this.i.push(data, final);\n    };\n    AsyncUnzipInflate.compression = 8;\n    return AsyncUnzipInflate;\n}());\nexport { AsyncUnzipInflate };\n/**\n * A ZIP archive decompression stream that emits files as they are discovered\n */\nvar Unzip = /*#__PURE__*/ (function () {\n    /**\n     * Creates a ZIP decompression stream\n     * @param cb The callback to call whenever a file in the ZIP archive is found\n     */\n    function Unzip(cb) {\n        this.onfile = cb;\n        this.k = [];\n        this.o = {\n            0: UnzipPassThrough\n        };\n        this.p = et;\n    }\n    /**\n     * Pushes a chunk to be unzipped\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Unzip.prototype.push = function (chunk, final) {\n        var _this_1 = this;\n        if (!this.onfile)\n            throw 'no callback';\n        if (!this.p)\n            throw 'stream finished';\n        if (this.c > 0) {\n            var len = Math.min(this.c, chunk.length);\n            var toAdd = chunk.subarray(0, len);\n            this.c -= len;\n            if (this.d)\n                this.d.push(toAdd, !this.c);\n            else\n                this.k[0].push(toAdd);\n            chunk = chunk.subarray(len);\n            if (chunk.length)\n                return this.push(chunk, final);\n        }\n        else {\n            var f = 0, i = 0, is = void 0, buf = void 0;\n            if (!this.p.length)\n                buf = chunk;\n            else if (!chunk.length)\n                buf = this.p;\n            else {\n                buf = new u8(this.p.length + chunk.length);\n                buf.set(this.p), buf.set(chunk, this.p.length);\n            }\n            var l = buf.length, oc = this.c, add = oc && this.d;\n            var _loop_2 = function () {\n                var _a;\n                var sig = b4(buf, i);\n                if (sig == 0x4034B50) {\n                    f = 1, is = i;\n                    this_1.d = null;\n                    this_1.c = 0;\n                    var bf = b2(buf, i + 6), cmp_1 = b2(buf, i + 8), u = bf & 2048, dd = bf & 8, fnl = b2(buf, i + 26), es = b2(buf, i + 28);\n                    if (l > i + 30 + fnl + es) {\n                        var chks_2 = [];\n                        this_1.k.unshift(chks_2);\n                        f = 2;\n                        var sc_1 = b4(buf, i + 18), su_1 = b4(buf, i + 22);\n                        var fn_1 = strFromU8(buf.subarray(i + 30, i += 30 + fnl), !u);\n                        if (sc_1 == 4294967295) {\n                            _a = dd ? [-2] : z64e(buf, i), sc_1 = _a[0], su_1 = _a[1];\n                        }\n                        else if (dd)\n                            sc_1 = -1;\n                        i += es;\n                        this_1.c = sc_1;\n                        var d_1;\n                        var file_1 = {\n                            name: fn_1,\n                            compression: cmp_1,\n                            start: function () {\n                                if (!file_1.ondata)\n                                    throw 'no callback';\n                                if (!sc_1)\n                                    file_1.ondata(null, et, true);\n                                else {\n                                    var ctr = _this_1.o[cmp_1];\n                                    if (!ctr)\n                                        throw 'unknown compression type ' + cmp_1;\n                                    d_1 = sc_1 < 0 ? new ctr(fn_1) : new ctr(fn_1, sc_1, su_1);\n                                    d_1.ondata = function (err, dat, final) { file_1.ondata(err, dat, final); };\n                                    for (var _i = 0, chks_3 = chks_2; _i < chks_3.length; _i++) {\n                                        var dat = chks_3[_i];\n                                        d_1.push(dat, false);\n                                    }\n                                    if (_this_1.k[0] == chks_2 && _this_1.c)\n                                        _this_1.d = d_1;\n                                    else\n                                        d_1.push(et, true);\n                                }\n                            },\n                            terminate: function () {\n                                if (d_1 && d_1.terminate)\n                                    d_1.terminate();\n                            }\n                        };\n                        if (sc_1 >= 0)\n                            file_1.size = sc_1, file_1.originalSize = su_1;\n                        this_1.onfile(file_1);\n                    }\n                    return \"break\";\n                }\n                else if (oc) {\n                    if (sig == 0x8074B50) {\n                        is = i += 12 + (oc == -2 && 8), f = 3, this_1.c = 0;\n                        return \"break\";\n                    }\n                    else if (sig == 0x2014B50) {\n                        is = i -= 4, f = 3, this_1.c = 0;\n                        return \"break\";\n                    }\n                }\n            };\n            var this_1 = this;\n            for (; i < l - 4; ++i) {\n                var state_1 = _loop_2();\n                if (state_1 === \"break\")\n                    break;\n            }\n            this.p = et;\n            if (oc < 0) {\n                var dat = f ? buf.subarray(0, is - 12 - (oc == -2 && 8) - (b4(buf, is - 16) == 0x8074B50 && 4)) : buf.subarray(0, i);\n                if (add)\n                    add.push(dat, !!f);\n                else\n                    this.k[+(f == 2)].push(dat);\n            }\n            if (f & 2)\n                return this.push(buf.subarray(i), final);\n            this.p = buf.subarray(i);\n        }\n        if (final) {\n            if (this.c)\n                throw 'invalid zip file';\n            this.p = null;\n        }\n    };\n    /**\n     * Registers a decoder with the stream, allowing for files compressed with\n     * the compression type provided to be expanded correctly\n     * @param decoder The decoder constructor\n     */\n    Unzip.prototype.register = function (decoder) {\n        this.o[decoder.compression] = decoder;\n    };\n    return Unzip;\n}());\nexport { Unzip };\n/**\n * Asynchronously decompresses a ZIP archive\n * @param data The raw compressed ZIP file\n * @param cb The callback to call with the decompressed files\n * @returns A function that can be used to immediately terminate the unzipping\n */\nexport function unzip(data, cb) {\n    if (typeof cb != 'function')\n        throw 'no callback';\n    var term = [];\n    var tAll = function () {\n        for (var i = 0; i < term.length; ++i)\n            term[i]();\n    };\n    var files = {};\n    var e = data.length - 22;\n    for (; b4(data, e) != 0x6054B50; --e) {\n        if (!e || data.length - e > 65558) {\n            cb('invalid zip file', null);\n            return;\n        }\n    }\n    ;\n    var lft = b2(data, e + 8);\n    if (!lft)\n        cb(null, {});\n    var c = lft;\n    var o = b4(data, e + 16);\n    var z = o == 4294967295;\n    if (z) {\n        e = b4(data, e - 12);\n        if (b4(data, e) != 0x6064B50) {\n            cb('invalid zip file', null);\n            return;\n        }\n        c = lft = b4(data, e + 32);\n        o = b4(data, e + 48);\n    }\n    var _loop_3 = function (i) {\n        var _a = zh(data, o, z), c_1 = _a[0], sc = _a[1], su = _a[2], fn = _a[3], no = _a[4], off = _a[5], b = slzh(data, off);\n        o = no;\n        var cbl = function (e, d) {\n            if (e) {\n                tAll();\n                cb(e, null);\n            }\n            else {\n                files[fn] = d;\n                if (!--lft)\n                    cb(null, files);\n            }\n        };\n        if (!c_1)\n            cbl(null, slc(data, b, b + sc));\n        else if (c_1 == 8) {\n            var infl = data.subarray(b, b + sc);\n            if (sc < 320000) {\n                try {\n                    cbl(null, inflateSync(infl, new u8(su)));\n                }\n                catch (e) {\n                    cbl(e, null);\n                }\n            }\n            else\n                term.push(inflate(infl, { size: su }, cbl));\n        }\n        else\n            cbl('unknown compression type ' + c_1, null);\n    };\n    for (var i = 0; i < c; ++i) {\n        _loop_3(i);\n    }\n    return tAll;\n}\n/**\n * Synchronously decompresses a ZIP archive. Prefer using `unzip` for better\n * performance with more than one file.\n * @param data The raw compressed ZIP file\n * @returns The decompressed files\n */\nexport function unzipSync(data) {\n    var files = {};\n    var e = data.length - 22;\n    for (; b4(data, e) != 0x6054B50; --e) {\n        if (!e || data.length - e > 65558)\n            throw 'invalid zip file';\n    }\n    ;\n    var c = b2(data, e + 8);\n    if (!c)\n        return {};\n    var o = b4(data, e + 16);\n    var z = o == 4294967295;\n    if (z) {\n        e = b4(data, e - 12);\n        if (b4(data, e) != 0x6064B50)\n            throw 'invalid zip file';\n        c = b4(data, e + 32);\n        o = b4(data, e + 48);\n    }\n    for (var i = 0; i < c; ++i) {\n        var _a = zh(data, o, z), c_2 = _a[0], sc = _a[1], su = _a[2], fn = _a[3], no = _a[4], off = _a[5], b = slzh(data, off);\n        o = no;\n        if (!c_2)\n            files[fn] = slc(data, b, b + sc);\n        else if (c_2 == 8)\n            files[fn] = inflateSync(data.subarray(b, b + sc), new u8(su));\n        else\n            throw 'unknown compression type ' + c_2;\n    }\n    return files;\n}\n","import {\n\tVector3,\n\tVector4\n} from 'three';\n\n/**\n * NURBS utils\n *\n * See NURBSCurve and NURBSSurface.\n **/\n\n\n/**************************************************************\n *\tNURBS Utils\n **************************************************************/\n\n/*\nFinds knot vector span.\n\np : degree\nu : parametric value\nU : knot vector\n\nreturns the span\n*/\nfunction findSpan( p, u, U ) {\n\n\tconst n = U.length - p - 1;\n\n\tif ( u >= U[ n ] ) {\n\n\t\treturn n - 1;\n\n\t}\n\n\tif ( u <= U[ p ] ) {\n\n\t\treturn p;\n\n\t}\n\n\tlet low = p;\n\tlet high = n;\n\tlet mid = Math.floor( ( low + high ) / 2 );\n\n\twhile ( u < U[ mid ] || u >= U[ mid + 1 ] ) {\n\n\t\tif ( u < U[ mid ] ) {\n\n\t\t\thigh = mid;\n\n\t\t} else {\n\n\t\t\tlow = mid;\n\n\t\t}\n\n\t\tmid = Math.floor( ( low + high ) / 2 );\n\n\t}\n\n\treturn mid;\n\n}\n\n\n/*\nCalculate basis functions. See The NURBS Book, page 70, algorithm A2.2\n\nspan : span in which u lies\nu    : parametric point\np    : degree\nU    : knot vector\n\nreturns array[p+1] with basis functions values.\n*/\nfunction calcBasisFunctions( span, u, p, U ) {\n\n\tconst N = [];\n\tconst left = [];\n\tconst right = [];\n\tN[ 0 ] = 1.0;\n\n\tfor ( let j = 1; j <= p; ++ j ) {\n\n\t\tleft[ j ] = u - U[ span + 1 - j ];\n\t\tright[ j ] = U[ span + j ] - u;\n\n\t\tlet saved = 0.0;\n\n\t\tfor ( let r = 0; r < j; ++ r ) {\n\n\t\t\tconst rv = right[ r + 1 ];\n\t\t\tconst lv = left[ j - r ];\n\t\t\tconst temp = N[ r ] / ( rv + lv );\n\t\t\tN[ r ] = saved + rv * temp;\n\t\t\tsaved = lv * temp;\n\n\t\t}\n\n\t\tN[ j ] = saved;\n\n\t}\n\n\treturn N;\n\n}\n\n\n/*\nCalculate B-Spline curve points. See The NURBS Book, page 82, algorithm A3.1.\n\np : degree of B-Spline\nU : knot vector\nP : control points (x, y, z, w)\nu : parametric point\n\nreturns point for given u\n*/\nfunction calcBSplinePoint( p, U, P, u ) {\n\n\tconst span = findSpan( p, u, U );\n\tconst N = calcBasisFunctions( span, u, p, U );\n\tconst C = new Vector4( 0, 0, 0, 0 );\n\n\tfor ( let j = 0; j <= p; ++ j ) {\n\n\t\tconst point = P[ span - p + j ];\n\t\tconst Nj = N[ j ];\n\t\tconst wNj = point.w * Nj;\n\t\tC.x += point.x * wNj;\n\t\tC.y += point.y * wNj;\n\t\tC.z += point.z * wNj;\n\t\tC.w += point.w * Nj;\n\n\t}\n\n\treturn C;\n\n}\n\n\n/*\nCalculate basis functions derivatives. See The NURBS Book, page 72, algorithm A2.3.\n\nspan : span in which u lies\nu    : parametric point\np    : degree\nn    : number of derivatives to calculate\nU    : knot vector\n\nreturns array[n+1][p+1] with basis functions derivatives\n*/\nfunction calcBasisFunctionDerivatives( span, u, p, n, U ) {\n\n\tconst zeroArr = [];\n\tfor ( let i = 0; i <= p; ++ i )\n\t\tzeroArr[ i ] = 0.0;\n\n\tconst ders = [];\n\n\tfor ( let i = 0; i <= n; ++ i )\n\t\tders[ i ] = zeroArr.slice( 0 );\n\n\tconst ndu = [];\n\n\tfor ( let i = 0; i <= p; ++ i )\n\t\tndu[ i ] = zeroArr.slice( 0 );\n\n\tndu[ 0 ][ 0 ] = 1.0;\n\n\tconst left = zeroArr.slice( 0 );\n\tconst right = zeroArr.slice( 0 );\n\n\tfor ( let j = 1; j <= p; ++ j ) {\n\n\t\tleft[ j ] = u - U[ span + 1 - j ];\n\t\tright[ j ] = U[ span + j ] - u;\n\n\t\tlet saved = 0.0;\n\n\t\tfor ( let r = 0; r < j; ++ r ) {\n\n\t\t\tconst rv = right[ r + 1 ];\n\t\t\tconst lv = left[ j - r ];\n\t\t\tndu[ j ][ r ] = rv + lv;\n\n\t\t\tconst temp = ndu[ r ][ j - 1 ] / ndu[ j ][ r ];\n\t\t\tndu[ r ][ j ] = saved + rv * temp;\n\t\t\tsaved = lv * temp;\n\n\t\t}\n\n\t\tndu[ j ][ j ] = saved;\n\n\t}\n\n\tfor ( let j = 0; j <= p; ++ j ) {\n\n\t\tders[ 0 ][ j ] = ndu[ j ][ p ];\n\n\t}\n\n\tfor ( let r = 0; r <= p; ++ r ) {\n\n\t\tlet s1 = 0;\n\t\tlet s2 = 1;\n\n\t\tconst a = [];\n\t\tfor ( let i = 0; i <= p; ++ i ) {\n\n\t\t\ta[ i ] = zeroArr.slice( 0 );\n\n\t\t}\n\n\t\ta[ 0 ][ 0 ] = 1.0;\n\n\t\tfor ( let k = 1; k <= n; ++ k ) {\n\n\t\t\tlet d = 0.0;\n\t\t\tconst rk = r - k;\n\t\t\tconst pk = p - k;\n\n\t\t\tif ( r >= k ) {\n\n\t\t\t\ta[ s2 ][ 0 ] = a[ s1 ][ 0 ] / ndu[ pk + 1 ][ rk ];\n\t\t\t\td = a[ s2 ][ 0 ] * ndu[ rk ][ pk ];\n\n\t\t\t}\n\n\t\t\tconst j1 = ( rk >= - 1 ) ? 1 : - rk;\n\t\t\tconst j2 = ( r - 1 <= pk ) ? k - 1 : p - r;\n\n\t\t\tfor ( let j = j1; j <= j2; ++ j ) {\n\n\t\t\t\ta[ s2 ][ j ] = ( a[ s1 ][ j ] - a[ s1 ][ j - 1 ] ) / ndu[ pk + 1 ][ rk + j ];\n\t\t\t\td += a[ s2 ][ j ] * ndu[ rk + j ][ pk ];\n\n\t\t\t}\n\n\t\t\tif ( r <= pk ) {\n\n\t\t\t\ta[ s2 ][ k ] = - a[ s1 ][ k - 1 ] / ndu[ pk + 1 ][ r ];\n\t\t\t\td += a[ s2 ][ k ] * ndu[ r ][ pk ];\n\n\t\t\t}\n\n\t\t\tders[ k ][ r ] = d;\n\n\t\t\tconst j = s1;\n\t\t\ts1 = s2;\n\t\t\ts2 = j;\n\n\t\t}\n\n\t}\n\n\tlet r = p;\n\n\tfor ( let k = 1; k <= n; ++ k ) {\n\n\t\tfor ( let j = 0; j <= p; ++ j ) {\n\n\t\t\tders[ k ][ j ] *= r;\n\n\t\t}\n\n\t\tr *= p - k;\n\n\t}\n\n\treturn ders;\n\n}\n\n\n/*\n\tCalculate derivatives of a B-Spline. See The NURBS Book, page 93, algorithm A3.2.\n\n\tp  : degree\n\tU  : knot vector\n\tP  : control points\n\tu  : Parametric points\n\tnd : number of derivatives\n\n\treturns array[d+1] with derivatives\n\t*/\nfunction calcBSplineDerivatives( p, U, P, u, nd ) {\n\n\tconst du = nd < p ? nd : p;\n\tconst CK = [];\n\tconst span = findSpan( p, u, U );\n\tconst nders = calcBasisFunctionDerivatives( span, u, p, du, U );\n\tconst Pw = [];\n\n\tfor ( let i = 0; i < P.length; ++ i ) {\n\n\t\tconst point = P[ i ].clone();\n\t\tconst w = point.w;\n\n\t\tpoint.x *= w;\n\t\tpoint.y *= w;\n\t\tpoint.z *= w;\n\n\t\tPw[ i ] = point;\n\n\t}\n\n\tfor ( let k = 0; k <= du; ++ k ) {\n\n\t\tconst point = Pw[ span - p ].clone().multiplyScalar( nders[ k ][ 0 ] );\n\n\t\tfor ( let j = 1; j <= p; ++ j ) {\n\n\t\t\tpoint.add( Pw[ span - p + j ].clone().multiplyScalar( nders[ k ][ j ] ) );\n\n\t\t}\n\n\t\tCK[ k ] = point;\n\n\t}\n\n\tfor ( let k = du + 1; k <= nd + 1; ++ k ) {\n\n\t\tCK[ k ] = new Vector4( 0, 0, 0 );\n\n\t}\n\n\treturn CK;\n\n}\n\n\n/*\nCalculate \"K over I\"\n\nreturns k!/(i!(k-i)!)\n*/\nfunction calcKoverI( k, i ) {\n\n\tlet nom = 1;\n\n\tfor ( let j = 2; j <= k; ++ j ) {\n\n\t\tnom *= j;\n\n\t}\n\n\tlet denom = 1;\n\n\tfor ( let j = 2; j <= i; ++ j ) {\n\n\t\tdenom *= j;\n\n\t}\n\n\tfor ( let j = 2; j <= k - i; ++ j ) {\n\n\t\tdenom *= j;\n\n\t}\n\n\treturn nom / denom;\n\n}\n\n\n/*\nCalculate derivatives (0-nd) of rational curve. See The NURBS Book, page 127, algorithm A4.2.\n\nPders : result of function calcBSplineDerivatives\n\nreturns array with derivatives for rational curve.\n*/\nfunction calcRationalCurveDerivatives( Pders ) {\n\n\tconst nd = Pders.length;\n\tconst Aders = [];\n\tconst wders = [];\n\n\tfor ( let i = 0; i < nd; ++ i ) {\n\n\t\tconst point = Pders[ i ];\n\t\tAders[ i ] = new Vector3( point.x, point.y, point.z );\n\t\twders[ i ] = point.w;\n\n\t}\n\n\tconst CK = [];\n\n\tfor ( let k = 0; k < nd; ++ k ) {\n\n\t\tconst v = Aders[ k ].clone();\n\n\t\tfor ( let i = 1; i <= k; ++ i ) {\n\n\t\t\tv.sub( CK[ k - i ].clone().multiplyScalar( calcKoverI( k, i ) * wders[ i ] ) );\n\n\t\t}\n\n\t\tCK[ k ] = v.divideScalar( wders[ 0 ] );\n\n\t}\n\n\treturn CK;\n\n}\n\n\n/*\nCalculate NURBS curve derivatives. See The NURBS Book, page 127, algorithm A4.2.\n\np  : degree\nU  : knot vector\nP  : control points in homogeneous space\nu  : parametric points\nnd : number of derivatives\n\nreturns array with derivatives.\n*/\nfunction calcNURBSDerivatives( p, U, P, u, nd ) {\n\n\tconst Pders = calcBSplineDerivatives( p, U, P, u, nd );\n\treturn calcRationalCurveDerivatives( Pders );\n\n}\n\n\n/*\nCalculate rational B-Spline surface point. See The NURBS Book, page 134, algorithm A4.3.\n\np1, p2 : degrees of B-Spline surface\nU1, U2 : knot vectors\nP      : control points (x, y, z, w)\nu, v   : parametric values\n\nreturns point for given (u, v)\n*/\nfunction calcSurfacePoint( p, q, U, V, P, u, v, target ) {\n\n\tconst uspan = findSpan( p, u, U );\n\tconst vspan = findSpan( q, v, V );\n\tconst Nu = calcBasisFunctions( uspan, u, p, U );\n\tconst Nv = calcBasisFunctions( vspan, v, q, V );\n\tconst temp = [];\n\n\tfor ( let l = 0; l <= q; ++ l ) {\n\n\t\ttemp[ l ] = new Vector4( 0, 0, 0, 0 );\n\t\tfor ( let k = 0; k <= p; ++ k ) {\n\n\t\t\tconst point = P[ uspan - p + k ][ vspan - q + l ].clone();\n\t\t\tconst w = point.w;\n\t\t\tpoint.x *= w;\n\t\t\tpoint.y *= w;\n\t\t\tpoint.z *= w;\n\t\t\ttemp[ l ].add( point.multiplyScalar( Nu[ k ] ) );\n\n\t\t}\n\n\t}\n\n\tconst Sw = new Vector4( 0, 0, 0, 0 );\n\tfor ( let l = 0; l <= q; ++ l ) {\n\n\t\tSw.add( temp[ l ].multiplyScalar( Nv[ l ] ) );\n\n\t}\n\n\tSw.divideScalar( Sw.w );\n\ttarget.set( Sw.x, Sw.y, Sw.z );\n\n}\n\n\n\nexport {\n\tfindSpan,\n\tcalcBasisFunctions,\n\tcalcBSplinePoint,\n\tcalcBasisFunctionDerivatives,\n\tcalcBSplineDerivatives,\n\tcalcKoverI,\n\tcalcRationalCurveDerivatives,\n\tcalcNURBSDerivatives,\n\tcalcSurfacePoint,\n};\n","import {\n\tCurve,\n\tVector3,\n\tVector4\n} from 'three';\nimport * as NURBSUtils from '../curves/NURBSUtils.js';\n\n/**\n * NURBS curve object\n *\n * Derives from Curve, overriding getPoint and getTangent.\n *\n * Implementation is based on (x, y [, z=0 [, w=1]]) control points with w=weight.\n *\n **/\n\nclass NURBSCurve extends Curve {\n\n\tconstructor(\n\t\tdegree,\n\t\tknots /* array of reals */,\n\t\tcontrolPoints /* array of Vector(2|3|4) */,\n\t\tstartKnot /* index in knots */,\n\t\tendKnot /* index in knots */\n\t) {\n\n\t\tsuper();\n\n\t\tthis.degree = degree;\n\t\tthis.knots = knots;\n\t\tthis.controlPoints = [];\n\t\t// Used by periodic NURBS to remove hidden spans\n\t\tthis.startKnot = startKnot || 0;\n\t\tthis.endKnot = endKnot || ( this.knots.length - 1 );\n\n\t\tfor ( let i = 0; i < controlPoints.length; ++ i ) {\n\n\t\t\t// ensure Vector4 for control points\n\t\t\tconst point = controlPoints[ i ];\n\t\t\tthis.controlPoints[ i ] = new Vector4( point.x, point.y, point.z, point.w );\n\n\t\t}\n\n\t}\n\n\tgetPoint( t, optionalTarget = new Vector3() ) {\n\n\t\tconst point = optionalTarget;\n\n\t\tconst u = this.knots[ this.startKnot ] + t * ( this.knots[ this.endKnot ] - this.knots[ this.startKnot ] ); // linear mapping t->u\n\n\t\t// following results in (wx, wy, wz, w) homogeneous point\n\t\tconst hpoint = NURBSUtils.calcBSplinePoint( this.degree, this.knots, this.controlPoints, u );\n\n\t\tif ( hpoint.w !== 1.0 ) {\n\n\t\t\t// project to 3D space: (wx, wy, wz, w) -> (x, y, z, 1)\n\t\t\thpoint.divideScalar( hpoint.w );\n\n\t\t}\n\n\t\treturn point.set( hpoint.x, hpoint.y, hpoint.z );\n\n\t}\n\n\tgetTangent( t, optionalTarget = new Vector3() ) {\n\n\t\tconst tangent = optionalTarget;\n\n\t\tconst u = this.knots[ 0 ] + t * ( this.knots[ this.knots.length - 1 ] - this.knots[ 0 ] );\n\t\tconst ders = NURBSUtils.calcNURBSDerivatives( this.degree, this.knots, this.controlPoints, u, 1 );\n\t\ttangent.copy( ders[ 1 ] ).normalize();\n\n\t\treturn tangent;\n\n\t}\n\n}\n\nexport { NURBSCurve };\n","import {\n\tAmbientLight,\n\tAnimationClip,\n\tBone,\n\tBufferGeometry,\n\tClampToEdgeWrapping,\n\tColor,\n\tDirectionalLight,\n\tEquirectangularReflectionMapping,\n\tEuler,\n\tFileLoader,\n\tFloat32BufferAttribute,\n\tGroup,\n\tLine,\n\tLineBasicMaterial,\n\tLoader,\n\tLoaderUtils,\n\tMathUtils,\n\tMatrix3,\n\tMatrix4,\n\tMesh,\n\tMeshLambertMaterial,\n\tMeshPhongMaterial,\n\tNumberKeyframeTrack,\n\tObject3D,\n\tOrthographicCamera,\n\tPerspectiveCamera,\n\tPointLight,\n\tPropertyBinding,\n\tQuaternion,\n\tQuaternionKeyframeTrack,\n\tRepeatWrapping,\n\tSkeleton,\n\tSkinnedMesh,\n\tSpotLight,\n\tTexture,\n\tTextureLoader,\n\tUint16BufferAttribute,\n\tVector3,\n\tVector4,\n\tVectorKeyframeTrack,\n\tsRGBEncoding\n} from 'three';\nimport * as fflate from '../libs/fflate.module.js';\nimport { NURBSCurve } from '../curves/NURBSCurve.js';\n\n/**\n * Loader loads FBX file and generates Group representing FBX scene.\n * Requires FBX file to be >= 7.0 and in ASCII or >= 6400 in Binary format\n * Versions lower than this may load but will probably have errors\n *\n * Needs Support:\n *  Morph normals / blend shape normals\n *\n * FBX format references:\n * \thttps://help.autodesk.com/view/FBX/2017/ENU/?guid=__cpp_ref_index_html (C++ SDK reference)\n *\n * Binary format specification:\n *\thttps://code.blender.org/2013/08/fbx-binary-file-format-specification/\n */\n\n\nlet fbxTree;\nlet connections;\nlet sceneGraph;\n\nclass FBXLoader extends Loader {\n\n\tconstructor( manager ) {\n\n\t\tsuper( manager );\n\n\t}\n\n\tload( url, onLoad, onProgress, onError ) {\n\n\t\tconst scope = this;\n\n\t\tconst path = ( scope.path === '' ) ? LoaderUtils.extractUrlBase( url ) : scope.path;\n\n\t\tconst loader = new FileLoader( this.manager );\n\t\tloader.setPath( scope.path );\n\t\tloader.setResponseType( 'arraybuffer' );\n\t\tloader.setRequestHeader( scope.requestHeader );\n\t\tloader.setWithCredentials( scope.withCredentials );\n\n\t\tloader.load( url, function ( buffer ) {\n\n\t\t\ttry {\n\n\t\t\t\tonLoad( scope.parse( buffer, path ) );\n\n\t\t\t} catch ( e ) {\n\n\t\t\t\tif ( onError ) {\n\n\t\t\t\t\tonError( e );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconsole.error( e );\n\n\t\t\t\t}\n\n\t\t\t\tscope.manager.itemError( url );\n\n\t\t\t}\n\n\t\t}, onProgress, onError );\n\n\t}\n\n\tparse( FBXBuffer, path ) {\n\n\t\tif ( isFbxFormatBinary( FBXBuffer ) ) {\n\n\t\t\tfbxTree = new BinaryParser().parse( FBXBuffer );\n\n\t\t} else {\n\n\t\t\tconst FBXText = convertArrayBufferToString( FBXBuffer );\n\n\t\t\tif ( ! isFbxFormatASCII( FBXText ) ) {\n\n\t\t\t\tthrow new Error( 'THREE.FBXLoader: Unknown format.' );\n\n\t\t\t}\n\n\t\t\tif ( getFbxVersion( FBXText ) < 7000 ) {\n\n\t\t\t\tthrow new Error( 'THREE.FBXLoader: FBX version not supported, FileVersion: ' + getFbxVersion( FBXText ) );\n\n\t\t\t}\n\n\t\t\tfbxTree = new TextParser().parse( FBXText );\n\n\t\t}\n\n\t\t// console.log( fbxTree );\n\n\t\tconst textureLoader = new TextureLoader( this.manager ).setPath( this.resourcePath || path ).setCrossOrigin( this.crossOrigin );\n\n\t\treturn new FBXTreeParser( textureLoader, this.manager ).parse( fbxTree );\n\n\t}\n\n}\n\n// Parse the FBXTree object returned by the BinaryParser or TextParser and return a Group\nclass FBXTreeParser {\n\n\tconstructor( textureLoader, manager ) {\n\n\t\tthis.textureLoader = textureLoader;\n\t\tthis.manager = manager;\n\n\t}\n\n\tparse() {\n\n\t\tconnections = this.parseConnections();\n\n\t\tconst images = this.parseImages();\n\t\tconst textures = this.parseTextures( images );\n\t\tconst materials = this.parseMaterials( textures );\n\t\tconst deformers = this.parseDeformers();\n\t\tconst geometryMap = new GeometryParser().parse( deformers );\n\n\t\tthis.parseScene( deformers, geometryMap, materials );\n\n\t\treturn sceneGraph;\n\n\t}\n\n\t// Parses FBXTree.Connections which holds parent-child connections between objects (e.g. material -> texture, model->geometry )\n\t// and details the connection type\n\tparseConnections() {\n\n\t\tconst connectionMap = new Map();\n\n\t\tif ( 'Connections' in fbxTree ) {\n\n\t\t\tconst rawConnections = fbxTree.Connections.connections;\n\n\t\t\trawConnections.forEach( function ( rawConnection ) {\n\n\t\t\t\tconst fromID = rawConnection[ 0 ];\n\t\t\t\tconst toID = rawConnection[ 1 ];\n\t\t\t\tconst relationship = rawConnection[ 2 ];\n\n\t\t\t\tif ( ! connectionMap.has( fromID ) ) {\n\n\t\t\t\t\tconnectionMap.set( fromID, {\n\t\t\t\t\t\tparents: [],\n\t\t\t\t\t\tchildren: []\n\t\t\t\t\t} );\n\n\t\t\t\t}\n\n\t\t\t\tconst parentRelationship = { ID: toID, relationship: relationship };\n\t\t\t\tconnectionMap.get( fromID ).parents.push( parentRelationship );\n\n\t\t\t\tif ( ! connectionMap.has( toID ) ) {\n\n\t\t\t\t\tconnectionMap.set( toID, {\n\t\t\t\t\t\tparents: [],\n\t\t\t\t\t\tchildren: []\n\t\t\t\t\t} );\n\n\t\t\t\t}\n\n\t\t\t\tconst childRelationship = { ID: fromID, relationship: relationship };\n\t\t\t\tconnectionMap.get( toID ).children.push( childRelationship );\n\n\t\t\t} );\n\n\t\t}\n\n\t\treturn connectionMap;\n\n\t}\n\n\t// Parse FBXTree.Objects.Video for embedded image data\n\t// These images are connected to textures in FBXTree.Objects.Textures\n\t// via FBXTree.Connections.\n\tparseImages() {\n\n\t\tconst images = {};\n\t\tconst blobs = {};\n\n\t\tif ( 'Video' in fbxTree.Objects ) {\n\n\t\t\tconst videoNodes = fbxTree.Objects.Video;\n\n\t\t\tfor ( const nodeID in videoNodes ) {\n\n\t\t\t\tconst videoNode = videoNodes[ nodeID ];\n\n\t\t\t\tconst id = parseInt( nodeID );\n\n\t\t\t\timages[ id ] = videoNode.RelativeFilename || videoNode.Filename;\n\n\t\t\t\t// raw image data is in videoNode.Content\n\t\t\t\tif ( 'Content' in videoNode ) {\n\n\t\t\t\t\tconst arrayBufferContent = ( videoNode.Content instanceof ArrayBuffer ) && ( videoNode.Content.byteLength > 0 );\n\t\t\t\t\tconst base64Content = ( typeof videoNode.Content === 'string' ) && ( videoNode.Content !== '' );\n\n\t\t\t\t\tif ( arrayBufferContent || base64Content ) {\n\n\t\t\t\t\t\tconst image = this.parseImage( videoNodes[ nodeID ] );\n\n\t\t\t\t\t\tblobs[ videoNode.RelativeFilename || videoNode.Filename ] = image;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tfor ( const id in images ) {\n\n\t\t\tconst filename = images[ id ];\n\n\t\t\tif ( blobs[ filename ] !== undefined ) images[ id ] = blobs[ filename ];\n\t\t\telse images[ id ] = images[ id ].split( '\\\\' ).pop();\n\n\t\t}\n\n\t\treturn images;\n\n\t}\n\n\t// Parse embedded image data in FBXTree.Video.Content\n\tparseImage( videoNode ) {\n\n\t\tconst content = videoNode.Content;\n\t\tconst fileName = videoNode.RelativeFilename || videoNode.Filename;\n\t\tconst extension = fileName.slice( fileName.lastIndexOf( '.' ) + 1 ).toLowerCase();\n\n\t\tlet type;\n\n\t\tswitch ( extension ) {\n\n\t\t\tcase 'bmp':\n\n\t\t\t\ttype = 'image/bmp';\n\t\t\t\tbreak;\n\n\t\t\tcase 'jpg':\n\t\t\tcase 'jpeg':\n\n\t\t\t\ttype = 'image/jpeg';\n\t\t\t\tbreak;\n\n\t\t\tcase 'png':\n\n\t\t\t\ttype = 'image/png';\n\t\t\t\tbreak;\n\n\t\t\tcase 'tif':\n\n\t\t\t\ttype = 'image/tiff';\n\t\t\t\tbreak;\n\n\t\t\tcase 'tga':\n\n\t\t\t\tif ( this.manager.getHandler( '.tga' ) === null ) {\n\n\t\t\t\t\tconsole.warn( 'FBXLoader: TGA loader not found, skipping ', fileName );\n\n\t\t\t\t}\n\n\t\t\t\ttype = 'image/tga';\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\n\t\t\t\tconsole.warn( 'FBXLoader: Image type \"' + extension + '\" is not supported.' );\n\t\t\t\treturn;\n\n\t\t}\n\n\t\tif ( typeof content === 'string' ) { // ASCII format\n\n\t\t\treturn 'data:' + type + ';base64,' + content;\n\n\t\t} else { // Binary Format\n\n\t\t\tconst array = new Uint8Array( content );\n\t\t\treturn window.URL.createObjectURL( new Blob( [ array ], { type: type } ) );\n\n\t\t}\n\n\t}\n\n\t// Parse nodes in FBXTree.Objects.Texture\n\t// These contain details such as UV scaling, cropping, rotation etc and are connected\n\t// to images in FBXTree.Objects.Video\n\tparseTextures( images ) {\n\n\t\tconst textureMap = new Map();\n\n\t\tif ( 'Texture' in fbxTree.Objects ) {\n\n\t\t\tconst textureNodes = fbxTree.Objects.Texture;\n\t\t\tfor ( const nodeID in textureNodes ) {\n\n\t\t\t\tconst texture = this.parseTexture( textureNodes[ nodeID ], images );\n\t\t\t\ttextureMap.set( parseInt( nodeID ), texture );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn textureMap;\n\n\t}\n\n\t// Parse individual node in FBXTree.Objects.Texture\n\tparseTexture( textureNode, images ) {\n\n\t\tconst texture = this.loadTexture( textureNode, images );\n\n\t\ttexture.ID = textureNode.id;\n\n\t\ttexture.name = textureNode.attrName;\n\n\t\tconst wrapModeU = textureNode.WrapModeU;\n\t\tconst wrapModeV = textureNode.WrapModeV;\n\n\t\tconst valueU = wrapModeU !== undefined ? wrapModeU.value : 0;\n\t\tconst valueV = wrapModeV !== undefined ? wrapModeV.value : 0;\n\n\t\t// http://download.autodesk.com/us/fbx/SDKdocs/FBX_SDK_Help/files/fbxsdkref/class_k_fbx_texture.html#889640e63e2e681259ea81061b85143a\n\t\t// 0: repeat(default), 1: clamp\n\n\t\ttexture.wrapS = valueU === 0 ? RepeatWrapping : ClampToEdgeWrapping;\n\t\ttexture.wrapT = valueV === 0 ? RepeatWrapping : ClampToEdgeWrapping;\n\n\t\tif ( 'Scaling' in textureNode ) {\n\n\t\t\tconst values = textureNode.Scaling.value;\n\n\t\t\ttexture.repeat.x = values[ 0 ];\n\t\t\ttexture.repeat.y = values[ 1 ];\n\n\t\t}\n\n\t\treturn texture;\n\n\t}\n\n\t// load a texture specified as a blob or data URI, or via an external URL using TextureLoader\n\tloadTexture( textureNode, images ) {\n\n\t\tlet fileName;\n\n\t\tconst currentPath = this.textureLoader.path;\n\n\t\tconst children = connections.get( textureNode.id ).children;\n\n\t\tif ( children !== undefined && children.length > 0 && images[ children[ 0 ].ID ] !== undefined ) {\n\n\t\t\tfileName = images[ children[ 0 ].ID ];\n\n\t\t\tif ( fileName.indexOf( 'blob:' ) === 0 || fileName.indexOf( 'data:' ) === 0 ) {\n\n\t\t\t\tthis.textureLoader.setPath( undefined );\n\n\t\t\t}\n\n\t\t}\n\n\t\tlet texture;\n\n\t\tconst extension = textureNode.FileName.slice( - 3 ).toLowerCase();\n\n\t\tif ( extension === 'tga' ) {\n\n\t\t\tconst loader = this.manager.getHandler( '.tga' );\n\n\t\t\tif ( loader === null ) {\n\n\t\t\t\tconsole.warn( 'FBXLoader: TGA loader not found, creating placeholder texture for', textureNode.RelativeFilename );\n\t\t\t\ttexture = new Texture();\n\n\t\t\t} else {\n\n\t\t\t\tloader.setPath( this.textureLoader.path );\n\t\t\t\ttexture = loader.load( fileName );\n\n\t\t\t}\n\n\t\t} else if ( extension === 'psd' ) {\n\n\t\t\tconsole.warn( 'FBXLoader: PSD textures are not supported, creating placeholder texture for', textureNode.RelativeFilename );\n\t\t\ttexture = new Texture();\n\n\t\t} else {\n\n\t\t\ttexture = this.textureLoader.load( fileName );\n\n\t\t}\n\n\t\tthis.textureLoader.setPath( currentPath );\n\n\t\treturn texture;\n\n\t}\n\n\t// Parse nodes in FBXTree.Objects.Material\n\tparseMaterials( textureMap ) {\n\n\t\tconst materialMap = new Map();\n\n\t\tif ( 'Material' in fbxTree.Objects ) {\n\n\t\t\tconst materialNodes = fbxTree.Objects.Material;\n\n\t\t\tfor ( const nodeID in materialNodes ) {\n\n\t\t\t\tconst material = this.parseMaterial( materialNodes[ nodeID ], textureMap );\n\n\t\t\t\tif ( material !== null ) materialMap.set( parseInt( nodeID ), material );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn materialMap;\n\n\t}\n\n\t// Parse single node in FBXTree.Objects.Material\n\t// Materials are connected to texture maps in FBXTree.Objects.Textures\n\t// FBX format currently only supports Lambert and Phong shading models\n\tparseMaterial( materialNode, textureMap ) {\n\n\t\tconst ID = materialNode.id;\n\t\tconst name = materialNode.attrName;\n\t\tlet type = materialNode.ShadingModel;\n\n\t\t// Case where FBX wraps shading model in property object.\n\t\tif ( typeof type === 'object' ) {\n\n\t\t\ttype = type.value;\n\n\t\t}\n\n\t\t// Ignore unused materials which don't have any connections.\n\t\tif ( ! connections.has( ID ) ) return null;\n\n\t\tconst parameters = this.parseParameters( materialNode, textureMap, ID );\n\n\t\tlet material;\n\n\t\tswitch ( type.toLowerCase() ) {\n\n\t\t\tcase 'phong':\n\t\t\t\tmaterial = new MeshPhongMaterial();\n\t\t\t\tbreak;\n\t\t\tcase 'lambert':\n\t\t\t\tmaterial = new MeshLambertMaterial();\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tconsole.warn( 'THREE.FBXLoader: unknown material type \"%s\". Defaulting to MeshPhongMaterial.', type );\n\t\t\t\tmaterial = new MeshPhongMaterial();\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\tmaterial.setValues( parameters );\n\t\tmaterial.name = name;\n\n\t\treturn material;\n\n\t}\n\n\t// Parse FBX material and return parameters suitable for a three.js material\n\t// Also parse the texture map and return any textures associated with the material\n\tparseParameters( materialNode, textureMap, ID ) {\n\n\t\tconst parameters = {};\n\n\t\tif ( materialNode.BumpFactor ) {\n\n\t\t\tparameters.bumpScale = materialNode.BumpFactor.value;\n\n\t\t}\n\n\t\tif ( materialNode.Diffuse ) {\n\n\t\t\tparameters.color = new Color().fromArray( materialNode.Diffuse.value );\n\n\t\t} else if ( materialNode.DiffuseColor && ( materialNode.DiffuseColor.type === 'Color' || materialNode.DiffuseColor.type === 'ColorRGB' ) ) {\n\n\t\t\t// The blender exporter exports diffuse here instead of in materialNode.Diffuse\n\t\t\tparameters.color = new Color().fromArray( materialNode.DiffuseColor.value );\n\n\t\t}\n\n\t\tif ( materialNode.DisplacementFactor ) {\n\n\t\t\tparameters.displacementScale = materialNode.DisplacementFactor.value;\n\n\t\t}\n\n\t\tif ( materialNode.Emissive ) {\n\n\t\t\tparameters.emissive = new Color().fromArray( materialNode.Emissive.value );\n\n\t\t} else if ( materialNode.EmissiveColor && ( materialNode.EmissiveColor.type === 'Color' || materialNode.EmissiveColor.type === 'ColorRGB' ) ) {\n\n\t\t\t// The blender exporter exports emissive color here instead of in materialNode.Emissive\n\t\t\tparameters.emissive = new Color().fromArray( materialNode.EmissiveColor.value );\n\n\t\t}\n\n\t\tif ( materialNode.EmissiveFactor ) {\n\n\t\t\tparameters.emissiveIntensity = parseFloat( materialNode.EmissiveFactor.value );\n\n\t\t}\n\n\t\tif ( materialNode.Opacity ) {\n\n\t\t\tparameters.opacity = parseFloat( materialNode.Opacity.value );\n\n\t\t}\n\n\t\tif ( parameters.opacity < 1.0 ) {\n\n\t\t\tparameters.transparent = true;\n\n\t\t}\n\n\t\tif ( materialNode.ReflectionFactor ) {\n\n\t\t\tparameters.reflectivity = materialNode.ReflectionFactor.value;\n\n\t\t}\n\n\t\tif ( materialNode.Shininess ) {\n\n\t\t\tparameters.shininess = materialNode.Shininess.value;\n\n\t\t}\n\n\t\tif ( materialNode.Specular ) {\n\n\t\t\tparameters.specular = new Color().fromArray( materialNode.Specular.value );\n\n\t\t} else if ( materialNode.SpecularColor && materialNode.SpecularColor.type === 'Color' ) {\n\n\t\t\t// The blender exporter exports specular color here instead of in materialNode.Specular\n\t\t\tparameters.specular = new Color().fromArray( materialNode.SpecularColor.value );\n\n\t\t}\n\n\t\tconst scope = this;\n\t\tconnections.get( ID ).children.forEach( function ( child ) {\n\n\t\t\tconst type = child.relationship;\n\n\t\t\tswitch ( type ) {\n\n\t\t\t\tcase 'Bump':\n\t\t\t\t\tparameters.bumpMap = scope.getTexture( textureMap, child.ID );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'Maya|TEX_ao_map':\n\t\t\t\t\tparameters.aoMap = scope.getTexture( textureMap, child.ID );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'DiffuseColor':\n\t\t\t\tcase 'Maya|TEX_color_map':\n\t\t\t\t\tparameters.map = scope.getTexture( textureMap, child.ID );\n\t\t\t\t\tif ( parameters.map !== undefined ) {\n\n\t\t\t\t\t\tparameters.map.encoding = sRGBEncoding;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'DisplacementColor':\n\t\t\t\t\tparameters.displacementMap = scope.getTexture( textureMap, child.ID );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'EmissiveColor':\n\t\t\t\t\tparameters.emissiveMap = scope.getTexture( textureMap, child.ID );\n\t\t\t\t\tif ( parameters.emissiveMap !== undefined ) {\n\n\t\t\t\t\t\tparameters.emissiveMap.encoding = sRGBEncoding;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'NormalMap':\n\t\t\t\tcase 'Maya|TEX_normal_map':\n\t\t\t\t\tparameters.normalMap = scope.getTexture( textureMap, child.ID );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'ReflectionColor':\n\t\t\t\t\tparameters.envMap = scope.getTexture( textureMap, child.ID );\n\t\t\t\t\tif ( parameters.envMap !== undefined ) {\n\n\t\t\t\t\t\tparameters.envMap.mapping = EquirectangularReflectionMapping;\n\t\t\t\t\t\tparameters.envMap.encoding = sRGBEncoding;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'SpecularColor':\n\t\t\t\t\tparameters.specularMap = scope.getTexture( textureMap, child.ID );\n\t\t\t\t\tif ( parameters.specularMap !== undefined ) {\n\n\t\t\t\t\t\tparameters.specularMap.encoding = sRGBEncoding;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'TransparentColor':\n\t\t\t\tcase 'TransparencyFactor':\n\t\t\t\t\tparameters.alphaMap = scope.getTexture( textureMap, child.ID );\n\t\t\t\t\tparameters.transparent = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'AmbientColor':\n\t\t\t\tcase 'ShininessExponent': // AKA glossiness map\n\t\t\t\tcase 'SpecularFactor': // AKA specularLevel\n\t\t\t\tcase 'VectorDisplacementColor': // NOTE: Seems to be a copy of DisplacementColor\n\t\t\t\tdefault:\n\t\t\t\t\tconsole.warn( 'THREE.FBXLoader: %s map is not supported in three.js, skipping texture.', type );\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t} );\n\n\t\treturn parameters;\n\n\t}\n\n\t// get a texture from the textureMap for use by a material.\n\tgetTexture( textureMap, id ) {\n\n\t\t// if the texture is a layered texture, just use the first layer and issue a warning\n\t\tif ( 'LayeredTexture' in fbxTree.Objects && id in fbxTree.Objects.LayeredTexture ) {\n\n\t\t\tconsole.warn( 'THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer.' );\n\t\t\tid = connections.get( id ).children[ 0 ].ID;\n\n\t\t}\n\n\t\treturn textureMap.get( id );\n\n\t}\n\n\t// Parse nodes in FBXTree.Objects.Deformer\n\t// Deformer node can contain skinning or Vertex Cache animation data, however only skinning is supported here\n\t// Generates map of Skeleton-like objects for use later when generating and binding skeletons.\n\tparseDeformers() {\n\n\t\tconst skeletons = {};\n\t\tconst morphTargets = {};\n\n\t\tif ( 'Deformer' in fbxTree.Objects ) {\n\n\t\t\tconst DeformerNodes = fbxTree.Objects.Deformer;\n\n\t\t\tfor ( const nodeID in DeformerNodes ) {\n\n\t\t\t\tconst deformerNode = DeformerNodes[ nodeID ];\n\n\t\t\t\tconst relationships = connections.get( parseInt( nodeID ) );\n\n\t\t\t\tif ( deformerNode.attrType === 'Skin' ) {\n\n\t\t\t\t\tconst skeleton = this.parseSkeleton( relationships, DeformerNodes );\n\t\t\t\t\tskeleton.ID = nodeID;\n\n\t\t\t\t\tif ( relationships.parents.length > 1 ) console.warn( 'THREE.FBXLoader: skeleton attached to more than one geometry is not supported.' );\n\t\t\t\t\tskeleton.geometryID = relationships.parents[ 0 ].ID;\n\n\t\t\t\t\tskeletons[ nodeID ] = skeleton;\n\n\t\t\t\t} else if ( deformerNode.attrType === 'BlendShape' ) {\n\n\t\t\t\t\tconst morphTarget = {\n\t\t\t\t\t\tid: nodeID,\n\t\t\t\t\t};\n\n\t\t\t\t\tmorphTarget.rawTargets = this.parseMorphTargets( relationships, DeformerNodes );\n\t\t\t\t\tmorphTarget.id = nodeID;\n\n\t\t\t\t\tif ( relationships.parents.length > 1 ) console.warn( 'THREE.FBXLoader: morph target attached to more than one geometry is not supported.' );\n\n\t\t\t\t\tmorphTargets[ nodeID ] = morphTarget;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn {\n\n\t\t\tskeletons: skeletons,\n\t\t\tmorphTargets: morphTargets,\n\n\t\t};\n\n\t}\n\n\t// Parse single nodes in FBXTree.Objects.Deformer\n\t// The top level skeleton node has type 'Skin' and sub nodes have type 'Cluster'\n\t// Each skin node represents a skeleton and each cluster node represents a bone\n\tparseSkeleton( relationships, deformerNodes ) {\n\n\t\tconst rawBones = [];\n\n\t\trelationships.children.forEach( function ( child ) {\n\n\t\t\tconst boneNode = deformerNodes[ child.ID ];\n\n\t\t\tif ( boneNode.attrType !== 'Cluster' ) return;\n\n\t\t\tconst rawBone = {\n\n\t\t\t\tID: child.ID,\n\t\t\t\tindices: [],\n\t\t\t\tweights: [],\n\t\t\t\ttransformLink: new Matrix4().fromArray( boneNode.TransformLink.a ),\n\t\t\t\t// transform: new Matrix4().fromArray( boneNode.Transform.a ),\n\t\t\t\t// linkMode: boneNode.Mode,\n\n\t\t\t};\n\n\t\t\tif ( 'Indexes' in boneNode ) {\n\n\t\t\t\trawBone.indices = boneNode.Indexes.a;\n\t\t\t\trawBone.weights = boneNode.Weights.a;\n\n\t\t\t}\n\n\t\t\trawBones.push( rawBone );\n\n\t\t} );\n\n\t\treturn {\n\n\t\t\trawBones: rawBones,\n\t\t\tbones: []\n\n\t\t};\n\n\t}\n\n\t// The top level morph deformer node has type \"BlendShape\" and sub nodes have type \"BlendShapeChannel\"\n\tparseMorphTargets( relationships, deformerNodes ) {\n\n\t\tconst rawMorphTargets = [];\n\n\t\tfor ( let i = 0; i < relationships.children.length; i ++ ) {\n\n\t\t\tconst child = relationships.children[ i ];\n\n\t\t\tconst morphTargetNode = deformerNodes[ child.ID ];\n\n\t\t\tconst rawMorphTarget = {\n\n\t\t\t\tname: morphTargetNode.attrName,\n\t\t\t\tinitialWeight: morphTargetNode.DeformPercent,\n\t\t\t\tid: morphTargetNode.id,\n\t\t\t\tfullWeights: morphTargetNode.FullWeights.a\n\n\t\t\t};\n\n\t\t\tif ( morphTargetNode.attrType !== 'BlendShapeChannel' ) return;\n\n\t\t\trawMorphTarget.geoID = connections.get( parseInt( child.ID ) ).children.filter( function ( child ) {\n\n\t\t\t\treturn child.relationship === undefined;\n\n\t\t\t} )[ 0 ].ID;\n\n\t\t\trawMorphTargets.push( rawMorphTarget );\n\n\t\t}\n\n\t\treturn rawMorphTargets;\n\n\t}\n\n\t// create the main Group() to be returned by the loader\n\tparseScene( deformers, geometryMap, materialMap ) {\n\n\t\tsceneGraph = new Group();\n\n\t\tconst modelMap = this.parseModels( deformers.skeletons, geometryMap, materialMap );\n\n\t\tconst modelNodes = fbxTree.Objects.Model;\n\n\t\tconst scope = this;\n\t\tmodelMap.forEach( function ( model ) {\n\n\t\t\tconst modelNode = modelNodes[ model.ID ];\n\t\t\tscope.setLookAtProperties( model, modelNode );\n\n\t\t\tconst parentConnections = connections.get( model.ID ).parents;\n\n\t\t\tparentConnections.forEach( function ( connection ) {\n\n\t\t\t\tconst parent = modelMap.get( connection.ID );\n\t\t\t\tif ( parent !== undefined ) parent.add( model );\n\n\t\t\t} );\n\n\t\t\tif ( model.parent === null ) {\n\n\t\t\t\tsceneGraph.add( model );\n\n\t\t\t}\n\n\n\t\t} );\n\n\t\tthis.bindSkeleton( deformers.skeletons, geometryMap, modelMap );\n\n\t\tthis.createAmbientLight();\n\n\t\tsceneGraph.traverse( function ( node ) {\n\n\t\t\tif ( node.userData.transformData ) {\n\n\t\t\t\tif ( node.parent ) {\n\n\t\t\t\t\tnode.userData.transformData.parentMatrix = node.parent.matrix;\n\t\t\t\t\tnode.userData.transformData.parentMatrixWorld = node.parent.matrixWorld;\n\n\t\t\t\t}\n\n\t\t\t\tconst transform = generateTransform( node.userData.transformData );\n\n\t\t\t\tnode.applyMatrix4( transform );\n\t\t\t\tnode.updateWorldMatrix();\n\n\t\t\t}\n\n\t\t} );\n\n\t\tconst animations = new AnimationParser().parse();\n\n\t\t// if all the models where already combined in a single group, just return that\n\t\tif ( sceneGraph.children.length === 1 && sceneGraph.children[ 0 ].isGroup ) {\n\n\t\t\tsceneGraph.children[ 0 ].animations = animations;\n\t\t\tsceneGraph = sceneGraph.children[ 0 ];\n\n\t\t}\n\n\t\tsceneGraph.animations = animations;\n\n\t}\n\n\t// parse nodes in FBXTree.Objects.Model\n\tparseModels( skeletons, geometryMap, materialMap ) {\n\n\t\tconst modelMap = new Map();\n\t\tconst modelNodes = fbxTree.Objects.Model;\n\n\t\tfor ( const nodeID in modelNodes ) {\n\n\t\t\tconst id = parseInt( nodeID );\n\t\t\tconst node = modelNodes[ nodeID ];\n\t\t\tconst relationships = connections.get( id );\n\n\t\t\tlet model = this.buildSkeleton( relationships, skeletons, id, node.attrName );\n\n\t\t\tif ( ! model ) {\n\n\t\t\t\tswitch ( node.attrType ) {\n\n\t\t\t\t\tcase 'Camera':\n\t\t\t\t\t\tmodel = this.createCamera( relationships );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'Light':\n\t\t\t\t\t\tmodel = this.createLight( relationships );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'Mesh':\n\t\t\t\t\t\tmodel = this.createMesh( relationships, geometryMap, materialMap );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'NurbsCurve':\n\t\t\t\t\t\tmodel = this.createCurve( relationships, geometryMap );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'LimbNode':\n\t\t\t\t\tcase 'Root':\n\t\t\t\t\t\tmodel = new Bone();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'Null':\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tmodel = new Group();\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t\tmodel.name = node.attrName ? PropertyBinding.sanitizeNodeName( node.attrName ) : '';\n\n\t\t\t\tmodel.ID = id;\n\n\t\t\t}\n\n\t\t\tthis.getTransformData( model, node );\n\t\t\tmodelMap.set( id, model );\n\n\t\t}\n\n\t\treturn modelMap;\n\n\t}\n\n\tbuildSkeleton( relationships, skeletons, id, name ) {\n\n\t\tlet bone = null;\n\n\t\trelationships.parents.forEach( function ( parent ) {\n\n\t\t\tfor ( const ID in skeletons ) {\n\n\t\t\t\tconst skeleton = skeletons[ ID ];\n\n\t\t\t\tskeleton.rawBones.forEach( function ( rawBone, i ) {\n\n\t\t\t\t\tif ( rawBone.ID === parent.ID ) {\n\n\t\t\t\t\t\tconst subBone = bone;\n\t\t\t\t\t\tbone = new Bone();\n\n\t\t\t\t\t\tbone.matrixWorld.copy( rawBone.transformLink );\n\n\t\t\t\t\t\t// set name and id here - otherwise in cases where \"subBone\" is created it will not have a name / id\n\n\t\t\t\t\t\tbone.name = name ? PropertyBinding.sanitizeNodeName( name ) : '';\n\t\t\t\t\t\tbone.ID = id;\n\n\t\t\t\t\t\tskeleton.bones[ i ] = bone;\n\n\t\t\t\t\t\t// In cases where a bone is shared between multiple meshes\n\t\t\t\t\t\t// duplicate the bone here and and it as a child of the first bone\n\t\t\t\t\t\tif ( subBone !== null ) {\n\n\t\t\t\t\t\t\tbone.add( subBone );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t} );\n\n\t\t\t}\n\n\t\t} );\n\n\t\treturn bone;\n\n\t}\n\n\t// create a PerspectiveCamera or OrthographicCamera\n\tcreateCamera( relationships ) {\n\n\t\tlet model;\n\t\tlet cameraAttribute;\n\n\t\trelationships.children.forEach( function ( child ) {\n\n\t\t\tconst attr = fbxTree.Objects.NodeAttribute[ child.ID ];\n\n\t\t\tif ( attr !== undefined ) {\n\n\t\t\t\tcameraAttribute = attr;\n\n\t\t\t}\n\n\t\t} );\n\n\t\tif ( cameraAttribute === undefined ) {\n\n\t\t\tmodel = new Object3D();\n\n\t\t} else {\n\n\t\t\tlet type = 0;\n\t\t\tif ( cameraAttribute.CameraProjectionType !== undefined && cameraAttribute.CameraProjectionType.value === 1 ) {\n\n\t\t\t\ttype = 1;\n\n\t\t\t}\n\n\t\t\tlet nearClippingPlane = 1;\n\t\t\tif ( cameraAttribute.NearPlane !== undefined ) {\n\n\t\t\t\tnearClippingPlane = cameraAttribute.NearPlane.value / 1000;\n\n\t\t\t}\n\n\t\t\tlet farClippingPlane = 1000;\n\t\t\tif ( cameraAttribute.FarPlane !== undefined ) {\n\n\t\t\t\tfarClippingPlane = cameraAttribute.FarPlane.value / 1000;\n\n\t\t\t}\n\n\n\t\t\tlet width = window.innerWidth;\n\t\t\tlet height = window.innerHeight;\n\n\t\t\tif ( cameraAttribute.AspectWidth !== undefined && cameraAttribute.AspectHeight !== undefined ) {\n\n\t\t\t\twidth = cameraAttribute.AspectWidth.value;\n\t\t\t\theight = cameraAttribute.AspectHeight.value;\n\n\t\t\t}\n\n\t\t\tconst aspect = width / height;\n\n\t\t\tlet fov = 45;\n\t\t\tif ( cameraAttribute.FieldOfView !== undefined ) {\n\n\t\t\t\tfov = cameraAttribute.FieldOfView.value;\n\n\t\t\t}\n\n\t\t\tconst focalLength = cameraAttribute.FocalLength ? cameraAttribute.FocalLength.value : null;\n\n\t\t\tswitch ( type ) {\n\n\t\t\t\tcase 0: // Perspective\n\t\t\t\t\tmodel = new PerspectiveCamera( fov, aspect, nearClippingPlane, farClippingPlane );\n\t\t\t\t\tif ( focalLength !== null ) model.setFocalLength( focalLength );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 1: // Orthographic\n\t\t\t\t\tmodel = new OrthographicCamera( - width / 2, width / 2, height / 2, - height / 2, nearClippingPlane, farClippingPlane );\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tconsole.warn( 'THREE.FBXLoader: Unknown camera type ' + type + '.' );\n\t\t\t\t\tmodel = new Object3D();\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn model;\n\n\t}\n\n\t// Create a DirectionalLight, PointLight or SpotLight\n\tcreateLight( relationships ) {\n\n\t\tlet model;\n\t\tlet lightAttribute;\n\n\t\trelationships.children.forEach( function ( child ) {\n\n\t\t\tconst attr = fbxTree.Objects.NodeAttribute[ child.ID ];\n\n\t\t\tif ( attr !== undefined ) {\n\n\t\t\t\tlightAttribute = attr;\n\n\t\t\t}\n\n\t\t} );\n\n\t\tif ( lightAttribute === undefined ) {\n\n\t\t\tmodel = new Object3D();\n\n\t\t} else {\n\n\t\t\tlet type;\n\n\t\t\t// LightType can be undefined for Point lights\n\t\t\tif ( lightAttribute.LightType === undefined ) {\n\n\t\t\t\ttype = 0;\n\n\t\t\t} else {\n\n\t\t\t\ttype = lightAttribute.LightType.value;\n\n\t\t\t}\n\n\t\t\tlet color = 0xffffff;\n\n\t\t\tif ( lightAttribute.Color !== undefined ) {\n\n\t\t\t\tcolor = new Color().fromArray( lightAttribute.Color.value );\n\n\t\t\t}\n\n\t\t\tlet intensity = ( lightAttribute.Intensity === undefined ) ? 1 : lightAttribute.Intensity.value / 100;\n\n\t\t\t// light disabled\n\t\t\tif ( lightAttribute.CastLightOnObject !== undefined && lightAttribute.CastLightOnObject.value === 0 ) {\n\n\t\t\t\tintensity = 0;\n\n\t\t\t}\n\n\t\t\tlet distance = 0;\n\t\t\tif ( lightAttribute.FarAttenuationEnd !== undefined ) {\n\n\t\t\t\tif ( lightAttribute.EnableFarAttenuation !== undefined && lightAttribute.EnableFarAttenuation.value === 0 ) {\n\n\t\t\t\t\tdistance = 0;\n\n\t\t\t\t} else {\n\n\t\t\t\t\tdistance = lightAttribute.FarAttenuationEnd.value;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// TODO: could this be calculated linearly from FarAttenuationStart to FarAttenuationEnd?\n\t\t\tconst decay = 1;\n\n\t\t\tswitch ( type ) {\n\n\t\t\t\tcase 0: // Point\n\t\t\t\t\tmodel = new PointLight( color, intensity, distance, decay );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 1: // Directional\n\t\t\t\t\tmodel = new DirectionalLight( color, intensity );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 2: // Spot\n\t\t\t\t\tlet angle = Math.PI / 3;\n\n\t\t\t\t\tif ( lightAttribute.InnerAngle !== undefined ) {\n\n\t\t\t\t\t\tangle = MathUtils.degToRad( lightAttribute.InnerAngle.value );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tlet penumbra = 0;\n\t\t\t\t\tif ( lightAttribute.OuterAngle !== undefined ) {\n\n\t\t\t\t\t\t// TODO: this is not correct - FBX calculates outer and inner angle in degrees\n\t\t\t\t\t\t// with OuterAngle > InnerAngle && OuterAngle <= Math.PI\n\t\t\t\t\t\t// while three.js uses a penumbra between (0, 1) to attenuate the inner angle\n\t\t\t\t\t\tpenumbra = MathUtils.degToRad( lightAttribute.OuterAngle.value );\n\t\t\t\t\t\tpenumbra = Math.max( penumbra, 1 );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tmodel = new SpotLight( color, intensity, distance, angle, penumbra, decay );\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tconsole.warn( 'THREE.FBXLoader: Unknown light type ' + lightAttribute.LightType.value + ', defaulting to a PointLight.' );\n\t\t\t\t\tmodel = new PointLight( color, intensity );\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t\tif ( lightAttribute.CastShadows !== undefined && lightAttribute.CastShadows.value === 1 ) {\n\n\t\t\t\tmodel.castShadow = true;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn model;\n\n\t}\n\n\tcreateMesh( relationships, geometryMap, materialMap ) {\n\n\t\tlet model;\n\t\tlet geometry = null;\n\t\tlet material = null;\n\t\tconst materials = [];\n\n\t\t// get geometry and materials(s) from connections\n\t\trelationships.children.forEach( function ( child ) {\n\n\t\t\tif ( geometryMap.has( child.ID ) ) {\n\n\t\t\t\tgeometry = geometryMap.get( child.ID );\n\n\t\t\t}\n\n\t\t\tif ( materialMap.has( child.ID ) ) {\n\n\t\t\t\tmaterials.push( materialMap.get( child.ID ) );\n\n\t\t\t}\n\n\t\t} );\n\n\t\tif ( materials.length > 1 ) {\n\n\t\t\tmaterial = materials;\n\n\t\t} else if ( materials.length > 0 ) {\n\n\t\t\tmaterial = materials[ 0 ];\n\n\t\t} else {\n\n\t\t\tmaterial = new MeshPhongMaterial( { color: 0xcccccc } );\n\t\t\tmaterials.push( material );\n\n\t\t}\n\n\t\tif ( 'color' in geometry.attributes ) {\n\n\t\t\tmaterials.forEach( function ( material ) {\n\n\t\t\t\tmaterial.vertexColors = true;\n\n\t\t\t} );\n\n\t\t}\n\n\t\tif ( geometry.FBX_Deformer ) {\n\n\t\t\tmodel = new SkinnedMesh( geometry, material );\n\t\t\tmodel.normalizeSkinWeights();\n\n\t\t} else {\n\n\t\t\tmodel = new Mesh( geometry, material );\n\n\t\t}\n\n\t\treturn model;\n\n\t}\n\n\tcreateCurve( relationships, geometryMap ) {\n\n\t\tconst geometry = relationships.children.reduce( function ( geo, child ) {\n\n\t\t\tif ( geometryMap.has( child.ID ) ) geo = geometryMap.get( child.ID );\n\n\t\t\treturn geo;\n\n\t\t}, null );\n\n\t\t// FBX does not list materials for Nurbs lines, so we'll just put our own in here.\n\t\tconst material = new LineBasicMaterial( { color: 0x3300ff, linewidth: 1 } );\n\t\treturn new Line( geometry, material );\n\n\t}\n\n\t// parse the model node for transform data\n\tgetTransformData( model, modelNode ) {\n\n\t\tconst transformData = {};\n\n\t\tif ( 'InheritType' in modelNode ) transformData.inheritType = parseInt( modelNode.InheritType.value );\n\n\t\tif ( 'RotationOrder' in modelNode ) transformData.eulerOrder = getEulerOrder( modelNode.RotationOrder.value );\n\t\telse transformData.eulerOrder = 'ZYX';\n\n\t\tif ( 'Lcl_Translation' in modelNode ) transformData.translation = modelNode.Lcl_Translation.value;\n\n\t\tif ( 'PreRotation' in modelNode ) transformData.preRotation = modelNode.PreRotation.value;\n\t\tif ( 'Lcl_Rotation' in modelNode ) transformData.rotation = modelNode.Lcl_Rotation.value;\n\t\tif ( 'PostRotation' in modelNode ) transformData.postRotation = modelNode.PostRotation.value;\n\n\t\tif ( 'Lcl_Scaling' in modelNode ) transformData.scale = modelNode.Lcl_Scaling.value;\n\n\t\tif ( 'ScalingOffset' in modelNode ) transformData.scalingOffset = modelNode.ScalingOffset.value;\n\t\tif ( 'ScalingPivot' in modelNode ) transformData.scalingPivot = modelNode.ScalingPivot.value;\n\n\t\tif ( 'RotationOffset' in modelNode ) transformData.rotationOffset = modelNode.RotationOffset.value;\n\t\tif ( 'RotationPivot' in modelNode ) transformData.rotationPivot = modelNode.RotationPivot.value;\n\n\t\tmodel.userData.transformData = transformData;\n\n\t}\n\n\tsetLookAtProperties( model, modelNode ) {\n\n\t\tif ( 'LookAtProperty' in modelNode ) {\n\n\t\t\tconst children = connections.get( model.ID ).children;\n\n\t\t\tchildren.forEach( function ( child ) {\n\n\t\t\t\tif ( child.relationship === 'LookAtProperty' ) {\n\n\t\t\t\t\tconst lookAtTarget = fbxTree.Objects.Model[ child.ID ];\n\n\t\t\t\t\tif ( 'Lcl_Translation' in lookAtTarget ) {\n\n\t\t\t\t\t\tconst pos = lookAtTarget.Lcl_Translation.value;\n\n\t\t\t\t\t\t// DirectionalLight, SpotLight\n\t\t\t\t\t\tif ( model.target !== undefined ) {\n\n\t\t\t\t\t\t\tmodel.target.position.fromArray( pos );\n\t\t\t\t\t\t\tsceneGraph.add( model.target );\n\n\t\t\t\t\t\t} else { // Cameras and other Object3Ds\n\n\t\t\t\t\t\t\tmodel.lookAt( new Vector3().fromArray( pos ) );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t}\n\n\t}\n\n\tbindSkeleton( skeletons, geometryMap, modelMap ) {\n\n\t\tconst bindMatrices = this.parsePoseNodes();\n\n\t\tfor ( const ID in skeletons ) {\n\n\t\t\tconst skeleton = skeletons[ ID ];\n\n\t\t\tconst parents = connections.get( parseInt( skeleton.ID ) ).parents;\n\n\t\t\tparents.forEach( function ( parent ) {\n\n\t\t\t\tif ( geometryMap.has( parent.ID ) ) {\n\n\t\t\t\t\tconst geoID = parent.ID;\n\t\t\t\t\tconst geoRelationships = connections.get( geoID );\n\n\t\t\t\t\tgeoRelationships.parents.forEach( function ( geoConnParent ) {\n\n\t\t\t\t\t\tif ( modelMap.has( geoConnParent.ID ) ) {\n\n\t\t\t\t\t\t\tconst model = modelMap.get( geoConnParent.ID );\n\n\t\t\t\t\t\t\tmodel.bind( new Skeleton( skeleton.bones ), bindMatrices[ geoConnParent.ID ] );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t} );\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t}\n\n\t}\n\n\tparsePoseNodes() {\n\n\t\tconst bindMatrices = {};\n\n\t\tif ( 'Pose' in fbxTree.Objects ) {\n\n\t\t\tconst BindPoseNode = fbxTree.Objects.Pose;\n\n\t\t\tfor ( const nodeID in BindPoseNode ) {\n\n\t\t\t\tif ( BindPoseNode[ nodeID ].attrType === 'BindPose' && BindPoseNode[ nodeID ].NbPoseNodes > 0 ) {\n\n\t\t\t\t\tconst poseNodes = BindPoseNode[ nodeID ].PoseNode;\n\n\t\t\t\t\tif ( Array.isArray( poseNodes ) ) {\n\n\t\t\t\t\t\tposeNodes.forEach( function ( poseNode ) {\n\n\t\t\t\t\t\t\tbindMatrices[ poseNode.Node ] = new Matrix4().fromArray( poseNode.Matrix.a );\n\n\t\t\t\t\t\t} );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tbindMatrices[ poseNodes.Node ] = new Matrix4().fromArray( poseNodes.Matrix.a );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn bindMatrices;\n\n\t}\n\n\t// Parse ambient color in FBXTree.GlobalSettings - if it's not set to black (default), create an ambient light\n\tcreateAmbientLight() {\n\n\t\tif ( 'GlobalSettings' in fbxTree && 'AmbientColor' in fbxTree.GlobalSettings ) {\n\n\t\t\tconst ambientColor = fbxTree.GlobalSettings.AmbientColor.value;\n\t\t\tconst r = ambientColor[ 0 ];\n\t\t\tconst g = ambientColor[ 1 ];\n\t\t\tconst b = ambientColor[ 2 ];\n\n\t\t\tif ( r !== 0 || g !== 0 || b !== 0 ) {\n\n\t\t\t\tconst color = new Color( r, g, b );\n\t\t\t\tsceneGraph.add( new AmbientLight( color, 1 ) );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n}\n\n// parse Geometry data from FBXTree and return map of BufferGeometries\nclass GeometryParser {\n\n\t// Parse nodes in FBXTree.Objects.Geometry\n\tparse( deformers ) {\n\n\t\tconst geometryMap = new Map();\n\n\t\tif ( 'Geometry' in fbxTree.Objects ) {\n\n\t\t\tconst geoNodes = fbxTree.Objects.Geometry;\n\n\t\t\tfor ( const nodeID in geoNodes ) {\n\n\t\t\t\tconst relationships = connections.get( parseInt( nodeID ) );\n\t\t\t\tconst geo = this.parseGeometry( relationships, geoNodes[ nodeID ], deformers );\n\n\t\t\t\tgeometryMap.set( parseInt( nodeID ), geo );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn geometryMap;\n\n\t}\n\n\t// Parse single node in FBXTree.Objects.Geometry\n\tparseGeometry( relationships, geoNode, deformers ) {\n\n\t\tswitch ( geoNode.attrType ) {\n\n\t\t\tcase 'Mesh':\n\t\t\t\treturn this.parseMeshGeometry( relationships, geoNode, deformers );\n\t\t\t\tbreak;\n\n\t\t\tcase 'NurbsCurve':\n\t\t\t\treturn this.parseNurbsGeometry( geoNode );\n\t\t\t\tbreak;\n\n\t\t}\n\n\t}\n\n\t// Parse single node mesh geometry in FBXTree.Objects.Geometry\n\tparseMeshGeometry( relationships, geoNode, deformers ) {\n\n\t\tconst skeletons = deformers.skeletons;\n\t\tconst morphTargets = [];\n\n\t\tconst modelNodes = relationships.parents.map( function ( parent ) {\n\n\t\t\treturn fbxTree.Objects.Model[ parent.ID ];\n\n\t\t} );\n\n\t\t// don't create geometry if it is not associated with any models\n\t\tif ( modelNodes.length === 0 ) return;\n\n\t\tconst skeleton = relationships.children.reduce( function ( skeleton, child ) {\n\n\t\t\tif ( skeletons[ child.ID ] !== undefined ) skeleton = skeletons[ child.ID ];\n\n\t\t\treturn skeleton;\n\n\t\t}, null );\n\n\t\trelationships.children.forEach( function ( child ) {\n\n\t\t\tif ( deformers.morphTargets[ child.ID ] !== undefined ) {\n\n\t\t\t\tmorphTargets.push( deformers.morphTargets[ child.ID ] );\n\n\t\t\t}\n\n\t\t} );\n\n\t\t// Assume one model and get the preRotation from that\n\t\t// if there is more than one model associated with the geometry this may cause problems\n\t\tconst modelNode = modelNodes[ 0 ];\n\n\t\tconst transformData = {};\n\n\t\tif ( 'RotationOrder' in modelNode ) transformData.eulerOrder = getEulerOrder( modelNode.RotationOrder.value );\n\t\tif ( 'InheritType' in modelNode ) transformData.inheritType = parseInt( modelNode.InheritType.value );\n\n\t\tif ( 'GeometricTranslation' in modelNode ) transformData.translation = modelNode.GeometricTranslation.value;\n\t\tif ( 'GeometricRotation' in modelNode ) transformData.rotation = modelNode.GeometricRotation.value;\n\t\tif ( 'GeometricScaling' in modelNode ) transformData.scale = modelNode.GeometricScaling.value;\n\n\t\tconst transform = generateTransform( transformData );\n\n\t\treturn this.genGeometry( geoNode, skeleton, morphTargets, transform );\n\n\t}\n\n\t// Generate a BufferGeometry from a node in FBXTree.Objects.Geometry\n\tgenGeometry( geoNode, skeleton, morphTargets, preTransform ) {\n\n\t\tconst geo = new BufferGeometry();\n\t\tif ( geoNode.attrName ) geo.name = geoNode.attrName;\n\n\t\tconst geoInfo = this.parseGeoNode( geoNode, skeleton );\n\t\tconst buffers = this.genBuffers( geoInfo );\n\n\t\tconst positionAttribute = new Float32BufferAttribute( buffers.vertex, 3 );\n\n\t\tpositionAttribute.applyMatrix4( preTransform );\n\n\t\tgeo.setAttribute( 'position', positionAttribute );\n\n\t\tif ( buffers.colors.length > 0 ) {\n\n\t\t\tgeo.setAttribute( 'color', new Float32BufferAttribute( buffers.colors, 3 ) );\n\n\t\t}\n\n\t\tif ( skeleton ) {\n\n\t\t\tgeo.setAttribute( 'skinIndex', new Uint16BufferAttribute( buffers.weightsIndices, 4 ) );\n\n\t\t\tgeo.setAttribute( 'skinWeight', new Float32BufferAttribute( buffers.vertexWeights, 4 ) );\n\n\t\t\t// used later to bind the skeleton to the model\n\t\t\tgeo.FBX_Deformer = skeleton;\n\n\t\t}\n\n\t\tif ( buffers.normal.length > 0 ) {\n\n\t\t\tconst normalMatrix = new Matrix3().getNormalMatrix( preTransform );\n\n\t\t\tconst normalAttribute = new Float32BufferAttribute( buffers.normal, 3 );\n\t\t\tnormalAttribute.applyNormalMatrix( normalMatrix );\n\n\t\t\tgeo.setAttribute( 'normal', normalAttribute );\n\n\t\t}\n\n\t\tbuffers.uvs.forEach( function ( uvBuffer, i ) {\n\n\t\t\t// subsequent uv buffers are called 'uv1', 'uv2', ...\n\t\t\tlet name = 'uv' + ( i + 1 ).toString();\n\n\t\t\t// the first uv buffer is just called 'uv'\n\t\t\tif ( i === 0 ) {\n\n\t\t\t\tname = 'uv';\n\n\t\t\t}\n\n\t\t\tgeo.setAttribute( name, new Float32BufferAttribute( buffers.uvs[ i ], 2 ) );\n\n\t\t} );\n\n\t\tif ( geoInfo.material && geoInfo.material.mappingType !== 'AllSame' ) {\n\n\t\t\t// Convert the material indices of each vertex into rendering groups on the geometry.\n\t\t\tlet prevMaterialIndex = buffers.materialIndex[ 0 ];\n\t\t\tlet startIndex = 0;\n\n\t\t\tbuffers.materialIndex.forEach( function ( currentIndex, i ) {\n\n\t\t\t\tif ( currentIndex !== prevMaterialIndex ) {\n\n\t\t\t\t\tgeo.addGroup( startIndex, i - startIndex, prevMaterialIndex );\n\n\t\t\t\t\tprevMaterialIndex = currentIndex;\n\t\t\t\t\tstartIndex = i;\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t\t// the loop above doesn't add the last group, do that here.\n\t\t\tif ( geo.groups.length > 0 ) {\n\n\t\t\t\tconst lastGroup = geo.groups[ geo.groups.length - 1 ];\n\t\t\t\tconst lastIndex = lastGroup.start + lastGroup.count;\n\n\t\t\t\tif ( lastIndex !== buffers.materialIndex.length ) {\n\n\t\t\t\t\tgeo.addGroup( lastIndex, buffers.materialIndex.length - lastIndex, prevMaterialIndex );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// case where there are multiple materials but the whole geometry is only\n\t\t\t// using one of them\n\t\t\tif ( geo.groups.length === 0 ) {\n\n\t\t\t\tgeo.addGroup( 0, buffers.materialIndex.length, buffers.materialIndex[ 0 ] );\n\n\t\t\t}\n\n\t\t}\n\n\t\tthis.addMorphTargets( geo, geoNode, morphTargets, preTransform );\n\n\t\treturn geo;\n\n\t}\n\n\tparseGeoNode( geoNode, skeleton ) {\n\n\t\tconst geoInfo = {};\n\n\t\tgeoInfo.vertexPositions = ( geoNode.Vertices !== undefined ) ? geoNode.Vertices.a : [];\n\t\tgeoInfo.vertexIndices = ( geoNode.PolygonVertexIndex !== undefined ) ? geoNode.PolygonVertexIndex.a : [];\n\n\t\tif ( geoNode.LayerElementColor ) {\n\n\t\t\tgeoInfo.color = this.parseVertexColors( geoNode.LayerElementColor[ 0 ] );\n\n\t\t}\n\n\t\tif ( geoNode.LayerElementMaterial ) {\n\n\t\t\tgeoInfo.material = this.parseMaterialIndices( geoNode.LayerElementMaterial[ 0 ] );\n\n\t\t}\n\n\t\tif ( geoNode.LayerElementNormal ) {\n\n\t\t\tgeoInfo.normal = this.parseNormals( geoNode.LayerElementNormal[ 0 ] );\n\n\t\t}\n\n\t\tif ( geoNode.LayerElementUV ) {\n\n\t\t\tgeoInfo.uv = [];\n\n\t\t\tlet i = 0;\n\t\t\twhile ( geoNode.LayerElementUV[ i ] ) {\n\n\t\t\t\tif ( geoNode.LayerElementUV[ i ].UV ) {\n\n\t\t\t\t\tgeoInfo.uv.push( this.parseUVs( geoNode.LayerElementUV[ i ] ) );\n\n\t\t\t\t}\n\n\t\t\t\ti ++;\n\n\t\t\t}\n\n\t\t}\n\n\t\tgeoInfo.weightTable = {};\n\n\t\tif ( skeleton !== null ) {\n\n\t\t\tgeoInfo.skeleton = skeleton;\n\n\t\t\tskeleton.rawBones.forEach( function ( rawBone, i ) {\n\n\t\t\t\t// loop over the bone's vertex indices and weights\n\t\t\t\trawBone.indices.forEach( function ( index, j ) {\n\n\t\t\t\t\tif ( geoInfo.weightTable[ index ] === undefined ) geoInfo.weightTable[ index ] = [];\n\n\t\t\t\t\tgeoInfo.weightTable[ index ].push( {\n\n\t\t\t\t\t\tid: i,\n\t\t\t\t\t\tweight: rawBone.weights[ j ],\n\n\t\t\t\t\t} );\n\n\t\t\t\t} );\n\n\t\t\t} );\n\n\t\t}\n\n\t\treturn geoInfo;\n\n\t}\n\n\tgenBuffers( geoInfo ) {\n\n\t\tconst buffers = {\n\t\t\tvertex: [],\n\t\t\tnormal: [],\n\t\t\tcolors: [],\n\t\t\tuvs: [],\n\t\t\tmaterialIndex: [],\n\t\t\tvertexWeights: [],\n\t\t\tweightsIndices: [],\n\t\t};\n\n\t\tlet polygonIndex = 0;\n\t\tlet faceLength = 0;\n\t\tlet displayedWeightsWarning = false;\n\n\t\t// these will hold data for a single face\n\t\tlet facePositionIndexes = [];\n\t\tlet faceNormals = [];\n\t\tlet faceColors = [];\n\t\tlet faceUVs = [];\n\t\tlet faceWeights = [];\n\t\tlet faceWeightIndices = [];\n\n\t\tconst scope = this;\n\t\tgeoInfo.vertexIndices.forEach( function ( vertexIndex, polygonVertexIndex ) {\n\n\t\t\tlet materialIndex;\n\t\t\tlet endOfFace = false;\n\n\t\t\t// Face index and vertex index arrays are combined in a single array\n\t\t\t// A cube with quad faces looks like this:\n\t\t\t// PolygonVertexIndex: *24 {\n\t\t\t//  a: 0, 1, 3, -3, 2, 3, 5, -5, 4, 5, 7, -7, 6, 7, 1, -1, 1, 7, 5, -4, 6, 0, 2, -5\n\t\t\t//  }\n\t\t\t// Negative numbers mark the end of a face - first face here is 0, 1, 3, -3\n\t\t\t// to find index of last vertex bit shift the index: ^ - 1\n\t\t\tif ( vertexIndex < 0 ) {\n\n\t\t\t\tvertexIndex = vertexIndex ^ - 1; // equivalent to ( x * -1 ) - 1\n\t\t\t\tendOfFace = true;\n\n\t\t\t}\n\n\t\t\tlet weightIndices = [];\n\t\t\tlet weights = [];\n\n\t\t\tfacePositionIndexes.push( vertexIndex * 3, vertexIndex * 3 + 1, vertexIndex * 3 + 2 );\n\n\t\t\tif ( geoInfo.color ) {\n\n\t\t\t\tconst data = getData( polygonVertexIndex, polygonIndex, vertexIndex, geoInfo.color );\n\n\t\t\t\tfaceColors.push( data[ 0 ], data[ 1 ], data[ 2 ] );\n\n\t\t\t}\n\n\t\t\tif ( geoInfo.skeleton ) {\n\n\t\t\t\tif ( geoInfo.weightTable[ vertexIndex ] !== undefined ) {\n\n\t\t\t\t\tgeoInfo.weightTable[ vertexIndex ].forEach( function ( wt ) {\n\n\t\t\t\t\t\tweights.push( wt.weight );\n\t\t\t\t\t\tweightIndices.push( wt.id );\n\n\t\t\t\t\t} );\n\n\n\t\t\t\t}\n\n\t\t\t\tif ( weights.length > 4 ) {\n\n\t\t\t\t\tif ( ! displayedWeightsWarning ) {\n\n\t\t\t\t\t\tconsole.warn( 'THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights.' );\n\t\t\t\t\t\tdisplayedWeightsWarning = true;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tconst wIndex = [ 0, 0, 0, 0 ];\n\t\t\t\t\tconst Weight = [ 0, 0, 0, 0 ];\n\n\t\t\t\t\tweights.forEach( function ( weight, weightIndex ) {\n\n\t\t\t\t\t\tlet currentWeight = weight;\n\t\t\t\t\t\tlet currentIndex = weightIndices[ weightIndex ];\n\n\t\t\t\t\t\tWeight.forEach( function ( comparedWeight, comparedWeightIndex, comparedWeightArray ) {\n\n\t\t\t\t\t\t\tif ( currentWeight > comparedWeight ) {\n\n\t\t\t\t\t\t\t\tcomparedWeightArray[ comparedWeightIndex ] = currentWeight;\n\t\t\t\t\t\t\t\tcurrentWeight = comparedWeight;\n\n\t\t\t\t\t\t\t\tconst tmp = wIndex[ comparedWeightIndex ];\n\t\t\t\t\t\t\t\twIndex[ comparedWeightIndex ] = currentIndex;\n\t\t\t\t\t\t\t\tcurrentIndex = tmp;\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t} );\n\n\t\t\t\t\t} );\n\n\t\t\t\t\tweightIndices = wIndex;\n\t\t\t\t\tweights = Weight;\n\n\t\t\t\t}\n\n\t\t\t\t// if the weight array is shorter than 4 pad with 0s\n\t\t\t\twhile ( weights.length < 4 ) {\n\n\t\t\t\t\tweights.push( 0 );\n\t\t\t\t\tweightIndices.push( 0 );\n\n\t\t\t\t}\n\n\t\t\t\tfor ( let i = 0; i < 4; ++ i ) {\n\n\t\t\t\t\tfaceWeights.push( weights[ i ] );\n\t\t\t\t\tfaceWeightIndices.push( weightIndices[ i ] );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( geoInfo.normal ) {\n\n\t\t\t\tconst data = getData( polygonVertexIndex, polygonIndex, vertexIndex, geoInfo.normal );\n\n\t\t\t\tfaceNormals.push( data[ 0 ], data[ 1 ], data[ 2 ] );\n\n\t\t\t}\n\n\t\t\tif ( geoInfo.material && geoInfo.material.mappingType !== 'AllSame' ) {\n\n\t\t\t\tmaterialIndex = getData( polygonVertexIndex, polygonIndex, vertexIndex, geoInfo.material )[ 0 ];\n\n\t\t\t}\n\n\t\t\tif ( geoInfo.uv ) {\n\n\t\t\t\tgeoInfo.uv.forEach( function ( uv, i ) {\n\n\t\t\t\t\tconst data = getData( polygonVertexIndex, polygonIndex, vertexIndex, uv );\n\n\t\t\t\t\tif ( faceUVs[ i ] === undefined ) {\n\n\t\t\t\t\t\tfaceUVs[ i ] = [];\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfaceUVs[ i ].push( data[ 0 ] );\n\t\t\t\t\tfaceUVs[ i ].push( data[ 1 ] );\n\n\t\t\t\t} );\n\n\t\t\t}\n\n\t\t\tfaceLength ++;\n\n\t\t\tif ( endOfFace ) {\n\n\t\t\t\tscope.genFace( buffers, geoInfo, facePositionIndexes, materialIndex, faceNormals, faceColors, faceUVs, faceWeights, faceWeightIndices, faceLength );\n\n\t\t\t\tpolygonIndex ++;\n\t\t\t\tfaceLength = 0;\n\n\t\t\t\t// reset arrays for the next face\n\t\t\t\tfacePositionIndexes = [];\n\t\t\t\tfaceNormals = [];\n\t\t\t\tfaceColors = [];\n\t\t\t\tfaceUVs = [];\n\t\t\t\tfaceWeights = [];\n\t\t\t\tfaceWeightIndices = [];\n\n\t\t\t}\n\n\t\t} );\n\n\t\treturn buffers;\n\n\t}\n\n\t// Generate data for a single face in a geometry. If the face is a quad then split it into 2 tris\n\tgenFace( buffers, geoInfo, facePositionIndexes, materialIndex, faceNormals, faceColors, faceUVs, faceWeights, faceWeightIndices, faceLength ) {\n\n\t\tfor ( let i = 2; i < faceLength; i ++ ) {\n\n\t\t\tbuffers.vertex.push( geoInfo.vertexPositions[ facePositionIndexes[ 0 ] ] );\n\t\t\tbuffers.vertex.push( geoInfo.vertexPositions[ facePositionIndexes[ 1 ] ] );\n\t\t\tbuffers.vertex.push( geoInfo.vertexPositions[ facePositionIndexes[ 2 ] ] );\n\n\t\t\tbuffers.vertex.push( geoInfo.vertexPositions[ facePositionIndexes[ ( i - 1 ) * 3 ] ] );\n\t\t\tbuffers.vertex.push( geoInfo.vertexPositions[ facePositionIndexes[ ( i - 1 ) * 3 + 1 ] ] );\n\t\t\tbuffers.vertex.push( geoInfo.vertexPositions[ facePositionIndexes[ ( i - 1 ) * 3 + 2 ] ] );\n\n\t\t\tbuffers.vertex.push( geoInfo.vertexPositions[ facePositionIndexes[ i * 3 ] ] );\n\t\t\tbuffers.vertex.push( geoInfo.vertexPositions[ facePositionIndexes[ i * 3 + 1 ] ] );\n\t\t\tbuffers.vertex.push( geoInfo.vertexPositions[ facePositionIndexes[ i * 3 + 2 ] ] );\n\n\t\t\tif ( geoInfo.skeleton ) {\n\n\t\t\t\tbuffers.vertexWeights.push( faceWeights[ 0 ] );\n\t\t\t\tbuffers.vertexWeights.push( faceWeights[ 1 ] );\n\t\t\t\tbuffers.vertexWeights.push( faceWeights[ 2 ] );\n\t\t\t\tbuffers.vertexWeights.push( faceWeights[ 3 ] );\n\n\t\t\t\tbuffers.vertexWeights.push( faceWeights[ ( i - 1 ) * 4 ] );\n\t\t\t\tbuffers.vertexWeights.push( faceWeights[ ( i - 1 ) * 4 + 1 ] );\n\t\t\t\tbuffers.vertexWeights.push( faceWeights[ ( i - 1 ) * 4 + 2 ] );\n\t\t\t\tbuffers.vertexWeights.push( faceWeights[ ( i - 1 ) * 4 + 3 ] );\n\n\t\t\t\tbuffers.vertexWeights.push( faceWeights[ i * 4 ] );\n\t\t\t\tbuffers.vertexWeights.push( faceWeights[ i * 4 + 1 ] );\n\t\t\t\tbuffers.vertexWeights.push( faceWeights[ i * 4 + 2 ] );\n\t\t\t\tbuffers.vertexWeights.push( faceWeights[ i * 4 + 3 ] );\n\n\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ 0 ] );\n\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ 1 ] );\n\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ 2 ] );\n\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ 3 ] );\n\n\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ ( i - 1 ) * 4 ] );\n\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ ( i - 1 ) * 4 + 1 ] );\n\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ ( i - 1 ) * 4 + 2 ] );\n\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ ( i - 1 ) * 4 + 3 ] );\n\n\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ i * 4 ] );\n\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ i * 4 + 1 ] );\n\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ i * 4 + 2 ] );\n\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ i * 4 + 3 ] );\n\n\t\t\t}\n\n\t\t\tif ( geoInfo.color ) {\n\n\t\t\t\tbuffers.colors.push( faceColors[ 0 ] );\n\t\t\t\tbuffers.colors.push( faceColors[ 1 ] );\n\t\t\t\tbuffers.colors.push( faceColors[ 2 ] );\n\n\t\t\t\tbuffers.colors.push( faceColors[ ( i - 1 ) * 3 ] );\n\t\t\t\tbuffers.colors.push( faceColors[ ( i - 1 ) * 3 + 1 ] );\n\t\t\t\tbuffers.colors.push( faceColors[ ( i - 1 ) * 3 + 2 ] );\n\n\t\t\t\tbuffers.colors.push( faceColors[ i * 3 ] );\n\t\t\t\tbuffers.colors.push( faceColors[ i * 3 + 1 ] );\n\t\t\t\tbuffers.colors.push( faceColors[ i * 3 + 2 ] );\n\n\t\t\t}\n\n\t\t\tif ( geoInfo.material && geoInfo.material.mappingType !== 'AllSame' ) {\n\n\t\t\t\tbuffers.materialIndex.push( materialIndex );\n\t\t\t\tbuffers.materialIndex.push( materialIndex );\n\t\t\t\tbuffers.materialIndex.push( materialIndex );\n\n\t\t\t}\n\n\t\t\tif ( geoInfo.normal ) {\n\n\t\t\t\tbuffers.normal.push( faceNormals[ 0 ] );\n\t\t\t\tbuffers.normal.push( faceNormals[ 1 ] );\n\t\t\t\tbuffers.normal.push( faceNormals[ 2 ] );\n\n\t\t\t\tbuffers.normal.push( faceNormals[ ( i - 1 ) * 3 ] );\n\t\t\t\tbuffers.normal.push( faceNormals[ ( i - 1 ) * 3 + 1 ] );\n\t\t\t\tbuffers.normal.push( faceNormals[ ( i - 1 ) * 3 + 2 ] );\n\n\t\t\t\tbuffers.normal.push( faceNormals[ i * 3 ] );\n\t\t\t\tbuffers.normal.push( faceNormals[ i * 3 + 1 ] );\n\t\t\t\tbuffers.normal.push( faceNormals[ i * 3 + 2 ] );\n\n\t\t\t}\n\n\t\t\tif ( geoInfo.uv ) {\n\n\t\t\t\tgeoInfo.uv.forEach( function ( uv, j ) {\n\n\t\t\t\t\tif ( buffers.uvs[ j ] === undefined ) buffers.uvs[ j ] = [];\n\n\t\t\t\t\tbuffers.uvs[ j ].push( faceUVs[ j ][ 0 ] );\n\t\t\t\t\tbuffers.uvs[ j ].push( faceUVs[ j ][ 1 ] );\n\n\t\t\t\t\tbuffers.uvs[ j ].push( faceUVs[ j ][ ( i - 1 ) * 2 ] );\n\t\t\t\t\tbuffers.uvs[ j ].push( faceUVs[ j ][ ( i - 1 ) * 2 + 1 ] );\n\n\t\t\t\t\tbuffers.uvs[ j ].push( faceUVs[ j ][ i * 2 ] );\n\t\t\t\t\tbuffers.uvs[ j ].push( faceUVs[ j ][ i * 2 + 1 ] );\n\n\t\t\t\t} );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\taddMorphTargets( parentGeo, parentGeoNode, morphTargets, preTransform ) {\n\n\t\tif ( morphTargets.length === 0 ) return;\n\n\t\tparentGeo.morphTargetsRelative = true;\n\n\t\tparentGeo.morphAttributes.position = [];\n\t\t// parentGeo.morphAttributes.normal = []; // not implemented\n\n\t\tconst scope = this;\n\t\tmorphTargets.forEach( function ( morphTarget ) {\n\n\t\t\tmorphTarget.rawTargets.forEach( function ( rawTarget ) {\n\n\t\t\t\tconst morphGeoNode = fbxTree.Objects.Geometry[ rawTarget.geoID ];\n\n\t\t\t\tif ( morphGeoNode !== undefined ) {\n\n\t\t\t\t\tscope.genMorphGeometry( parentGeo, parentGeoNode, morphGeoNode, preTransform, rawTarget.name );\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t} );\n\n\t}\n\n\t// a morph geometry node is similar to a standard  node, and the node is also contained\n\t// in FBXTree.Objects.Geometry, however it can only have attributes for position, normal\n\t// and a special attribute Index defining which vertices of the original geometry are affected\n\t// Normal and position attributes only have data for the vertices that are affected by the morph\n\tgenMorphGeometry( parentGeo, parentGeoNode, morphGeoNode, preTransform, name ) {\n\n\t\tconst vertexIndices = ( parentGeoNode.PolygonVertexIndex !== undefined ) ? parentGeoNode.PolygonVertexIndex.a : [];\n\n\t\tconst morphPositionsSparse = ( morphGeoNode.Vertices !== undefined ) ? morphGeoNode.Vertices.a : [];\n\t\tconst indices = ( morphGeoNode.Indexes !== undefined ) ? morphGeoNode.Indexes.a : [];\n\n\t\tconst length = parentGeo.attributes.position.count * 3;\n\t\tconst morphPositions = new Float32Array( length );\n\n\t\tfor ( let i = 0; i < indices.length; i ++ ) {\n\n\t\t\tconst morphIndex = indices[ i ] * 3;\n\n\t\t\tmorphPositions[ morphIndex ] = morphPositionsSparse[ i * 3 ];\n\t\t\tmorphPositions[ morphIndex + 1 ] = morphPositionsSparse[ i * 3 + 1 ];\n\t\t\tmorphPositions[ morphIndex + 2 ] = morphPositionsSparse[ i * 3 + 2 ];\n\n\t\t}\n\n\t\t// TODO: add morph normal support\n\t\tconst morphGeoInfo = {\n\t\t\tvertexIndices: vertexIndices,\n\t\t\tvertexPositions: morphPositions,\n\n\t\t};\n\n\t\tconst morphBuffers = this.genBuffers( morphGeoInfo );\n\n\t\tconst positionAttribute = new Float32BufferAttribute( morphBuffers.vertex, 3 );\n\t\tpositionAttribute.name = name || morphGeoNode.attrName;\n\n\t\tpositionAttribute.applyMatrix4( preTransform );\n\n\t\tparentGeo.morphAttributes.position.push( positionAttribute );\n\n\t}\n\n\t// Parse normal from FBXTree.Objects.Geometry.LayerElementNormal if it exists\n\tparseNormals( NormalNode ) {\n\n\t\tconst mappingType = NormalNode.MappingInformationType;\n\t\tconst referenceType = NormalNode.ReferenceInformationType;\n\t\tconst buffer = NormalNode.Normals.a;\n\t\tlet indexBuffer = [];\n\t\tif ( referenceType === 'IndexToDirect' ) {\n\n\t\t\tif ( 'NormalIndex' in NormalNode ) {\n\n\t\t\t\tindexBuffer = NormalNode.NormalIndex.a;\n\n\t\t\t} else if ( 'NormalsIndex' in NormalNode ) {\n\n\t\t\t\tindexBuffer = NormalNode.NormalsIndex.a;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn {\n\t\t\tdataSize: 3,\n\t\t\tbuffer: buffer,\n\t\t\tindices: indexBuffer,\n\t\t\tmappingType: mappingType,\n\t\t\treferenceType: referenceType\n\t\t};\n\n\t}\n\n\t// Parse UVs from FBXTree.Objects.Geometry.LayerElementUV if it exists\n\tparseUVs( UVNode ) {\n\n\t\tconst mappingType = UVNode.MappingInformationType;\n\t\tconst referenceType = UVNode.ReferenceInformationType;\n\t\tconst buffer = UVNode.UV.a;\n\t\tlet indexBuffer = [];\n\t\tif ( referenceType === 'IndexToDirect' ) {\n\n\t\t\tindexBuffer = UVNode.UVIndex.a;\n\n\t\t}\n\n\t\treturn {\n\t\t\tdataSize: 2,\n\t\t\tbuffer: buffer,\n\t\t\tindices: indexBuffer,\n\t\t\tmappingType: mappingType,\n\t\t\treferenceType: referenceType\n\t\t};\n\n\t}\n\n\t// Parse Vertex Colors from FBXTree.Objects.Geometry.LayerElementColor if it exists\n\tparseVertexColors( ColorNode ) {\n\n\t\tconst mappingType = ColorNode.MappingInformationType;\n\t\tconst referenceType = ColorNode.ReferenceInformationType;\n\t\tconst buffer = ColorNode.Colors.a;\n\t\tlet indexBuffer = [];\n\t\tif ( referenceType === 'IndexToDirect' ) {\n\n\t\t\tindexBuffer = ColorNode.ColorIndex.a;\n\n\t\t}\n\n\t\treturn {\n\t\t\tdataSize: 4,\n\t\t\tbuffer: buffer,\n\t\t\tindices: indexBuffer,\n\t\t\tmappingType: mappingType,\n\t\t\treferenceType: referenceType\n\t\t};\n\n\t}\n\n\t// Parse mapping and material data in FBXTree.Objects.Geometry.LayerElementMaterial if it exists\n\tparseMaterialIndices( MaterialNode ) {\n\n\t\tconst mappingType = MaterialNode.MappingInformationType;\n\t\tconst referenceType = MaterialNode.ReferenceInformationType;\n\n\t\tif ( mappingType === 'NoMappingInformation' ) {\n\n\t\t\treturn {\n\t\t\t\tdataSize: 1,\n\t\t\t\tbuffer: [ 0 ],\n\t\t\t\tindices: [ 0 ],\n\t\t\t\tmappingType: 'AllSame',\n\t\t\t\treferenceType: referenceType\n\t\t\t};\n\n\t\t}\n\n\t\tconst materialIndexBuffer = MaterialNode.Materials.a;\n\n\t\t// Since materials are stored as indices, there's a bit of a mismatch between FBX and what\n\t\t// we expect.So we create an intermediate buffer that points to the index in the buffer,\n\t\t// for conforming with the other functions we've written for other data.\n\t\tconst materialIndices = [];\n\n\t\tfor ( let i = 0; i < materialIndexBuffer.length; ++ i ) {\n\n\t\t\tmaterialIndices.push( i );\n\n\t\t}\n\n\t\treturn {\n\t\t\tdataSize: 1,\n\t\t\tbuffer: materialIndexBuffer,\n\t\t\tindices: materialIndices,\n\t\t\tmappingType: mappingType,\n\t\t\treferenceType: referenceType\n\t\t};\n\n\t}\n\n\t// Generate a NurbGeometry from a node in FBXTree.Objects.Geometry\n\tparseNurbsGeometry( geoNode ) {\n\n\t\tif ( NURBSCurve === undefined ) {\n\n\t\t\tconsole.error( 'THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry.' );\n\t\t\treturn new BufferGeometry();\n\n\t\t}\n\n\t\tconst order = parseInt( geoNode.Order );\n\n\t\tif ( isNaN( order ) ) {\n\n\t\t\tconsole.error( 'THREE.FBXLoader: Invalid Order %s given for geometry ID: %s', geoNode.Order, geoNode.id );\n\t\t\treturn new BufferGeometry();\n\n\t\t}\n\n\t\tconst degree = order - 1;\n\n\t\tconst knots = geoNode.KnotVector.a;\n\t\tconst controlPoints = [];\n\t\tconst pointsValues = geoNode.Points.a;\n\n\t\tfor ( let i = 0, l = pointsValues.length; i < l; i += 4 ) {\n\n\t\t\tcontrolPoints.push( new Vector4().fromArray( pointsValues, i ) );\n\n\t\t}\n\n\t\tlet startKnot, endKnot;\n\n\t\tif ( geoNode.Form === 'Closed' ) {\n\n\t\t\tcontrolPoints.push( controlPoints[ 0 ] );\n\n\t\t} else if ( geoNode.Form === 'Periodic' ) {\n\n\t\t\tstartKnot = degree;\n\t\t\tendKnot = knots.length - 1 - startKnot;\n\n\t\t\tfor ( let i = 0; i < degree; ++ i ) {\n\n\t\t\t\tcontrolPoints.push( controlPoints[ i ] );\n\n\t\t\t}\n\n\t\t}\n\n\t\tconst curve = new NURBSCurve( degree, knots, controlPoints, startKnot, endKnot );\n\t\tconst points = curve.getPoints( controlPoints.length * 12 );\n\n\t\treturn new BufferGeometry().setFromPoints( points );\n\n\t}\n\n}\n\n// parse animation data from FBXTree\nclass AnimationParser {\n\n\t// take raw animation clips and turn them into three.js animation clips\n\tparse() {\n\n\t\tconst animationClips = [];\n\n\t\tconst rawClips = this.parseClips();\n\n\t\tif ( rawClips !== undefined ) {\n\n\t\t\tfor ( const key in rawClips ) {\n\n\t\t\t\tconst rawClip = rawClips[ key ];\n\n\t\t\t\tconst clip = this.addClip( rawClip );\n\n\t\t\t\tanimationClips.push( clip );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn animationClips;\n\n\t}\n\n\tparseClips() {\n\n\t\t// since the actual transformation data is stored in FBXTree.Objects.AnimationCurve,\n\t\t// if this is undefined we can safely assume there are no animations\n\t\tif ( fbxTree.Objects.AnimationCurve === undefined ) return undefined;\n\n\t\tconst curveNodesMap = this.parseAnimationCurveNodes();\n\n\t\tthis.parseAnimationCurves( curveNodesMap );\n\n\t\tconst layersMap = this.parseAnimationLayers( curveNodesMap );\n\t\tconst rawClips = this.parseAnimStacks( layersMap );\n\n\t\treturn rawClips;\n\n\t}\n\n\t// parse nodes in FBXTree.Objects.AnimationCurveNode\n\t// each AnimationCurveNode holds data for an animation transform for a model (e.g. left arm rotation )\n\t// and is referenced by an AnimationLayer\n\tparseAnimationCurveNodes() {\n\n\t\tconst rawCurveNodes = fbxTree.Objects.AnimationCurveNode;\n\n\t\tconst curveNodesMap = new Map();\n\n\t\tfor ( const nodeID in rawCurveNodes ) {\n\n\t\t\tconst rawCurveNode = rawCurveNodes[ nodeID ];\n\n\t\t\tif ( rawCurveNode.attrName.match( /S|R|T|DeformPercent/ ) !== null ) {\n\n\t\t\t\tconst curveNode = {\n\n\t\t\t\t\tid: rawCurveNode.id,\n\t\t\t\t\tattr: rawCurveNode.attrName,\n\t\t\t\t\tcurves: {},\n\n\t\t\t\t};\n\n\t\t\t\tcurveNodesMap.set( curveNode.id, curveNode );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn curveNodesMap;\n\n\t}\n\n\t// parse nodes in FBXTree.Objects.AnimationCurve and connect them up to\n\t// previously parsed AnimationCurveNodes. Each AnimationCurve holds data for a single animated\n\t// axis ( e.g. times and values of x rotation)\n\tparseAnimationCurves( curveNodesMap ) {\n\n\t\tconst rawCurves = fbxTree.Objects.AnimationCurve;\n\n\t\t// TODO: Many values are identical up to roundoff error, but won't be optimised\n\t\t// e.g. position times: [0, 0.4, 0. 8]\n\t\t// position values: [7.23538335023477e-7, 93.67518615722656, -0.9982695579528809, 7.23538335023477e-7, 93.67518615722656, -0.9982695579528809, 7.235384487103147e-7, 93.67520904541016, -0.9982695579528809]\n\t\t// clearly, this should be optimised to\n\t\t// times: [0], positions [7.23538335023477e-7, 93.67518615722656, -0.9982695579528809]\n\t\t// this shows up in nearly every FBX file, and generally time array is length > 100\n\n\t\tfor ( const nodeID in rawCurves ) {\n\n\t\t\tconst animationCurve = {\n\n\t\t\t\tid: rawCurves[ nodeID ].id,\n\t\t\t\ttimes: rawCurves[ nodeID ].KeyTime.a.map( convertFBXTimeToSeconds ),\n\t\t\t\tvalues: rawCurves[ nodeID ].KeyValueFloat.a,\n\n\t\t\t};\n\n\t\t\tconst relationships = connections.get( animationCurve.id );\n\n\t\t\tif ( relationships !== undefined ) {\n\n\t\t\t\tconst animationCurveID = relationships.parents[ 0 ].ID;\n\t\t\t\tconst animationCurveRelationship = relationships.parents[ 0 ].relationship;\n\n\t\t\t\tif ( animationCurveRelationship.match( /X/ ) ) {\n\n\t\t\t\t\tcurveNodesMap.get( animationCurveID ).curves[ 'x' ] = animationCurve;\n\n\t\t\t\t} else if ( animationCurveRelationship.match( /Y/ ) ) {\n\n\t\t\t\t\tcurveNodesMap.get( animationCurveID ).curves[ 'y' ] = animationCurve;\n\n\t\t\t\t} else if ( animationCurveRelationship.match( /Z/ ) ) {\n\n\t\t\t\t\tcurveNodesMap.get( animationCurveID ).curves[ 'z' ] = animationCurve;\n\n\t\t\t\t} else if ( animationCurveRelationship.match( /d|DeformPercent/ ) && curveNodesMap.has( animationCurveID ) ) {\n\n\t\t\t\t\tcurveNodesMap.get( animationCurveID ).curves[ 'morph' ] = animationCurve;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\t// parse nodes in FBXTree.Objects.AnimationLayer. Each layers holds references\n\t// to various AnimationCurveNodes and is referenced by an AnimationStack node\n\t// note: theoretically a stack can have multiple layers, however in practice there always seems to be one per stack\n\tparseAnimationLayers( curveNodesMap ) {\n\n\t\tconst rawLayers = fbxTree.Objects.AnimationLayer;\n\n\t\tconst layersMap = new Map();\n\n\t\tfor ( const nodeID in rawLayers ) {\n\n\t\t\tconst layerCurveNodes = [];\n\n\t\t\tconst connection = connections.get( parseInt( nodeID ) );\n\n\t\t\tif ( connection !== undefined ) {\n\n\t\t\t\t// all the animationCurveNodes used in the layer\n\t\t\t\tconst children = connection.children;\n\n\t\t\t\tchildren.forEach( function ( child, i ) {\n\n\t\t\t\t\tif ( curveNodesMap.has( child.ID ) ) {\n\n\t\t\t\t\t\tconst curveNode = curveNodesMap.get( child.ID );\n\n\t\t\t\t\t\t// check that the curves are defined for at least one axis, otherwise ignore the curveNode\n\t\t\t\t\t\tif ( curveNode.curves.x !== undefined || curveNode.curves.y !== undefined || curveNode.curves.z !== undefined ) {\n\n\t\t\t\t\t\t\tif ( layerCurveNodes[ i ] === undefined ) {\n\n\t\t\t\t\t\t\t\tconst modelID = connections.get( child.ID ).parents.filter( function ( parent ) {\n\n\t\t\t\t\t\t\t\t\treturn parent.relationship !== undefined;\n\n\t\t\t\t\t\t\t\t} )[ 0 ].ID;\n\n\t\t\t\t\t\t\t\tif ( modelID !== undefined ) {\n\n\t\t\t\t\t\t\t\t\tconst rawModel = fbxTree.Objects.Model[ modelID.toString() ];\n\n\t\t\t\t\t\t\t\t\tif ( rawModel === undefined ) {\n\n\t\t\t\t\t\t\t\t\t\tconsole.warn( 'THREE.FBXLoader: Encountered a unused curve.', child );\n\t\t\t\t\t\t\t\t\t\treturn;\n\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tconst node = {\n\n\t\t\t\t\t\t\t\t\t\tmodelName: rawModel.attrName ? PropertyBinding.sanitizeNodeName( rawModel.attrName ) : '',\n\t\t\t\t\t\t\t\t\t\tID: rawModel.id,\n\t\t\t\t\t\t\t\t\t\tinitialPosition: [ 0, 0, 0 ],\n\t\t\t\t\t\t\t\t\t\tinitialRotation: [ 0, 0, 0 ],\n\t\t\t\t\t\t\t\t\t\tinitialScale: [ 1, 1, 1 ],\n\n\t\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\t\tsceneGraph.traverse( function ( child ) {\n\n\t\t\t\t\t\t\t\t\t\tif ( child.ID === rawModel.id ) {\n\n\t\t\t\t\t\t\t\t\t\t\tnode.transform = child.matrix;\n\n\t\t\t\t\t\t\t\t\t\t\tif ( child.userData.transformData ) node.eulerOrder = child.userData.transformData.eulerOrder;\n\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t} );\n\n\t\t\t\t\t\t\t\t\tif ( ! node.transform ) node.transform = new Matrix4();\n\n\t\t\t\t\t\t\t\t\t// if the animated model is pre rotated, we'll have to apply the pre rotations to every\n\t\t\t\t\t\t\t\t\t// animation value as well\n\t\t\t\t\t\t\t\t\tif ( 'PreRotation' in rawModel ) node.preRotation = rawModel.PreRotation.value;\n\t\t\t\t\t\t\t\t\tif ( 'PostRotation' in rawModel ) node.postRotation = rawModel.PostRotation.value;\n\n\t\t\t\t\t\t\t\t\tlayerCurveNodes[ i ] = node;\n\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif ( layerCurveNodes[ i ] ) layerCurveNodes[ i ][ curveNode.attr ] = curveNode;\n\n\t\t\t\t\t\t} else if ( curveNode.curves.morph !== undefined ) {\n\n\t\t\t\t\t\t\tif ( layerCurveNodes[ i ] === undefined ) {\n\n\t\t\t\t\t\t\t\tconst deformerID = connections.get( child.ID ).parents.filter( function ( parent ) {\n\n\t\t\t\t\t\t\t\t\treturn parent.relationship !== undefined;\n\n\t\t\t\t\t\t\t\t} )[ 0 ].ID;\n\n\t\t\t\t\t\t\t\tconst morpherID = connections.get( deformerID ).parents[ 0 ].ID;\n\t\t\t\t\t\t\t\tconst geoID = connections.get( morpherID ).parents[ 0 ].ID;\n\n\t\t\t\t\t\t\t\t// assuming geometry is not used in more than one model\n\t\t\t\t\t\t\t\tconst modelID = connections.get( geoID ).parents[ 0 ].ID;\n\n\t\t\t\t\t\t\t\tconst rawModel = fbxTree.Objects.Model[ modelID ];\n\n\t\t\t\t\t\t\t\tconst node = {\n\n\t\t\t\t\t\t\t\t\tmodelName: rawModel.attrName ? PropertyBinding.sanitizeNodeName( rawModel.attrName ) : '',\n\t\t\t\t\t\t\t\t\tmorphName: fbxTree.Objects.Deformer[ deformerID ].attrName,\n\n\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\tlayerCurveNodes[ i ] = node;\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tlayerCurveNodes[ i ][ curveNode.attr ] = curveNode;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t} );\n\n\t\t\t\tlayersMap.set( parseInt( nodeID ), layerCurveNodes );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn layersMap;\n\n\t}\n\n\t// parse nodes in FBXTree.Objects.AnimationStack. These are the top level node in the animation\n\t// hierarchy. Each Stack node will be used to create a AnimationClip\n\tparseAnimStacks( layersMap ) {\n\n\t\tconst rawStacks = fbxTree.Objects.AnimationStack;\n\n\t\t// connect the stacks (clips) up to the layers\n\t\tconst rawClips = {};\n\n\t\tfor ( const nodeID in rawStacks ) {\n\n\t\t\tconst children = connections.get( parseInt( nodeID ) ).children;\n\n\t\t\tif ( children.length > 1 ) {\n\n\t\t\t\t// it seems like stacks will always be associated with a single layer. But just in case there are files\n\t\t\t\t// where there are multiple layers per stack, we'll display a warning\n\t\t\t\tconsole.warn( 'THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.' );\n\n\t\t\t}\n\n\t\t\tconst layer = layersMap.get( children[ 0 ].ID );\n\n\t\t\trawClips[ nodeID ] = {\n\n\t\t\t\tname: rawStacks[ nodeID ].attrName,\n\t\t\t\tlayer: layer,\n\n\t\t\t};\n\n\t\t}\n\n\t\treturn rawClips;\n\n\t}\n\n\taddClip( rawClip ) {\n\n\t\tlet tracks = [];\n\n\t\tconst scope = this;\n\t\trawClip.layer.forEach( function ( rawTracks ) {\n\n\t\t\ttracks = tracks.concat( scope.generateTracks( rawTracks ) );\n\n\t\t} );\n\n\t\treturn new AnimationClip( rawClip.name, - 1, tracks );\n\n\t}\n\n\tgenerateTracks( rawTracks ) {\n\n\t\tconst tracks = [];\n\n\t\tlet initialPosition = new Vector3();\n\t\tlet initialRotation = new Quaternion();\n\t\tlet initialScale = new Vector3();\n\n\t\tif ( rawTracks.transform ) rawTracks.transform.decompose( initialPosition, initialRotation, initialScale );\n\n\t\tinitialPosition = initialPosition.toArray();\n\t\tinitialRotation = new Euler().setFromQuaternion( initialRotation, rawTracks.eulerOrder ).toArray();\n\t\tinitialScale = initialScale.toArray();\n\n\t\tif ( rawTracks.T !== undefined && Object.keys( rawTracks.T.curves ).length > 0 ) {\n\n\t\t\tconst positionTrack = this.generateVectorTrack( rawTracks.modelName, rawTracks.T.curves, initialPosition, 'position' );\n\t\t\tif ( positionTrack !== undefined ) tracks.push( positionTrack );\n\n\t\t}\n\n\t\tif ( rawTracks.R !== undefined && Object.keys( rawTracks.R.curves ).length > 0 ) {\n\n\t\t\tconst rotationTrack = this.generateRotationTrack( rawTracks.modelName, rawTracks.R.curves, initialRotation, rawTracks.preRotation, rawTracks.postRotation, rawTracks.eulerOrder );\n\t\t\tif ( rotationTrack !== undefined ) tracks.push( rotationTrack );\n\n\t\t}\n\n\t\tif ( rawTracks.S !== undefined && Object.keys( rawTracks.S.curves ).length > 0 ) {\n\n\t\t\tconst scaleTrack = this.generateVectorTrack( rawTracks.modelName, rawTracks.S.curves, initialScale, 'scale' );\n\t\t\tif ( scaleTrack !== undefined ) tracks.push( scaleTrack );\n\n\t\t}\n\n\t\tif ( rawTracks.DeformPercent !== undefined ) {\n\n\t\t\tconst morphTrack = this.generateMorphTrack( rawTracks );\n\t\t\tif ( morphTrack !== undefined ) tracks.push( morphTrack );\n\n\t\t}\n\n\t\treturn tracks;\n\n\t}\n\n\tgenerateVectorTrack( modelName, curves, initialValue, type ) {\n\n\t\tconst times = this.getTimesForAllAxes( curves );\n\t\tconst values = this.getKeyframeTrackValues( times, curves, initialValue );\n\n\t\treturn new VectorKeyframeTrack( modelName + '.' + type, times, values );\n\n\t}\n\n\tgenerateRotationTrack( modelName, curves, initialValue, preRotation, postRotation, eulerOrder ) {\n\n\t\tif ( curves.x !== undefined ) {\n\n\t\t\tthis.interpolateRotations( curves.x );\n\t\t\tcurves.x.values = curves.x.values.map( MathUtils.degToRad );\n\n\t\t}\n\n\t\tif ( curves.y !== undefined ) {\n\n\t\t\tthis.interpolateRotations( curves.y );\n\t\t\tcurves.y.values = curves.y.values.map( MathUtils.degToRad );\n\n\t\t}\n\n\t\tif ( curves.z !== undefined ) {\n\n\t\t\tthis.interpolateRotations( curves.z );\n\t\t\tcurves.z.values = curves.z.values.map( MathUtils.degToRad );\n\n\t\t}\n\n\t\tconst times = this.getTimesForAllAxes( curves );\n\t\tconst values = this.getKeyframeTrackValues( times, curves, initialValue );\n\n\t\tif ( preRotation !== undefined ) {\n\n\t\t\tpreRotation = preRotation.map( MathUtils.degToRad );\n\t\t\tpreRotation.push( eulerOrder );\n\n\t\t\tpreRotation = new Euler().fromArray( preRotation );\n\t\t\tpreRotation = new Quaternion().setFromEuler( preRotation );\n\n\t\t}\n\n\t\tif ( postRotation !== undefined ) {\n\n\t\t\tpostRotation = postRotation.map( MathUtils.degToRad );\n\t\t\tpostRotation.push( eulerOrder );\n\n\t\t\tpostRotation = new Euler().fromArray( postRotation );\n\t\t\tpostRotation = new Quaternion().setFromEuler( postRotation ).invert();\n\n\t\t}\n\n\t\tconst quaternion = new Quaternion();\n\t\tconst euler = new Euler();\n\n\t\tconst quaternionValues = [];\n\n\t\tfor ( let i = 0; i < values.length; i += 3 ) {\n\n\t\t\teuler.set( values[ i ], values[ i + 1 ], values[ i + 2 ], eulerOrder );\n\n\t\t\tquaternion.setFromEuler( euler );\n\n\t\t\tif ( preRotation !== undefined ) quaternion.premultiply( preRotation );\n\t\t\tif ( postRotation !== undefined ) quaternion.multiply( postRotation );\n\n\t\t\tquaternion.toArray( quaternionValues, ( i / 3 ) * 4 );\n\n\t\t}\n\n\t\treturn new QuaternionKeyframeTrack( modelName + '.quaternion', times, quaternionValues );\n\n\t}\n\n\tgenerateMorphTrack( rawTracks ) {\n\n\t\tconst curves = rawTracks.DeformPercent.curves.morph;\n\t\tconst values = curves.values.map( function ( val ) {\n\n\t\t\treturn val / 100;\n\n\t\t} );\n\n\t\tconst morphNum = sceneGraph.getObjectByName( rawTracks.modelName ).morphTargetDictionary[ rawTracks.morphName ];\n\n\t\treturn new NumberKeyframeTrack( rawTracks.modelName + '.morphTargetInfluences[' + morphNum + ']', curves.times, values );\n\n\t}\n\n\t// For all animated objects, times are defined separately for each axis\n\t// Here we'll combine the times into one sorted array without duplicates\n\tgetTimesForAllAxes( curves ) {\n\n\t\tlet times = [];\n\n\t\t// first join together the times for each axis, if defined\n\t\tif ( curves.x !== undefined ) times = times.concat( curves.x.times );\n\t\tif ( curves.y !== undefined ) times = times.concat( curves.y.times );\n\t\tif ( curves.z !== undefined ) times = times.concat( curves.z.times );\n\n\t\t// then sort them\n\t\ttimes = times.sort( function ( a, b ) {\n\n\t\t\treturn a - b;\n\n\t\t} );\n\n\t\t// and remove duplicates\n\t\tif ( times.length > 1 ) {\n\n\t\t\tlet targetIndex = 1;\n\t\t\tlet lastValue = times[ 0 ];\n\t\t\tfor ( let i = 1; i < times.length; i ++ ) {\n\n\t\t\t\tconst currentValue = times[ i ];\n\t\t\t\tif ( currentValue !== lastValue ) {\n\n\t\t\t\t\ttimes[ targetIndex ] = currentValue;\n\t\t\t\t\tlastValue = currentValue;\n\t\t\t\t\ttargetIndex ++;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\ttimes = times.slice( 0, targetIndex );\n\n\t\t}\n\n\t\treturn times;\n\n\t}\n\n\tgetKeyframeTrackValues( times, curves, initialValue ) {\n\n\t\tconst prevValue = initialValue;\n\n\t\tconst values = [];\n\n\t\tlet xIndex = - 1;\n\t\tlet yIndex = - 1;\n\t\tlet zIndex = - 1;\n\n\t\ttimes.forEach( function ( time ) {\n\n\t\t\tif ( curves.x ) xIndex = curves.x.times.indexOf( time );\n\t\t\tif ( curves.y ) yIndex = curves.y.times.indexOf( time );\n\t\t\tif ( curves.z ) zIndex = curves.z.times.indexOf( time );\n\n\t\t\t// if there is an x value defined for this frame, use that\n\t\t\tif ( xIndex !== - 1 ) {\n\n\t\t\t\tconst xValue = curves.x.values[ xIndex ];\n\t\t\t\tvalues.push( xValue );\n\t\t\t\tprevValue[ 0 ] = xValue;\n\n\t\t\t} else {\n\n\t\t\t\t// otherwise use the x value from the previous frame\n\t\t\t\tvalues.push( prevValue[ 0 ] );\n\n\t\t\t}\n\n\t\t\tif ( yIndex !== - 1 ) {\n\n\t\t\t\tconst yValue = curves.y.values[ yIndex ];\n\t\t\t\tvalues.push( yValue );\n\t\t\t\tprevValue[ 1 ] = yValue;\n\n\t\t\t} else {\n\n\t\t\t\tvalues.push( prevValue[ 1 ] );\n\n\t\t\t}\n\n\t\t\tif ( zIndex !== - 1 ) {\n\n\t\t\t\tconst zValue = curves.z.values[ zIndex ];\n\t\t\t\tvalues.push( zValue );\n\t\t\t\tprevValue[ 2 ] = zValue;\n\n\t\t\t} else {\n\n\t\t\t\tvalues.push( prevValue[ 2 ] );\n\n\t\t\t}\n\n\t\t} );\n\n\t\treturn values;\n\n\t}\n\n\t// Rotations are defined as Euler angles which can have values  of any size\n\t// These will be converted to quaternions which don't support values greater than\n\t// PI, so we'll interpolate large rotations\n\tinterpolateRotations( curve ) {\n\n\t\tfor ( let i = 1; i < curve.values.length; i ++ ) {\n\n\t\t\tconst initialValue = curve.values[ i - 1 ];\n\t\t\tconst valuesSpan = curve.values[ i ] - initialValue;\n\n\t\t\tconst absoluteSpan = Math.abs( valuesSpan );\n\n\t\t\tif ( absoluteSpan >= 180 ) {\n\n\t\t\t\tconst numSubIntervals = absoluteSpan / 180;\n\n\t\t\t\tconst step = valuesSpan / numSubIntervals;\n\t\t\t\tlet nextValue = initialValue + step;\n\n\t\t\t\tconst initialTime = curve.times[ i - 1 ];\n\t\t\t\tconst timeSpan = curve.times[ i ] - initialTime;\n\t\t\t\tconst interval = timeSpan / numSubIntervals;\n\t\t\t\tlet nextTime = initialTime + interval;\n\n\t\t\t\tconst interpolatedTimes = [];\n\t\t\t\tconst interpolatedValues = [];\n\n\t\t\t\twhile ( nextTime < curve.times[ i ] ) {\n\n\t\t\t\t\tinterpolatedTimes.push( nextTime );\n\t\t\t\t\tnextTime += interval;\n\n\t\t\t\t\tinterpolatedValues.push( nextValue );\n\t\t\t\t\tnextValue += step;\n\n\t\t\t\t}\n\n\t\t\t\tcurve.times = inject( curve.times, i, interpolatedTimes );\n\t\t\t\tcurve.values = inject( curve.values, i, interpolatedValues );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n}\n\n// parse an FBX file in ASCII format\nclass TextParser {\n\n\tgetPrevNode() {\n\n\t\treturn this.nodeStack[ this.currentIndent - 2 ];\n\n\t}\n\n\tgetCurrentNode() {\n\n\t\treturn this.nodeStack[ this.currentIndent - 1 ];\n\n\t}\n\n\tgetCurrentProp() {\n\n\t\treturn this.currentProp;\n\n\t}\n\n\tpushStack( node ) {\n\n\t\tthis.nodeStack.push( node );\n\t\tthis.currentIndent += 1;\n\n\t}\n\n\tpopStack() {\n\n\t\tthis.nodeStack.pop();\n\t\tthis.currentIndent -= 1;\n\n\t}\n\n\tsetCurrentProp( val, name ) {\n\n\t\tthis.currentProp = val;\n\t\tthis.currentPropName = name;\n\n\t}\n\n\tparse( text ) {\n\n\t\tthis.currentIndent = 0;\n\n\t\tthis.allNodes = new FBXTree();\n\t\tthis.nodeStack = [];\n\t\tthis.currentProp = [];\n\t\tthis.currentPropName = '';\n\n\t\tconst scope = this;\n\n\t\tconst split = text.split( /[\\r\\n]+/ );\n\n\t\tsplit.forEach( function ( line, i ) {\n\n\t\t\tconst matchComment = line.match( /^[\\s\\t]*;/ );\n\t\t\tconst matchEmpty = line.match( /^[\\s\\t]*$/ );\n\n\t\t\tif ( matchComment || matchEmpty ) return;\n\n\t\t\tconst matchBeginning = line.match( '^\\\\t{' + scope.currentIndent + '}(\\\\w+):(.*){', '' );\n\t\t\tconst matchProperty = line.match( '^\\\\t{' + ( scope.currentIndent ) + '}(\\\\w+):[\\\\s\\\\t\\\\r\\\\n](.*)' );\n\t\t\tconst matchEnd = line.match( '^\\\\t{' + ( scope.currentIndent - 1 ) + '}}' );\n\n\t\t\tif ( matchBeginning ) {\n\n\t\t\t\tscope.parseNodeBegin( line, matchBeginning );\n\n\t\t\t} else if ( matchProperty ) {\n\n\t\t\t\tscope.parseNodeProperty( line, matchProperty, split[ ++ i ] );\n\n\t\t\t} else if ( matchEnd ) {\n\n\t\t\t\tscope.popStack();\n\n\t\t\t} else if ( line.match( /^[^\\s\\t}]/ ) ) {\n\n\t\t\t\t// large arrays are split over multiple lines terminated with a ',' character\n\t\t\t\t// if this is encountered the line needs to be joined to the previous line\n\t\t\t\tscope.parseNodePropertyContinued( line );\n\n\t\t\t}\n\n\t\t} );\n\n\t\treturn this.allNodes;\n\n\t}\n\n\tparseNodeBegin( line, property ) {\n\n\t\tconst nodeName = property[ 1 ].trim().replace( /^\"/, '' ).replace( /\"$/, '' );\n\n\t\tconst nodeAttrs = property[ 2 ].split( ',' ).map( function ( attr ) {\n\n\t\t\treturn attr.trim().replace( /^\"/, '' ).replace( /\"$/, '' );\n\n\t\t} );\n\n\t\tconst node = { name: nodeName };\n\t\tconst attrs = this.parseNodeAttr( nodeAttrs );\n\n\t\tconst currentNode = this.getCurrentNode();\n\n\t\t// a top node\n\t\tif ( this.currentIndent === 0 ) {\n\n\t\t\tthis.allNodes.add( nodeName, node );\n\n\t\t} else { // a subnode\n\n\t\t\t// if the subnode already exists, append it\n\t\t\tif ( nodeName in currentNode ) {\n\n\t\t\t\t// special case Pose needs PoseNodes as an array\n\t\t\t\tif ( nodeName === 'PoseNode' ) {\n\n\t\t\t\t\tcurrentNode.PoseNode.push( node );\n\n\t\t\t\t} else if ( currentNode[ nodeName ].id !== undefined ) {\n\n\t\t\t\t\tcurrentNode[ nodeName ] = {};\n\t\t\t\t\tcurrentNode[ nodeName ][ currentNode[ nodeName ].id ] = currentNode[ nodeName ];\n\n\t\t\t\t}\n\n\t\t\t\tif ( attrs.id !== '' ) currentNode[ nodeName ][ attrs.id ] = node;\n\n\t\t\t} else if ( typeof attrs.id === 'number' ) {\n\n\t\t\t\tcurrentNode[ nodeName ] = {};\n\t\t\t\tcurrentNode[ nodeName ][ attrs.id ] = node;\n\n\t\t\t} else if ( nodeName !== 'Properties70' ) {\n\n\t\t\t\tif ( nodeName === 'PoseNode' )\tcurrentNode[ nodeName ] = [ node ];\n\t\t\t\telse currentNode[ nodeName ] = node;\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( typeof attrs.id === 'number' ) node.id = attrs.id;\n\t\tif ( attrs.name !== '' ) node.attrName = attrs.name;\n\t\tif ( attrs.type !== '' ) node.attrType = attrs.type;\n\n\t\tthis.pushStack( node );\n\n\t}\n\n\tparseNodeAttr( attrs ) {\n\n\t\tlet id = attrs[ 0 ];\n\n\t\tif ( attrs[ 0 ] !== '' ) {\n\n\t\t\tid = parseInt( attrs[ 0 ] );\n\n\t\t\tif ( isNaN( id ) ) {\n\n\t\t\t\tid = attrs[ 0 ];\n\n\t\t\t}\n\n\t\t}\n\n\t\tlet name = '', type = '';\n\n\t\tif ( attrs.length > 1 ) {\n\n\t\t\tname = attrs[ 1 ].replace( /^(\\w+)::/, '' );\n\t\t\ttype = attrs[ 2 ];\n\n\t\t}\n\n\t\treturn { id: id, name: name, type: type };\n\n\t}\n\n\tparseNodeProperty( line, property, contentLine ) {\n\n\t\tlet propName = property[ 1 ].replace( /^\"/, '' ).replace( /\"$/, '' ).trim();\n\t\tlet propValue = property[ 2 ].replace( /^\"/, '' ).replace( /\"$/, '' ).trim();\n\n\t\t// for special case: base64 image data follows \"Content: ,\" line\n\t\t//\tContent: ,\n\t\t//\t \"/9j/4RDaRXhpZgAATU0A...\"\n\t\tif ( propName === 'Content' && propValue === ',' ) {\n\n\t\t\tpropValue = contentLine.replace( /\"/g, '' ).replace( /,$/, '' ).trim();\n\n\t\t}\n\n\t\tconst currentNode = this.getCurrentNode();\n\t\tconst parentName = currentNode.name;\n\n\t\tif ( parentName === 'Properties70' ) {\n\n\t\t\tthis.parseNodeSpecialProperty( line, propName, propValue );\n\t\t\treturn;\n\n\t\t}\n\n\t\t// Connections\n\t\tif ( propName === 'C' ) {\n\n\t\t\tconst connProps = propValue.split( ',' ).slice( 1 );\n\t\t\tconst from = parseInt( connProps[ 0 ] );\n\t\t\tconst to = parseInt( connProps[ 1 ] );\n\n\t\t\tlet rest = propValue.split( ',' ).slice( 3 );\n\n\t\t\trest = rest.map( function ( elem ) {\n\n\t\t\t\treturn elem.trim().replace( /^\"/, '' );\n\n\t\t\t} );\n\n\t\t\tpropName = 'connections';\n\t\t\tpropValue = [ from, to ];\n\t\t\tappend( propValue, rest );\n\n\t\t\tif ( currentNode[ propName ] === undefined ) {\n\n\t\t\t\tcurrentNode[ propName ] = [];\n\n\t\t\t}\n\n\t\t}\n\n\t\t// Node\n\t\tif ( propName === 'Node' ) currentNode.id = propValue;\n\n\t\t// connections\n\t\tif ( propName in currentNode && Array.isArray( currentNode[ propName ] ) ) {\n\n\t\t\tcurrentNode[ propName ].push( propValue );\n\n\t\t} else {\n\n\t\t\tif ( propName !== 'a' ) currentNode[ propName ] = propValue;\n\t\t\telse currentNode.a = propValue;\n\n\t\t}\n\n\t\tthis.setCurrentProp( currentNode, propName );\n\n\t\t// convert string to array, unless it ends in ',' in which case more will be added to it\n\t\tif ( propName === 'a' && propValue.slice( - 1 ) !== ',' ) {\n\n\t\t\tcurrentNode.a = parseNumberArray( propValue );\n\n\t\t}\n\n\t}\n\n\tparseNodePropertyContinued( line ) {\n\n\t\tconst currentNode = this.getCurrentNode();\n\n\t\tcurrentNode.a += line;\n\n\t\t// if the line doesn't end in ',' we have reached the end of the property value\n\t\t// so convert the string to an array\n\t\tif ( line.slice( - 1 ) !== ',' ) {\n\n\t\t\tcurrentNode.a = parseNumberArray( currentNode.a );\n\n\t\t}\n\n\t}\n\n\t// parse \"Property70\"\n\tparseNodeSpecialProperty( line, propName, propValue ) {\n\n\t\t// split this\n\t\t// P: \"Lcl Scaling\", \"Lcl Scaling\", \"\", \"A\",1,1,1\n\t\t// into array like below\n\t\t// [\"Lcl Scaling\", \"Lcl Scaling\", \"\", \"A\", \"1,1,1\" ]\n\t\tconst props = propValue.split( '\",' ).map( function ( prop ) {\n\n\t\t\treturn prop.trim().replace( /^\\\"/, '' ).replace( /\\s/, '_' );\n\n\t\t} );\n\n\t\tconst innerPropName = props[ 0 ];\n\t\tconst innerPropType1 = props[ 1 ];\n\t\tconst innerPropType2 = props[ 2 ];\n\t\tconst innerPropFlag = props[ 3 ];\n\t\tlet innerPropValue = props[ 4 ];\n\n\t\t// cast values where needed, otherwise leave as strings\n\t\tswitch ( innerPropType1 ) {\n\n\t\t\tcase 'int':\n\t\t\tcase 'enum':\n\t\t\tcase 'bool':\n\t\t\tcase 'ULongLong':\n\t\t\tcase 'double':\n\t\t\tcase 'Number':\n\t\t\tcase 'FieldOfView':\n\t\t\t\tinnerPropValue = parseFloat( innerPropValue );\n\t\t\t\tbreak;\n\n\t\t\tcase 'Color':\n\t\t\tcase 'ColorRGB':\n\t\t\tcase 'Vector3D':\n\t\t\tcase 'Lcl_Translation':\n\t\t\tcase 'Lcl_Rotation':\n\t\t\tcase 'Lcl_Scaling':\n\t\t\t\tinnerPropValue = parseNumberArray( innerPropValue );\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\t// CAUTION: these props must append to parent's parent\n\t\tthis.getPrevNode()[ innerPropName ] = {\n\n\t\t\t'type': innerPropType1,\n\t\t\t'type2': innerPropType2,\n\t\t\t'flag': innerPropFlag,\n\t\t\t'value': innerPropValue\n\n\t\t};\n\n\t\tthis.setCurrentProp( this.getPrevNode(), innerPropName );\n\n\t}\n\n}\n\n// Parse an FBX file in Binary format\nclass BinaryParser {\n\n\tparse( buffer ) {\n\n\t\tconst reader = new BinaryReader( buffer );\n\t\treader.skip( 23 ); // skip magic 23 bytes\n\n\t\tconst version = reader.getUint32();\n\n\t\tif ( version < 6400 ) {\n\n\t\t\tthrow new Error( 'THREE.FBXLoader: FBX version not supported, FileVersion: ' + version );\n\n\t\t}\n\n\t\tconst allNodes = new FBXTree();\n\n\t\twhile ( ! this.endOfContent( reader ) ) {\n\n\t\t\tconst node = this.parseNode( reader, version );\n\t\t\tif ( node !== null ) allNodes.add( node.name, node );\n\n\t\t}\n\n\t\treturn allNodes;\n\n\t}\n\n\t// Check if reader has reached the end of content.\n\tendOfContent( reader ) {\n\n\t\t// footer size: 160bytes + 16-byte alignment padding\n\t\t// - 16bytes: magic\n\t\t// - padding til 16-byte alignment (at least 1byte?)\n\t\t//\t(seems like some exporters embed fixed 15 or 16bytes?)\n\t\t// - 4bytes: magic\n\t\t// - 4bytes: version\n\t\t// - 120bytes: zero\n\t\t// - 16bytes: magic\n\t\tif ( reader.size() % 16 === 0 ) {\n\n\t\t\treturn ( ( reader.getOffset() + 160 + 16 ) & ~ 0xf ) >= reader.size();\n\n\t\t} else {\n\n\t\t\treturn reader.getOffset() + 160 + 16 >= reader.size();\n\n\t\t}\n\n\t}\n\n\t// recursively parse nodes until the end of the file is reached\n\tparseNode( reader, version ) {\n\n\t\tconst node = {};\n\n\t\t// The first three data sizes depends on version.\n\t\tconst endOffset = ( version >= 7500 ) ? reader.getUint64() : reader.getUint32();\n\t\tconst numProperties = ( version >= 7500 ) ? reader.getUint64() : reader.getUint32();\n\n\t\t( version >= 7500 ) ? reader.getUint64() : reader.getUint32(); // the returned propertyListLen is not used\n\n\t\tconst nameLen = reader.getUint8();\n\t\tconst name = reader.getString( nameLen );\n\n\t\t// Regards this node as NULL-record if endOffset is zero\n\t\tif ( endOffset === 0 ) return null;\n\n\t\tconst propertyList = [];\n\n\t\tfor ( let i = 0; i < numProperties; i ++ ) {\n\n\t\t\tpropertyList.push( this.parseProperty( reader ) );\n\n\t\t}\n\n\t\t// Regards the first three elements in propertyList as id, attrName, and attrType\n\t\tconst id = propertyList.length > 0 ? propertyList[ 0 ] : '';\n\t\tconst attrName = propertyList.length > 1 ? propertyList[ 1 ] : '';\n\t\tconst attrType = propertyList.length > 2 ? propertyList[ 2 ] : '';\n\n\t\t// check if this node represents just a single property\n\t\t// like (name, 0) set or (name2, [0, 1, 2]) set of {name: 0, name2: [0, 1, 2]}\n\t\tnode.singleProperty = ( numProperties === 1 && reader.getOffset() === endOffset ) ? true : false;\n\n\t\twhile ( endOffset > reader.getOffset() ) {\n\n\t\t\tconst subNode = this.parseNode( reader, version );\n\n\t\t\tif ( subNode !== null ) this.parseSubNode( name, node, subNode );\n\n\t\t}\n\n\t\tnode.propertyList = propertyList; // raw property list used by parent\n\n\t\tif ( typeof id === 'number' ) node.id = id;\n\t\tif ( attrName !== '' ) node.attrName = attrName;\n\t\tif ( attrType !== '' ) node.attrType = attrType;\n\t\tif ( name !== '' ) node.name = name;\n\n\t\treturn node;\n\n\t}\n\n\tparseSubNode( name, node, subNode ) {\n\n\t\t// special case: child node is single property\n\t\tif ( subNode.singleProperty === true ) {\n\n\t\t\tconst value = subNode.propertyList[ 0 ];\n\n\t\t\tif ( Array.isArray( value ) ) {\n\n\t\t\t\tnode[ subNode.name ] = subNode;\n\n\t\t\t\tsubNode.a = value;\n\n\t\t\t} else {\n\n\t\t\t\tnode[ subNode.name ] = value;\n\n\t\t\t}\n\n\t\t} else if ( name === 'Connections' && subNode.name === 'C' ) {\n\n\t\t\tconst array = [];\n\n\t\t\tsubNode.propertyList.forEach( function ( property, i ) {\n\n\t\t\t\t// first Connection is FBX type (OO, OP, etc.). We'll discard these\n\t\t\t\tif ( i !== 0 ) array.push( property );\n\n\t\t\t} );\n\n\t\t\tif ( node.connections === undefined ) {\n\n\t\t\t\tnode.connections = [];\n\n\t\t\t}\n\n\t\t\tnode.connections.push( array );\n\n\t\t} else if ( subNode.name === 'Properties70' ) {\n\n\t\t\tconst keys = Object.keys( subNode );\n\n\t\t\tkeys.forEach( function ( key ) {\n\n\t\t\t\tnode[ key ] = subNode[ key ];\n\n\t\t\t} );\n\n\t\t} else if ( name === 'Properties70' && subNode.name === 'P' ) {\n\n\t\t\tlet innerPropName = subNode.propertyList[ 0 ];\n\t\t\tlet innerPropType1 = subNode.propertyList[ 1 ];\n\t\t\tconst innerPropType2 = subNode.propertyList[ 2 ];\n\t\t\tconst innerPropFlag = subNode.propertyList[ 3 ];\n\t\t\tlet innerPropValue;\n\n\t\t\tif ( innerPropName.indexOf( 'Lcl ' ) === 0 ) innerPropName = innerPropName.replace( 'Lcl ', 'Lcl_' );\n\t\t\tif ( innerPropType1.indexOf( 'Lcl ' ) === 0 ) innerPropType1 = innerPropType1.replace( 'Lcl ', 'Lcl_' );\n\n\t\t\tif ( innerPropType1 === 'Color' || innerPropType1 === 'ColorRGB' || innerPropType1 === 'Vector' || innerPropType1 === 'Vector3D' || innerPropType1.indexOf( 'Lcl_' ) === 0 ) {\n\n\t\t\t\tinnerPropValue = [\n\t\t\t\t\tsubNode.propertyList[ 4 ],\n\t\t\t\t\tsubNode.propertyList[ 5 ],\n\t\t\t\t\tsubNode.propertyList[ 6 ]\n\t\t\t\t];\n\n\t\t\t} else {\n\n\t\t\t\tinnerPropValue = subNode.propertyList[ 4 ];\n\n\t\t\t}\n\n\t\t\t// this will be copied to parent, see above\n\t\t\tnode[ innerPropName ] = {\n\n\t\t\t\t'type': innerPropType1,\n\t\t\t\t'type2': innerPropType2,\n\t\t\t\t'flag': innerPropFlag,\n\t\t\t\t'value': innerPropValue\n\n\t\t\t};\n\n\t\t} else if ( node[ subNode.name ] === undefined ) {\n\n\t\t\tif ( typeof subNode.id === 'number' ) {\n\n\t\t\t\tnode[ subNode.name ] = {};\n\t\t\t\tnode[ subNode.name ][ subNode.id ] = subNode;\n\n\t\t\t} else {\n\n\t\t\t\tnode[ subNode.name ] = subNode;\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tif ( subNode.name === 'PoseNode' ) {\n\n\t\t\t\tif ( ! Array.isArray( node[ subNode.name ] ) ) {\n\n\t\t\t\t\tnode[ subNode.name ] = [ node[ subNode.name ] ];\n\n\t\t\t\t}\n\n\t\t\t\tnode[ subNode.name ].push( subNode );\n\n\t\t\t} else if ( node[ subNode.name ][ subNode.id ] === undefined ) {\n\n\t\t\t\tnode[ subNode.name ][ subNode.id ] = subNode;\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\tparseProperty( reader ) {\n\n\t\tconst type = reader.getString( 1 );\n\t\tlet length;\n\n\t\tswitch ( type ) {\n\n\t\t\tcase 'C':\n\t\t\t\treturn reader.getBoolean();\n\n\t\t\tcase 'D':\n\t\t\t\treturn reader.getFloat64();\n\n\t\t\tcase 'F':\n\t\t\t\treturn reader.getFloat32();\n\n\t\t\tcase 'I':\n\t\t\t\treturn reader.getInt32();\n\n\t\t\tcase 'L':\n\t\t\t\treturn reader.getInt64();\n\n\t\t\tcase 'R':\n\t\t\t\tlength = reader.getUint32();\n\t\t\t\treturn reader.getArrayBuffer( length );\n\n\t\t\tcase 'S':\n\t\t\t\tlength = reader.getUint32();\n\t\t\t\treturn reader.getString( length );\n\n\t\t\tcase 'Y':\n\t\t\t\treturn reader.getInt16();\n\n\t\t\tcase 'b':\n\t\t\tcase 'c':\n\t\t\tcase 'd':\n\t\t\tcase 'f':\n\t\t\tcase 'i':\n\t\t\tcase 'l':\n\n\t\t\t\tconst arrayLength = reader.getUint32();\n\t\t\t\tconst encoding = reader.getUint32(); // 0: non-compressed, 1: compressed\n\t\t\t\tconst compressedLength = reader.getUint32();\n\n\t\t\t\tif ( encoding === 0 ) {\n\n\t\t\t\t\tswitch ( type ) {\n\n\t\t\t\t\t\tcase 'b':\n\t\t\t\t\t\tcase 'c':\n\t\t\t\t\t\t\treturn reader.getBooleanArray( arrayLength );\n\n\t\t\t\t\t\tcase 'd':\n\t\t\t\t\t\t\treturn reader.getFloat64Array( arrayLength );\n\n\t\t\t\t\t\tcase 'f':\n\t\t\t\t\t\t\treturn reader.getFloat32Array( arrayLength );\n\n\t\t\t\t\t\tcase 'i':\n\t\t\t\t\t\t\treturn reader.getInt32Array( arrayLength );\n\n\t\t\t\t\t\tcase 'l':\n\t\t\t\t\t\t\treturn reader.getInt64Array( arrayLength );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tif ( typeof fflate === 'undefined' ) {\n\n\t\t\t\t\tconsole.error( 'THREE.FBXLoader: External library fflate.min.js required.' );\n\n\t\t\t\t}\n\n\t\t\t\tconst data = fflate.unzlibSync( new Uint8Array( reader.getArrayBuffer( compressedLength ) ) ); // eslint-disable-line no-undef\n\t\t\t\tconst reader2 = new BinaryReader( data.buffer );\n\n\t\t\t\tswitch ( type ) {\n\n\t\t\t\t\tcase 'b':\n\t\t\t\t\tcase 'c':\n\t\t\t\t\t\treturn reader2.getBooleanArray( arrayLength );\n\n\t\t\t\t\tcase 'd':\n\t\t\t\t\t\treturn reader2.getFloat64Array( arrayLength );\n\n\t\t\t\t\tcase 'f':\n\t\t\t\t\t\treturn reader2.getFloat32Array( arrayLength );\n\n\t\t\t\t\tcase 'i':\n\t\t\t\t\t\treturn reader2.getInt32Array( arrayLength );\n\n\t\t\t\t\tcase 'l':\n\t\t\t\t\t\treturn reader2.getInt64Array( arrayLength );\n\n\t\t\t\t}\n\n\t\t\tdefault:\n\t\t\t\tthrow new Error( 'THREE.FBXLoader: Unknown property type ' + type );\n\n\t\t}\n\n\t}\n\n}\n\nclass BinaryReader {\n\n\tconstructor( buffer, littleEndian ) {\n\n\t\tthis.dv = new DataView( buffer );\n\t\tthis.offset = 0;\n\t\tthis.littleEndian = ( littleEndian !== undefined ) ? littleEndian : true;\n\n\t}\n\n\tgetOffset() {\n\n\t\treturn this.offset;\n\n\t}\n\n\tsize() {\n\n\t\treturn this.dv.buffer.byteLength;\n\n\t}\n\n\tskip( length ) {\n\n\t\tthis.offset += length;\n\n\t}\n\n\t// seems like true/false representation depends on exporter.\n\t// true: 1 or 'Y'(=0x59), false: 0 or 'T'(=0x54)\n\t// then sees LSB.\n\tgetBoolean() {\n\n\t\treturn ( this.getUint8() & 1 ) === 1;\n\n\t}\n\n\tgetBooleanArray( size ) {\n\n\t\tconst a = [];\n\n\t\tfor ( let i = 0; i < size; i ++ ) {\n\n\t\t\ta.push( this.getBoolean() );\n\n\t\t}\n\n\t\treturn a;\n\n\t}\n\n\tgetUint8() {\n\n\t\tconst value = this.dv.getUint8( this.offset );\n\t\tthis.offset += 1;\n\t\treturn value;\n\n\t}\n\n\tgetInt16() {\n\n\t\tconst value = this.dv.getInt16( this.offset, this.littleEndian );\n\t\tthis.offset += 2;\n\t\treturn value;\n\n\t}\n\n\tgetInt32() {\n\n\t\tconst value = this.dv.getInt32( this.offset, this.littleEndian );\n\t\tthis.offset += 4;\n\t\treturn value;\n\n\t}\n\n\tgetInt32Array( size ) {\n\n\t\tconst a = [];\n\n\t\tfor ( let i = 0; i < size; i ++ ) {\n\n\t\t\ta.push( this.getInt32() );\n\n\t\t}\n\n\t\treturn a;\n\n\t}\n\n\tgetUint32() {\n\n\t\tconst value = this.dv.getUint32( this.offset, this.littleEndian );\n\t\tthis.offset += 4;\n\t\treturn value;\n\n\t}\n\n\t// JavaScript doesn't support 64-bit integer so calculate this here\n\t// 1 << 32 will return 1 so using multiply operation instead here.\n\t// There's a possibility that this method returns wrong value if the value\n\t// is out of the range between Number.MAX_SAFE_INTEGER and Number.MIN_SAFE_INTEGER.\n\t// TODO: safely handle 64-bit integer\n\tgetInt64() {\n\n\t\tlet low, high;\n\n\t\tif ( this.littleEndian ) {\n\n\t\t\tlow = this.getUint32();\n\t\t\thigh = this.getUint32();\n\n\t\t} else {\n\n\t\t\thigh = this.getUint32();\n\t\t\tlow = this.getUint32();\n\n\t\t}\n\n\t\t// calculate negative value\n\t\tif ( high & 0x80000000 ) {\n\n\t\t\thigh = ~ high & 0xFFFFFFFF;\n\t\t\tlow = ~ low & 0xFFFFFFFF;\n\n\t\t\tif ( low === 0xFFFFFFFF ) high = ( high + 1 ) & 0xFFFFFFFF;\n\n\t\t\tlow = ( low + 1 ) & 0xFFFFFFFF;\n\n\t\t\treturn - ( high * 0x100000000 + low );\n\n\t\t}\n\n\t\treturn high * 0x100000000 + low;\n\n\t}\n\n\tgetInt64Array( size ) {\n\n\t\tconst a = [];\n\n\t\tfor ( let i = 0; i < size; i ++ ) {\n\n\t\t\ta.push( this.getInt64() );\n\n\t\t}\n\n\t\treturn a;\n\n\t}\n\n\t// Note: see getInt64() comment\n\tgetUint64() {\n\n\t\tlet low, high;\n\n\t\tif ( this.littleEndian ) {\n\n\t\t\tlow = this.getUint32();\n\t\t\thigh = this.getUint32();\n\n\t\t} else {\n\n\t\t\thigh = this.getUint32();\n\t\t\tlow = this.getUint32();\n\n\t\t}\n\n\t\treturn high * 0x100000000 + low;\n\n\t}\n\n\tgetFloat32() {\n\n\t\tconst value = this.dv.getFloat32( this.offset, this.littleEndian );\n\t\tthis.offset += 4;\n\t\treturn value;\n\n\t}\n\n\tgetFloat32Array( size ) {\n\n\t\tconst a = [];\n\n\t\tfor ( let i = 0; i < size; i ++ ) {\n\n\t\t\ta.push( this.getFloat32() );\n\n\t\t}\n\n\t\treturn a;\n\n\t}\n\n\tgetFloat64() {\n\n\t\tconst value = this.dv.getFloat64( this.offset, this.littleEndian );\n\t\tthis.offset += 8;\n\t\treturn value;\n\n\t}\n\n\tgetFloat64Array( size ) {\n\n\t\tconst a = [];\n\n\t\tfor ( let i = 0; i < size; i ++ ) {\n\n\t\t\ta.push( this.getFloat64() );\n\n\t\t}\n\n\t\treturn a;\n\n\t}\n\n\tgetArrayBuffer( size ) {\n\n\t\tconst value = this.dv.buffer.slice( this.offset, this.offset + size );\n\t\tthis.offset += size;\n\t\treturn value;\n\n\t}\n\n\tgetString( size ) {\n\n\t\t// note: safari 9 doesn't support Uint8Array.indexOf; create intermediate array instead\n\t\tlet a = [];\n\n\t\tfor ( let i = 0; i < size; i ++ ) {\n\n\t\t\ta[ i ] = this.getUint8();\n\n\t\t}\n\n\t\tconst nullByte = a.indexOf( 0 );\n\t\tif ( nullByte >= 0 ) a = a.slice( 0, nullByte );\n\n\t\treturn LoaderUtils.decodeText( new Uint8Array( a ) );\n\n\t}\n\n}\n\n// FBXTree holds a representation of the FBX data, returned by the TextParser ( FBX ASCII format)\n// and BinaryParser( FBX Binary format)\nclass FBXTree {\n\n\tadd( key, val ) {\n\n\t\tthis[ key ] = val;\n\n\t}\n\n}\n\n// ************** UTILITY FUNCTIONS **************\n\nfunction isFbxFormatBinary( buffer ) {\n\n\tconst CORRECT = 'Kaydara\\u0020FBX\\u0020Binary\\u0020\\u0020\\0';\n\n\treturn buffer.byteLength >= CORRECT.length && CORRECT === convertArrayBufferToString( buffer, 0, CORRECT.length );\n\n}\n\nfunction isFbxFormatASCII( text ) {\n\n\tconst CORRECT = [ 'K', 'a', 'y', 'd', 'a', 'r', 'a', '\\\\', 'F', 'B', 'X', '\\\\', 'B', 'i', 'n', 'a', 'r', 'y', '\\\\', '\\\\' ];\n\n\tlet cursor = 0;\n\n\tfunction read( offset ) {\n\n\t\tconst result = text[ offset - 1 ];\n\t\ttext = text.slice( cursor + offset );\n\t\tcursor ++;\n\t\treturn result;\n\n\t}\n\n\tfor ( let i = 0; i < CORRECT.length; ++ i ) {\n\n\t\tconst num = read( 1 );\n\t\tif ( num === CORRECT[ i ] ) {\n\n\t\t\treturn false;\n\n\t\t}\n\n\t}\n\n\treturn true;\n\n}\n\nfunction getFbxVersion( text ) {\n\n\tconst versionRegExp = /FBXVersion: (\\d+)/;\n\tconst match = text.match( versionRegExp );\n\n\tif ( match ) {\n\n\t\tconst version = parseInt( match[ 1 ] );\n\t\treturn version;\n\n\t}\n\n\tthrow new Error( 'THREE.FBXLoader: Cannot find the version number for the file given.' );\n\n}\n\n// Converts FBX ticks into real time seconds.\nfunction convertFBXTimeToSeconds( time ) {\n\n\treturn time / 46186158000;\n\n}\n\nconst dataArray = [];\n\n// extracts the data from the correct position in the FBX array based on indexing type\nfunction getData( polygonVertexIndex, polygonIndex, vertexIndex, infoObject ) {\n\n\tlet index;\n\n\tswitch ( infoObject.mappingType ) {\n\n\t\tcase 'ByPolygonVertex' :\n\t\t\tindex = polygonVertexIndex;\n\t\t\tbreak;\n\t\tcase 'ByPolygon' :\n\t\t\tindex = polygonIndex;\n\t\t\tbreak;\n\t\tcase 'ByVertice' :\n\t\t\tindex = vertexIndex;\n\t\t\tbreak;\n\t\tcase 'AllSame' :\n\t\t\tindex = infoObject.indices[ 0 ];\n\t\t\tbreak;\n\t\tdefault :\n\t\t\tconsole.warn( 'THREE.FBXLoader: unknown attribute mapping type ' + infoObject.mappingType );\n\n\t}\n\n\tif ( infoObject.referenceType === 'IndexToDirect' ) index = infoObject.indices[ index ];\n\n\tconst from = index * infoObject.dataSize;\n\tconst to = from + infoObject.dataSize;\n\n\treturn slice( dataArray, infoObject.buffer, from, to );\n\n}\n\nconst tempEuler = new Euler();\nconst tempVec = new Vector3();\n\n// generate transformation from FBX transform data\n// ref: https://help.autodesk.com/view/FBX/2017/ENU/?guid=__files_GUID_10CDD63C_79C1_4F2D_BB28_AD2BE65A02ED_htm\n// ref: http://docs.autodesk.com/FBX/2014/ENU/FBX-SDK-Documentation/index.html?url=cpp_ref/_transformations_2main_8cxx-example.html,topicNumber=cpp_ref__transformations_2main_8cxx_example_htmlfc10a1e1-b18d-4e72-9dc0-70d0f1959f5e\nfunction generateTransform( transformData ) {\n\n\tconst lTranslationM = new Matrix4();\n\tconst lPreRotationM = new Matrix4();\n\tconst lRotationM = new Matrix4();\n\tconst lPostRotationM = new Matrix4();\n\n\tconst lScalingM = new Matrix4();\n\tconst lScalingPivotM = new Matrix4();\n\tconst lScalingOffsetM = new Matrix4();\n\tconst lRotationOffsetM = new Matrix4();\n\tconst lRotationPivotM = new Matrix4();\n\n\tconst lParentGX = new Matrix4();\n\tconst lParentLX = new Matrix4();\n\tconst lGlobalT = new Matrix4();\n\n\tconst inheritType = ( transformData.inheritType ) ? transformData.inheritType : 0;\n\n\tif ( transformData.translation ) lTranslationM.setPosition( tempVec.fromArray( transformData.translation ) );\n\n\tif ( transformData.preRotation ) {\n\n\t\tconst array = transformData.preRotation.map( MathUtils.degToRad );\n\t\tarray.push( transformData.eulerOrder );\n\t\tlPreRotationM.makeRotationFromEuler( tempEuler.fromArray( array ) );\n\n\t}\n\n\tif ( transformData.rotation ) {\n\n\t\tconst array = transformData.rotation.map( MathUtils.degToRad );\n\t\tarray.push( transformData.eulerOrder );\n\t\tlRotationM.makeRotationFromEuler( tempEuler.fromArray( array ) );\n\n\t}\n\n\tif ( transformData.postRotation ) {\n\n\t\tconst array = transformData.postRotation.map( MathUtils.degToRad );\n\t\tarray.push( transformData.eulerOrder );\n\t\tlPostRotationM.makeRotationFromEuler( tempEuler.fromArray( array ) );\n\t\tlPostRotationM.invert();\n\n\t}\n\n\tif ( transformData.scale ) lScalingM.scale( tempVec.fromArray( transformData.scale ) );\n\n\t// Pivots and offsets\n\tif ( transformData.scalingOffset ) lScalingOffsetM.setPosition( tempVec.fromArray( transformData.scalingOffset ) );\n\tif ( transformData.scalingPivot ) lScalingPivotM.setPosition( tempVec.fromArray( transformData.scalingPivot ) );\n\tif ( transformData.rotationOffset ) lRotationOffsetM.setPosition( tempVec.fromArray( transformData.rotationOffset ) );\n\tif ( transformData.rotationPivot ) lRotationPivotM.setPosition( tempVec.fromArray( transformData.rotationPivot ) );\n\n\t// parent transform\n\tif ( transformData.parentMatrixWorld ) {\n\n\t\tlParentLX.copy( transformData.parentMatrix );\n\t\tlParentGX.copy( transformData.parentMatrixWorld );\n\n\t}\n\n\tconst lLRM = lPreRotationM.clone().multiply( lRotationM ).multiply( lPostRotationM );\n\t// Global Rotation\n\tconst lParentGRM = new Matrix4();\n\tlParentGRM.extractRotation( lParentGX );\n\n\t// Global Shear*Scaling\n\tconst lParentTM = new Matrix4();\n\tlParentTM.copyPosition( lParentGX );\n\n\tconst lParentGRSM = lParentTM.clone().invert().multiply( lParentGX );\n\tconst lParentGSM = lParentGRM.clone().invert().multiply( lParentGRSM );\n\tconst lLSM = lScalingM;\n\n\tconst lGlobalRS = new Matrix4();\n\n\tif ( inheritType === 0 ) {\n\n\t\tlGlobalRS.copy( lParentGRM ).multiply( lLRM ).multiply( lParentGSM ).multiply( lLSM );\n\n\t} else if ( inheritType === 1 ) {\n\n\t\tlGlobalRS.copy( lParentGRM ).multiply( lParentGSM ).multiply( lLRM ).multiply( lLSM );\n\n\t} else {\n\n\t\tconst lParentLSM = new Matrix4().scale( new Vector3().setFromMatrixScale( lParentLX ) );\n\t\tconst lParentLSM_inv = lParentLSM.clone().invert();\n\t\tconst lParentGSM_noLocal = lParentGSM.clone().multiply( lParentLSM_inv );\n\n\t\tlGlobalRS.copy( lParentGRM ).multiply( lLRM ).multiply( lParentGSM_noLocal ).multiply( lLSM );\n\n\t}\n\n\tconst lRotationPivotM_inv = lRotationPivotM.clone().invert();\n\tconst lScalingPivotM_inv = lScalingPivotM.clone().invert();\n\t// Calculate the local transform matrix\n\tlet lTransform = lTranslationM.clone().multiply( lRotationOffsetM ).multiply( lRotationPivotM ).multiply( lPreRotationM ).multiply( lRotationM ).multiply( lPostRotationM ).multiply( lRotationPivotM_inv ).multiply( lScalingOffsetM ).multiply( lScalingPivotM ).multiply( lScalingM ).multiply( lScalingPivotM_inv );\n\n\tconst lLocalTWithAllPivotAndOffsetInfo = new Matrix4().copyPosition( lTransform );\n\n\tconst lGlobalTranslation = lParentGX.clone().multiply( lLocalTWithAllPivotAndOffsetInfo );\n\tlGlobalT.copyPosition( lGlobalTranslation );\n\n\tlTransform = lGlobalT.clone().multiply( lGlobalRS );\n\n\t// from global to local\n\tlTransform.premultiply( lParentGX.invert() );\n\n\treturn lTransform;\n\n}\n\n// Returns the three.js intrinsic Euler order corresponding to FBX extrinsic Euler order\n// ref: http://help.autodesk.com/view/FBX/2017/ENU/?guid=__cpp_ref_class_fbx_euler_html\nfunction getEulerOrder( order ) {\n\n\torder = order || 0;\n\n\tconst enums = [\n\t\t'ZYX', // -> XYZ extrinsic\n\t\t'YZX', // -> XZY extrinsic\n\t\t'XZY', // -> YZX extrinsic\n\t\t'ZXY', // -> YXZ extrinsic\n\t\t'YXZ', // -> ZXY extrinsic\n\t\t'XYZ', // -> ZYX extrinsic\n\t\t//'SphericXYZ', // not possible to support\n\t];\n\n\tif ( order === 6 ) {\n\n\t\tconsole.warn( 'THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect.' );\n\t\treturn enums[ 0 ];\n\n\t}\n\n\treturn enums[ order ];\n\n}\n\n// Parses comma separated list of numbers and returns them an array.\n// Used internally by the TextParser\nfunction parseNumberArray( value ) {\n\n\tconst array = value.split( ',' ).map( function ( val ) {\n\n\t\treturn parseFloat( val );\n\n\t} );\n\n\treturn array;\n\n}\n\nfunction convertArrayBufferToString( buffer, from, to ) {\n\n\tif ( from === undefined ) from = 0;\n\tif ( to === undefined ) to = buffer.byteLength;\n\n\treturn LoaderUtils.decodeText( new Uint8Array( buffer, from, to ) );\n\n}\n\nfunction append( a, b ) {\n\n\tfor ( let i = 0, j = a.length, l = b.length; i < l; i ++, j ++ ) {\n\n\t\ta[ j ] = b[ i ];\n\n\t}\n\n}\n\nfunction slice( a, b, from, to ) {\n\n\tfor ( let i = from, j = 0; i < to; i ++, j ++ ) {\n\n\t\ta[ j ] = b[ i ];\n\n\t}\n\n\treturn a;\n\n}\n\n// inject array a2 into array a1 at index\nfunction inject( a1, index, a2 ) {\n\n\treturn a1.slice( 0, index ).concat( a2 ).concat( a1.slice( index ) );\n\n}\n\nexport { FBXLoader };\n","import {\n\tAnimationClip,\n\tBone,\n\tBox3,\n\tBufferAttribute,\n\tBufferGeometry,\n\tClampToEdgeWrapping,\n\tColor,\n\tDirectionalLight,\n\tDoubleSide,\n\tFileLoader,\n\tFrontSide,\n\tGroup,\n\tImageBitmapLoader,\n\tInterleavedBuffer,\n\tInterleavedBufferAttribute,\n\tInterpolant,\n\tInterpolateDiscrete,\n\tInterpolateLinear,\n\tLine,\n\tLineBasicMaterial,\n\tLineLoop,\n\tLineSegments,\n\tLinearFilter,\n\tLinearMipmapLinearFilter,\n\tLinearMipmapNearestFilter,\n\tLoader,\n\tLoaderUtils,\n\tMaterial,\n\tMathUtils,\n\tMatrix4,\n\tMesh,\n\tMeshBasicMaterial,\n\tMeshPhysicalMaterial,\n\tMeshStandardMaterial,\n\tMirroredRepeatWrapping,\n\tNearestFilter,\n\tNearestMipmapLinearFilter,\n\tNearestMipmapNearestFilter,\n\tNumberKeyframeTrack,\n\tObject3D,\n\tOrthographicCamera,\n\tPerspectiveCamera,\n\tPointLight,\n\tPoints,\n\tPointsMaterial,\n\tPropertyBinding,\n\tQuaternion,\n\tQuaternionKeyframeTrack,\n\tRepeatWrapping,\n\tSkeleton,\n\tSkinnedMesh,\n\tSphere,\n\tSpotLight,\n\tTangentSpaceNormalMap,\n\tTexture,\n\tTextureLoader,\n\tTriangleFanDrawMode,\n\tTriangleStripDrawMode,\n\tVector2,\n\tVector3,\n\tVectorKeyframeTrack,\n\tsRGBEncoding\n} from 'three';\n\nclass GLTFLoader extends Loader {\n\n\tconstructor( manager ) {\n\n\t\tsuper( manager );\n\n\t\tthis.dracoLoader = null;\n\t\tthis.ktx2Loader = null;\n\t\tthis.meshoptDecoder = null;\n\n\t\tthis.pluginCallbacks = [];\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsClearcoatExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFTextureBasisUExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFTextureWebPExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsSheenExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsTransmissionExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsVolumeExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsIorExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsSpecularExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFLightsExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMeshoptCompression( parser );\n\n\t\t} );\n\n\t}\n\n\tload( url, onLoad, onProgress, onError ) {\n\n\t\tconst scope = this;\n\n\t\tlet resourcePath;\n\n\t\tif ( this.resourcePath !== '' ) {\n\n\t\t\tresourcePath = this.resourcePath;\n\n\t\t} else if ( this.path !== '' ) {\n\n\t\t\tresourcePath = this.path;\n\n\t\t} else {\n\n\t\t\tresourcePath = LoaderUtils.extractUrlBase( url );\n\n\t\t}\n\n\t\t// Tells the LoadingManager to track an extra item, which resolves after\n\t\t// the model is fully loaded. This means the count of items loaded will\n\t\t// be incorrect, but ensures manager.onLoad() does not fire early.\n\t\tthis.manager.itemStart( url );\n\n\t\tconst _onError = function ( e ) {\n\n\t\t\tif ( onError ) {\n\n\t\t\t\tonError( e );\n\n\t\t\t} else {\n\n\t\t\t\tconsole.error( e );\n\n\t\t\t}\n\n\t\t\tscope.manager.itemError( url );\n\t\t\tscope.manager.itemEnd( url );\n\n\t\t};\n\n\t\tconst loader = new FileLoader( this.manager );\n\n\t\tloader.setPath( this.path );\n\t\tloader.setResponseType( 'arraybuffer' );\n\t\tloader.setRequestHeader( this.requestHeader );\n\t\tloader.setWithCredentials( this.withCredentials );\n\n\t\tloader.load( url, function ( data ) {\n\n\t\t\ttry {\n\n\t\t\t\tscope.parse( data, resourcePath, function ( gltf ) {\n\n\t\t\t\t\tonLoad( gltf );\n\n\t\t\t\t\tscope.manager.itemEnd( url );\n\n\t\t\t\t}, _onError );\n\n\t\t\t} catch ( e ) {\n\n\t\t\t\t_onError( e );\n\n\t\t\t}\n\n\t\t}, onProgress, _onError );\n\n\t}\n\n\tsetDRACOLoader( dracoLoader ) {\n\n\t\tthis.dracoLoader = dracoLoader;\n\t\treturn this;\n\n\t}\n\n\tsetDDSLoader() {\n\n\t\tthrow new Error(\n\n\t\t\t'THREE.GLTFLoader: \"MSFT_texture_dds\" no longer supported. Please update to \"KHR_texture_basisu\".'\n\n\t\t);\n\n\t}\n\n\tsetKTX2Loader( ktx2Loader ) {\n\n\t\tthis.ktx2Loader = ktx2Loader;\n\t\treturn this;\n\n\t}\n\n\tsetMeshoptDecoder( meshoptDecoder ) {\n\n\t\tthis.meshoptDecoder = meshoptDecoder;\n\t\treturn this;\n\n\t}\n\n\tregister( callback ) {\n\n\t\tif ( this.pluginCallbacks.indexOf( callback ) === - 1 ) {\n\n\t\t\tthis.pluginCallbacks.push( callback );\n\n\t\t}\n\n\t\treturn this;\n\n\t}\n\n\tunregister( callback ) {\n\n\t\tif ( this.pluginCallbacks.indexOf( callback ) !== - 1 ) {\n\n\t\t\tthis.pluginCallbacks.splice( this.pluginCallbacks.indexOf( callback ), 1 );\n\n\t\t}\n\n\t\treturn this;\n\n\t}\n\n\tparse( data, path, onLoad, onError ) {\n\n\t\tlet content;\n\t\tconst extensions = {};\n\t\tconst plugins = {};\n\n\t\tif ( typeof data === 'string' ) {\n\n\t\t\tcontent = data;\n\n\t\t} else {\n\n\t\t\tconst magic = LoaderUtils.decodeText( new Uint8Array( data, 0, 4 ) );\n\n\t\t\tif ( magic === BINARY_EXTENSION_HEADER_MAGIC ) {\n\n\t\t\t\ttry {\n\n\t\t\t\t\textensions[ EXTENSIONS.KHR_BINARY_GLTF ] = new GLTFBinaryExtension( data );\n\n\t\t\t\t} catch ( error ) {\n\n\t\t\t\t\tif ( onError ) onError( error );\n\t\t\t\t\treturn;\n\n\t\t\t\t}\n\n\t\t\t\tcontent = extensions[ EXTENSIONS.KHR_BINARY_GLTF ].content;\n\n\t\t\t} else {\n\n\t\t\t\tcontent = LoaderUtils.decodeText( new Uint8Array( data ) );\n\n\t\t\t}\n\n\t\t}\n\n\t\tconst json = JSON.parse( content );\n\n\t\tif ( json.asset === undefined || json.asset.version[ 0 ] < 2 ) {\n\n\t\t\tif ( onError ) onError( new Error( 'THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.' ) );\n\t\t\treturn;\n\n\t\t}\n\n\t\tconst parser = new GLTFParser( json, {\n\n\t\t\tpath: path || this.resourcePath || '',\n\t\t\tcrossOrigin: this.crossOrigin,\n\t\t\trequestHeader: this.requestHeader,\n\t\t\tmanager: this.manager,\n\t\t\tktx2Loader: this.ktx2Loader,\n\t\t\tmeshoptDecoder: this.meshoptDecoder\n\n\t\t} );\n\n\t\tparser.fileLoader.setRequestHeader( this.requestHeader );\n\n\t\tfor ( let i = 0; i < this.pluginCallbacks.length; i ++ ) {\n\n\t\t\tconst plugin = this.pluginCallbacks[ i ]( parser );\n\t\t\tplugins[ plugin.name ] = plugin;\n\n\t\t\t// Workaround to avoid determining as unknown extension\n\t\t\t// in addUnknownExtensionsToUserData().\n\t\t\t// Remove this workaround if we move all the existing\n\t\t\t// extension handlers to plugin system\n\t\t\textensions[ plugin.name ] = true;\n\n\t\t}\n\n\t\tif ( json.extensionsUsed ) {\n\n\t\t\tfor ( let i = 0; i < json.extensionsUsed.length; ++ i ) {\n\n\t\t\t\tconst extensionName = json.extensionsUsed[ i ];\n\t\t\t\tconst extensionsRequired = json.extensionsRequired || [];\n\n\t\t\t\tswitch ( extensionName ) {\n\n\t\t\t\t\tcase EXTENSIONS.KHR_MATERIALS_UNLIT:\n\t\t\t\t\t\textensions[ extensionName ] = new GLTFMaterialsUnlitExtension();\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:\n\t\t\t\t\t\textensions[ extensionName ] = new GLTFMaterialsPbrSpecularGlossinessExtension();\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase EXTENSIONS.KHR_DRACO_MESH_COMPRESSION:\n\t\t\t\t\t\textensions[ extensionName ] = new GLTFDracoMeshCompressionExtension( json, this.dracoLoader );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase EXTENSIONS.KHR_TEXTURE_TRANSFORM:\n\t\t\t\t\t\textensions[ extensionName ] = new GLTFTextureTransformExtension();\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase EXTENSIONS.KHR_MESH_QUANTIZATION:\n\t\t\t\t\t\textensions[ extensionName ] = new GLTFMeshQuantizationExtension();\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\n\t\t\t\t\t\tif ( extensionsRequired.indexOf( extensionName ) >= 0 && plugins[ extensionName ] === undefined ) {\n\n\t\t\t\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Unknown extension \"' + extensionName + '\".' );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tparser.setExtensions( extensions );\n\t\tparser.setPlugins( plugins );\n\t\tparser.parse( onLoad, onError );\n\n\t}\n\n\tparseAsync( data, path ) {\n\n\t\tconst scope = this;\n\n\t\treturn new Promise( function ( resolve, reject ) {\n\n\t\t\tscope.parse( data, path, resolve, reject );\n\n\t\t} );\n\n\t}\n\n}\n\n/* GLTFREGISTRY */\n\nfunction GLTFRegistry() {\n\n\tlet objects = {};\n\n\treturn\t{\n\n\t\tget: function ( key ) {\n\n\t\t\treturn objects[ key ];\n\n\t\t},\n\n\t\tadd: function ( key, object ) {\n\n\t\t\tobjects[ key ] = object;\n\n\t\t},\n\n\t\tremove: function ( key ) {\n\n\t\t\tdelete objects[ key ];\n\n\t\t},\n\n\t\tremoveAll: function () {\n\n\t\t\tobjects = {};\n\n\t\t}\n\n\t};\n\n}\n\n/*********************************/\n/********** EXTENSIONS ***********/\n/*********************************/\n\nconst EXTENSIONS = {\n\tKHR_BINARY_GLTF: 'KHR_binary_glTF',\n\tKHR_DRACO_MESH_COMPRESSION: 'KHR_draco_mesh_compression',\n\tKHR_LIGHTS_PUNCTUAL: 'KHR_lights_punctual',\n\tKHR_MATERIALS_CLEARCOAT: 'KHR_materials_clearcoat',\n\tKHR_MATERIALS_IOR: 'KHR_materials_ior',\n\tKHR_MATERIALS_PBR_SPECULAR_GLOSSINESS: 'KHR_materials_pbrSpecularGlossiness',\n\tKHR_MATERIALS_SHEEN: 'KHR_materials_sheen',\n\tKHR_MATERIALS_SPECULAR: 'KHR_materials_specular',\n\tKHR_MATERIALS_TRANSMISSION: 'KHR_materials_transmission',\n\tKHR_MATERIALS_UNLIT: 'KHR_materials_unlit',\n\tKHR_MATERIALS_VOLUME: 'KHR_materials_volume',\n\tKHR_TEXTURE_BASISU: 'KHR_texture_basisu',\n\tKHR_TEXTURE_TRANSFORM: 'KHR_texture_transform',\n\tKHR_MESH_QUANTIZATION: 'KHR_mesh_quantization',\n\tEXT_TEXTURE_WEBP: 'EXT_texture_webp',\n\tEXT_MESHOPT_COMPRESSION: 'EXT_meshopt_compression'\n};\n\n/**\n * Punctual Lights Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_lights_punctual\n */\nclass GLTFLightsExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_LIGHTS_PUNCTUAL;\n\n\t\t// Object3D instance caches\n\t\tthis.cache = { refs: {}, uses: {} };\n\n\t}\n\n\t_markDefs() {\n\n\t\tconst parser = this.parser;\n\t\tconst nodeDefs = this.parser.json.nodes || [];\n\n\t\tfor ( let nodeIndex = 0, nodeLength = nodeDefs.length; nodeIndex < nodeLength; nodeIndex ++ ) {\n\n\t\t\tconst nodeDef = nodeDefs[ nodeIndex ];\n\n\t\t\tif ( nodeDef.extensions\n\t\t\t\t\t&& nodeDef.extensions[ this.name ]\n\t\t\t\t\t&& nodeDef.extensions[ this.name ].light !== undefined ) {\n\n\t\t\t\tparser._addNodeRef( this.cache, nodeDef.extensions[ this.name ].light );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\t_loadLight( lightIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst cacheKey = 'light:' + lightIndex;\n\t\tlet dependency = parser.cache.get( cacheKey );\n\n\t\tif ( dependency ) return dependency;\n\n\t\tconst json = parser.json;\n\t\tconst extensions = ( json.extensions && json.extensions[ this.name ] ) || {};\n\t\tconst lightDefs = extensions.lights || [];\n\t\tconst lightDef = lightDefs[ lightIndex ];\n\t\tlet lightNode;\n\n\t\tconst color = new Color( 0xffffff );\n\n\t\tif ( lightDef.color !== undefined ) color.fromArray( lightDef.color );\n\n\t\tconst range = lightDef.range !== undefined ? lightDef.range : 0;\n\n\t\tswitch ( lightDef.type ) {\n\n\t\t\tcase 'directional':\n\t\t\t\tlightNode = new DirectionalLight( color );\n\t\t\t\tlightNode.target.position.set( 0, 0, - 1 );\n\t\t\t\tlightNode.add( lightNode.target );\n\t\t\t\tbreak;\n\n\t\t\tcase 'point':\n\t\t\t\tlightNode = new PointLight( color );\n\t\t\t\tlightNode.distance = range;\n\t\t\t\tbreak;\n\n\t\t\tcase 'spot':\n\t\t\t\tlightNode = new SpotLight( color );\n\t\t\t\tlightNode.distance = range;\n\t\t\t\t// Handle spotlight properties.\n\t\t\t\tlightDef.spot = lightDef.spot || {};\n\t\t\t\tlightDef.spot.innerConeAngle = lightDef.spot.innerConeAngle !== undefined ? lightDef.spot.innerConeAngle : 0;\n\t\t\t\tlightDef.spot.outerConeAngle = lightDef.spot.outerConeAngle !== undefined ? lightDef.spot.outerConeAngle : Math.PI / 4.0;\n\t\t\t\tlightNode.angle = lightDef.spot.outerConeAngle;\n\t\t\t\tlightNode.penumbra = 1.0 - lightDef.spot.innerConeAngle / lightDef.spot.outerConeAngle;\n\t\t\t\tlightNode.target.position.set( 0, 0, - 1 );\n\t\t\t\tlightNode.add( lightNode.target );\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tthrow new Error( 'THREE.GLTFLoader: Unexpected light type: ' + lightDef.type );\n\n\t\t}\n\n\t\t// Some lights (e.g. spot) default to a position other than the origin. Reset the position\n\t\t// here, because node-level parsing will only override position if explicitly specified.\n\t\tlightNode.position.set( 0, 0, 0 );\n\n\t\tlightNode.decay = 2;\n\n\t\tif ( lightDef.intensity !== undefined ) lightNode.intensity = lightDef.intensity;\n\n\t\tlightNode.name = parser.createUniqueName( lightDef.name || ( 'light_' + lightIndex ) );\n\n\t\tdependency = Promise.resolve( lightNode );\n\n\t\tparser.cache.add( cacheKey, dependency );\n\n\t\treturn dependency;\n\n\t}\n\n\tcreateNodeAttachment( nodeIndex ) {\n\n\t\tconst self = this;\n\t\tconst parser = this.parser;\n\t\tconst json = parser.json;\n\t\tconst nodeDef = json.nodes[ nodeIndex ];\n\t\tconst lightDef = ( nodeDef.extensions && nodeDef.extensions[ this.name ] ) || {};\n\t\tconst lightIndex = lightDef.light;\n\n\t\tif ( lightIndex === undefined ) return null;\n\n\t\treturn this._loadLight( lightIndex ).then( function ( light ) {\n\n\t\t\treturn parser._getNodeRef( self.cache, lightIndex, light );\n\n\t\t} );\n\n\t}\n\n}\n\n/**\n * Unlit Materials Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_unlit\n */\nclass GLTFMaterialsUnlitExtension {\n\n\tconstructor() {\n\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_UNLIT;\n\n\t}\n\n\tgetMaterialType() {\n\n\t\treturn MeshBasicMaterial;\n\n\t}\n\n\textendParams( materialParams, materialDef, parser ) {\n\n\t\tconst pending = [];\n\n\t\tmaterialParams.color = new Color( 1.0, 1.0, 1.0 );\n\t\tmaterialParams.opacity = 1.0;\n\n\t\tconst metallicRoughness = materialDef.pbrMetallicRoughness;\n\n\t\tif ( metallicRoughness ) {\n\n\t\t\tif ( Array.isArray( metallicRoughness.baseColorFactor ) ) {\n\n\t\t\t\tconst array = metallicRoughness.baseColorFactor;\n\n\t\t\t\tmaterialParams.color.fromArray( array );\n\t\t\t\tmaterialParams.opacity = array[ 3 ];\n\n\t\t\t}\n\n\t\t\tif ( metallicRoughness.baseColorTexture !== undefined ) {\n\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'map', metallicRoughness.baseColorTexture ) );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * Clearcoat Materials Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_clearcoat\n */\nclass GLTFMaterialsClearcoatExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_CLEARCOAT;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tif ( extension.clearcoatFactor !== undefined ) {\n\n\t\t\tmaterialParams.clearcoat = extension.clearcoatFactor;\n\n\t\t}\n\n\t\tif ( extension.clearcoatTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'clearcoatMap', extension.clearcoatTexture ) );\n\n\t\t}\n\n\t\tif ( extension.clearcoatRoughnessFactor !== undefined ) {\n\n\t\t\tmaterialParams.clearcoatRoughness = extension.clearcoatRoughnessFactor;\n\n\t\t}\n\n\t\tif ( extension.clearcoatRoughnessTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'clearcoatRoughnessMap', extension.clearcoatRoughnessTexture ) );\n\n\t\t}\n\n\t\tif ( extension.clearcoatNormalTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'clearcoatNormalMap', extension.clearcoatNormalTexture ) );\n\n\t\t\tif ( extension.clearcoatNormalTexture.scale !== undefined ) {\n\n\t\t\t\tconst scale = extension.clearcoatNormalTexture.scale;\n\n\t\t\t\tmaterialParams.clearcoatNormalScale = new Vector2( scale, scale );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * Sheen Materials Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/main/extensions/2.0/Khronos/KHR_materials_sheen\n */\nclass GLTFMaterialsSheenExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_SHEEN;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tmaterialParams.sheenColor = new Color( 0, 0, 0 );\n\t\tmaterialParams.sheenRoughness = 0;\n\t\tmaterialParams.sheen = 1;\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tif ( extension.sheenColorFactor !== undefined ) {\n\n\t\t\tmaterialParams.sheenColor.fromArray( extension.sheenColorFactor );\n\n\t\t}\n\n\t\tif ( extension.sheenRoughnessFactor !== undefined ) {\n\n\t\t\tmaterialParams.sheenRoughness = extension.sheenRoughnessFactor;\n\n\t\t}\n\n\t\tif ( extension.sheenColorTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'sheenColorMap', extension.sheenColorTexture ) );\n\n\t\t}\n\n\t\tif ( extension.sheenRoughnessTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'sheenRoughnessMap', extension.sheenRoughnessTexture ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * Transmission Materials Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_transmission\n * Draft: https://github.com/KhronosGroup/glTF/pull/1698\n */\nclass GLTFMaterialsTransmissionExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_TRANSMISSION;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tif ( extension.transmissionFactor !== undefined ) {\n\n\t\t\tmaterialParams.transmission = extension.transmissionFactor;\n\n\t\t}\n\n\t\tif ( extension.transmissionTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'transmissionMap', extension.transmissionTexture ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * Materials Volume Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_volume\n */\nclass GLTFMaterialsVolumeExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_VOLUME;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tmaterialParams.thickness = extension.thicknessFactor !== undefined ? extension.thicknessFactor : 0;\n\n\t\tif ( extension.thicknessTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'thicknessMap', extension.thicknessTexture ) );\n\n\t\t}\n\n\t\tmaterialParams.attenuationDistance = extension.attenuationDistance || 0;\n\n\t\tconst colorArray = extension.attenuationColor || [ 1, 1, 1 ];\n\t\tmaterialParams.attenuationColor = new Color( colorArray[ 0 ], colorArray[ 1 ], colorArray[ 2 ] );\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * Materials ior Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_ior\n */\nclass GLTFMaterialsIorExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_IOR;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tmaterialParams.ior = extension.ior !== undefined ? extension.ior : 1.5;\n\n\t\treturn Promise.resolve();\n\n\t}\n\n}\n\n/**\n * Materials specular Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_specular\n */\nclass GLTFMaterialsSpecularExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_SPECULAR;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tmaterialParams.specularIntensity = extension.specularFactor !== undefined ? extension.specularFactor : 1.0;\n\n\t\tif ( extension.specularTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'specularIntensityMap', extension.specularTexture ) );\n\n\t\t}\n\n\t\tconst colorArray = extension.specularColorFactor || [ 1, 1, 1 ];\n\t\tmaterialParams.specularColor = new Color( colorArray[ 0 ], colorArray[ 1 ], colorArray[ 2 ] );\n\n\t\tif ( extension.specularColorTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'specularColorMap', extension.specularColorTexture ).then( function ( texture ) {\n\n\t\t\t\ttexture.encoding = sRGBEncoding;\n\n\t\t\t} ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * BasisU Texture Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_texture_basisu\n */\nclass GLTFTextureBasisUExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_TEXTURE_BASISU;\n\n\t}\n\n\tloadTexture( textureIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst json = parser.json;\n\n\t\tconst textureDef = json.textures[ textureIndex ];\n\n\t\tif ( ! textureDef.extensions || ! textureDef.extensions[ this.name ] ) {\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\tconst extension = textureDef.extensions[ this.name ];\n\t\tconst source = json.images[ extension.source ];\n\t\tconst loader = parser.options.ktx2Loader;\n\n\t\tif ( ! loader ) {\n\n\t\t\tif ( json.extensionsRequired && json.extensionsRequired.indexOf( this.name ) >= 0 ) {\n\n\t\t\t\tthrow new Error( 'THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures' );\n\n\t\t\t} else {\n\n\t\t\t\t// Assumes that the extension is optional and that a fallback texture is present\n\t\t\t\treturn null;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn parser.loadTextureImage( textureIndex, source, loader );\n\n\t}\n\n}\n\n/**\n * WebP Texture Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_texture_webp\n */\nclass GLTFTextureWebPExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.EXT_TEXTURE_WEBP;\n\t\tthis.isSupported = null;\n\n\t}\n\n\tloadTexture( textureIndex ) {\n\n\t\tconst name = this.name;\n\t\tconst parser = this.parser;\n\t\tconst json = parser.json;\n\n\t\tconst textureDef = json.textures[ textureIndex ];\n\n\t\tif ( ! textureDef.extensions || ! textureDef.extensions[ name ] ) {\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\tconst extension = textureDef.extensions[ name ];\n\t\tconst source = json.images[ extension.source ];\n\n\t\tlet loader = parser.textureLoader;\n\t\tif ( source.uri ) {\n\n\t\t\tconst handler = parser.options.manager.getHandler( source.uri );\n\t\t\tif ( handler !== null ) loader = handler;\n\n\t\t}\n\n\t\treturn this.detectSupport().then( function ( isSupported ) {\n\n\t\t\tif ( isSupported ) return parser.loadTextureImage( textureIndex, source, loader );\n\n\t\t\tif ( json.extensionsRequired && json.extensionsRequired.indexOf( name ) >= 0 ) {\n\n\t\t\t\tthrow new Error( 'THREE.GLTFLoader: WebP required by asset but unsupported.' );\n\n\t\t\t}\n\n\t\t\t// Fall back to PNG or JPEG.\n\t\t\treturn parser.loadTexture( textureIndex );\n\n\t\t} );\n\n\t}\n\n\tdetectSupport() {\n\n\t\tif ( ! this.isSupported ) {\n\n\t\t\tthis.isSupported = new Promise( function ( resolve ) {\n\n\t\t\t\tconst image = new Image();\n\n\t\t\t\t// Lossy test image. Support for lossy images doesn't guarantee support for all\n\t\t\t\t// WebP images, unfortunately.\n\t\t\t\timage.src = 'data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA';\n\n\t\t\t\timage.onload = image.onerror = function () {\n\n\t\t\t\t\tresolve( image.height === 1 );\n\n\t\t\t\t};\n\n\t\t\t} );\n\n\t\t}\n\n\t\treturn this.isSupported;\n\n\t}\n\n}\n\n/**\n * meshopt BufferView Compression Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_meshopt_compression\n */\nclass GLTFMeshoptCompression {\n\n\tconstructor( parser ) {\n\n\t\tthis.name = EXTENSIONS.EXT_MESHOPT_COMPRESSION;\n\t\tthis.parser = parser;\n\n\t}\n\n\tloadBufferView( index ) {\n\n\t\tconst json = this.parser.json;\n\t\tconst bufferView = json.bufferViews[ index ];\n\n\t\tif ( bufferView.extensions && bufferView.extensions[ this.name ] ) {\n\n\t\t\tconst extensionDef = bufferView.extensions[ this.name ];\n\n\t\t\tconst buffer = this.parser.getDependency( 'buffer', extensionDef.buffer );\n\t\t\tconst decoder = this.parser.options.meshoptDecoder;\n\n\t\t\tif ( ! decoder || ! decoder.supported ) {\n\n\t\t\t\tif ( json.extensionsRequired && json.extensionsRequired.indexOf( this.name ) >= 0 ) {\n\n\t\t\t\t\tthrow new Error( 'THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files' );\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// Assumes that the extension is optional and that fallback buffer data is present\n\t\t\t\t\treturn null;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn Promise.all( [ buffer, decoder.ready ] ).then( function ( res ) {\n\n\t\t\t\tconst byteOffset = extensionDef.byteOffset || 0;\n\t\t\t\tconst byteLength = extensionDef.byteLength || 0;\n\n\t\t\t\tconst count = extensionDef.count;\n\t\t\t\tconst stride = extensionDef.byteStride;\n\n\t\t\t\tconst result = new ArrayBuffer( count * stride );\n\t\t\t\tconst source = new Uint8Array( res[ 0 ], byteOffset, byteLength );\n\n\t\t\t\tdecoder.decodeGltfBuffer( new Uint8Array( result ), count, stride, source, extensionDef.mode, extensionDef.filter );\n\t\t\t\treturn result;\n\n\t\t\t} );\n\n\t\t} else {\n\n\t\t\treturn null;\n\n\t\t}\n\n\t}\n\n}\n\n/* BINARY EXTENSION */\nconst BINARY_EXTENSION_HEADER_MAGIC = 'glTF';\nconst BINARY_EXTENSION_HEADER_LENGTH = 12;\nconst BINARY_EXTENSION_CHUNK_TYPES = { JSON: 0x4E4F534A, BIN: 0x004E4942 };\n\nclass GLTFBinaryExtension {\n\n\tconstructor( data ) {\n\n\t\tthis.name = EXTENSIONS.KHR_BINARY_GLTF;\n\t\tthis.content = null;\n\t\tthis.body = null;\n\n\t\tconst headerView = new DataView( data, 0, BINARY_EXTENSION_HEADER_LENGTH );\n\n\t\tthis.header = {\n\t\t\tmagic: LoaderUtils.decodeText( new Uint8Array( data.slice( 0, 4 ) ) ),\n\t\t\tversion: headerView.getUint32( 4, true ),\n\t\t\tlength: headerView.getUint32( 8, true )\n\t\t};\n\n\t\tif ( this.header.magic !== BINARY_EXTENSION_HEADER_MAGIC ) {\n\n\t\t\tthrow new Error( 'THREE.GLTFLoader: Unsupported glTF-Binary header.' );\n\n\t\t} else if ( this.header.version < 2.0 ) {\n\n\t\t\tthrow new Error( 'THREE.GLTFLoader: Legacy binary file detected.' );\n\n\t\t}\n\n\t\tconst chunkContentsLength = this.header.length - BINARY_EXTENSION_HEADER_LENGTH;\n\t\tconst chunkView = new DataView( data, BINARY_EXTENSION_HEADER_LENGTH );\n\t\tlet chunkIndex = 0;\n\n\t\twhile ( chunkIndex < chunkContentsLength ) {\n\n\t\t\tconst chunkLength = chunkView.getUint32( chunkIndex, true );\n\t\t\tchunkIndex += 4;\n\n\t\t\tconst chunkType = chunkView.getUint32( chunkIndex, true );\n\t\t\tchunkIndex += 4;\n\n\t\t\tif ( chunkType === BINARY_EXTENSION_CHUNK_TYPES.JSON ) {\n\n\t\t\t\tconst contentArray = new Uint8Array( data, BINARY_EXTENSION_HEADER_LENGTH + chunkIndex, chunkLength );\n\t\t\t\tthis.content = LoaderUtils.decodeText( contentArray );\n\n\t\t\t} else if ( chunkType === BINARY_EXTENSION_CHUNK_TYPES.BIN ) {\n\n\t\t\t\tconst byteOffset = BINARY_EXTENSION_HEADER_LENGTH + chunkIndex;\n\t\t\t\tthis.body = data.slice( byteOffset, byteOffset + chunkLength );\n\n\t\t\t}\n\n\t\t\t// Clients must ignore chunks with unknown types.\n\n\t\t\tchunkIndex += chunkLength;\n\n\t\t}\n\n\t\tif ( this.content === null ) {\n\n\t\t\tthrow new Error( 'THREE.GLTFLoader: JSON content not found.' );\n\n\t\t}\n\n\t}\n\n}\n\n/**\n * DRACO Mesh Compression Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_draco_mesh_compression\n */\nclass GLTFDracoMeshCompressionExtension {\n\n\tconstructor( json, dracoLoader ) {\n\n\t\tif ( ! dracoLoader ) {\n\n\t\t\tthrow new Error( 'THREE.GLTFLoader: No DRACOLoader instance provided.' );\n\n\t\t}\n\n\t\tthis.name = EXTENSIONS.KHR_DRACO_MESH_COMPRESSION;\n\t\tthis.json = json;\n\t\tthis.dracoLoader = dracoLoader;\n\t\tthis.dracoLoader.preload();\n\n\t}\n\n\tdecodePrimitive( primitive, parser ) {\n\n\t\tconst json = this.json;\n\t\tconst dracoLoader = this.dracoLoader;\n\t\tconst bufferViewIndex = primitive.extensions[ this.name ].bufferView;\n\t\tconst gltfAttributeMap = primitive.extensions[ this.name ].attributes;\n\t\tconst threeAttributeMap = {};\n\t\tconst attributeNormalizedMap = {};\n\t\tconst attributeTypeMap = {};\n\n\t\tfor ( const attributeName in gltfAttributeMap ) {\n\n\t\t\tconst threeAttributeName = ATTRIBUTES[ attributeName ] || attributeName.toLowerCase();\n\n\t\t\tthreeAttributeMap[ threeAttributeName ] = gltfAttributeMap[ attributeName ];\n\n\t\t}\n\n\t\tfor ( const attributeName in primitive.attributes ) {\n\n\t\t\tconst threeAttributeName = ATTRIBUTES[ attributeName ] || attributeName.toLowerCase();\n\n\t\t\tif ( gltfAttributeMap[ attributeName ] !== undefined ) {\n\n\t\t\t\tconst accessorDef = json.accessors[ primitive.attributes[ attributeName ] ];\n\t\t\t\tconst componentType = WEBGL_COMPONENT_TYPES[ accessorDef.componentType ];\n\n\t\t\t\tattributeTypeMap[ threeAttributeName ] = componentType;\n\t\t\t\tattributeNormalizedMap[ threeAttributeName ] = accessorDef.normalized === true;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn parser.getDependency( 'bufferView', bufferViewIndex ).then( function ( bufferView ) {\n\n\t\t\treturn new Promise( function ( resolve ) {\n\n\t\t\t\tdracoLoader.decodeDracoFile( bufferView, function ( geometry ) {\n\n\t\t\t\t\tfor ( const attributeName in geometry.attributes ) {\n\n\t\t\t\t\t\tconst attribute = geometry.attributes[ attributeName ];\n\t\t\t\t\t\tconst normalized = attributeNormalizedMap[ attributeName ];\n\n\t\t\t\t\t\tif ( normalized !== undefined ) attribute.normalized = normalized;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tresolve( geometry );\n\n\t\t\t\t}, threeAttributeMap, attributeTypeMap );\n\n\t\t\t} );\n\n\t\t} );\n\n\t}\n\n}\n\n/**\n * Texture Transform Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_texture_transform\n */\nclass GLTFTextureTransformExtension {\n\n\tconstructor() {\n\n\t\tthis.name = EXTENSIONS.KHR_TEXTURE_TRANSFORM;\n\n\t}\n\n\textendTexture( texture, transform ) {\n\n\t\tif ( transform.texCoord !== undefined ) {\n\n\t\t\tconsole.warn( 'THREE.GLTFLoader: Custom UV sets in \"' + this.name + '\" extension not yet supported.' );\n\n\t\t}\n\n\t\tif ( transform.offset === undefined && transform.rotation === undefined && transform.scale === undefined ) {\n\n\t\t\t// See https://github.com/mrdoob/three.js/issues/21819.\n\t\t\treturn texture;\n\n\t\t}\n\n\t\ttexture = texture.clone();\n\n\t\tif ( transform.offset !== undefined ) {\n\n\t\t\ttexture.offset.fromArray( transform.offset );\n\n\t\t}\n\n\t\tif ( transform.rotation !== undefined ) {\n\n\t\t\ttexture.rotation = transform.rotation;\n\n\t\t}\n\n\t\tif ( transform.scale !== undefined ) {\n\n\t\t\ttexture.repeat.fromArray( transform.scale );\n\n\t\t}\n\n\t\ttexture.needsUpdate = true;\n\n\t\treturn texture;\n\n\t}\n\n}\n\n/**\n * Specular-Glossiness Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/main/extensions/2.0/Archived/KHR_materials_pbrSpecularGlossiness\n */\n\n/**\n * A sub class of StandardMaterial with some of the functionality\n * changed via the `onBeforeCompile` callback\n * @pailhead\n */\nclass GLTFMeshStandardSGMaterial extends MeshStandardMaterial {\n\n\tconstructor( params ) {\n\n\t\tsuper();\n\n\t\tthis.isGLTFSpecularGlossinessMaterial = true;\n\n\t\t//various chunks that need replacing\n\t\tconst specularMapParsFragmentChunk = [\n\t\t\t'#ifdef USE_SPECULARMAP',\n\t\t\t'\tuniform sampler2D specularMap;',\n\t\t\t'#endif'\n\t\t].join( '\\n' );\n\n\t\tconst glossinessMapParsFragmentChunk = [\n\t\t\t'#ifdef USE_GLOSSINESSMAP',\n\t\t\t'\tuniform sampler2D glossinessMap;',\n\t\t\t'#endif'\n\t\t].join( '\\n' );\n\n\t\tconst specularMapFragmentChunk = [\n\t\t\t'vec3 specularFactor = specular;',\n\t\t\t'#ifdef USE_SPECULARMAP',\n\t\t\t'\tvec4 texelSpecular = texture2D( specularMap, vUv );',\n\t\t\t'\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture',\n\t\t\t'\tspecularFactor *= texelSpecular.rgb;',\n\t\t\t'#endif'\n\t\t].join( '\\n' );\n\n\t\tconst glossinessMapFragmentChunk = [\n\t\t\t'float glossinessFactor = glossiness;',\n\t\t\t'#ifdef USE_GLOSSINESSMAP',\n\t\t\t'\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );',\n\t\t\t'\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture',\n\t\t\t'\tglossinessFactor *= texelGlossiness.a;',\n\t\t\t'#endif'\n\t\t].join( '\\n' );\n\n\t\tconst lightPhysicalFragmentChunk = [\n\t\t\t'PhysicalMaterial material;',\n\t\t\t'material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );',\n\t\t\t'vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );',\n\t\t\t'float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );',\n\t\t\t'material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.',\n\t\t\t'material.roughness += geometryRoughness;',\n\t\t\t'material.roughness = min( material.roughness, 1.0 );',\n\t\t\t'material.specularColor = specularFactor;',\n\t\t].join( '\\n' );\n\n\t\tconst uniforms = {\n\t\t\tspecular: { value: new Color().setHex( 0xffffff ) },\n\t\t\tglossiness: { value: 1 },\n\t\t\tspecularMap: { value: null },\n\t\t\tglossinessMap: { value: null }\n\t\t};\n\n\t\tthis._extraUniforms = uniforms;\n\n\t\tthis.onBeforeCompile = function ( shader ) {\n\n\t\t\tfor ( const uniformName in uniforms ) {\n\n\t\t\t\tshader.uniforms[ uniformName ] = uniforms[ uniformName ];\n\n\t\t\t}\n\n\t\t\tshader.fragmentShader = shader.fragmentShader\n\t\t\t\t.replace( 'uniform float roughness;', 'uniform vec3 specular;' )\n\t\t\t\t.replace( 'uniform float metalness;', 'uniform float glossiness;' )\n\t\t\t\t.replace( '#include <roughnessmap_pars_fragment>', specularMapParsFragmentChunk )\n\t\t\t\t.replace( '#include <metalnessmap_pars_fragment>', glossinessMapParsFragmentChunk )\n\t\t\t\t.replace( '#include <roughnessmap_fragment>', specularMapFragmentChunk )\n\t\t\t\t.replace( '#include <metalnessmap_fragment>', glossinessMapFragmentChunk )\n\t\t\t\t.replace( '#include <lights_physical_fragment>', lightPhysicalFragmentChunk );\n\n\t\t};\n\n\t\tObject.defineProperties( this, {\n\n\t\t\tspecular: {\n\t\t\t\tget: function () {\n\n\t\t\t\t\treturn uniforms.specular.value;\n\n\t\t\t\t},\n\t\t\t\tset: function ( v ) {\n\n\t\t\t\t\tuniforms.specular.value = v;\n\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tspecularMap: {\n\t\t\t\tget: function () {\n\n\t\t\t\t\treturn uniforms.specularMap.value;\n\n\t\t\t\t},\n\t\t\t\tset: function ( v ) {\n\n\t\t\t\t\tuniforms.specularMap.value = v;\n\n\t\t\t\t\tif ( v ) {\n\n\t\t\t\t\t\tthis.defines.USE_SPECULARMAP = ''; // USE_UV is set by the renderer for specular maps\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tdelete this.defines.USE_SPECULARMAP;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tglossiness: {\n\t\t\t\tget: function () {\n\n\t\t\t\t\treturn uniforms.glossiness.value;\n\n\t\t\t\t},\n\t\t\t\tset: function ( v ) {\n\n\t\t\t\t\tuniforms.glossiness.value = v;\n\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tglossinessMap: {\n\t\t\t\tget: function () {\n\n\t\t\t\t\treturn uniforms.glossinessMap.value;\n\n\t\t\t\t},\n\t\t\t\tset: function ( v ) {\n\n\t\t\t\t\tuniforms.glossinessMap.value = v;\n\n\t\t\t\t\tif ( v ) {\n\n\t\t\t\t\t\tthis.defines.USE_GLOSSINESSMAP = '';\n\t\t\t\t\t\tthis.defines.USE_UV = '';\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tdelete this.defines.USE_GLOSSINESSMAP;\n\t\t\t\t\t\tdelete this.defines.USE_UV;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t}\n\n\t\t} );\n\n\t\tdelete this.metalness;\n\t\tdelete this.roughness;\n\t\tdelete this.metalnessMap;\n\t\tdelete this.roughnessMap;\n\n\t\tthis.setValues( params );\n\n\t}\n\n\tcopy( source ) {\n\n\t\tsuper.copy( source );\n\n\t\tthis.specularMap = source.specularMap;\n\t\tthis.specular.copy( source.specular );\n\t\tthis.glossinessMap = source.glossinessMap;\n\t\tthis.glossiness = source.glossiness;\n\t\tdelete this.metalness;\n\t\tdelete this.roughness;\n\t\tdelete this.metalnessMap;\n\t\tdelete this.roughnessMap;\n\t\treturn this;\n\n\t}\n\n}\n\n\nclass GLTFMaterialsPbrSpecularGlossinessExtension {\n\n\tconstructor() {\n\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS;\n\n\t\tthis.specularGlossinessParams = [\n\t\t\t'color',\n\t\t\t'map',\n\t\t\t'lightMap',\n\t\t\t'lightMapIntensity',\n\t\t\t'aoMap',\n\t\t\t'aoMapIntensity',\n\t\t\t'emissive',\n\t\t\t'emissiveIntensity',\n\t\t\t'emissiveMap',\n\t\t\t'bumpMap',\n\t\t\t'bumpScale',\n\t\t\t'normalMap',\n\t\t\t'normalMapType',\n\t\t\t'displacementMap',\n\t\t\t'displacementScale',\n\t\t\t'displacementBias',\n\t\t\t'specularMap',\n\t\t\t'specular',\n\t\t\t'glossinessMap',\n\t\t\t'glossiness',\n\t\t\t'alphaMap',\n\t\t\t'envMap',\n\t\t\t'envMapIntensity',\n\t\t\t'refractionRatio',\n\t\t];\n\n\t}\n\n\tgetMaterialType() {\n\n\t\treturn GLTFMeshStandardSGMaterial;\n\n\t}\n\n\textendParams( materialParams, materialDef, parser ) {\n\n\t\tconst pbrSpecularGlossiness = materialDef.extensions[ this.name ];\n\n\t\tmaterialParams.color = new Color( 1.0, 1.0, 1.0 );\n\t\tmaterialParams.opacity = 1.0;\n\n\t\tconst pending = [];\n\n\t\tif ( Array.isArray( pbrSpecularGlossiness.diffuseFactor ) ) {\n\n\t\t\tconst array = pbrSpecularGlossiness.diffuseFactor;\n\n\t\t\tmaterialParams.color.fromArray( array );\n\t\t\tmaterialParams.opacity = array[ 3 ];\n\n\t\t}\n\n\t\tif ( pbrSpecularGlossiness.diffuseTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'map', pbrSpecularGlossiness.diffuseTexture ) );\n\n\t\t}\n\n\t\tmaterialParams.emissive = new Color( 0.0, 0.0, 0.0 );\n\t\tmaterialParams.glossiness = pbrSpecularGlossiness.glossinessFactor !== undefined ? pbrSpecularGlossiness.glossinessFactor : 1.0;\n\t\tmaterialParams.specular = new Color( 1.0, 1.0, 1.0 );\n\n\t\tif ( Array.isArray( pbrSpecularGlossiness.specularFactor ) ) {\n\n\t\t\tmaterialParams.specular.fromArray( pbrSpecularGlossiness.specularFactor );\n\n\t\t}\n\n\t\tif ( pbrSpecularGlossiness.specularGlossinessTexture !== undefined ) {\n\n\t\t\tconst specGlossMapDef = pbrSpecularGlossiness.specularGlossinessTexture;\n\t\t\tpending.push( parser.assignTexture( materialParams, 'glossinessMap', specGlossMapDef ) );\n\t\t\tpending.push( parser.assignTexture( materialParams, 'specularMap', specGlossMapDef ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n\tcreateMaterial( materialParams ) {\n\n\t\tconst material = new GLTFMeshStandardSGMaterial( materialParams );\n\t\tmaterial.fog = true;\n\n\t\tmaterial.color = materialParams.color;\n\n\t\tmaterial.map = materialParams.map === undefined ? null : materialParams.map;\n\n\t\tmaterial.lightMap = null;\n\t\tmaterial.lightMapIntensity = 1.0;\n\n\t\tmaterial.aoMap = materialParams.aoMap === undefined ? null : materialParams.aoMap;\n\t\tmaterial.aoMapIntensity = 1.0;\n\n\t\tmaterial.emissive = materialParams.emissive;\n\t\tmaterial.emissiveIntensity = 1.0;\n\t\tmaterial.emissiveMap = materialParams.emissiveMap === undefined ? null : materialParams.emissiveMap;\n\n\t\tmaterial.bumpMap = materialParams.bumpMap === undefined ? null : materialParams.bumpMap;\n\t\tmaterial.bumpScale = 1;\n\n\t\tmaterial.normalMap = materialParams.normalMap === undefined ? null : materialParams.normalMap;\n\t\tmaterial.normalMapType = TangentSpaceNormalMap;\n\n\t\tif ( materialParams.normalScale ) material.normalScale = materialParams.normalScale;\n\n\t\tmaterial.displacementMap = null;\n\t\tmaterial.displacementScale = 1;\n\t\tmaterial.displacementBias = 0;\n\n\t\tmaterial.specularMap = materialParams.specularMap === undefined ? null : materialParams.specularMap;\n\t\tmaterial.specular = materialParams.specular;\n\n\t\tmaterial.glossinessMap = materialParams.glossinessMap === undefined ? null : materialParams.glossinessMap;\n\t\tmaterial.glossiness = materialParams.glossiness;\n\n\t\tmaterial.alphaMap = null;\n\n\t\tmaterial.envMap = materialParams.envMap === undefined ? null : materialParams.envMap;\n\t\tmaterial.envMapIntensity = 1.0;\n\n\t\tmaterial.refractionRatio = 0.98;\n\n\t\treturn material;\n\n\t}\n\n}\n\n/**\n * Mesh Quantization Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_mesh_quantization\n */\nclass GLTFMeshQuantizationExtension {\n\n\tconstructor() {\n\n\t\tthis.name = EXTENSIONS.KHR_MESH_QUANTIZATION;\n\n\t}\n\n}\n\n/*********************************/\n/********** INTERPOLATION ********/\n/*********************************/\n\n// Spline Interpolation\n// Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#appendix-c-spline-interpolation\nclass GLTFCubicSplineInterpolant extends Interpolant {\n\n\tconstructor( parameterPositions, sampleValues, sampleSize, resultBuffer ) {\n\n\t\tsuper( parameterPositions, sampleValues, sampleSize, resultBuffer );\n\n\t}\n\n\tcopySampleValue_( index ) {\n\n\t\t// Copies a sample value to the result buffer. See description of glTF\n\t\t// CUBICSPLINE values layout in interpolate_() function below.\n\n\t\tconst result = this.resultBuffer,\n\t\t\tvalues = this.sampleValues,\n\t\t\tvalueSize = this.valueSize,\n\t\t\toffset = index * valueSize * 3 + valueSize;\n\n\t\tfor ( let i = 0; i !== valueSize; i ++ ) {\n\n\t\t\tresult[ i ] = values[ offset + i ];\n\n\t\t}\n\n\t\treturn result;\n\n\t}\n\n}\n\nGLTFCubicSplineInterpolant.prototype.beforeStart_ = GLTFCubicSplineInterpolant.prototype.copySampleValue_;\n\nGLTFCubicSplineInterpolant.prototype.afterEnd_ = GLTFCubicSplineInterpolant.prototype.copySampleValue_;\n\nGLTFCubicSplineInterpolant.prototype.interpolate_ = function ( i1, t0, t, t1 ) {\n\n\tconst result = this.resultBuffer;\n\tconst values = this.sampleValues;\n\tconst stride = this.valueSize;\n\n\tconst stride2 = stride * 2;\n\tconst stride3 = stride * 3;\n\n\tconst td = t1 - t0;\n\n\tconst p = ( t - t0 ) / td;\n\tconst pp = p * p;\n\tconst ppp = pp * p;\n\n\tconst offset1 = i1 * stride3;\n\tconst offset0 = offset1 - stride3;\n\n\tconst s2 = - 2 * ppp + 3 * pp;\n\tconst s3 = ppp - pp;\n\tconst s0 = 1 - s2;\n\tconst s1 = s3 - pp + p;\n\n\t// Layout of keyframe output values for CUBICSPLINE animations:\n\t//   [ inTangent_1, splineVertex_1, outTangent_1, inTangent_2, splineVertex_2, ... ]\n\tfor ( let i = 0; i !== stride; i ++ ) {\n\n\t\tconst p0 = values[ offset0 + i + stride ]; // splineVertex_k\n\t\tconst m0 = values[ offset0 + i + stride2 ] * td; // outTangent_k * (t_k+1 - t_k)\n\t\tconst p1 = values[ offset1 + i + stride ]; // splineVertex_k+1\n\t\tconst m1 = values[ offset1 + i ] * td; // inTangent_k+1 * (t_k+1 - t_k)\n\n\t\tresult[ i ] = s0 * p0 + s1 * m0 + s2 * p1 + s3 * m1;\n\n\t}\n\n\treturn result;\n\n};\n\nconst _q = new Quaternion();\n\nclass GLTFCubicSplineQuaternionInterpolant extends GLTFCubicSplineInterpolant {\n\n\tinterpolate_( i1, t0, t, t1 ) {\n\n\t\tconst result = super.interpolate_( i1, t0, t, t1 );\n\n\t\t_q.fromArray( result ).normalize().toArray( result );\n\n\t\treturn result;\n\n\t}\n\n}\n\n\n/*********************************/\n/********** INTERNALS ************/\n/*********************************/\n\n/* CONSTANTS */\n\nconst WEBGL_CONSTANTS = {\n\tFLOAT: 5126,\n\t//FLOAT_MAT2: 35674,\n\tFLOAT_MAT3: 35675,\n\tFLOAT_MAT4: 35676,\n\tFLOAT_VEC2: 35664,\n\tFLOAT_VEC3: 35665,\n\tFLOAT_VEC4: 35666,\n\tLINEAR: 9729,\n\tREPEAT: 10497,\n\tSAMPLER_2D: 35678,\n\tPOINTS: 0,\n\tLINES: 1,\n\tLINE_LOOP: 2,\n\tLINE_STRIP: 3,\n\tTRIANGLES: 4,\n\tTRIANGLE_STRIP: 5,\n\tTRIANGLE_FAN: 6,\n\tUNSIGNED_BYTE: 5121,\n\tUNSIGNED_SHORT: 5123\n};\n\nconst WEBGL_COMPONENT_TYPES = {\n\t5120: Int8Array,\n\t5121: Uint8Array,\n\t5122: Int16Array,\n\t5123: Uint16Array,\n\t5125: Uint32Array,\n\t5126: Float32Array\n};\n\nconst WEBGL_FILTERS = {\n\t9728: NearestFilter,\n\t9729: LinearFilter,\n\t9984: NearestMipmapNearestFilter,\n\t9985: LinearMipmapNearestFilter,\n\t9986: NearestMipmapLinearFilter,\n\t9987: LinearMipmapLinearFilter\n};\n\nconst WEBGL_WRAPPINGS = {\n\t33071: ClampToEdgeWrapping,\n\t33648: MirroredRepeatWrapping,\n\t10497: RepeatWrapping\n};\n\nconst WEBGL_TYPE_SIZES = {\n\t'SCALAR': 1,\n\t'VEC2': 2,\n\t'VEC3': 3,\n\t'VEC4': 4,\n\t'MAT2': 4,\n\t'MAT3': 9,\n\t'MAT4': 16\n};\n\nconst ATTRIBUTES = {\n\tPOSITION: 'position',\n\tNORMAL: 'normal',\n\tTANGENT: 'tangent',\n\tTEXCOORD_0: 'uv',\n\tTEXCOORD_1: 'uv2',\n\tCOLOR_0: 'color',\n\tWEIGHTS_0: 'skinWeight',\n\tJOINTS_0: 'skinIndex',\n};\n\nconst PATH_PROPERTIES = {\n\tscale: 'scale',\n\ttranslation: 'position',\n\trotation: 'quaternion',\n\tweights: 'morphTargetInfluences'\n};\n\nconst INTERPOLATION = {\n\tCUBICSPLINE: undefined, // We use a custom interpolant (GLTFCubicSplineInterpolation) for CUBICSPLINE tracks. Each\n\t\t                        // keyframe track will be initialized with a default interpolation type, then modified.\n\tLINEAR: InterpolateLinear,\n\tSTEP: InterpolateDiscrete\n};\n\nconst ALPHA_MODES = {\n\tOPAQUE: 'OPAQUE',\n\tMASK: 'MASK',\n\tBLEND: 'BLEND'\n};\n\n/**\n * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#default-material\n */\nfunction createDefaultMaterial( cache ) {\n\n\tif ( cache[ 'DefaultMaterial' ] === undefined ) {\n\n\t\tcache[ 'DefaultMaterial' ] = new MeshStandardMaterial( {\n\t\t\tcolor: 0xFFFFFF,\n\t\t\temissive: 0x000000,\n\t\t\tmetalness: 1,\n\t\t\troughness: 1,\n\t\t\ttransparent: false,\n\t\t\tdepthTest: true,\n\t\t\tside: FrontSide\n\t\t} );\n\n\t}\n\n\treturn cache[ 'DefaultMaterial' ];\n\n}\n\nfunction addUnknownExtensionsToUserData( knownExtensions, object, objectDef ) {\n\n\t// Add unknown glTF extensions to an object's userData.\n\n\tfor ( const name in objectDef.extensions ) {\n\n\t\tif ( knownExtensions[ name ] === undefined ) {\n\n\t\t\tobject.userData.gltfExtensions = object.userData.gltfExtensions || {};\n\t\t\tobject.userData.gltfExtensions[ name ] = objectDef.extensions[ name ];\n\n\t\t}\n\n\t}\n\n}\n\n/**\n * @param {Object3D|Material|BufferGeometry} object\n * @param {GLTF.definition} gltfDef\n */\nfunction assignExtrasToUserData( object, gltfDef ) {\n\n\tif ( gltfDef.extras !== undefined ) {\n\n\t\tif ( typeof gltfDef.extras === 'object' ) {\n\n\t\t\tObject.assign( object.userData, gltfDef.extras );\n\n\t\t} else {\n\n\t\t\tconsole.warn( 'THREE.GLTFLoader: Ignoring primitive type .extras, ' + gltfDef.extras );\n\n\t\t}\n\n\t}\n\n}\n\n/**\n * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#morph-targets\n *\n * @param {BufferGeometry} geometry\n * @param {Array<GLTF.Target>} targets\n * @param {GLTFParser} parser\n * @return {Promise<BufferGeometry>}\n */\nfunction addMorphTargets( geometry, targets, parser ) {\n\n\tlet hasMorphPosition = false;\n\tlet hasMorphNormal = false;\n\n\tfor ( let i = 0, il = targets.length; i < il; i ++ ) {\n\n\t\tconst target = targets[ i ];\n\n\t\tif ( target.POSITION !== undefined ) hasMorphPosition = true;\n\t\tif ( target.NORMAL !== undefined ) hasMorphNormal = true;\n\n\t\tif ( hasMorphPosition && hasMorphNormal ) break;\n\n\t}\n\n\tif ( ! hasMorphPosition && ! hasMorphNormal ) return Promise.resolve( geometry );\n\n\tconst pendingPositionAccessors = [];\n\tconst pendingNormalAccessors = [];\n\n\tfor ( let i = 0, il = targets.length; i < il; i ++ ) {\n\n\t\tconst target = targets[ i ];\n\n\t\tif ( hasMorphPosition ) {\n\n\t\t\tconst pendingAccessor = target.POSITION !== undefined\n\t\t\t\t? parser.getDependency( 'accessor', target.POSITION )\n\t\t\t\t: geometry.attributes.position;\n\n\t\t\tpendingPositionAccessors.push( pendingAccessor );\n\n\t\t}\n\n\t\tif ( hasMorphNormal ) {\n\n\t\t\tconst pendingAccessor = target.NORMAL !== undefined\n\t\t\t\t? parser.getDependency( 'accessor', target.NORMAL )\n\t\t\t\t: geometry.attributes.normal;\n\n\t\t\tpendingNormalAccessors.push( pendingAccessor );\n\n\t\t}\n\n\t}\n\n\treturn Promise.all( [\n\t\tPromise.all( pendingPositionAccessors ),\n\t\tPromise.all( pendingNormalAccessors )\n\t] ).then( function ( accessors ) {\n\n\t\tconst morphPositions = accessors[ 0 ];\n\t\tconst morphNormals = accessors[ 1 ];\n\n\t\tif ( hasMorphPosition ) geometry.morphAttributes.position = morphPositions;\n\t\tif ( hasMorphNormal ) geometry.morphAttributes.normal = morphNormals;\n\t\tgeometry.morphTargetsRelative = true;\n\n\t\treturn geometry;\n\n\t} );\n\n}\n\n/**\n * @param {Mesh} mesh\n * @param {GLTF.Mesh} meshDef\n */\nfunction updateMorphTargets( mesh, meshDef ) {\n\n\tmesh.updateMorphTargets();\n\n\tif ( meshDef.weights !== undefined ) {\n\n\t\tfor ( let i = 0, il = meshDef.weights.length; i < il; i ++ ) {\n\n\t\t\tmesh.morphTargetInfluences[ i ] = meshDef.weights[ i ];\n\n\t\t}\n\n\t}\n\n\t// .extras has user-defined data, so check that .extras.targetNames is an array.\n\tif ( meshDef.extras && Array.isArray( meshDef.extras.targetNames ) ) {\n\n\t\tconst targetNames = meshDef.extras.targetNames;\n\n\t\tif ( mesh.morphTargetInfluences.length === targetNames.length ) {\n\n\t\t\tmesh.morphTargetDictionary = {};\n\n\t\t\tfor ( let i = 0, il = targetNames.length; i < il; i ++ ) {\n\n\t\t\t\tmesh.morphTargetDictionary[ targetNames[ i ] ] = i;\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tconsole.warn( 'THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.' );\n\n\t\t}\n\n\t}\n\n}\n\nfunction createPrimitiveKey( primitiveDef ) {\n\n\tconst dracoExtension = primitiveDef.extensions && primitiveDef.extensions[ EXTENSIONS.KHR_DRACO_MESH_COMPRESSION ];\n\tlet geometryKey;\n\n\tif ( dracoExtension ) {\n\n\t\tgeometryKey = 'draco:' + dracoExtension.bufferView\n\t\t\t\t+ ':' + dracoExtension.indices\n\t\t\t\t+ ':' + createAttributesKey( dracoExtension.attributes );\n\n\t} else {\n\n\t\tgeometryKey = primitiveDef.indices + ':' + createAttributesKey( primitiveDef.attributes ) + ':' + primitiveDef.mode;\n\n\t}\n\n\treturn geometryKey;\n\n}\n\nfunction createAttributesKey( attributes ) {\n\n\tlet attributesKey = '';\n\n\tconst keys = Object.keys( attributes ).sort();\n\n\tfor ( let i = 0, il = keys.length; i < il; i ++ ) {\n\n\t\tattributesKey += keys[ i ] + ':' + attributes[ keys[ i ] ] + ';';\n\n\t}\n\n\treturn attributesKey;\n\n}\n\nfunction getNormalizedComponentScale( constructor ) {\n\n\t// Reference:\n\t// https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_mesh_quantization#encoding-quantized-data\n\n\tswitch ( constructor ) {\n\n\t\tcase Int8Array:\n\t\t\treturn 1 / 127;\n\n\t\tcase Uint8Array:\n\t\t\treturn 1 / 255;\n\n\t\tcase Int16Array:\n\t\t\treturn 1 / 32767;\n\n\t\tcase Uint16Array:\n\t\t\treturn 1 / 65535;\n\n\t\tdefault:\n\t\t\tthrow new Error( 'THREE.GLTFLoader: Unsupported normalized accessor component type.' );\n\n\t}\n\n}\n\n/* GLTF PARSER */\n\nclass GLTFParser {\n\n\tconstructor( json = {}, options = {} ) {\n\n\t\tthis.json = json;\n\t\tthis.extensions = {};\n\t\tthis.plugins = {};\n\t\tthis.options = options;\n\n\t\t// loader object cache\n\t\tthis.cache = new GLTFRegistry();\n\n\t\t// associations between Three.js objects and glTF elements\n\t\tthis.associations = new Map();\n\n\t\t// BufferGeometry caching\n\t\tthis.primitiveCache = {};\n\n\t\t// Object3D instance caches\n\t\tthis.meshCache = { refs: {}, uses: {} };\n\t\tthis.cameraCache = { refs: {}, uses: {} };\n\t\tthis.lightCache = { refs: {}, uses: {} };\n\n\t\tthis.textureCache = {};\n\n\t\t// Track node names, to ensure no duplicates\n\t\tthis.nodeNamesUsed = {};\n\n\t\t// Use an ImageBitmapLoader if imageBitmaps are supported. Moves much of the\n\t\t// expensive work of uploading a texture to the GPU off the main thread.\n\t\tif ( typeof createImageBitmap !== 'undefined' && /Firefox|^((?!chrome|android).)*safari/i.test( navigator.userAgent ) === false ) {\n\n\t\t\tthis.textureLoader = new ImageBitmapLoader( this.options.manager );\n\n\t\t} else {\n\n\t\t\tthis.textureLoader = new TextureLoader( this.options.manager );\n\n\t\t}\n\n\t\tthis.textureLoader.setCrossOrigin( this.options.crossOrigin );\n\t\tthis.textureLoader.setRequestHeader( this.options.requestHeader );\n\n\t\tthis.fileLoader = new FileLoader( this.options.manager );\n\t\tthis.fileLoader.setResponseType( 'arraybuffer' );\n\n\t\tif ( this.options.crossOrigin === 'use-credentials' ) {\n\n\t\t\tthis.fileLoader.setWithCredentials( true );\n\n\t\t}\n\n\t}\n\n\tsetExtensions( extensions ) {\n\n\t\tthis.extensions = extensions;\n\n\t}\n\n\tsetPlugins( plugins ) {\n\n\t\tthis.plugins = plugins;\n\n\t}\n\n\tparse( onLoad, onError ) {\n\n\t\tconst parser = this;\n\t\tconst json = this.json;\n\t\tconst extensions = this.extensions;\n\n\t\t// Clear the loader cache\n\t\tthis.cache.removeAll();\n\n\t\t// Mark the special nodes/meshes in json for efficient parse\n\t\tthis._invokeAll( function ( ext ) {\n\n\t\t\treturn ext._markDefs && ext._markDefs();\n\n\t\t} );\n\n\t\tPromise.all( this._invokeAll( function ( ext ) {\n\n\t\t\treturn ext.beforeRoot && ext.beforeRoot();\n\n\t\t} ) ).then( function () {\n\n\t\t\treturn Promise.all( [\n\n\t\t\t\tparser.getDependencies( 'scene' ),\n\t\t\t\tparser.getDependencies( 'animation' ),\n\t\t\t\tparser.getDependencies( 'camera' ),\n\n\t\t\t] );\n\n\t\t} ).then( function ( dependencies ) {\n\n\t\t\tconst result = {\n\t\t\t\tscene: dependencies[ 0 ][ json.scene || 0 ],\n\t\t\t\tscenes: dependencies[ 0 ],\n\t\t\t\tanimations: dependencies[ 1 ],\n\t\t\t\tcameras: dependencies[ 2 ],\n\t\t\t\tasset: json.asset,\n\t\t\t\tparser: parser,\n\t\t\t\tuserData: {}\n\t\t\t};\n\n\t\t\taddUnknownExtensionsToUserData( extensions, result, json );\n\n\t\t\tassignExtrasToUserData( result, json );\n\n\t\t\tPromise.all( parser._invokeAll( function ( ext ) {\n\n\t\t\t\treturn ext.afterRoot && ext.afterRoot( result );\n\n\t\t\t} ) ).then( function () {\n\n\t\t\t\tonLoad( result );\n\n\t\t\t} );\n\n\t\t} ).catch( onError );\n\n\t}\n\n\t/**\n\t * Marks the special nodes/meshes in json for efficient parse.\n\t */\n\t_markDefs() {\n\n\t\tconst nodeDefs = this.json.nodes || [];\n\t\tconst skinDefs = this.json.skins || [];\n\t\tconst meshDefs = this.json.meshes || [];\n\n\t\t// Nothing in the node definition indicates whether it is a Bone or an\n\t\t// Object3D. Use the skins' joint references to mark bones.\n\t\tfor ( let skinIndex = 0, skinLength = skinDefs.length; skinIndex < skinLength; skinIndex ++ ) {\n\n\t\t\tconst joints = skinDefs[ skinIndex ].joints;\n\n\t\t\tfor ( let i = 0, il = joints.length; i < il; i ++ ) {\n\n\t\t\t\tnodeDefs[ joints[ i ] ].isBone = true;\n\n\t\t\t}\n\n\t\t}\n\n\t\t// Iterate over all nodes, marking references to shared resources,\n\t\t// as well as skeleton joints.\n\t\tfor ( let nodeIndex = 0, nodeLength = nodeDefs.length; nodeIndex < nodeLength; nodeIndex ++ ) {\n\n\t\t\tconst nodeDef = nodeDefs[ nodeIndex ];\n\n\t\t\tif ( nodeDef.mesh !== undefined ) {\n\n\t\t\t\tthis._addNodeRef( this.meshCache, nodeDef.mesh );\n\n\t\t\t\t// Nothing in the mesh definition indicates whether it is\n\t\t\t\t// a SkinnedMesh or Mesh. Use the node's mesh reference\n\t\t\t\t// to mark SkinnedMesh if node has skin.\n\t\t\t\tif ( nodeDef.skin !== undefined ) {\n\n\t\t\t\t\tmeshDefs[ nodeDef.mesh ].isSkinnedMesh = true;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( nodeDef.camera !== undefined ) {\n\n\t\t\t\tthis._addNodeRef( this.cameraCache, nodeDef.camera );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\t/**\n\t * Counts references to shared node / Object3D resources. These resources\n\t * can be reused, or \"instantiated\", at multiple nodes in the scene\n\t * hierarchy. Mesh, Camera, and Light instances are instantiated and must\n\t * be marked. Non-scenegraph resources (like Materials, Geometries, and\n\t * Textures) can be reused directly and are not marked here.\n\t *\n\t * Example: CesiumMilkTruck sample model reuses \"Wheel\" meshes.\n\t */\n\t_addNodeRef( cache, index ) {\n\n\t\tif ( index === undefined ) return;\n\n\t\tif ( cache.refs[ index ] === undefined ) {\n\n\t\t\tcache.refs[ index ] = cache.uses[ index ] = 0;\n\n\t\t}\n\n\t\tcache.refs[ index ] ++;\n\n\t}\n\n\t/** Returns a reference to a shared resource, cloning it if necessary. */\n\t_getNodeRef( cache, index, object ) {\n\n\t\tif ( cache.refs[ index ] <= 1 ) return object;\n\n\t\tconst ref = object.clone();\n\n\t\t// Propagates mappings to the cloned object, prevents mappings on the\n\t\t// original object from being lost.\n\t\tconst updateMappings = ( original, clone ) => {\n\n\t\t\tconst mappings = this.associations.get( original );\n\t\t\tif ( mappings != null ) {\n\n\t\t\t\tthis.associations.set( clone, mappings );\n\n\t\t\t}\n\n\t\t\tfor ( const [ i, child ] of original.children.entries() ) {\n\n\t\t\t\tupdateMappings( child, clone.children[ i ] );\n\n\t\t\t}\n\n\t\t};\n\n\t\tupdateMappings( object, ref );\n\n\t\tref.name += '_instance_' + ( cache.uses[ index ] ++ );\n\n\t\treturn ref;\n\n\t}\n\n\t_invokeOne( func ) {\n\n\t\tconst extensions = Object.values( this.plugins );\n\t\textensions.push( this );\n\n\t\tfor ( let i = 0; i < extensions.length; i ++ ) {\n\n\t\t\tconst result = func( extensions[ i ] );\n\n\t\t\tif ( result ) return result;\n\n\t\t}\n\n\t\treturn null;\n\n\t}\n\n\t_invokeAll( func ) {\n\n\t\tconst extensions = Object.values( this.plugins );\n\t\textensions.unshift( this );\n\n\t\tconst pending = [];\n\n\t\tfor ( let i = 0; i < extensions.length; i ++ ) {\n\n\t\t\tconst result = func( extensions[ i ] );\n\n\t\t\tif ( result ) pending.push( result );\n\n\t\t}\n\n\t\treturn pending;\n\n\t}\n\n\t/**\n\t * Requests the specified dependency asynchronously, with caching.\n\t * @param {string} type\n\t * @param {number} index\n\t * @return {Promise<Object3D|Material|THREE.Texture|AnimationClip|ArrayBuffer|Object>}\n\t */\n\tgetDependency( type, index ) {\n\n\t\tconst cacheKey = type + ':' + index;\n\t\tlet dependency = this.cache.get( cacheKey );\n\n\t\tif ( ! dependency ) {\n\n\t\t\tswitch ( type ) {\n\n\t\t\t\tcase 'scene':\n\t\t\t\t\tdependency = this.loadScene( index );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'node':\n\t\t\t\t\tdependency = this.loadNode( index );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'mesh':\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\n\n\t\t\t\t\t\treturn ext.loadMesh && ext.loadMesh( index );\n\n\t\t\t\t\t} );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'accessor':\n\t\t\t\t\tdependency = this.loadAccessor( index );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'bufferView':\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\n\n\t\t\t\t\t\treturn ext.loadBufferView && ext.loadBufferView( index );\n\n\t\t\t\t\t} );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'buffer':\n\t\t\t\t\tdependency = this.loadBuffer( index );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'material':\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\n\n\t\t\t\t\t\treturn ext.loadMaterial && ext.loadMaterial( index );\n\n\t\t\t\t\t} );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'texture':\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\n\n\t\t\t\t\t\treturn ext.loadTexture && ext.loadTexture( index );\n\n\t\t\t\t\t} );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'skin':\n\t\t\t\t\tdependency = this.loadSkin( index );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'animation':\n\t\t\t\t\tdependency = this.loadAnimation( index );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'camera':\n\t\t\t\t\tdependency = this.loadCamera( index );\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tthrow new Error( 'Unknown type: ' + type );\n\n\t\t\t}\n\n\t\t\tthis.cache.add( cacheKey, dependency );\n\n\t\t}\n\n\t\treturn dependency;\n\n\t}\n\n\t/**\n\t * Requests all dependencies of the specified type asynchronously, with caching.\n\t * @param {string} type\n\t * @return {Promise<Array<Object>>}\n\t */\n\tgetDependencies( type ) {\n\n\t\tlet dependencies = this.cache.get( type );\n\n\t\tif ( ! dependencies ) {\n\n\t\t\tconst parser = this;\n\t\t\tconst defs = this.json[ type + ( type === 'mesh' ? 'es' : 's' ) ] || [];\n\n\t\t\tdependencies = Promise.all( defs.map( function ( def, index ) {\n\n\t\t\t\treturn parser.getDependency( type, index );\n\n\t\t\t} ) );\n\n\t\t\tthis.cache.add( type, dependencies );\n\n\t\t}\n\n\t\treturn dependencies;\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#buffers-and-buffer-views\n\t * @param {number} bufferIndex\n\t * @return {Promise<ArrayBuffer>}\n\t */\n\tloadBuffer( bufferIndex ) {\n\n\t\tconst bufferDef = this.json.buffers[ bufferIndex ];\n\t\tconst loader = this.fileLoader;\n\n\t\tif ( bufferDef.type && bufferDef.type !== 'arraybuffer' ) {\n\n\t\t\tthrow new Error( 'THREE.GLTFLoader: ' + bufferDef.type + ' buffer type is not supported.' );\n\n\t\t}\n\n\t\t// If present, GLB container is required to be the first buffer.\n\t\tif ( bufferDef.uri === undefined && bufferIndex === 0 ) {\n\n\t\t\treturn Promise.resolve( this.extensions[ EXTENSIONS.KHR_BINARY_GLTF ].body );\n\n\t\t}\n\n\t\tconst options = this.options;\n\n\t\treturn new Promise( function ( resolve, reject ) {\n\n\t\t\tloader.load( LoaderUtils.resolveURL( bufferDef.uri, options.path ), resolve, undefined, function () {\n\n\t\t\t\treject( new Error( 'THREE.GLTFLoader: Failed to load buffer \"' + bufferDef.uri + '\".' ) );\n\n\t\t\t} );\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#buffers-and-buffer-views\n\t * @param {number} bufferViewIndex\n\t * @return {Promise<ArrayBuffer>}\n\t */\n\tloadBufferView( bufferViewIndex ) {\n\n\t\tconst bufferViewDef = this.json.bufferViews[ bufferViewIndex ];\n\n\t\treturn this.getDependency( 'buffer', bufferViewDef.buffer ).then( function ( buffer ) {\n\n\t\t\tconst byteLength = bufferViewDef.byteLength || 0;\n\t\t\tconst byteOffset = bufferViewDef.byteOffset || 0;\n\t\t\treturn buffer.slice( byteOffset, byteOffset + byteLength );\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#accessors\n\t * @param {number} accessorIndex\n\t * @return {Promise<BufferAttribute|InterleavedBufferAttribute>}\n\t */\n\tloadAccessor( accessorIndex ) {\n\n\t\tconst parser = this;\n\t\tconst json = this.json;\n\n\t\tconst accessorDef = this.json.accessors[ accessorIndex ];\n\n\t\tif ( accessorDef.bufferView === undefined && accessorDef.sparse === undefined ) {\n\n\t\t\t// Ignore empty accessors, which may be used to declare runtime\n\t\t\t// information about attributes coming from another source (e.g. Draco\n\t\t\t// compression extension).\n\t\t\treturn Promise.resolve( null );\n\n\t\t}\n\n\t\tconst pendingBufferViews = [];\n\n\t\tif ( accessorDef.bufferView !== undefined ) {\n\n\t\t\tpendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.bufferView ) );\n\n\t\t} else {\n\n\t\t\tpendingBufferViews.push( null );\n\n\t\t}\n\n\t\tif ( accessorDef.sparse !== undefined ) {\n\n\t\t\tpendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.sparse.indices.bufferView ) );\n\t\t\tpendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.sparse.values.bufferView ) );\n\n\t\t}\n\n\t\treturn Promise.all( pendingBufferViews ).then( function ( bufferViews ) {\n\n\t\t\tconst bufferView = bufferViews[ 0 ];\n\n\t\t\tconst itemSize = WEBGL_TYPE_SIZES[ accessorDef.type ];\n\t\t\tconst TypedArray = WEBGL_COMPONENT_TYPES[ accessorDef.componentType ];\n\n\t\t\t// For VEC3: itemSize is 3, elementBytes is 4, itemBytes is 12.\n\t\t\tconst elementBytes = TypedArray.BYTES_PER_ELEMENT;\n\t\t\tconst itemBytes = elementBytes * itemSize;\n\t\t\tconst byteOffset = accessorDef.byteOffset || 0;\n\t\t\tconst byteStride = accessorDef.bufferView !== undefined ? json.bufferViews[ accessorDef.bufferView ].byteStride : undefined;\n\t\t\tconst normalized = accessorDef.normalized === true;\n\t\t\tlet array, bufferAttribute;\n\n\t\t\t// The buffer is not interleaved if the stride is the item size in bytes.\n\t\t\tif ( byteStride && byteStride !== itemBytes ) {\n\n\t\t\t\t// Each \"slice\" of the buffer, as defined by 'count' elements of 'byteStride' bytes, gets its own InterleavedBuffer\n\t\t\t\t// This makes sure that IBA.count reflects accessor.count properly\n\t\t\t\tconst ibSlice = Math.floor( byteOffset / byteStride );\n\t\t\t\tconst ibCacheKey = 'InterleavedBuffer:' + accessorDef.bufferView + ':' + accessorDef.componentType + ':' + ibSlice + ':' + accessorDef.count;\n\t\t\t\tlet ib = parser.cache.get( ibCacheKey );\n\n\t\t\t\tif ( ! ib ) {\n\n\t\t\t\t\tarray = new TypedArray( bufferView, ibSlice * byteStride, accessorDef.count * byteStride / elementBytes );\n\n\t\t\t\t\t// Integer parameters to IB/IBA are in array elements, not bytes.\n\t\t\t\t\tib = new InterleavedBuffer( array, byteStride / elementBytes );\n\n\t\t\t\t\tparser.cache.add( ibCacheKey, ib );\n\n\t\t\t\t}\n\n\t\t\t\tbufferAttribute = new InterleavedBufferAttribute( ib, itemSize, ( byteOffset % byteStride ) / elementBytes, normalized );\n\n\t\t\t} else {\n\n\t\t\t\tif ( bufferView === null ) {\n\n\t\t\t\t\tarray = new TypedArray( accessorDef.count * itemSize );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tarray = new TypedArray( bufferView, byteOffset, accessorDef.count * itemSize );\n\n\t\t\t\t}\n\n\t\t\t\tbufferAttribute = new BufferAttribute( array, itemSize, normalized );\n\n\t\t\t}\n\n\t\t\t// https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#sparse-accessors\n\t\t\tif ( accessorDef.sparse !== undefined ) {\n\n\t\t\t\tconst itemSizeIndices = WEBGL_TYPE_SIZES.SCALAR;\n\t\t\t\tconst TypedArrayIndices = WEBGL_COMPONENT_TYPES[ accessorDef.sparse.indices.componentType ];\n\n\t\t\t\tconst byteOffsetIndices = accessorDef.sparse.indices.byteOffset || 0;\n\t\t\t\tconst byteOffsetValues = accessorDef.sparse.values.byteOffset || 0;\n\n\t\t\t\tconst sparseIndices = new TypedArrayIndices( bufferViews[ 1 ], byteOffsetIndices, accessorDef.sparse.count * itemSizeIndices );\n\t\t\t\tconst sparseValues = new TypedArray( bufferViews[ 2 ], byteOffsetValues, accessorDef.sparse.count * itemSize );\n\n\t\t\t\tif ( bufferView !== null ) {\n\n\t\t\t\t\t// Avoid modifying the original ArrayBuffer, if the bufferView wasn't initialized with zeroes.\n\t\t\t\t\tbufferAttribute = new BufferAttribute( bufferAttribute.array.slice(), bufferAttribute.itemSize, bufferAttribute.normalized );\n\n\t\t\t\t}\n\n\t\t\t\tfor ( let i = 0, il = sparseIndices.length; i < il; i ++ ) {\n\n\t\t\t\t\tconst index = sparseIndices[ i ];\n\n\t\t\t\t\tbufferAttribute.setX( index, sparseValues[ i * itemSize ] );\n\t\t\t\t\tif ( itemSize >= 2 ) bufferAttribute.setY( index, sparseValues[ i * itemSize + 1 ] );\n\t\t\t\t\tif ( itemSize >= 3 ) bufferAttribute.setZ( index, sparseValues[ i * itemSize + 2 ] );\n\t\t\t\t\tif ( itemSize >= 4 ) bufferAttribute.setW( index, sparseValues[ i * itemSize + 3 ] );\n\t\t\t\t\tif ( itemSize >= 5 ) throw new Error( 'THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.' );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn bufferAttribute;\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#textures\n\t * @param {number} textureIndex\n\t * @return {Promise<THREE.Texture>}\n\t */\n\tloadTexture( textureIndex ) {\n\n\t\tconst json = this.json;\n\t\tconst options = this.options;\n\t\tconst textureDef = json.textures[ textureIndex ];\n\t\tconst source = json.images[ textureDef.source ];\n\n\t\tlet loader = this.textureLoader;\n\n\t\tif ( source.uri ) {\n\n\t\t\tconst handler = options.manager.getHandler( source.uri );\n\t\t\tif ( handler !== null ) loader = handler;\n\n\t\t}\n\n\t\treturn this.loadTextureImage( textureIndex, source, loader );\n\n\t}\n\n\tloadTextureImage( textureIndex, source, loader ) {\n\n\t\tconst parser = this;\n\t\tconst json = this.json;\n\t\tconst options = this.options;\n\n\t\tconst textureDef = json.textures[ textureIndex ];\n\n\t\tconst cacheKey = ( source.uri || source.bufferView ) + ':' + textureDef.sampler;\n\n\t\tif ( this.textureCache[ cacheKey ] ) {\n\n\t\t\t// See https://github.com/mrdoob/three.js/issues/21559.\n\t\t\treturn this.textureCache[ cacheKey ];\n\n\t\t}\n\n\t\tconst URL = self.URL || self.webkitURL;\n\n\t\tlet sourceURI = source.uri || '';\n\t\tlet isObjectURL = false;\n\n\t\tif ( source.bufferView !== undefined ) {\n\n\t\t\t// Load binary image data from bufferView, if provided.\n\n\t\t\tsourceURI = parser.getDependency( 'bufferView', source.bufferView ).then( function ( bufferView ) {\n\n\t\t\t\tisObjectURL = true;\n\t\t\t\tconst blob = new Blob( [ bufferView ], { type: source.mimeType } );\n\t\t\t\tsourceURI = URL.createObjectURL( blob );\n\t\t\t\treturn sourceURI;\n\n\t\t\t} );\n\n\t\t} else if ( source.uri === undefined ) {\n\n\t\t\tthrow new Error( 'THREE.GLTFLoader: Image ' + textureIndex + ' is missing URI and bufferView' );\n\n\t\t}\n\n\t\tconst promise = Promise.resolve( sourceURI ).then( function ( sourceURI ) {\n\n\t\t\treturn new Promise( function ( resolve, reject ) {\n\n\t\t\t\tlet onLoad = resolve;\n\n\t\t\t\tif ( loader.isImageBitmapLoader === true ) {\n\n\t\t\t\t\tonLoad = function ( imageBitmap ) {\n\n\t\t\t\t\t\tconst texture = new Texture( imageBitmap );\n\t\t\t\t\t\ttexture.needsUpdate = true;\n\n\t\t\t\t\t\tresolve( texture );\n\n\t\t\t\t\t};\n\n\t\t\t\t}\n\n\t\t\t\tloader.load( LoaderUtils.resolveURL( sourceURI, options.path ), onLoad, undefined, reject );\n\n\t\t\t} );\n\n\t\t} ).then( function ( texture ) {\n\n\t\t\t// Clean up resources and configure Texture.\n\n\t\t\tif ( isObjectURL === true ) {\n\n\t\t\t\tURL.revokeObjectURL( sourceURI );\n\n\t\t\t}\n\n\t\t\ttexture.flipY = false;\n\n\t\t\tif ( textureDef.name ) texture.name = textureDef.name;\n\n\t\t\tconst samplers = json.samplers || {};\n\t\t\tconst sampler = samplers[ textureDef.sampler ] || {};\n\n\t\t\ttexture.magFilter = WEBGL_FILTERS[ sampler.magFilter ] || LinearFilter;\n\t\t\ttexture.minFilter = WEBGL_FILTERS[ sampler.minFilter ] || LinearMipmapLinearFilter;\n\t\t\ttexture.wrapS = WEBGL_WRAPPINGS[ sampler.wrapS ] || RepeatWrapping;\n\t\t\ttexture.wrapT = WEBGL_WRAPPINGS[ sampler.wrapT ] || RepeatWrapping;\n\n\t\t\tparser.associations.set( texture, { textures: textureIndex } );\n\n\t\t\treturn texture;\n\n\t\t} ).catch( function () {\n\n\t\t\tconsole.error( 'THREE.GLTFLoader: Couldn\\'t load texture', sourceURI );\n\t\t\treturn null;\n\n\t\t} );\n\n\t\tthis.textureCache[ cacheKey ] = promise;\n\n\t\treturn promise;\n\n\t}\n\n\t/**\n\t * Asynchronously assigns a texture to the given material parameters.\n\t * @param {Object} materialParams\n\t * @param {string} mapName\n\t * @param {Object} mapDef\n\t * @return {Promise<Texture>}\n\t */\n\tassignTexture( materialParams, mapName, mapDef ) {\n\n\t\tconst parser = this;\n\n\t\treturn this.getDependency( 'texture', mapDef.index ).then( function ( texture ) {\n\n\t\t\t// Materials sample aoMap from UV set 1 and other maps from UV set 0 - this can't be configured\n\t\t\t// However, we will copy UV set 0 to UV set 1 on demand for aoMap\n\t\t\tif ( mapDef.texCoord !== undefined && mapDef.texCoord != 0 && ! ( mapName === 'aoMap' && mapDef.texCoord == 1 ) ) {\n\n\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Custom UV set ' + mapDef.texCoord + ' for texture ' + mapName + ' not yet supported.' );\n\n\t\t\t}\n\n\t\t\tif ( parser.extensions[ EXTENSIONS.KHR_TEXTURE_TRANSFORM ] ) {\n\n\t\t\t\tconst transform = mapDef.extensions !== undefined ? mapDef.extensions[ EXTENSIONS.KHR_TEXTURE_TRANSFORM ] : undefined;\n\n\t\t\t\tif ( transform ) {\n\n\t\t\t\t\tconst gltfReference = parser.associations.get( texture );\n\t\t\t\t\ttexture = parser.extensions[ EXTENSIONS.KHR_TEXTURE_TRANSFORM ].extendTexture( texture, transform );\n\t\t\t\t\tparser.associations.set( texture, gltfReference );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tmaterialParams[ mapName ] = texture;\n\n\t\t\treturn texture;\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Assigns final material to a Mesh, Line, or Points instance. The instance\n\t * already has a material (generated from the glTF material options alone)\n\t * but reuse of the same glTF material may require multiple threejs materials\n\t * to accommodate different primitive types, defines, etc. New materials will\n\t * be created if necessary, and reused from a cache.\n\t * @param  {Object3D} mesh Mesh, Line, or Points instance.\n\t */\n\tassignFinalMaterial( mesh ) {\n\n\t\tconst geometry = mesh.geometry;\n\t\tlet material = mesh.material;\n\n\t\tconst useDerivativeTangents = geometry.attributes.tangent === undefined;\n\t\tconst useVertexColors = geometry.attributes.color !== undefined;\n\t\tconst useFlatShading = geometry.attributes.normal === undefined;\n\n\t\tif ( mesh.isPoints ) {\n\n\t\t\tconst cacheKey = 'PointsMaterial:' + material.uuid;\n\n\t\t\tlet pointsMaterial = this.cache.get( cacheKey );\n\n\t\t\tif ( ! pointsMaterial ) {\n\n\t\t\t\tpointsMaterial = new PointsMaterial();\n\t\t\t\tMaterial.prototype.copy.call( pointsMaterial, material );\n\t\t\t\tpointsMaterial.color.copy( material.color );\n\t\t\t\tpointsMaterial.map = material.map;\n\t\t\t\tpointsMaterial.sizeAttenuation = false; // glTF spec says points should be 1px\n\n\t\t\t\tthis.cache.add( cacheKey, pointsMaterial );\n\n\t\t\t}\n\n\t\t\tmaterial = pointsMaterial;\n\n\t\t} else if ( mesh.isLine ) {\n\n\t\t\tconst cacheKey = 'LineBasicMaterial:' + material.uuid;\n\n\t\t\tlet lineMaterial = this.cache.get( cacheKey );\n\n\t\t\tif ( ! lineMaterial ) {\n\n\t\t\t\tlineMaterial = new LineBasicMaterial();\n\t\t\t\tMaterial.prototype.copy.call( lineMaterial, material );\n\t\t\t\tlineMaterial.color.copy( material.color );\n\n\t\t\t\tthis.cache.add( cacheKey, lineMaterial );\n\n\t\t\t}\n\n\t\t\tmaterial = lineMaterial;\n\n\t\t}\n\n\t\t// Clone the material if it will be modified\n\t\tif ( useDerivativeTangents || useVertexColors || useFlatShading ) {\n\n\t\t\tlet cacheKey = 'ClonedMaterial:' + material.uuid + ':';\n\n\t\t\tif ( material.isGLTFSpecularGlossinessMaterial ) cacheKey += 'specular-glossiness:';\n\t\t\tif ( useDerivativeTangents ) cacheKey += 'derivative-tangents:';\n\t\t\tif ( useVertexColors ) cacheKey += 'vertex-colors:';\n\t\t\tif ( useFlatShading ) cacheKey += 'flat-shading:';\n\n\t\t\tlet cachedMaterial = this.cache.get( cacheKey );\n\n\t\t\tif ( ! cachedMaterial ) {\n\n\t\t\t\tcachedMaterial = material.clone();\n\n\t\t\t\tif ( useVertexColors ) cachedMaterial.vertexColors = true;\n\t\t\t\tif ( useFlatShading ) cachedMaterial.flatShading = true;\n\n\t\t\t\tif ( useDerivativeTangents ) {\n\n\t\t\t\t\t// https://github.com/mrdoob/three.js/issues/11438#issuecomment-507003995\n\t\t\t\t\tif ( cachedMaterial.normalScale ) cachedMaterial.normalScale.y *= - 1;\n\t\t\t\t\tif ( cachedMaterial.clearcoatNormalScale ) cachedMaterial.clearcoatNormalScale.y *= - 1;\n\n\t\t\t\t}\n\n\t\t\t\tthis.cache.add( cacheKey, cachedMaterial );\n\n\t\t\t\tthis.associations.set( cachedMaterial, this.associations.get( material ) );\n\n\t\t\t}\n\n\t\t\tmaterial = cachedMaterial;\n\n\t\t}\n\n\t\t// workarounds for mesh and geometry\n\n\t\tif ( material.aoMap && geometry.attributes.uv2 === undefined && geometry.attributes.uv !== undefined ) {\n\n\t\t\tgeometry.setAttribute( 'uv2', geometry.attributes.uv );\n\n\t\t}\n\n\t\tmesh.material = material;\n\n\t}\n\n\tgetMaterialType( /* materialIndex */ ) {\n\n\t\treturn MeshStandardMaterial;\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#materials\n\t * @param {number} materialIndex\n\t * @return {Promise<Material>}\n\t */\n\tloadMaterial( materialIndex ) {\n\n\t\tconst parser = this;\n\t\tconst json = this.json;\n\t\tconst extensions = this.extensions;\n\t\tconst materialDef = json.materials[ materialIndex ];\n\n\t\tlet materialType;\n\t\tconst materialParams = {};\n\t\tconst materialExtensions = materialDef.extensions || {};\n\n\t\tconst pending = [];\n\n\t\tif ( materialExtensions[ EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS ] ) {\n\n\t\t\tconst sgExtension = extensions[ EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS ];\n\t\t\tmaterialType = sgExtension.getMaterialType();\n\t\t\tpending.push( sgExtension.extendParams( materialParams, materialDef, parser ) );\n\n\t\t} else if ( materialExtensions[ EXTENSIONS.KHR_MATERIALS_UNLIT ] ) {\n\n\t\t\tconst kmuExtension = extensions[ EXTENSIONS.KHR_MATERIALS_UNLIT ];\n\t\t\tmaterialType = kmuExtension.getMaterialType();\n\t\t\tpending.push( kmuExtension.extendParams( materialParams, materialDef, parser ) );\n\n\t\t} else {\n\n\t\t\t// Specification:\n\t\t\t// https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#metallic-roughness-material\n\n\t\t\tconst metallicRoughness = materialDef.pbrMetallicRoughness || {};\n\n\t\t\tmaterialParams.color = new Color( 1.0, 1.0, 1.0 );\n\t\t\tmaterialParams.opacity = 1.0;\n\n\t\t\tif ( Array.isArray( metallicRoughness.baseColorFactor ) ) {\n\n\t\t\t\tconst array = metallicRoughness.baseColorFactor;\n\n\t\t\t\tmaterialParams.color.fromArray( array );\n\t\t\t\tmaterialParams.opacity = array[ 3 ];\n\n\t\t\t}\n\n\t\t\tif ( metallicRoughness.baseColorTexture !== undefined ) {\n\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'map', metallicRoughness.baseColorTexture ) );\n\n\t\t\t}\n\n\t\t\tmaterialParams.metalness = metallicRoughness.metallicFactor !== undefined ? metallicRoughness.metallicFactor : 1.0;\n\t\t\tmaterialParams.roughness = metallicRoughness.roughnessFactor !== undefined ? metallicRoughness.roughnessFactor : 1.0;\n\n\t\t\tif ( metallicRoughness.metallicRoughnessTexture !== undefined ) {\n\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'metalnessMap', metallicRoughness.metallicRoughnessTexture ) );\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'roughnessMap', metallicRoughness.metallicRoughnessTexture ) );\n\n\t\t\t}\n\n\t\t\tmaterialType = this._invokeOne( function ( ext ) {\n\n\t\t\t\treturn ext.getMaterialType && ext.getMaterialType( materialIndex );\n\n\t\t\t} );\n\n\t\t\tpending.push( Promise.all( this._invokeAll( function ( ext ) {\n\n\t\t\t\treturn ext.extendMaterialParams && ext.extendMaterialParams( materialIndex, materialParams );\n\n\t\t\t} ) ) );\n\n\t\t}\n\n\t\tif ( materialDef.doubleSided === true ) {\n\n\t\t\tmaterialParams.side = DoubleSide;\n\n\t\t}\n\n\t\tconst alphaMode = materialDef.alphaMode || ALPHA_MODES.OPAQUE;\n\n\t\tif ( alphaMode === ALPHA_MODES.BLEND ) {\n\n\t\t\tmaterialParams.transparent = true;\n\n\t\t\t// See: https://github.com/mrdoob/three.js/issues/17706\n\t\t\tmaterialParams.depthWrite = false;\n\n\t\t} else {\n\n\t\t\tmaterialParams.transparent = false;\n\t\t\tmaterialParams.alphaWrite = false;\n\n\t\t\tif ( alphaMode === ALPHA_MODES.MASK ) {\n\n\t\t\t\tmaterialParams.alphaTest = materialDef.alphaCutoff !== undefined ? materialDef.alphaCutoff : 0.5;\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( materialDef.normalTexture !== undefined && materialType !== MeshBasicMaterial ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'normalMap', materialDef.normalTexture ) );\n\n\t\t\tmaterialParams.normalScale = new Vector2( 1, 1 );\n\n\t\t\tif ( materialDef.normalTexture.scale !== undefined ) {\n\n\t\t\t\tconst scale = materialDef.normalTexture.scale;\n\n\t\t\t\tmaterialParams.normalScale.set( scale, scale );\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( materialDef.occlusionTexture !== undefined && materialType !== MeshBasicMaterial ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'aoMap', materialDef.occlusionTexture ) );\n\n\t\t\tif ( materialDef.occlusionTexture.strength !== undefined ) {\n\n\t\t\t\tmaterialParams.aoMapIntensity = materialDef.occlusionTexture.strength;\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( materialDef.emissiveFactor !== undefined && materialType !== MeshBasicMaterial ) {\n\n\t\t\tmaterialParams.emissive = new Color().fromArray( materialDef.emissiveFactor );\n\n\t\t}\n\n\t\tif ( materialDef.emissiveTexture !== undefined && materialType !== MeshBasicMaterial ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'emissiveMap', materialDef.emissiveTexture ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending ).then( function () {\n\n\t\t\tlet material;\n\n\t\t\tif ( materialType === GLTFMeshStandardSGMaterial ) {\n\n\t\t\t\tmaterial = extensions[ EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS ].createMaterial( materialParams );\n\n\t\t\t} else {\n\n\t\t\t\tmaterial = new materialType( materialParams );\n\n\t\t\t}\n\n\t\t\tif ( materialDef.name ) material.name = materialDef.name;\n\n\t\t\t// baseColorTexture, emissiveTexture, and specularGlossinessTexture use sRGB encoding.\n\t\t\tif ( material.map ) material.map.encoding = sRGBEncoding;\n\t\t\tif ( material.emissiveMap ) material.emissiveMap.encoding = sRGBEncoding;\n\n\t\t\tassignExtrasToUserData( material, materialDef );\n\n\t\t\tparser.associations.set( material, { materials: materialIndex } );\n\n\t\t\tif ( materialDef.extensions ) addUnknownExtensionsToUserData( extensions, material, materialDef );\n\n\t\t\treturn material;\n\n\t\t} );\n\n\t}\n\n\t/** When Object3D instances are targeted by animation, they need unique names. */\n\tcreateUniqueName( originalName ) {\n\n\t\tconst sanitizedName = PropertyBinding.sanitizeNodeName( originalName || '' );\n\n\t\tlet name = sanitizedName;\n\n\t\tfor ( let i = 1; this.nodeNamesUsed[ name ]; ++ i ) {\n\n\t\t\tname = sanitizedName + '_' + i;\n\n\t\t}\n\n\t\tthis.nodeNamesUsed[ name ] = true;\n\n\t\treturn name;\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#geometry\n\t *\n\t * Creates BufferGeometries from primitives.\n\t *\n\t * @param {Array<GLTF.Primitive>} primitives\n\t * @return {Promise<Array<BufferGeometry>>}\n\t */\n\tloadGeometries( primitives ) {\n\n\t\tconst parser = this;\n\t\tconst extensions = this.extensions;\n\t\tconst cache = this.primitiveCache;\n\n\t\tfunction createDracoPrimitive( primitive ) {\n\n\t\t\treturn extensions[ EXTENSIONS.KHR_DRACO_MESH_COMPRESSION ]\n\t\t\t\t.decodePrimitive( primitive, parser )\n\t\t\t\t.then( function ( geometry ) {\n\n\t\t\t\t\treturn addPrimitiveAttributes( geometry, primitive, parser );\n\n\t\t\t\t} );\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tfor ( let i = 0, il = primitives.length; i < il; i ++ ) {\n\n\t\t\tconst primitive = primitives[ i ];\n\t\t\tconst cacheKey = createPrimitiveKey( primitive );\n\n\t\t\t// See if we've already created this geometry\n\t\t\tconst cached = cache[ cacheKey ];\n\n\t\t\tif ( cached ) {\n\n\t\t\t\t// Use the cached geometry if it exists\n\t\t\t\tpending.push( cached.promise );\n\n\t\t\t} else {\n\n\t\t\t\tlet geometryPromise;\n\n\t\t\t\tif ( primitive.extensions && primitive.extensions[ EXTENSIONS.KHR_DRACO_MESH_COMPRESSION ] ) {\n\n\t\t\t\t\t// Use DRACO geometry if available\n\t\t\t\t\tgeometryPromise = createDracoPrimitive( primitive );\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// Otherwise create a new geometry\n\t\t\t\t\tgeometryPromise = addPrimitiveAttributes( new BufferGeometry(), primitive, parser );\n\n\t\t\t\t}\n\n\t\t\t\t// Cache this geometry\n\t\t\t\tcache[ cacheKey ] = { primitive: primitive, promise: geometryPromise };\n\n\t\t\t\tpending.push( geometryPromise );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#meshes\n\t * @param {number} meshIndex\n\t * @return {Promise<Group|Mesh|SkinnedMesh>}\n\t */\n\tloadMesh( meshIndex ) {\n\n\t\tconst parser = this;\n\t\tconst json = this.json;\n\t\tconst extensions = this.extensions;\n\n\t\tconst meshDef = json.meshes[ meshIndex ];\n\t\tconst primitives = meshDef.primitives;\n\n\t\tconst pending = [];\n\n\t\tfor ( let i = 0, il = primitives.length; i < il; i ++ ) {\n\n\t\t\tconst material = primitives[ i ].material === undefined\n\t\t\t\t? createDefaultMaterial( this.cache )\n\t\t\t\t: this.getDependency( 'material', primitives[ i ].material );\n\n\t\t\tpending.push( material );\n\n\t\t}\n\n\t\tpending.push( parser.loadGeometries( primitives ) );\n\n\t\treturn Promise.all( pending ).then( function ( results ) {\n\n\t\t\tconst materials = results.slice( 0, results.length - 1 );\n\t\t\tconst geometries = results[ results.length - 1 ];\n\n\t\t\tconst meshes = [];\n\n\t\t\tfor ( let i = 0, il = geometries.length; i < il; i ++ ) {\n\n\t\t\t\tconst geometry = geometries[ i ];\n\t\t\t\tconst primitive = primitives[ i ];\n\n\t\t\t\t// 1. create Mesh\n\n\t\t\t\tlet mesh;\n\n\t\t\t\tconst material = materials[ i ];\n\n\t\t\t\tif ( primitive.mode === WEBGL_CONSTANTS.TRIANGLES ||\n\t\t\t\t\t\tprimitive.mode === WEBGL_CONSTANTS.TRIANGLE_STRIP ||\n\t\t\t\t\t\tprimitive.mode === WEBGL_CONSTANTS.TRIANGLE_FAN ||\n\t\t\t\t\t\tprimitive.mode === undefined ) {\n\n\t\t\t\t\t// .isSkinnedMesh isn't in glTF spec. See ._markDefs()\n\t\t\t\t\tmesh = meshDef.isSkinnedMesh === true\n\t\t\t\t\t\t? new SkinnedMesh( geometry, material )\n\t\t\t\t\t\t: new Mesh( geometry, material );\n\n\t\t\t\t\tif ( mesh.isSkinnedMesh === true && ! mesh.geometry.attributes.skinWeight.normalized ) {\n\n\t\t\t\t\t\t// we normalize floating point skin weight array to fix malformed assets (see #15319)\n\t\t\t\t\t\t// it's important to skip this for non-float32 data since normalizeSkinWeights assumes non-normalized inputs\n\t\t\t\t\t\tmesh.normalizeSkinWeights();\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( primitive.mode === WEBGL_CONSTANTS.TRIANGLE_STRIP ) {\n\n\t\t\t\t\t\tmesh.geometry = toTrianglesDrawMode( mesh.geometry, TriangleStripDrawMode );\n\n\t\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.TRIANGLE_FAN ) {\n\n\t\t\t\t\t\tmesh.geometry = toTrianglesDrawMode( mesh.geometry, TriangleFanDrawMode );\n\n\t\t\t\t\t}\n\n\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.LINES ) {\n\n\t\t\t\t\tmesh = new LineSegments( geometry, material );\n\n\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.LINE_STRIP ) {\n\n\t\t\t\t\tmesh = new Line( geometry, material );\n\n\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.LINE_LOOP ) {\n\n\t\t\t\t\tmesh = new LineLoop( geometry, material );\n\n\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.POINTS ) {\n\n\t\t\t\t\tmesh = new Points( geometry, material );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tthrow new Error( 'THREE.GLTFLoader: Primitive mode unsupported: ' + primitive.mode );\n\n\t\t\t\t}\n\n\t\t\t\tif ( Object.keys( mesh.geometry.morphAttributes ).length > 0 ) {\n\n\t\t\t\t\tupdateMorphTargets( mesh, meshDef );\n\n\t\t\t\t}\n\n\t\t\t\tmesh.name = parser.createUniqueName( meshDef.name || ( 'mesh_' + meshIndex ) );\n\n\t\t\t\tassignExtrasToUserData( mesh, meshDef );\n\n\t\t\t\tif ( primitive.extensions ) addUnknownExtensionsToUserData( extensions, mesh, primitive );\n\n\t\t\t\tparser.assignFinalMaterial( mesh );\n\n\t\t\t\tmeshes.push( mesh );\n\n\t\t\t}\n\n\t\t\tfor ( let i = 0, il = meshes.length; i < il; i ++ ) {\n\n\t\t\t\tparser.associations.set( meshes[ i ], {\n\t\t\t\t\tmeshes: meshIndex,\n\t\t\t\t\tprimitives: i\n\t\t\t\t} );\n\n\t\t\t}\n\n\t\t\tif ( meshes.length === 1 ) {\n\n\t\t\t\treturn meshes[ 0 ];\n\n\t\t\t}\n\n\t\t\tconst group = new Group();\n\n\t\t\tparser.associations.set( group, { meshes: meshIndex } );\n\n\t\t\tfor ( let i = 0, il = meshes.length; i < il; i ++ ) {\n\n\t\t\t\tgroup.add( meshes[ i ] );\n\n\t\t\t}\n\n\t\t\treturn group;\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#cameras\n\t * @param {number} cameraIndex\n\t * @return {Promise<THREE.Camera>}\n\t */\n\tloadCamera( cameraIndex ) {\n\n\t\tlet camera;\n\t\tconst cameraDef = this.json.cameras[ cameraIndex ];\n\t\tconst params = cameraDef[ cameraDef.type ];\n\n\t\tif ( ! params ) {\n\n\t\t\tconsole.warn( 'THREE.GLTFLoader: Missing camera parameters.' );\n\t\t\treturn;\n\n\t\t}\n\n\t\tif ( cameraDef.type === 'perspective' ) {\n\n\t\t\tcamera = new PerspectiveCamera( MathUtils.radToDeg( params.yfov ), params.aspectRatio || 1, params.znear || 1, params.zfar || 2e6 );\n\n\t\t} else if ( cameraDef.type === 'orthographic' ) {\n\n\t\t\tcamera = new OrthographicCamera( - params.xmag, params.xmag, params.ymag, - params.ymag, params.znear, params.zfar );\n\n\t\t}\n\n\t\tif ( cameraDef.name ) camera.name = this.createUniqueName( cameraDef.name );\n\n\t\tassignExtrasToUserData( camera, cameraDef );\n\n\t\treturn Promise.resolve( camera );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#skins\n\t * @param {number} skinIndex\n\t * @return {Promise<Object>}\n\t */\n\tloadSkin( skinIndex ) {\n\n\t\tconst skinDef = this.json.skins[ skinIndex ];\n\n\t\tconst skinEntry = { joints: skinDef.joints };\n\n\t\tif ( skinDef.inverseBindMatrices === undefined ) {\n\n\t\t\treturn Promise.resolve( skinEntry );\n\n\t\t}\n\n\t\treturn this.getDependency( 'accessor', skinDef.inverseBindMatrices ).then( function ( accessor ) {\n\n\t\t\tskinEntry.inverseBindMatrices = accessor;\n\n\t\t\treturn skinEntry;\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#animations\n\t * @param {number} animationIndex\n\t * @return {Promise<AnimationClip>}\n\t */\n\tloadAnimation( animationIndex ) {\n\n\t\tconst json = this.json;\n\n\t\tconst animationDef = json.animations[ animationIndex ];\n\n\t\tconst pendingNodes = [];\n\t\tconst pendingInputAccessors = [];\n\t\tconst pendingOutputAccessors = [];\n\t\tconst pendingSamplers = [];\n\t\tconst pendingTargets = [];\n\n\t\tfor ( let i = 0, il = animationDef.channels.length; i < il; i ++ ) {\n\n\t\t\tconst channel = animationDef.channels[ i ];\n\t\t\tconst sampler = animationDef.samplers[ channel.sampler ];\n\t\t\tconst target = channel.target;\n\t\t\tconst name = target.node !== undefined ? target.node : target.id; // NOTE: target.id is deprecated.\n\t\t\tconst input = animationDef.parameters !== undefined ? animationDef.parameters[ sampler.input ] : sampler.input;\n\t\t\tconst output = animationDef.parameters !== undefined ? animationDef.parameters[ sampler.output ] : sampler.output;\n\n\t\t\tpendingNodes.push( this.getDependency( 'node', name ) );\n\t\t\tpendingInputAccessors.push( this.getDependency( 'accessor', input ) );\n\t\t\tpendingOutputAccessors.push( this.getDependency( 'accessor', output ) );\n\t\t\tpendingSamplers.push( sampler );\n\t\t\tpendingTargets.push( target );\n\n\t\t}\n\n\t\treturn Promise.all( [\n\n\t\t\tPromise.all( pendingNodes ),\n\t\t\tPromise.all( pendingInputAccessors ),\n\t\t\tPromise.all( pendingOutputAccessors ),\n\t\t\tPromise.all( pendingSamplers ),\n\t\t\tPromise.all( pendingTargets )\n\n\t\t] ).then( function ( dependencies ) {\n\n\t\t\tconst nodes = dependencies[ 0 ];\n\t\t\tconst inputAccessors = dependencies[ 1 ];\n\t\t\tconst outputAccessors = dependencies[ 2 ];\n\t\t\tconst samplers = dependencies[ 3 ];\n\t\t\tconst targets = dependencies[ 4 ];\n\n\t\t\tconst tracks = [];\n\n\t\t\tfor ( let i = 0, il = nodes.length; i < il; i ++ ) {\n\n\t\t\t\tconst node = nodes[ i ];\n\t\t\t\tconst inputAccessor = inputAccessors[ i ];\n\t\t\t\tconst outputAccessor = outputAccessors[ i ];\n\t\t\t\tconst sampler = samplers[ i ];\n\t\t\t\tconst target = targets[ i ];\n\n\t\t\t\tif ( node === undefined ) continue;\n\n\t\t\t\tnode.updateMatrix();\n\t\t\t\tnode.matrixAutoUpdate = true;\n\n\t\t\t\tlet TypedKeyframeTrack;\n\n\t\t\t\tswitch ( PATH_PROPERTIES[ target.path ] ) {\n\n\t\t\t\t\tcase PATH_PROPERTIES.weights:\n\n\t\t\t\t\t\tTypedKeyframeTrack = NumberKeyframeTrack;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase PATH_PROPERTIES.rotation:\n\n\t\t\t\t\t\tTypedKeyframeTrack = QuaternionKeyframeTrack;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase PATH_PROPERTIES.position:\n\t\t\t\t\tcase PATH_PROPERTIES.scale:\n\t\t\t\t\tdefault:\n\n\t\t\t\t\t\tTypedKeyframeTrack = VectorKeyframeTrack;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t\tconst targetName = node.name ? node.name : node.uuid;\n\n\t\t\t\tconst interpolation = sampler.interpolation !== undefined ? INTERPOLATION[ sampler.interpolation ] : InterpolateLinear;\n\n\t\t\t\tconst targetNames = [];\n\n\t\t\t\tif ( PATH_PROPERTIES[ target.path ] === PATH_PROPERTIES.weights ) {\n\n\t\t\t\t\tnode.traverse( function ( object ) {\n\n\t\t\t\t\t\tif ( object.morphTargetInfluences ) {\n\n\t\t\t\t\t\t\ttargetNames.push( object.name ? object.name : object.uuid );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t} );\n\n\t\t\t\t} else {\n\n\t\t\t\t\ttargetNames.push( targetName );\n\n\t\t\t\t}\n\n\t\t\t\tlet outputArray = outputAccessor.array;\n\n\t\t\t\tif ( outputAccessor.normalized ) {\n\n\t\t\t\t\tconst scale = getNormalizedComponentScale( outputArray.constructor );\n\t\t\t\t\tconst scaled = new Float32Array( outputArray.length );\n\n\t\t\t\t\tfor ( let j = 0, jl = outputArray.length; j < jl; j ++ ) {\n\n\t\t\t\t\t\tscaled[ j ] = outputArray[ j ] * scale;\n\n\t\t\t\t\t}\n\n\t\t\t\t\toutputArray = scaled;\n\n\t\t\t\t}\n\n\t\t\t\tfor ( let j = 0, jl = targetNames.length; j < jl; j ++ ) {\n\n\t\t\t\t\tconst track = new TypedKeyframeTrack(\n\t\t\t\t\t\ttargetNames[ j ] + '.' + PATH_PROPERTIES[ target.path ],\n\t\t\t\t\t\tinputAccessor.array,\n\t\t\t\t\t\toutputArray,\n\t\t\t\t\t\tinterpolation\n\t\t\t\t\t);\n\n\t\t\t\t\t// Override interpolation with custom factory method.\n\t\t\t\t\tif ( sampler.interpolation === 'CUBICSPLINE' ) {\n\n\t\t\t\t\t\ttrack.createInterpolant = function InterpolantFactoryMethodGLTFCubicSpline( result ) {\n\n\t\t\t\t\t\t\t// A CUBICSPLINE keyframe in glTF has three output values for each input value,\n\t\t\t\t\t\t\t// representing inTangent, splineVertex, and outTangent. As a result, track.getValueSize()\n\t\t\t\t\t\t\t// must be divided by three to get the interpolant's sampleSize argument.\n\n\t\t\t\t\t\t\tconst interpolantType = ( this instanceof QuaternionKeyframeTrack ) ? GLTFCubicSplineQuaternionInterpolant : GLTFCubicSplineInterpolant;\n\n\t\t\t\t\t\t\treturn new interpolantType( this.times, this.values, this.getValueSize() / 3, result );\n\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\t// Mark as CUBICSPLINE. `track.getInterpolation()` doesn't support custom interpolants.\n\t\t\t\t\t\ttrack.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline = true;\n\n\t\t\t\t\t}\n\n\t\t\t\t\ttracks.push( track );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tconst name = animationDef.name ? animationDef.name : 'animation_' + animationIndex;\n\n\t\t\treturn new AnimationClip( name, undefined, tracks );\n\n\t\t} );\n\n\t}\n\n\tcreateNodeMesh( nodeIndex ) {\n\n\t\tconst json = this.json;\n\t\tconst parser = this;\n\t\tconst nodeDef = json.nodes[ nodeIndex ];\n\n\t\tif ( nodeDef.mesh === undefined ) return null;\n\n\t\treturn parser.getDependency( 'mesh', nodeDef.mesh ).then( function ( mesh ) {\n\n\t\t\tconst node = parser._getNodeRef( parser.meshCache, nodeDef.mesh, mesh );\n\n\t\t\t// if weights are provided on the node, override weights on the mesh.\n\t\t\tif ( nodeDef.weights !== undefined ) {\n\n\t\t\t\tnode.traverse( function ( o ) {\n\n\t\t\t\t\tif ( ! o.isMesh ) return;\n\n\t\t\t\t\tfor ( let i = 0, il = nodeDef.weights.length; i < il; i ++ ) {\n\n\t\t\t\t\t\to.morphTargetInfluences[ i ] = nodeDef.weights[ i ];\n\n\t\t\t\t\t}\n\n\t\t\t\t} );\n\n\t\t\t}\n\n\t\t\treturn node;\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#nodes-and-hierarchy\n\t * @param {number} nodeIndex\n\t * @return {Promise<Object3D>}\n\t */\n\tloadNode( nodeIndex ) {\n\n\t\tconst json = this.json;\n\t\tconst extensions = this.extensions;\n\t\tconst parser = this;\n\n\t\tconst nodeDef = json.nodes[ nodeIndex ];\n\n\t\t// reserve node's name before its dependencies, so the root has the intended name.\n\t\tconst nodeName = nodeDef.name ? parser.createUniqueName( nodeDef.name ) : '';\n\n\t\treturn ( function () {\n\n\t\t\tconst pending = [];\n\n\t\t\tconst meshPromise = parser._invokeOne( function ( ext ) {\n\n\t\t\t\treturn ext.createNodeMesh && ext.createNodeMesh( nodeIndex );\n\n\t\t\t} );\n\n\t\t\tif ( meshPromise ) {\n\n\t\t\t\tpending.push( meshPromise );\n\n\t\t\t}\n\n\t\t\tif ( nodeDef.camera !== undefined ) {\n\n\t\t\t\tpending.push( parser.getDependency( 'camera', nodeDef.camera ).then( function ( camera ) {\n\n\t\t\t\t\treturn parser._getNodeRef( parser.cameraCache, nodeDef.camera, camera );\n\n\t\t\t\t} ) );\n\n\t\t\t}\n\n\t\t\tparser._invokeAll( function ( ext ) {\n\n\t\t\t\treturn ext.createNodeAttachment && ext.createNodeAttachment( nodeIndex );\n\n\t\t\t} ).forEach( function ( promise ) {\n\n\t\t\t\tpending.push( promise );\n\n\t\t\t} );\n\n\t\t\treturn Promise.all( pending );\n\n\t\t}() ).then( function ( objects ) {\n\n\t\t\tlet node;\n\n\t\t\t// .isBone isn't in glTF spec. See ._markDefs\n\t\t\tif ( nodeDef.isBone === true ) {\n\n\t\t\t\tnode = new Bone();\n\n\t\t\t} else if ( objects.length > 1 ) {\n\n\t\t\t\tnode = new Group();\n\n\t\t\t} else if ( objects.length === 1 ) {\n\n\t\t\t\tnode = objects[ 0 ];\n\n\t\t\t} else {\n\n\t\t\t\tnode = new Object3D();\n\n\t\t\t}\n\n\t\t\tif ( node !== objects[ 0 ] ) {\n\n\t\t\t\tfor ( let i = 0, il = objects.length; i < il; i ++ ) {\n\n\t\t\t\t\tnode.add( objects[ i ] );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( nodeDef.name ) {\n\n\t\t\t\tnode.userData.name = nodeDef.name;\n\t\t\t\tnode.name = nodeName;\n\n\t\t\t}\n\n\t\t\tassignExtrasToUserData( node, nodeDef );\n\n\t\t\tif ( nodeDef.extensions ) addUnknownExtensionsToUserData( extensions, node, nodeDef );\n\n\t\t\tif ( nodeDef.matrix !== undefined ) {\n\n\t\t\t\tconst matrix = new Matrix4();\n\t\t\t\tmatrix.fromArray( nodeDef.matrix );\n\t\t\t\tnode.applyMatrix4( matrix );\n\n\t\t\t} else {\n\n\t\t\t\tif ( nodeDef.translation !== undefined ) {\n\n\t\t\t\t\tnode.position.fromArray( nodeDef.translation );\n\n\t\t\t\t}\n\n\t\t\t\tif ( nodeDef.rotation !== undefined ) {\n\n\t\t\t\t\tnode.quaternion.fromArray( nodeDef.rotation );\n\n\t\t\t\t}\n\n\t\t\t\tif ( nodeDef.scale !== undefined ) {\n\n\t\t\t\t\tnode.scale.fromArray( nodeDef.scale );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( ! parser.associations.has( node ) ) {\n\n\t\t\t\tparser.associations.set( node, {} );\n\n\t\t\t}\n\n\t\t\tparser.associations.get( node ).nodes = nodeIndex;\n\n\t\t\treturn node;\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#scenes\n\t * @param {number} sceneIndex\n\t * @return {Promise<Group>}\n\t */\n\tloadScene( sceneIndex ) {\n\n\t\tconst json = this.json;\n\t\tconst extensions = this.extensions;\n\t\tconst sceneDef = this.json.scenes[ sceneIndex ];\n\t\tconst parser = this;\n\n\t\t// Loader returns Group, not Scene.\n\t\t// See: https://github.com/mrdoob/three.js/issues/18342#issuecomment-578981172\n\t\tconst scene = new Group();\n\t\tif ( sceneDef.name ) scene.name = parser.createUniqueName( sceneDef.name );\n\n\t\tassignExtrasToUserData( scene, sceneDef );\n\n\t\tif ( sceneDef.extensions ) addUnknownExtensionsToUserData( extensions, scene, sceneDef );\n\n\t\tconst nodeIds = sceneDef.nodes || [];\n\n\t\tconst pending = [];\n\n\t\tfor ( let i = 0, il = nodeIds.length; i < il; i ++ ) {\n\n\t\t\tpending.push( buildNodeHierarchy( nodeIds[ i ], scene, json, parser ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending ).then( function () {\n\n\t\t\t// Removes dangling associations, associations that reference a node that\n\t\t\t// didn't make it into the scene.\n\t\t\tconst reduceAssociations = ( node ) => {\n\n\t\t\t\tconst reducedAssociations = new Map();\n\n\t\t\t\tfor ( const [ key, value ] of parser.associations ) {\n\n\t\t\t\t\tif ( key instanceof Material || key instanceof Texture ) {\n\n\t\t\t\t\t\treducedAssociations.set( key, value );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tnode.traverse( ( node ) => {\n\n\t\t\t\t\tconst mappings = parser.associations.get( node );\n\n\t\t\t\t\tif ( mappings != null ) {\n\n\t\t\t\t\t\treducedAssociations.set( node, mappings );\n\n\t\t\t\t\t}\n\n\t\t\t\t} );\n\n\t\t\t\treturn reducedAssociations;\n\n\t\t\t};\n\n\t\t\tparser.associations = reduceAssociations( scene );\n\n\t\t\treturn scene;\n\n\t\t} );\n\n\t}\n\n}\n\nfunction buildNodeHierarchy( nodeId, parentObject, json, parser ) {\n\n\tconst nodeDef = json.nodes[ nodeId ];\n\n\treturn parser.getDependency( 'node', nodeId ).then( function ( node ) {\n\n\t\tif ( nodeDef.skin === undefined ) return node;\n\n\t\t// build skeleton here as well\n\n\t\tlet skinEntry;\n\n\t\treturn parser.getDependency( 'skin', nodeDef.skin ).then( function ( skin ) {\n\n\t\t\tskinEntry = skin;\n\n\t\t\tconst pendingJoints = [];\n\n\t\t\tfor ( let i = 0, il = skinEntry.joints.length; i < il; i ++ ) {\n\n\t\t\t\tpendingJoints.push( parser.getDependency( 'node', skinEntry.joints[ i ] ) );\n\n\t\t\t}\n\n\t\t\treturn Promise.all( pendingJoints );\n\n\t\t} ).then( function ( jointNodes ) {\n\n\t\t\tnode.traverse( function ( mesh ) {\n\n\t\t\t\tif ( ! mesh.isMesh ) return;\n\n\t\t\t\tconst bones = [];\n\t\t\t\tconst boneInverses = [];\n\n\t\t\t\tfor ( let j = 0, jl = jointNodes.length; j < jl; j ++ ) {\n\n\t\t\t\t\tconst jointNode = jointNodes[ j ];\n\n\t\t\t\t\tif ( jointNode ) {\n\n\t\t\t\t\t\tbones.push( jointNode );\n\n\t\t\t\t\t\tconst mat = new Matrix4();\n\n\t\t\t\t\t\tif ( skinEntry.inverseBindMatrices !== undefined ) {\n\n\t\t\t\t\t\t\tmat.fromArray( skinEntry.inverseBindMatrices.array, j * 16 );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tboneInverses.push( mat );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Joint \"%s\" could not be found.', skinEntry.joints[ j ] );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tmesh.bind( new Skeleton( bones, boneInverses ), mesh.matrixWorld );\n\n\t\t\t} );\n\n\t\t\treturn node;\n\n\t\t} );\n\n\t} ).then( function ( node ) {\n\n\t\t// build node hierachy\n\n\t\tparentObject.add( node );\n\n\t\tconst pending = [];\n\n\t\tif ( nodeDef.children ) {\n\n\t\t\tconst children = nodeDef.children;\n\n\t\t\tfor ( let i = 0, il = children.length; i < il; i ++ ) {\n\n\t\t\t\tconst child = children[ i ];\n\t\t\t\tpending.push( buildNodeHierarchy( child, node, json, parser ) );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t} );\n\n}\n\n/**\n * @param {BufferGeometry} geometry\n * @param {GLTF.Primitive} primitiveDef\n * @param {GLTFParser} parser\n */\nfunction computeBounds( geometry, primitiveDef, parser ) {\n\n\tconst attributes = primitiveDef.attributes;\n\n\tconst box = new Box3();\n\n\tif ( attributes.POSITION !== undefined ) {\n\n\t\tconst accessor = parser.json.accessors[ attributes.POSITION ];\n\n\t\tconst min = accessor.min;\n\t\tconst max = accessor.max;\n\n\t\t// glTF requires 'min' and 'max', but VRM (which extends glTF) currently ignores that requirement.\n\n\t\tif ( min !== undefined && max !== undefined ) {\n\n\t\t\tbox.set(\n\t\t\t\tnew Vector3( min[ 0 ], min[ 1 ], min[ 2 ] ),\n\t\t\t\tnew Vector3( max[ 0 ], max[ 1 ], max[ 2 ] )\n\t\t\t);\n\n\t\t\tif ( accessor.normalized ) {\n\n\t\t\t\tconst boxScale = getNormalizedComponentScale( WEBGL_COMPONENT_TYPES[ accessor.componentType ] );\n\t\t\t\tbox.min.multiplyScalar( boxScale );\n\t\t\t\tbox.max.multiplyScalar( boxScale );\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tconsole.warn( 'THREE.GLTFLoader: Missing min/max properties for accessor POSITION.' );\n\n\t\t\treturn;\n\n\t\t}\n\n\t} else {\n\n\t\treturn;\n\n\t}\n\n\tconst targets = primitiveDef.targets;\n\n\tif ( targets !== undefined ) {\n\n\t\tconst maxDisplacement = new Vector3();\n\t\tconst vector = new Vector3();\n\n\t\tfor ( let i = 0, il = targets.length; i < il; i ++ ) {\n\n\t\t\tconst target = targets[ i ];\n\n\t\t\tif ( target.POSITION !== undefined ) {\n\n\t\t\t\tconst accessor = parser.json.accessors[ target.POSITION ];\n\t\t\t\tconst min = accessor.min;\n\t\t\t\tconst max = accessor.max;\n\n\t\t\t\t// glTF requires 'min' and 'max', but VRM (which extends glTF) currently ignores that requirement.\n\n\t\t\t\tif ( min !== undefined && max !== undefined ) {\n\n\t\t\t\t\t// we need to get max of absolute components because target weight is [-1,1]\n\t\t\t\t\tvector.setX( Math.max( Math.abs( min[ 0 ] ), Math.abs( max[ 0 ] ) ) );\n\t\t\t\t\tvector.setY( Math.max( Math.abs( min[ 1 ] ), Math.abs( max[ 1 ] ) ) );\n\t\t\t\t\tvector.setZ( Math.max( Math.abs( min[ 2 ] ), Math.abs( max[ 2 ] ) ) );\n\n\n\t\t\t\t\tif ( accessor.normalized ) {\n\n\t\t\t\t\t\tconst boxScale = getNormalizedComponentScale( WEBGL_COMPONENT_TYPES[ accessor.componentType ] );\n\t\t\t\t\t\tvector.multiplyScalar( boxScale );\n\n\t\t\t\t\t}\n\n\t\t\t\t\t// Note: this assumes that the sum of all weights is at most 1. This isn't quite correct - it's more conservative\n\t\t\t\t\t// to assume that each target can have a max weight of 1. However, for some use cases - notably, when morph targets\n\t\t\t\t\t// are used to implement key-frame animations and as such only two are active at a time - this results in very large\n\t\t\t\t\t// boxes. So for now we make a box that's sometimes a touch too small but is hopefully mostly of reasonable size.\n\t\t\t\t\tmaxDisplacement.max( vector );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Missing min/max properties for accessor POSITION.' );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\t// As per comment above this box isn't conservative, but has a reasonable size for a very large number of morph targets.\n\t\tbox.expandByVector( maxDisplacement );\n\n\t}\n\n\tgeometry.boundingBox = box;\n\n\tconst sphere = new Sphere();\n\n\tbox.getCenter( sphere.center );\n\tsphere.radius = box.min.distanceTo( box.max ) / 2;\n\n\tgeometry.boundingSphere = sphere;\n\n}\n\n/**\n * @param {BufferGeometry} geometry\n * @param {GLTF.Primitive} primitiveDef\n * @param {GLTFParser} parser\n * @return {Promise<BufferGeometry>}\n */\nfunction addPrimitiveAttributes( geometry, primitiveDef, parser ) {\n\n\tconst attributes = primitiveDef.attributes;\n\n\tconst pending = [];\n\n\tfunction assignAttributeAccessor( accessorIndex, attributeName ) {\n\n\t\treturn parser.getDependency( 'accessor', accessorIndex )\n\t\t\t.then( function ( accessor ) {\n\n\t\t\t\tgeometry.setAttribute( attributeName, accessor );\n\n\t\t\t} );\n\n\t}\n\n\tfor ( const gltfAttributeName in attributes ) {\n\n\t\tconst threeAttributeName = ATTRIBUTES[ gltfAttributeName ] || gltfAttributeName.toLowerCase();\n\n\t\t// Skip attributes already provided by e.g. Draco extension.\n\t\tif ( threeAttributeName in geometry.attributes ) continue;\n\n\t\tpending.push( assignAttributeAccessor( attributes[ gltfAttributeName ], threeAttributeName ) );\n\n\t}\n\n\tif ( primitiveDef.indices !== undefined && ! geometry.index ) {\n\n\t\tconst accessor = parser.getDependency( 'accessor', primitiveDef.indices ).then( function ( accessor ) {\n\n\t\t\tgeometry.setIndex( accessor );\n\n\t\t} );\n\n\t\tpending.push( accessor );\n\n\t}\n\n\tassignExtrasToUserData( geometry, primitiveDef );\n\n\tcomputeBounds( geometry, primitiveDef, parser );\n\n\treturn Promise.all( pending ).then( function () {\n\n\t\treturn primitiveDef.targets !== undefined\n\t\t\t? addMorphTargets( geometry, primitiveDef.targets, parser )\n\t\t\t: geometry;\n\n\t} );\n\n}\n\n/**\n * @param {BufferGeometry} geometry\n * @param {Number} drawMode\n * @return {BufferGeometry}\n */\nfunction toTrianglesDrawMode( geometry, drawMode ) {\n\n\tlet index = geometry.getIndex();\n\n\t// generate index if not present\n\n\tif ( index === null ) {\n\n\t\tconst indices = [];\n\n\t\tconst position = geometry.getAttribute( 'position' );\n\n\t\tif ( position !== undefined ) {\n\n\t\t\tfor ( let i = 0; i < position.count; i ++ ) {\n\n\t\t\t\tindices.push( i );\n\n\t\t\t}\n\n\t\t\tgeometry.setIndex( indices );\n\t\t\tindex = geometry.getIndex();\n\n\t\t} else {\n\n\t\t\tconsole.error( 'THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible.' );\n\t\t\treturn geometry;\n\n\t\t}\n\n\t}\n\n\t//\n\n\tconst numberOfTriangles = index.count - 2;\n\tconst newIndices = [];\n\n\tif ( drawMode === TriangleFanDrawMode ) {\n\n\t\t// gl.TRIANGLE_FAN\n\n\t\tfor ( let i = 1; i <= numberOfTriangles; i ++ ) {\n\n\t\t\tnewIndices.push( index.getX( 0 ) );\n\t\t\tnewIndices.push( index.getX( i ) );\n\t\t\tnewIndices.push( index.getX( i + 1 ) );\n\n\t\t}\n\n\t} else {\n\n\t\t// gl.TRIANGLE_STRIP\n\n\t\tfor ( let i = 0; i < numberOfTriangles; i ++ ) {\n\n\t\t\tif ( i % 2 === 0 ) {\n\n\t\t\t\tnewIndices.push( index.getX( i ) );\n\t\t\t\tnewIndices.push( index.getX( i + 1 ) );\n\t\t\t\tnewIndices.push( index.getX( i + 2 ) );\n\n\n\t\t\t} else {\n\n\t\t\t\tnewIndices.push( index.getX( i + 2 ) );\n\t\t\t\tnewIndices.push( index.getX( i + 1 ) );\n\t\t\t\tnewIndices.push( index.getX( i ) );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\tif ( ( newIndices.length / 3 ) !== numberOfTriangles ) {\n\n\t\tconsole.error( 'THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.' );\n\n\t}\n\n\t// build final geometry\n\n\tconst newGeometry = geometry.clone();\n\tnewGeometry.setIndex( newIndices );\n\n\treturn newGeometry;\n\n}\n\nexport { GLTFLoader };\n","/**\n * Full-screen textured quad shader\n */\n\nvar CopyShader = {\n\n\tuniforms: {\n\n\t\t'tDiffuse': { value: null },\n\t\t'opacity': { value: 1.0 }\n\n\t},\n\n\tvertexShader: /* glsl */`\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}`,\n\n\tfragmentShader: /* glsl */`\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor = opacity * texel;\n\n\t\t}`\n\n};\n\nexport { CopyShader };\n","import {\n\tBufferGeometry,\n\tFloat32BufferAttribute,\n\tOrthographicCamera,\n\tMesh\n} from 'three';\n\nclass Pass {\n\n\tconstructor() {\n\n\t\t// if set to true, the pass is processed by the composer\n\t\tthis.enabled = true;\n\n\t\t// if set to true, the pass indicates to swap read and write buffer after rendering\n\t\tthis.needsSwap = true;\n\n\t\t// if set to true, the pass clears its buffer before rendering\n\t\tthis.clear = false;\n\n\t\t// if set to true, the result of the pass is rendered to screen. This is set automatically by EffectComposer.\n\t\tthis.renderToScreen = false;\n\n\t}\n\n\tsetSize( /* width, height */ ) {}\n\n\trender( /* renderer, writeBuffer, readBuffer, deltaTime, maskActive */ ) {\n\n\t\tconsole.error( 'THREE.Pass: .render() must be implemented in derived pass.' );\n\n\t}\n\n}\n\n// Helper for passes that need to fill the viewport with a single quad.\n\nconst _camera = new OrthographicCamera( - 1, 1, 1, - 1, 0, 1 );\n\n// https://github.com/mrdoob/three.js/pull/21358\n\nconst _geometry = new BufferGeometry();\n_geometry.setAttribute( 'position', new Float32BufferAttribute( [ - 1, 3, 0, - 1, - 1, 0, 3, - 1, 0 ], 3 ) );\n_geometry.setAttribute( 'uv', new Float32BufferAttribute( [ 0, 2, 0, 0, 2, 0 ], 2 ) );\n\nclass FullScreenQuad {\n\n\tconstructor( material ) {\n\n\t\tthis._mesh = new Mesh( _geometry, material );\n\n\t}\n\n\tdispose() {\n\n\t\tthis._mesh.geometry.dispose();\n\n\t}\n\n\trender( renderer ) {\n\n\t\trenderer.render( this._mesh, _camera );\n\n\t}\n\n\tget material() {\n\n\t\treturn this._mesh.material;\n\n\t}\n\n\tset material( value ) {\n\n\t\tthis._mesh.material = value;\n\n\t}\n\n}\n\nexport { Pass, FullScreenQuad };\n","import {\n\tShaderMaterial,\n\tUniformsUtils\n} from 'three';\nimport { Pass, FullScreenQuad } from './Pass.js';\n\nclass ShaderPass extends Pass {\n\n\tconstructor( shader, textureID ) {\n\n\t\tsuper();\n\n\t\tthis.textureID = ( textureID !== undefined ) ? textureID : 'tDiffuse';\n\n\t\tif ( shader instanceof ShaderMaterial ) {\n\n\t\t\tthis.uniforms = shader.uniforms;\n\n\t\t\tthis.material = shader;\n\n\t\t} else if ( shader ) {\n\n\t\t\tthis.uniforms = UniformsUtils.clone( shader.uniforms );\n\n\t\t\tthis.material = new ShaderMaterial( {\n\n\t\t\t\tdefines: Object.assign( {}, shader.defines ),\n\t\t\t\tuniforms: this.uniforms,\n\t\t\t\tvertexShader: shader.vertexShader,\n\t\t\t\tfragmentShader: shader.fragmentShader\n\n\t\t\t} );\n\n\t\t}\n\n\t\tthis.fsQuad = new FullScreenQuad( this.material );\n\n\t}\n\n\trender( renderer, writeBuffer, readBuffer /*, deltaTime, maskActive */ ) {\n\n\t\tif ( this.uniforms[ this.textureID ] ) {\n\n\t\t\tthis.uniforms[ this.textureID ].value = readBuffer.texture;\n\n\t\t}\n\n\t\tthis.fsQuad.material = this.material;\n\n\t\tif ( this.renderToScreen ) {\n\n\t\t\trenderer.setRenderTarget( null );\n\t\t\tthis.fsQuad.render( renderer );\n\n\t\t} else {\n\n\t\t\trenderer.setRenderTarget( writeBuffer );\n\t\t\t// TODO: Avoid using autoClear properties, see https://github.com/mrdoob/three.js/pull/15571#issuecomment-465669600\n\t\t\tif ( this.clear ) renderer.clear( renderer.autoClearColor, renderer.autoClearDepth, renderer.autoClearStencil );\n\t\t\tthis.fsQuad.render( renderer );\n\n\t\t}\n\n\t}\n\n}\n\nexport { ShaderPass };\n","import { Pass } from './Pass.js';\n\nclass MaskPass extends Pass {\n\n\tconstructor( scene, camera ) {\n\n\t\tsuper();\n\n\t\tthis.scene = scene;\n\t\tthis.camera = camera;\n\n\t\tthis.clear = true;\n\t\tthis.needsSwap = false;\n\n\t\tthis.inverse = false;\n\n\t}\n\n\trender( renderer, writeBuffer, readBuffer /*, deltaTime, maskActive */ ) {\n\n\t\tconst context = renderer.getContext();\n\t\tconst state = renderer.state;\n\n\t\t// don't update color or depth\n\n\t\tstate.buffers.color.setMask( false );\n\t\tstate.buffers.depth.setMask( false );\n\n\t\t// lock buffers\n\n\t\tstate.buffers.color.setLocked( true );\n\t\tstate.buffers.depth.setLocked( true );\n\n\t\t// set up stencil\n\n\t\tlet writeValue, clearValue;\n\n\t\tif ( this.inverse ) {\n\n\t\t\twriteValue = 0;\n\t\t\tclearValue = 1;\n\n\t\t} else {\n\n\t\t\twriteValue = 1;\n\t\t\tclearValue = 0;\n\n\t\t}\n\n\t\tstate.buffers.stencil.setTest( true );\n\t\tstate.buffers.stencil.setOp( context.REPLACE, context.REPLACE, context.REPLACE );\n\t\tstate.buffers.stencil.setFunc( context.ALWAYS, writeValue, 0xffffffff );\n\t\tstate.buffers.stencil.setClear( clearValue );\n\t\tstate.buffers.stencil.setLocked( true );\n\n\t\t// draw into the stencil buffer\n\n\t\trenderer.setRenderTarget( readBuffer );\n\t\tif ( this.clear ) renderer.clear();\n\t\trenderer.render( this.scene, this.camera );\n\n\t\trenderer.setRenderTarget( writeBuffer );\n\t\tif ( this.clear ) renderer.clear();\n\t\trenderer.render( this.scene, this.camera );\n\n\t\t// unlock color and depth buffer for subsequent rendering\n\n\t\tstate.buffers.color.setLocked( false );\n\t\tstate.buffers.depth.setLocked( false );\n\n\t\t// only render where stencil is set to 1\n\n\t\tstate.buffers.stencil.setLocked( false );\n\t\tstate.buffers.stencil.setFunc( context.EQUAL, 1, 0xffffffff ); // draw if == 1\n\t\tstate.buffers.stencil.setOp( context.KEEP, context.KEEP, context.KEEP );\n\t\tstate.buffers.stencil.setLocked( true );\n\n\t}\n\n}\n\nclass ClearMaskPass extends Pass {\n\n\tconstructor() {\n\n\t\tsuper();\n\n\t\tthis.needsSwap = false;\n\n\t}\n\n\trender( renderer /*, writeBuffer, readBuffer, deltaTime, maskActive */ ) {\n\n\t\trenderer.state.buffers.stencil.setLocked( false );\n\t\trenderer.state.buffers.stencil.setTest( false );\n\n\t}\n\n}\n\nexport { MaskPass, ClearMaskPass };\n","import {\n\tBufferGeometry,\n\tClock,\n\tFloat32BufferAttribute,\n\tLinearFilter,\n\tMesh,\n\tOrthographicCamera,\n\tRGBAFormat,\n\tVector2,\n\tWebGLRenderTarget\n} from 'three';\nimport { CopyShader } from '../shaders/CopyShader.js';\nimport { ShaderPass } from './ShaderPass.js';\nimport { MaskPass } from './MaskPass.js';\nimport { ClearMaskPass } from './MaskPass.js';\n\nclass EffectComposer {\n\n\tconstructor( renderer, renderTarget ) {\n\n\t\tthis.renderer = renderer;\n\n\t\tif ( renderTarget === undefined ) {\n\n\t\t\tconst parameters = {\n\t\t\t\tminFilter: LinearFilter,\n\t\t\t\tmagFilter: LinearFilter,\n\t\t\t\tformat: RGBAFormat\n\t\t\t};\n\n\t\t\tconst size = renderer.getSize( new Vector2() );\n\t\t\tthis._pixelRatio = renderer.getPixelRatio();\n\t\t\tthis._width = size.width;\n\t\t\tthis._height = size.height;\n\n\t\t\trenderTarget = new WebGLRenderTarget( this._width * this._pixelRatio, this._height * this._pixelRatio, parameters );\n\t\t\trenderTarget.texture.name = 'EffectComposer.rt1';\n\n\t\t} else {\n\n\t\t\tthis._pixelRatio = 1;\n\t\t\tthis._width = renderTarget.width;\n\t\t\tthis._height = renderTarget.height;\n\n\t\t}\n\n\t\tthis.renderTarget1 = renderTarget;\n\t\tthis.renderTarget2 = renderTarget.clone();\n\t\tthis.renderTarget2.texture.name = 'EffectComposer.rt2';\n\n\t\tthis.writeBuffer = this.renderTarget1;\n\t\tthis.readBuffer = this.renderTarget2;\n\n\t\tthis.renderToScreen = true;\n\n\t\tthis.passes = [];\n\n\t\t// dependencies\n\n\t\tif ( CopyShader === undefined ) {\n\n\t\t\tconsole.error( 'THREE.EffectComposer relies on CopyShader' );\n\n\t\t}\n\n\t\tif ( ShaderPass === undefined ) {\n\n\t\t\tconsole.error( 'THREE.EffectComposer relies on ShaderPass' );\n\n\t\t}\n\n\t\tthis.copyPass = new ShaderPass( CopyShader );\n\n\t\tthis.clock = new Clock();\n\n\t}\n\n\tswapBuffers() {\n\n\t\tconst tmp = this.readBuffer;\n\t\tthis.readBuffer = this.writeBuffer;\n\t\tthis.writeBuffer = tmp;\n\n\t}\n\n\taddPass( pass ) {\n\n\t\tthis.passes.push( pass );\n\t\tpass.setSize( this._width * this._pixelRatio, this._height * this._pixelRatio );\n\n\t}\n\n\tinsertPass( pass, index ) {\n\n\t\tthis.passes.splice( index, 0, pass );\n\t\tpass.setSize( this._width * this._pixelRatio, this._height * this._pixelRatio );\n\n\t}\n\n\tremovePass( pass ) {\n\n\t\tconst index = this.passes.indexOf( pass );\n\n\t\tif ( index !== - 1 ) {\n\n\t\t\tthis.passes.splice( index, 1 );\n\n\t\t}\n\n\t}\n\n\tisLastEnabledPass( passIndex ) {\n\n\t\tfor ( let i = passIndex + 1; i < this.passes.length; i ++ ) {\n\n\t\t\tif ( this.passes[ i ].enabled ) {\n\n\t\t\t\treturn false;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn true;\n\n\t}\n\n\trender( deltaTime ) {\n\n\t\t// deltaTime value is in seconds\n\n\t\tif ( deltaTime === undefined ) {\n\n\t\t\tdeltaTime = this.clock.getDelta();\n\n\t\t}\n\n\t\tconst currentRenderTarget = this.renderer.getRenderTarget();\n\n\t\tlet maskActive = false;\n\n\t\tfor ( let i = 0, il = this.passes.length; i < il; i ++ ) {\n\n\t\t\tconst pass = this.passes[ i ];\n\n\t\t\tif ( pass.enabled === false ) continue;\n\n\t\t\tpass.renderToScreen = ( this.renderToScreen && this.isLastEnabledPass( i ) );\n\t\t\tpass.render( this.renderer, this.writeBuffer, this.readBuffer, deltaTime, maskActive );\n\n\t\t\tif ( pass.needsSwap ) {\n\n\t\t\t\tif ( maskActive ) {\n\n\t\t\t\t\tconst context = this.renderer.getContext();\n\t\t\t\t\tconst stencil = this.renderer.state.buffers.stencil;\n\n\t\t\t\t\t//context.stencilFunc( context.NOTEQUAL, 1, 0xffffffff );\n\t\t\t\t\tstencil.setFunc( context.NOTEQUAL, 1, 0xffffffff );\n\n\t\t\t\t\tthis.copyPass.render( this.renderer, this.writeBuffer, this.readBuffer, deltaTime );\n\n\t\t\t\t\t//context.stencilFunc( context.EQUAL, 1, 0xffffffff );\n\t\t\t\t\tstencil.setFunc( context.EQUAL, 1, 0xffffffff );\n\n\t\t\t\t}\n\n\t\t\t\tthis.swapBuffers();\n\n\t\t\t}\n\n\t\t\tif ( MaskPass !== undefined ) {\n\n\t\t\t\tif ( pass instanceof MaskPass ) {\n\n\t\t\t\t\tmaskActive = true;\n\n\t\t\t\t} else if ( pass instanceof ClearMaskPass ) {\n\n\t\t\t\t\tmaskActive = false;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tthis.renderer.setRenderTarget( currentRenderTarget );\n\n\t}\n\n\treset( renderTarget ) {\n\n\t\tif ( renderTarget === undefined ) {\n\n\t\t\tconst size = this.renderer.getSize( new Vector2() );\n\t\t\tthis._pixelRatio = this.renderer.getPixelRatio();\n\t\t\tthis._width = size.width;\n\t\t\tthis._height = size.height;\n\n\t\t\trenderTarget = this.renderTarget1.clone();\n\t\t\trenderTarget.setSize( this._width * this._pixelRatio, this._height * this._pixelRatio );\n\n\t\t}\n\n\t\tthis.renderTarget1.dispose();\n\t\tthis.renderTarget2.dispose();\n\t\tthis.renderTarget1 = renderTarget;\n\t\tthis.renderTarget2 = renderTarget.clone();\n\n\t\tthis.writeBuffer = this.renderTarget1;\n\t\tthis.readBuffer = this.renderTarget2;\n\n\t}\n\n\tsetSize( width, height ) {\n\n\t\tthis._width = width;\n\t\tthis._height = height;\n\n\t\tconst effectiveWidth = this._width * this._pixelRatio;\n\t\tconst effectiveHeight = this._height * this._pixelRatio;\n\n\t\tthis.renderTarget1.setSize( effectiveWidth, effectiveHeight );\n\t\tthis.renderTarget2.setSize( effectiveWidth, effectiveHeight );\n\n\t\tfor ( let i = 0; i < this.passes.length; i ++ ) {\n\n\t\t\tthis.passes[ i ].setSize( effectiveWidth, effectiveHeight );\n\n\t\t}\n\n\t}\n\n\tsetPixelRatio( pixelRatio ) {\n\n\t\tthis._pixelRatio = pixelRatio;\n\n\t\tthis.setSize( this._width, this._height );\n\n\t}\n\n}\n\n\nclass Pass {\n\n\tconstructor() {\n\n\t\t// if set to true, the pass is processed by the composer\n\t\tthis.enabled = true;\n\n\t\t// if set to true, the pass indicates to swap read and write buffer after rendering\n\t\tthis.needsSwap = true;\n\n\t\t// if set to true, the pass clears its buffer before rendering\n\t\tthis.clear = false;\n\n\t\t// if set to true, the result of the pass is rendered to screen. This is set automatically by EffectComposer.\n\t\tthis.renderToScreen = false;\n\n\t}\n\n\tsetSize( /* width, height */ ) {}\n\n\trender( /* renderer, writeBuffer, readBuffer, deltaTime, maskActive */ ) {\n\n\t\tconsole.error( 'THREE.Pass: .render() must be implemented in derived pass.' );\n\n\t}\n\n}\n\n// Helper for passes that need to fill the viewport with a single quad.\n\nconst _camera = new OrthographicCamera( - 1, 1, 1, - 1, 0, 1 );\n\n// https://github.com/mrdoob/three.js/pull/21358\n\nconst _geometry = new BufferGeometry();\n_geometry.setAttribute( 'position', new Float32BufferAttribute( [ - 1, 3, 0, - 1, - 1, 0, 3, - 1, 0 ], 3 ) );\n_geometry.setAttribute( 'uv', new Float32BufferAttribute( [ 0, 2, 0, 0, 2, 0 ], 2 ) );\n\nclass FullScreenQuad {\n\n\tconstructor( material ) {\n\n\t\tthis._mesh = new Mesh( _geometry, material );\n\n\t}\n\n\tdispose() {\n\n\t\tthis._mesh.geometry.dispose();\n\n\t}\n\n\trender( renderer ) {\n\n\t\trenderer.render( this._mesh, _camera );\n\n\t}\n\n\tget material() {\n\n\t\treturn this._mesh.material;\n\n\t}\n\n\tset material( value ) {\n\n\t\tthis._mesh.material = value;\n\n\t}\n\n}\n\nexport { EffectComposer, Pass, FullScreenQuad };\n","import {\n\tAdditiveBlending,\n\tColor,\n\tDoubleSide,\n\tLinearFilter,\n\tMatrix4,\n\tMeshDepthMaterial,\n\tNoBlending,\n\tRGBADepthPacking,\n\tRGBAFormat,\n\tShaderMaterial,\n\tUniformsUtils,\n\tVector2,\n\tVector3,\n\tWebGLRenderTarget\n} from 'three';\nimport { Pass, FullScreenQuad } from './Pass.js';\nimport { CopyShader } from '../shaders/CopyShader.js';\n\nclass OutlinePass extends Pass {\n\n\tconstructor( resolution, scene, camera, selectedObjects ) {\n\n\t\tsuper();\n\n\t\tthis.renderScene = scene;\n\t\tthis.renderCamera = camera;\n\t\tthis.selectedObjects = selectedObjects !== undefined ? selectedObjects : [];\n\t\tthis.visibleEdgeColor = new Color( 1, 1, 1 );\n\t\tthis.hiddenEdgeColor = new Color( 0.1, 0.04, 0.02 );\n\t\tthis.edgeGlow = 0.0;\n\t\tthis.usePatternTexture = false;\n\t\tthis.edgeThickness = 1.0;\n\t\tthis.edgeStrength = 3.0;\n\t\tthis.downSampleRatio = 2;\n\t\tthis.pulsePeriod = 0;\n\n\t\tthis._visibilityCache = new Map();\n\n\n\t\tthis.resolution = ( resolution !== undefined ) ? new Vector2( resolution.x, resolution.y ) : new Vector2( 256, 256 );\n\n\t\tconst pars = { minFilter: LinearFilter, magFilter: LinearFilter, format: RGBAFormat };\n\n\t\tconst resx = Math.round( this.resolution.x / this.downSampleRatio );\n\t\tconst resy = Math.round( this.resolution.y / this.downSampleRatio );\n\n\t\tthis.renderTargetMaskBuffer = new WebGLRenderTarget( this.resolution.x, this.resolution.y, pars );\n\t\tthis.renderTargetMaskBuffer.texture.name = 'OutlinePass.mask';\n\t\tthis.renderTargetMaskBuffer.texture.generateMipmaps = false;\n\n\t\tthis.depthMaterial = new MeshDepthMaterial();\n\t\tthis.depthMaterial.side = DoubleSide;\n\t\tthis.depthMaterial.depthPacking = RGBADepthPacking;\n\t\tthis.depthMaterial.blending = NoBlending;\n\n\t\tthis.prepareMaskMaterial = this.getPrepareMaskMaterial();\n\t\tthis.prepareMaskMaterial.side = DoubleSide;\n\t\tthis.prepareMaskMaterial.fragmentShader = replaceDepthToViewZ( this.prepareMaskMaterial.fragmentShader, this.renderCamera );\n\n\t\tthis.renderTargetDepthBuffer = new WebGLRenderTarget( this.resolution.x, this.resolution.y, pars );\n\t\tthis.renderTargetDepthBuffer.texture.name = 'OutlinePass.depth';\n\t\tthis.renderTargetDepthBuffer.texture.generateMipmaps = false;\n\n\t\tthis.renderTargetMaskDownSampleBuffer = new WebGLRenderTarget( resx, resy, pars );\n\t\tthis.renderTargetMaskDownSampleBuffer.texture.name = 'OutlinePass.depthDownSample';\n\t\tthis.renderTargetMaskDownSampleBuffer.texture.generateMipmaps = false;\n\n\t\tthis.renderTargetBlurBuffer1 = new WebGLRenderTarget( resx, resy, pars );\n\t\tthis.renderTargetBlurBuffer1.texture.name = 'OutlinePass.blur1';\n\t\tthis.renderTargetBlurBuffer1.texture.generateMipmaps = false;\n\t\tthis.renderTargetBlurBuffer2 = new WebGLRenderTarget( Math.round( resx / 2 ), Math.round( resy / 2 ), pars );\n\t\tthis.renderTargetBlurBuffer2.texture.name = 'OutlinePass.blur2';\n\t\tthis.renderTargetBlurBuffer2.texture.generateMipmaps = false;\n\n\t\tthis.edgeDetectionMaterial = this.getEdgeDetectionMaterial();\n\t\tthis.renderTargetEdgeBuffer1 = new WebGLRenderTarget( resx, resy, pars );\n\t\tthis.renderTargetEdgeBuffer1.texture.name = 'OutlinePass.edge1';\n\t\tthis.renderTargetEdgeBuffer1.texture.generateMipmaps = false;\n\t\tthis.renderTargetEdgeBuffer2 = new WebGLRenderTarget( Math.round( resx / 2 ), Math.round( resy / 2 ), pars );\n\t\tthis.renderTargetEdgeBuffer2.texture.name = 'OutlinePass.edge2';\n\t\tthis.renderTargetEdgeBuffer2.texture.generateMipmaps = false;\n\n\t\tconst MAX_EDGE_THICKNESS = 4;\n\t\tconst MAX_EDGE_GLOW = 4;\n\n\t\tthis.separableBlurMaterial1 = this.getSeperableBlurMaterial( MAX_EDGE_THICKNESS );\n\t\tthis.separableBlurMaterial1.uniforms[ 'texSize' ].value.set( resx, resy );\n\t\tthis.separableBlurMaterial1.uniforms[ 'kernelRadius' ].value = 1;\n\t\tthis.separableBlurMaterial2 = this.getSeperableBlurMaterial( MAX_EDGE_GLOW );\n\t\tthis.separableBlurMaterial2.uniforms[ 'texSize' ].value.set( Math.round( resx / 2 ), Math.round( resy / 2 ) );\n\t\tthis.separableBlurMaterial2.uniforms[ 'kernelRadius' ].value = MAX_EDGE_GLOW;\n\n\t\t// Overlay material\n\t\tthis.overlayMaterial = this.getOverlayMaterial();\n\n\t\t// copy material\n\t\tif ( CopyShader === undefined ) console.error( 'THREE.OutlinePass relies on CopyShader' );\n\n\t\tconst copyShader = CopyShader;\n\n\t\tthis.copyUniforms = UniformsUtils.clone( copyShader.uniforms );\n\t\tthis.copyUniforms[ 'opacity' ].value = 1.0;\n\n\t\tthis.materialCopy = new ShaderMaterial( {\n\t\t\tuniforms: this.copyUniforms,\n\t\t\tvertexShader: copyShader.vertexShader,\n\t\t\tfragmentShader: copyShader.fragmentShader,\n\t\t\tblending: NoBlending,\n\t\t\tdepthTest: false,\n\t\t\tdepthWrite: false,\n\t\t\ttransparent: true\n\t\t} );\n\n\t\tthis.enabled = true;\n\t\tthis.needsSwap = false;\n\n\t\tthis._oldClearColor = new Color();\n\t\tthis.oldClearAlpha = 1;\n\n\t\tthis.fsQuad = new FullScreenQuad( null );\n\n\t\tthis.tempPulseColor1 = new Color();\n\t\tthis.tempPulseColor2 = new Color();\n\t\tthis.textureMatrix = new Matrix4();\n\n\t\tfunction replaceDepthToViewZ( string, camera ) {\n\n\t\t\tconst type = camera.isPerspectiveCamera ? 'perspective' : 'orthographic';\n\n\t\t\treturn string.replace( /DEPTH_TO_VIEW_Z/g, type + 'DepthToViewZ' );\n\n\t\t}\n\n\t}\n\n\tdispose() {\n\n\t\tthis.renderTargetMaskBuffer.dispose();\n\t\tthis.renderTargetDepthBuffer.dispose();\n\t\tthis.renderTargetMaskDownSampleBuffer.dispose();\n\t\tthis.renderTargetBlurBuffer1.dispose();\n\t\tthis.renderTargetBlurBuffer2.dispose();\n\t\tthis.renderTargetEdgeBuffer1.dispose();\n\t\tthis.renderTargetEdgeBuffer2.dispose();\n\n\t}\n\n\tsetSize( width, height ) {\n\n\t\tthis.renderTargetMaskBuffer.setSize( width, height );\n\t\tthis.renderTargetDepthBuffer.setSize( width, height );\n\n\t\tlet resx = Math.round( width / this.downSampleRatio );\n\t\tlet resy = Math.round( height / this.downSampleRatio );\n\t\tthis.renderTargetMaskDownSampleBuffer.setSize( resx, resy );\n\t\tthis.renderTargetBlurBuffer1.setSize( resx, resy );\n\t\tthis.renderTargetEdgeBuffer1.setSize( resx, resy );\n\t\tthis.separableBlurMaterial1.uniforms[ 'texSize' ].value.set( resx, resy );\n\n\t\tresx = Math.round( resx / 2 );\n\t\tresy = Math.round( resy / 2 );\n\n\t\tthis.renderTargetBlurBuffer2.setSize( resx, resy );\n\t\tthis.renderTargetEdgeBuffer2.setSize( resx, resy );\n\n\t\tthis.separableBlurMaterial2.uniforms[ 'texSize' ].value.set( resx, resy );\n\n\t}\n\n\tchangeVisibilityOfSelectedObjects( bVisible ) {\n\n\t\tconst cache = this._visibilityCache;\n\n\t\tfunction gatherSelectedMeshesCallBack( object ) {\n\n\t\t\tif ( object.isMesh ) {\n\n\t\t\t\tif ( bVisible === true ) {\n\n\t\t\t\t\tobject.visible = cache.get( object );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tcache.set( object, object.visible );\n\t\t\t\t\tobject.visible = bVisible;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tfor ( let i = 0; i < this.selectedObjects.length; i ++ ) {\n\n\t\t\tconst selectedObject = this.selectedObjects[ i ];\n\t\t\tselectedObject.traverse( gatherSelectedMeshesCallBack );\n\n\t\t}\n\n\t}\n\n\tchangeVisibilityOfNonSelectedObjects( bVisible ) {\n\n\t\tconst cache = this._visibilityCache;\n\t\tconst selectedMeshes = [];\n\n\t\tfunction gatherSelectedMeshesCallBack( object ) {\n\n\t\t\tif ( object.isMesh ) selectedMeshes.push( object );\n\n\t\t}\n\n\t\tfor ( let i = 0; i < this.selectedObjects.length; i ++ ) {\n\n\t\t\tconst selectedObject = this.selectedObjects[ i ];\n\t\t\tselectedObject.traverse( gatherSelectedMeshesCallBack );\n\n\t\t}\n\n\t\tfunction VisibilityChangeCallBack( object ) {\n\n\t\t\tif ( object.isMesh || object.isSprite ) {\n\n\t\t\t\t// only meshes and sprites are supported by OutlinePass\n\n\t\t\t\tlet bFound = false;\n\n\t\t\t\tfor ( let i = 0; i < selectedMeshes.length; i ++ ) {\n\n\t\t\t\t\tconst selectedObjectId = selectedMeshes[ i ].id;\n\n\t\t\t\t\tif ( selectedObjectId === object.id ) {\n\n\t\t\t\t\t\tbFound = true;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tif ( bFound === false ) {\n\n\t\t\t\t\tconst visibility = object.visible;\n\n\t\t\t\t\tif ( bVisible === false || cache.get( object ) === true ) {\n\n\t\t\t\t\t\tobject.visible = bVisible;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tcache.set( object, visibility );\n\n\t\t\t\t}\n\n\t\t\t} else if ( object.isPoints || object.isLine ) {\n\n\t\t\t\t// the visibilty of points and lines is always set to false in order to\n\t\t\t\t// not affect the outline computation\n\n\t\t\t\tif ( bVisible === true ) {\n\n\t\t\t\t\tobject.visible = cache.get( object ); // restore\n\n\t\t\t\t} else {\n\n\t\t\t\t\tcache.set( object, object.visible );\n\t\t\t\t\tobject.visible = bVisible;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tthis.renderScene.traverse( VisibilityChangeCallBack );\n\n\t}\n\n\tupdateTextureMatrix() {\n\n\t\tthis.textureMatrix.set( 0.5, 0.0, 0.0, 0.5,\n\t\t\t0.0, 0.5, 0.0, 0.5,\n\t\t\t0.0, 0.0, 0.5, 0.5,\n\t\t\t0.0, 0.0, 0.0, 1.0 );\n\t\tthis.textureMatrix.multiply( this.renderCamera.projectionMatrix );\n\t\tthis.textureMatrix.multiply( this.renderCamera.matrixWorldInverse );\n\n\t}\n\n\trender( renderer, writeBuffer, readBuffer, deltaTime, maskActive ) {\n\n\t\tif ( this.selectedObjects.length > 0 ) {\n\n\t\t\trenderer.getClearColor( this._oldClearColor );\n\t\t\tthis.oldClearAlpha = renderer.getClearAlpha();\n\t\t\tconst oldAutoClear = renderer.autoClear;\n\n\t\t\trenderer.autoClear = false;\n\n\t\t\tif ( maskActive ) renderer.state.buffers.stencil.setTest( false );\n\n\t\t\trenderer.setClearColor( 0xffffff, 1 );\n\n\t\t\t// Make selected objects invisible\n\t\t\tthis.changeVisibilityOfSelectedObjects( false );\n\n\t\t\tconst currentBackground = this.renderScene.background;\n\t\t\tthis.renderScene.background = null;\n\n\t\t\t// 1. Draw Non Selected objects in the depth buffer\n\t\t\tthis.renderScene.overrideMaterial = this.depthMaterial;\n\t\t\trenderer.setRenderTarget( this.renderTargetDepthBuffer );\n\t\t\trenderer.clear();\n\t\t\trenderer.render( this.renderScene, this.renderCamera );\n\n\t\t\t// Make selected objects visible\n\t\t\tthis.changeVisibilityOfSelectedObjects( true );\n\t\t\tthis._visibilityCache.clear();\n\n\t\t\t// Update Texture Matrix for Depth compare\n\t\t\tthis.updateTextureMatrix();\n\n\t\t\t// Make non selected objects invisible, and draw only the selected objects, by comparing the depth buffer of non selected objects\n\t\t\tthis.changeVisibilityOfNonSelectedObjects( false );\n\t\t\tthis.renderScene.overrideMaterial = this.prepareMaskMaterial;\n\t\t\tthis.prepareMaskMaterial.uniforms[ 'cameraNearFar' ].value.set( this.renderCamera.near, this.renderCamera.far );\n\t\t\tthis.prepareMaskMaterial.uniforms[ 'depthTexture' ].value = this.renderTargetDepthBuffer.texture;\n\t\t\tthis.prepareMaskMaterial.uniforms[ 'textureMatrix' ].value = this.textureMatrix;\n\t\t\trenderer.setRenderTarget( this.renderTargetMaskBuffer );\n\t\t\trenderer.clear();\n\t\t\trenderer.render( this.renderScene, this.renderCamera );\n\t\t\tthis.renderScene.overrideMaterial = null;\n\t\t\tthis.changeVisibilityOfNonSelectedObjects( true );\n\t\t\tthis._visibilityCache.clear();\n\n\t\t\tthis.renderScene.background = currentBackground;\n\n\t\t\t// 2. Downsample to Half resolution\n\t\t\tthis.fsQuad.material = this.materialCopy;\n\t\t\tthis.copyUniforms[ 'tDiffuse' ].value = this.renderTargetMaskBuffer.texture;\n\t\t\trenderer.setRenderTarget( this.renderTargetMaskDownSampleBuffer );\n\t\t\trenderer.clear();\n\t\t\tthis.fsQuad.render( renderer );\n\n\t\t\tthis.tempPulseColor1.copy( this.visibleEdgeColor );\n\t\t\tthis.tempPulseColor2.copy( this.hiddenEdgeColor );\n\n\t\t\tif ( this.pulsePeriod > 0 ) {\n\n\t\t\t\tconst scalar = ( 1 + 0.25 ) / 2 + Math.cos( performance.now() * 0.01 / this.pulsePeriod ) * ( 1.0 - 0.25 ) / 2;\n\t\t\t\tthis.tempPulseColor1.multiplyScalar( scalar );\n\t\t\t\tthis.tempPulseColor2.multiplyScalar( scalar );\n\n\t\t\t}\n\n\t\t\t// 3. Apply Edge Detection Pass\n\t\t\tthis.fsQuad.material = this.edgeDetectionMaterial;\n\t\t\tthis.edgeDetectionMaterial.uniforms[ 'maskTexture' ].value = this.renderTargetMaskDownSampleBuffer.texture;\n\t\t\tthis.edgeDetectionMaterial.uniforms[ 'texSize' ].value.set( this.renderTargetMaskDownSampleBuffer.width, this.renderTargetMaskDownSampleBuffer.height );\n\t\t\tthis.edgeDetectionMaterial.uniforms[ 'visibleEdgeColor' ].value = this.tempPulseColor1;\n\t\t\tthis.edgeDetectionMaterial.uniforms[ 'hiddenEdgeColor' ].value = this.tempPulseColor2;\n\t\t\trenderer.setRenderTarget( this.renderTargetEdgeBuffer1 );\n\t\t\trenderer.clear();\n\t\t\tthis.fsQuad.render( renderer );\n\n\t\t\t// 4. Apply Blur on Half res\n\t\t\tthis.fsQuad.material = this.separableBlurMaterial1;\n\t\t\tthis.separableBlurMaterial1.uniforms[ 'colorTexture' ].value = this.renderTargetEdgeBuffer1.texture;\n\t\t\tthis.separableBlurMaterial1.uniforms[ 'direction' ].value = OutlinePass.BlurDirectionX;\n\t\t\tthis.separableBlurMaterial1.uniforms[ 'kernelRadius' ].value = this.edgeThickness;\n\t\t\trenderer.setRenderTarget( this.renderTargetBlurBuffer1 );\n\t\t\trenderer.clear();\n\t\t\tthis.fsQuad.render( renderer );\n\t\t\tthis.separableBlurMaterial1.uniforms[ 'colorTexture' ].value = this.renderTargetBlurBuffer1.texture;\n\t\t\tthis.separableBlurMaterial1.uniforms[ 'direction' ].value = OutlinePass.BlurDirectionY;\n\t\t\trenderer.setRenderTarget( this.renderTargetEdgeBuffer1 );\n\t\t\trenderer.clear();\n\t\t\tthis.fsQuad.render( renderer );\n\n\t\t\t// Apply Blur on quarter res\n\t\t\tthis.fsQuad.material = this.separableBlurMaterial2;\n\t\t\tthis.separableBlurMaterial2.uniforms[ 'colorTexture' ].value = this.renderTargetEdgeBuffer1.texture;\n\t\t\tthis.separableBlurMaterial2.uniforms[ 'direction' ].value = OutlinePass.BlurDirectionX;\n\t\t\trenderer.setRenderTarget( this.renderTargetBlurBuffer2 );\n\t\t\trenderer.clear();\n\t\t\tthis.fsQuad.render( renderer );\n\t\t\tthis.separableBlurMaterial2.uniforms[ 'colorTexture' ].value = this.renderTargetBlurBuffer2.texture;\n\t\t\tthis.separableBlurMaterial2.uniforms[ 'direction' ].value = OutlinePass.BlurDirectionY;\n\t\t\trenderer.setRenderTarget( this.renderTargetEdgeBuffer2 );\n\t\t\trenderer.clear();\n\t\t\tthis.fsQuad.render( renderer );\n\n\t\t\t// Blend it additively over the input texture\n\t\t\tthis.fsQuad.material = this.overlayMaterial;\n\t\t\tthis.overlayMaterial.uniforms[ 'maskTexture' ].value = this.renderTargetMaskBuffer.texture;\n\t\t\tthis.overlayMaterial.uniforms[ 'edgeTexture1' ].value = this.renderTargetEdgeBuffer1.texture;\n\t\t\tthis.overlayMaterial.uniforms[ 'edgeTexture2' ].value = this.renderTargetEdgeBuffer2.texture;\n\t\t\tthis.overlayMaterial.uniforms[ 'patternTexture' ].value = this.patternTexture;\n\t\t\tthis.overlayMaterial.uniforms[ 'edgeStrength' ].value = this.edgeStrength;\n\t\t\tthis.overlayMaterial.uniforms[ 'edgeGlow' ].value = this.edgeGlow;\n\t\t\tthis.overlayMaterial.uniforms[ 'usePatternTexture' ].value = this.usePatternTexture;\n\n\n\t\t\tif ( maskActive ) renderer.state.buffers.stencil.setTest( true );\n\n\t\t\trenderer.setRenderTarget( readBuffer );\n\t\t\tthis.fsQuad.render( renderer );\n\n\t\t\trenderer.setClearColor( this._oldClearColor, this.oldClearAlpha );\n\t\t\trenderer.autoClear = oldAutoClear;\n\n\t\t}\n\n\t\tif ( this.renderToScreen ) {\n\n\t\t\tthis.fsQuad.material = this.materialCopy;\n\t\t\tthis.copyUniforms[ 'tDiffuse' ].value = readBuffer.texture;\n\t\t\trenderer.setRenderTarget( null );\n\t\t\tthis.fsQuad.render( renderer );\n\n\t\t}\n\n\t}\n\n\tgetPrepareMaskMaterial() {\n\n\t\treturn new ShaderMaterial( {\n\n\t\t\tuniforms: {\n\t\t\t\t'depthTexture': { value: null },\n\t\t\t\t'cameraNearFar': { value: new Vector2( 0.5, 0.5 ) },\n\t\t\t\t'textureMatrix': { value: null }\n\t\t\t},\n\n\t\t\tvertexShader:\n\t\t\t\t`#include <morphtarget_pars_vertex>\n\t\t\t\t#include <skinning_pars_vertex>\n\n\t\t\t\tvarying vec4 projTexCoord;\n\t\t\t\tvarying vec4 vPosition;\n\t\t\t\tuniform mat4 textureMatrix;\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\t#include <skinbase_vertex>\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <morphtarget_vertex>\n\t\t\t\t\t#include <skinning_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t\tvPosition = mvPosition;\n\t\t\t\t\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n\t\t\t\t\tprojTexCoord = textureMatrix * worldPosition;\n\n\t\t\t\t}`,\n\n\t\t\tfragmentShader:\n\t\t\t\t`#include <packing>\n\t\t\t\tvarying vec4 vPosition;\n\t\t\t\tvarying vec4 projTexCoord;\n\t\t\t\tuniform sampler2D depthTexture;\n\t\t\t\tuniform vec2 cameraNearFar;\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tfloat depth = unpackRGBAToDepth(texture2DProj( depthTexture, projTexCoord ));\n\t\t\t\t\tfloat viewZ = - DEPTH_TO_VIEW_Z( depth, cameraNearFar.x, cameraNearFar.y );\n\t\t\t\t\tfloat depthTest = (-vPosition.z > viewZ) ? 1.0 : 0.0;\n\t\t\t\t\tgl_FragColor = vec4(0.0, depthTest, 1.0, 1.0);\n\n\t\t\t\t}`\n\n\t\t} );\n\n\t}\n\n\tgetEdgeDetectionMaterial() {\n\n\t\treturn new ShaderMaterial( {\n\n\t\t\tuniforms: {\n\t\t\t\t'maskTexture': { value: null },\n\t\t\t\t'texSize': { value: new Vector2( 0.5, 0.5 ) },\n\t\t\t\t'visibleEdgeColor': { value: new Vector3( 1.0, 1.0, 1.0 ) },\n\t\t\t\t'hiddenEdgeColor': { value: new Vector3( 1.0, 1.0, 1.0 ) },\n\t\t\t},\n\n\t\t\tvertexShader:\n\t\t\t\t`varying vec2 vUv;\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}`,\n\n\t\t\tfragmentShader:\n\t\t\t\t`varying vec2 vUv;\n\n\t\t\t\tuniform sampler2D maskTexture;\n\t\t\t\tuniform vec2 texSize;\n\t\t\t\tuniform vec3 visibleEdgeColor;\n\t\t\t\tuniform vec3 hiddenEdgeColor;\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\n\t\t\t\t\tvec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);\n\t\t\t\t\tvec4 c1 = texture2D( maskTexture, vUv + uvOffset.xy);\n\t\t\t\t\tvec4 c2 = texture2D( maskTexture, vUv - uvOffset.xy);\n\t\t\t\t\tvec4 c3 = texture2D( maskTexture, vUv + uvOffset.yw);\n\t\t\t\t\tvec4 c4 = texture2D( maskTexture, vUv - uvOffset.yw);\n\t\t\t\t\tfloat diff1 = (c1.r - c2.r)*0.5;\n\t\t\t\t\tfloat diff2 = (c3.r - c4.r)*0.5;\n\t\t\t\t\tfloat d = length( vec2(diff1, diff2) );\n\t\t\t\t\tfloat a1 = min(c1.g, c2.g);\n\t\t\t\t\tfloat a2 = min(c3.g, c4.g);\n\t\t\t\t\tfloat visibilityFactor = min(a1, a2);\n\t\t\t\t\tvec3 edgeColor = 1.0 - visibilityFactor > 0.001 ? visibleEdgeColor : hiddenEdgeColor;\n\t\t\t\t\tgl_FragColor = vec4(edgeColor, 1.0) * vec4(d);\n\t\t\t\t}`\n\t\t} );\n\n\t}\n\n\tgetSeperableBlurMaterial( maxRadius ) {\n\n\t\treturn new ShaderMaterial( {\n\n\t\t\tdefines: {\n\t\t\t\t'MAX_RADIUS': maxRadius,\n\t\t\t},\n\n\t\t\tuniforms: {\n\t\t\t\t'colorTexture': { value: null },\n\t\t\t\t'texSize': { value: new Vector2( 0.5, 0.5 ) },\n\t\t\t\t'direction': { value: new Vector2( 0.5, 0.5 ) },\n\t\t\t\t'kernelRadius': { value: 1.0 }\n\t\t\t},\n\n\t\t\tvertexShader:\n\t\t\t\t`varying vec2 vUv;\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}`,\n\n\t\t\tfragmentShader:\n\t\t\t\t`#include <common>\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 texSize;\n\t\t\t\tuniform vec2 direction;\n\t\t\t\tuniform float kernelRadius;\n\n\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\n\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\n\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, kernelRadius);\n\t\t\t\t\tvec4 diffuseSum = texture2D( colorTexture, vUv) * weightSum;\n\t\t\t\t\tvec2 delta = direction * invSize * kernelRadius/float(MAX_RADIUS);\n\t\t\t\t\tvec2 uvOffset = delta;\n\t\t\t\t\tfor( int i = 1; i <= MAX_RADIUS; i ++ ) {\n\t\t\t\t\t\tfloat w = gaussianPdf(uvOffset.x, kernelRadius);\n\t\t\t\t\t\tvec4 sample1 = texture2D( colorTexture, vUv + uvOffset);\n\t\t\t\t\t\tvec4 sample2 = texture2D( colorTexture, vUv - uvOffset);\n\t\t\t\t\t\tdiffuseSum += ((sample1 + sample2) * w);\n\t\t\t\t\t\tweightSum += (2.0 * w);\n\t\t\t\t\t\tuvOffset += delta;\n\t\t\t\t\t}\n\t\t\t\t\tgl_FragColor = diffuseSum/weightSum;\n\t\t\t\t}`\n\t\t} );\n\n\t}\n\n\tgetOverlayMaterial() {\n\n\t\treturn new ShaderMaterial( {\n\n\t\t\tuniforms: {\n\t\t\t\t'maskTexture': { value: null },\n\t\t\t\t'edgeTexture1': { value: null },\n\t\t\t\t'edgeTexture2': { value: null },\n\t\t\t\t'patternTexture': { value: null },\n\t\t\t\t'edgeStrength': { value: 1.0 },\n\t\t\t\t'edgeGlow': { value: 1.0 },\n\t\t\t\t'usePatternTexture': { value: 0.0 }\n\t\t\t},\n\n\t\t\tvertexShader:\n\t\t\t\t`varying vec2 vUv;\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}`,\n\n\t\t\tfragmentShader:\n\t\t\t\t`varying vec2 vUv;\n\n\t\t\t\tuniform sampler2D maskTexture;\n\t\t\t\tuniform sampler2D edgeTexture1;\n\t\t\t\tuniform sampler2D edgeTexture2;\n\t\t\t\tuniform sampler2D patternTexture;\n\t\t\t\tuniform float edgeStrength;\n\t\t\t\tuniform float edgeGlow;\n\t\t\t\tuniform bool usePatternTexture;\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tvec4 edgeValue1 = texture2D(edgeTexture1, vUv);\n\t\t\t\t\tvec4 edgeValue2 = texture2D(edgeTexture2, vUv);\n\t\t\t\t\tvec4 maskColor = texture2D(maskTexture, vUv);\n\t\t\t\t\tvec4 patternColor = texture2D(patternTexture, 6.0 * vUv);\n\t\t\t\t\tfloat visibilityFactor = 1.0 - maskColor.g > 0.0 ? 1.0 : 0.5;\n\t\t\t\t\tvec4 edgeValue = edgeValue1 + edgeValue2 * edgeGlow;\n\t\t\t\t\tvec4 finalColor = edgeStrength * maskColor.r * edgeValue;\n\t\t\t\t\tif(usePatternTexture)\n\t\t\t\t\t\tfinalColor += + visibilityFactor * (1.0 - maskColor.r) * (1.0 - patternColor.r);\n\t\t\t\t\tgl_FragColor = finalColor;\n\t\t\t\t}`,\n\t\t\tblending: AdditiveBlending,\n\t\t\tdepthTest: false,\n\t\t\tdepthWrite: false,\n\t\t\ttransparent: true\n\t\t} );\n\n\t}\n\n}\n\nOutlinePass.BlurDirectionX = new Vector2( 1.0, 0.0 );\nOutlinePass.BlurDirectionY = new Vector2( 0.0, 1.0 );\n\nexport { OutlinePass };\n","import {\n  AmbientLight,\n  AxesHelper,\n  Curve,\n  DoubleSide,\n  Mesh,\n  MeshBasicMaterial,\n  PerspectiveCamera,\n  Scene,\n  TubeGeometry,\n  Vector3,\n  PlaneGeometry,\n  WebGLRenderer,\n  HemisphereLight,\n  Raycaster,\n  ShaderMaterial,\n  Vector2,\n  BackSide,\n  SphereGeometry,\n  Clock,\n  Color,\n  SpotLight,\n  DirectionalLight\n} from 'three'\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls'\nimport { CSS3DObject, CSS3DRenderer } from 'three/examples/jsm/renderers/CSS3DRenderer'\nimport { TrackballControls } from 'three/examples/jsm/controls/TrackballControls'\nimport { TransformControls } from 'three/examples/jsm/controls/TransformControls'\nimport { Loader3DTiles, PointCloudColoring, type Runtime } from 'three-loader-3dtiles'\nimport { FBXLoader } from 'three/examples/jsm/loaders/FBXLoader'\nimport { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader'\nimport { EffectComposer } from 'three/examples/jsm/postprocessing/EffectComposer'\nimport { OutlinePass } from 'three/examples/jsm/postprocessing/OutlinePass'\n\ntype CameraPosition = {\n  x: number\n  y: number\n  z: number\n}\nclass ThreeInit {\n  // 场景\n  scene!: Scene\n  // 相机\n  camera!: PerspectiveCamera\n  // 相机位置\n  cameraPosition: CameraPosition\n  // 渲染器\n  renderer!: WebGLRenderer\n  // 挂载点\n  dom: HTMLElement\n  // 控制器\n  controls!: OrbitControls\n  // 辅助坐标系\n  axesHelper!: AxesHelper\n  cssObject!: CSS3DObject\n  trackBallControls!: TrackballControls\n  cssRender!: CSS3DRenderer\n  cssScene!: Scene\n  composer!: EffectComposer\n  outlinePass!: OutlinePass\n  tag!: CSS3DObject\n  constructor(position: Vector3, dom: HTMLElement) {\n    this.cameraPosition = { x: position.x, y: position.y, z: position.z }\n    this.dom = dom\n  }\n  // 初始化场景\n  initScene(): void {\n    this.scene = new Scene()\n    this.camera = new PerspectiveCamera(30, window.innerWidth / window.innerHeight, 1, 500000)\n    this.camera.position.set(this.cameraPosition.x, this.cameraPosition.y, this.cameraPosition.z)\n    this.scene.add(this.camera)\n    this.renderer = new WebGLRenderer({\n      alpha: true,\n      antialias: true\n    })\n    this.renderer.setSize(this.dom.offsetWidth + 20, this.dom.offsetHeight)\n    this.renderer.setClearColor(0x000000, 0)\n    this.renderer.setPixelRatio(window.devicePixelRatio)\n    this.renderer.shadowMap.enabled = true\n    this.dom.appendChild(this.renderer.domElement)\n    // this.controls = new OrbitControls(this.camera, this.renderer.domElement);\n    // this.controls.enableZoom = false;\n    this.renderer.render(this.scene, this.camera)\n    this.composer = new EffectComposer(this.renderer)\n    this.scene.background = new Color(0xbfe3dd)\n    window.addEventListener('resize', () => {\n      this.camera.aspect = window.innerWidth / window.innerHeight\n      this.camera.updateProjectionMatrix()\n      this.renderer.setSize(window.innerWidth, window.innerHeight)\n    })\n  }\n  // 开始渲染\n  render(): void {\n    const fn = () => {\n      this.renderer.render(this.scene, this.camera)\n      this.composer.render()\n      requestAnimationFrame(fn)\n    }\n    fn()\n  }\n  // 初始化灯光\n  initLight(): void {\n    const ambientLight: AmbientLight = new AmbientLight(0xffffff, 0.6)\n    this.scene.add(ambientLight)\n    const directionalZPositiveLight = new DirectionalLight(0xffffff, 1)\n    directionalZPositiveLight.position.set(0, 0, -800)\n    this.scene.add(directionalZPositiveLight)\n  }\n  initAxesHelper(size: number) {\n    const axesHelper = new AxesHelper(size)\n    this.scene.add(axesHelper)\n  }\n  skybox() {\n    const vertexShader = `varying vec3 vWorldPosition;\n        void main() {\n            vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n            vWorldPosition = worldPosition.xyz;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }`\n    const fragmentShader = `\n            uniform vec3 topColor;\n            uniform vec3 bottomColor;\n            uniform float offset;\n            uniform float exponent;\n            varying vec3 vWorldPosition;\n            void main() {\n                float h = normalize( vWorldPosition + offset ).y;\n                gl_FragColor = vec4( mix( bottomColor, topColor, max( pow( max( h , 0.0), exponent ), 0.0 ) ), 1.0 );\n            }\n        `\n    // this.scene.background = new Color().setHSL( 0.6, 0, 1 );\n    // this.scene.fog = new Fog( this.scene.background, 1, 5000 );\n\n    this.scene.add(new AmbientLight(0xf0f0f0, 0.5))\n    const light = new SpotLight(0xffffff, 0.5)\n    light.position.set(0, 1500, 200)\n    light.angle = Math.PI * 0.2\n    light.decay = 0\n    light.castShadow = true\n    light.shadow.camera.near = 200\n    light.shadow.camera.far = 2000\n    light.shadow.bias = -0.000222\n    light.shadow.mapSize.width = 1024\n    light.shadow.mapSize.height = 1024\n    this.scene.add(light)\n\n    const planeGeometry = new PlaneGeometry(20000, 20000)\n    planeGeometry.rotateX(-Math.PI / 2)\n    const planeMaterial = new MeshBasicMaterial({ color: 0xf0ead4, opacity: 0.8, side: DoubleSide })\n\n    const plane = new Mesh(planeGeometry, planeMaterial)\n    plane.receiveShadow = true\n    this.scene.add(plane)\n\n    const uniforms = {\n      topColor: { value: new Color(0x0077ff) },\n      bottomColor: { value: new Color(0xffffff) },\n      offset: { value: 33 },\n      exponent: { value: 0.6 }\n    }\n    const hemiLight = new HemisphereLight(0xffffff, 0xffffff, 2)\n    hemiLight.color.setHSL(0.6, 1, 0.6)\n    hemiLight.groundColor.setHSL(0.095, 1, 0.75)\n    hemiLight.position.set(0, 50, 0)\n    // this.scene.add( hemiLight );\n    uniforms['topColor'].value.copy(hemiLight.color)\n\n    // this.scene.fog.color.copy( uniforms[ 'bottomColor' ].value );\n\n    const skyGeo = new SphereGeometry(2000, 32, 15)\n    const skyMat = new ShaderMaterial({\n      uniforms: uniforms,\n      vertexShader: vertexShader,\n      fragmentShader: fragmentShader,\n      side: BackSide\n    })\n\n    const sky = new Mesh(skyGeo, skyMat)\n    // this.scene.add( sky );\n  }\n  css3dRender(element: Array<HTMLElement>) {\n    this.cssScene = new Scene()\n    const cssObject0 = new CSS3DObject(element[0])\n    const cssObject1 = new CSS3DObject(element[1])\n    const cssObject2 = new CSS3DObject(element[2])\n    const cssObject3 = new CSS3DObject(element[3])\n    const cssObject4 = new CSS3DObject(element[4])\n    const cssObject5 = new CSS3DObject(element[5])\n    cssObject0.position.set(-250, 200, 115)\n    cssObject1.position.set(-380, 0, 30)\n    cssObject2.position.set(-220, 0, 30)\n    cssObject3.position.set(-60, 0, 30)\n    cssObject4.position.set(100, 0, 30)\n    cssObject5.position.set(245, 0, -35)\n    cssObject0.rotation.set(-Math.PI / 2, 0, 0)\n    cssObject1.rotation.set(-Math.PI / 2, 0, 0)\n    cssObject2.rotation.set(-Math.PI / 2, 0, 0)\n    cssObject3.rotation.set(-Math.PI / 2, 0, 0)\n    cssObject4.rotation.set(-Math.PI / 2, 0, 0)\n    cssObject5.rotation.set(-Math.PI / 2, 0, 0)\n    cssObject0.scale.set(1, 1, 1)\n    cssObject1.scale.set(1, 1, 1)\n    cssObject2.scale.set(1, 1, 1)\n    this.cssScene.add(cssObject0)\n    this.cssScene.add(cssObject1)\n    this.cssScene.add(cssObject2)\n    this.cssScene.add(cssObject3)\n    this.cssScene.add(cssObject4)\n    this.cssScene.add(cssObject5)\n    this.cssRender = new CSS3DRenderer()\n    this.cssRender.setSize(this.dom.offsetWidth, this.dom.offsetHeight)\n    this.cssRender.domElement.style.position = 'absolute'\n    this.cssRender.domElement.style.top = '0'\n    this.dom.appendChild(this.cssRender.domElement)\n    this.trackBallControls = new TrackballControls(this.camera, this.cssRender.domElement)\n    // this.trackBallControls.noZoom = true\n    const fn = () => {\n      requestAnimationFrame(fn)\n      this.cssRender.render(this.cssScene, this.camera)\n      this.renderer.render(this.scene, this.camera)\n      this.camera.updateMatrixWorld(true)\n      this.trackBallControls.update()\n      this.composer.render()\n    }\n    fn()\n  }\n  tubeGeo() {\n    class CustomCurve extends Curve<any> {\n      scale: number\n      constructor(scale = 1) {\n        super()\n        this.scale = scale\n      }\n      getPoint(t: number, optionalTarget = new Vector3()): any {\n        const tx = t\n        const ty = 0\n        const tz = 4 * t\n        return optionalTarget.set(tx, ty, tz).multiplyScalar(this.scale)\n      }\n    }\n    const path = new CustomCurve(115)\n    const geometry = new TubeGeometry(path, 50, 8, 8, false)\n    const material = new MeshBasicMaterial({\n      color: 0x666666,\n      side: DoubleSide,\n      clipShadows: true\n    })\n    const mesh = new Mesh(geometry, material)\n    mesh.position.set(0, 300, 0)\n    this.scene.add(mesh)\n    const raycaster = new Raycaster()\n    const pointer = new Vector2()\n    const onUpPosition = new Vector2()\n    const onDownPosition = new Vector2()\n    const transformControl = new TransformControls(this.camera, this.renderer.domElement)\n    transformControl.addEventListener('dragging-changed', (event) => {\n      this.controls.enabled = !event.value\n    })\n    this.scene.add(transformControl)\n    const onPointerMove = (event: DocumentEventMap['pointermove']) => {\n      pointer.x = (event.clientX / window.innerWidth) * 2 - 1\n      pointer.y = -(event.clientY / window.innerHeight) * 2 + 1\n\n      raycaster.setFromCamera(pointer, this.camera)\n      const intersects = raycaster.intersectObjects([mesh])\n\n      if (intersects.length > 0) {\n        const object = intersects[0].object\n\n        if (object !== transformControl.object) {\n          this.cssRender.domElement.style.zIndex = '-2'\n          transformControl.attach(object)\n        }\n      }\n    }\n    const onPointerUp = (event: DocumentEventMap['pointerup']) => {\n      onUpPosition.x = event.clientX\n      onUpPosition.y = event.clientY\n      if (onDownPosition.distanceTo(onUpPosition) === 0) {\n        this.cssRender.domElement.style.zIndex = '1'\n        transformControl.detach()\n      }\n    }\n    const onPointerDown = (event: DocumentEventMap['pointerdown']) => {\n      onDownPosition.x = event.clientX\n      onDownPosition.y = event.clientY\n    }\n    document.addEventListener('pointermove', onPointerMove)\n    document.addEventListener('pointerup', onPointerUp)\n    document.addEventListener('pointerdown', onPointerDown)\n    this.renderer.render(this.scene, this.camera)\n    // const fn = () => {\n    //     requestAnimationFrame(fn)\n    // }\n    // fn();\n  }\n  async loadGeo() {\n    const _this = this\n    let tilesRuntime: undefined | Runtime = undefined\n    const result = await Loader3DTiles.load({\n      url: 'http://47.109.18.246:33301/tileset.json',\n      renderer: _this.renderer,\n      options: {\n        dracoDecoderPath: 'https://unpkg.com/three@0.137.0/examples/js/libs/draco',\n        basisTranscoderPath: 'https://unpkg.com/three@0.137.0/examples/js/libs/basis',\n        debug: true,\n        pointCloudColoring: PointCloudColoring.RGB\n      }\n    })\n    const { model, runtime } = result\n    this.scene.add(model)\n    tilesRuntime = runtime\n    const clock = new Clock()\n    model.position.set(0, 100, 0)\n    model.rotation.x = (Math.PI * 3) / 2\n    function render() {\n      const dt = clock.getDelta()\n      if (tilesRuntime) {\n        tilesRuntime.update(dt, _this.renderer, _this.camera)\n      }\n      _this.renderer.render(_this.scene, _this.camera)\n      window.requestAnimationFrame(render)\n    }\n    render()\n  }\n  loadFbxInner(url: string) {\n    const loader = new FBXLoader()\n    loader.load(url, (objects) => {\n      objects.rotation.set(0, Math.PI, 0)\n      objects.scale.set(100, 100, 100)\n      this.scene.add(objects)\n      document.addEventListener('pointerdown', (event) => {\n        const raycaster = new Raycaster()\n        const pointer = new Vector2()\n        pointer.x = (event.clientX / window.innerWidth) * 2 - 1\n        pointer.y = -(event.clientY / window.innerHeight) * 2 + 1\n        raycaster.setFromCamera(pointer, this.camera)\n        const intersects = raycaster.intersectObjects(this.scene.children)\n        if (intersects.length > 0) {\n          const object = intersects[0].object\n          console.log(intersects, 'intersects')\n        }\n      })\n    })\n  }\n  loadFbxTree(url: string) {\n    const loader = new FBXLoader()\n    loader.load(url, (objects) => {\n      console.log(objects, 'objects')\n      objects.traverse((object) => {\n        console.log(object, 'object')\n      })\n      this.scene.add(objects)\n    })\n  }\n  loadGlb(\n    url: string,\n    position?: [x: number, y: number, z: number],\n    scale?: [x: number, y: number, z: number]\n  ) {\n    const gltfLoader = new GLTFLoader()\n    gltfLoader.load(url, (gltf) => {\n      const model = gltf.scene\n      scale && model.scale.set(...scale)\n      position && model.position.set(...position)\n      model.traverse((object) => {})\n      this.scene.add(gltf.scene)\n    })\n  }\n}\n\nexport default ThreeInit\n","import {\n\tColor\n} from 'three';\nimport { Pass } from './Pass.js';\n\nclass RenderPass extends Pass {\n\n\tconstructor( scene, camera, overrideMaterial, clearColor, clearAlpha ) {\n\n\t\tsuper();\n\n\t\tthis.scene = scene;\n\t\tthis.camera = camera;\n\n\t\tthis.overrideMaterial = overrideMaterial;\n\n\t\tthis.clearColor = clearColor;\n\t\tthis.clearAlpha = ( clearAlpha !== undefined ) ? clearAlpha : 0;\n\n\t\tthis.clear = true;\n\t\tthis.clearDepth = false;\n\t\tthis.needsSwap = false;\n\t\tthis._oldClearColor = new Color();\n\n\t}\n\n\trender( renderer, writeBuffer, readBuffer /*, deltaTime, maskActive */ ) {\n\n\t\tconst oldAutoClear = renderer.autoClear;\n\t\trenderer.autoClear = false;\n\n\t\tlet oldClearAlpha, oldOverrideMaterial;\n\n\t\tif ( this.overrideMaterial !== undefined ) {\n\n\t\t\toldOverrideMaterial = this.scene.overrideMaterial;\n\n\t\t\tthis.scene.overrideMaterial = this.overrideMaterial;\n\n\t\t}\n\n\t\tif ( this.clearColor ) {\n\n\t\t\trenderer.getClearColor( this._oldClearColor );\n\t\t\toldClearAlpha = renderer.getClearAlpha();\n\n\t\t\trenderer.setClearColor( this.clearColor, this.clearAlpha );\n\n\t\t}\n\n\t\tif ( this.clearDepth ) {\n\n\t\t\trenderer.clearDepth();\n\n\t\t}\n\n\t\trenderer.setRenderTarget( this.renderToScreen ? null : readBuffer );\n\n\t\t// TODO: Avoid using autoClear properties, see https://github.com/mrdoob/three.js/pull/15571#issuecomment-465669600\n\t\tif ( this.clear ) renderer.clear( renderer.autoClearColor, renderer.autoClearDepth, renderer.autoClearStencil );\n\t\trenderer.render( this.scene, this.camera );\n\n\t\tif ( this.clearColor ) {\n\n\t\t\trenderer.setClearColor( this._oldClearColor, oldClearAlpha );\n\n\t\t}\n\n\t\tif ( this.overrideMaterial !== undefined ) {\n\n\t\t\tthis.scene.overrideMaterial = oldOverrideMaterial;\n\n\t\t}\n\n\t\trenderer.autoClear = oldAutoClear;\n\n\t}\n\n}\n\nexport { RenderPass };\n","import {\n\tVector2\n} from 'three';\n\n/**\n * NVIDIA FXAA by Timothy Lottes\n * https://developer.download.nvidia.com/assets/gamedev/files/sdk/11/FXAA_WhitePaper.pdf\n * - WebGL port by @supereggbert\n * http://www.glge.org/demos/fxaa/\n */\n\nconst FXAAShader = {\n\n\tuniforms: {\n\n\t\t'tDiffuse': { value: null },\n\t\t'resolution': { value: new Vector2( 1 / 1024, 1 / 512 ) }\n\n\t},\n\n\tvertexShader: /* glsl */`\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}`,\n\n\tfragmentShader:\n\n\t// FXAA 3.11 implementation by NVIDIA, ported to WebGL by Agost Biro (biro@archilogic.com)\n\n\t//----------------------------------------------------------------------------------\n\t// File:\t\t\t\tes3-kepler\\FXAA\\assets\\shaders/FXAA_DefaultES.frag\n\t// SDK Version: v3.00\n\t// Email:\t\t\t gameworks@nvidia.com\n\t// Site:\t\t\t\thttp://developer.nvidia.com/\n\t//\n\t// Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.\n\t//\n\t// Redistribution and use in source and binary forms, with or without\n\t// modification, are permitted provided that the following conditions\n\t// are met:\n\t//\t* Redistributions of source code must retain the above copyright\n\t//\t\tnotice, this list of conditions and the following disclaimer.\n\t//\t* Redistributions in binary form must reproduce the above copyright\n\t//\t\tnotice, this list of conditions and the following disclaimer in the\n\t//\t\tdocumentation and/or other materials provided with the distribution.\n\t//\t* Neither the name of NVIDIA CORPORATION nor the names of its\n\t//\t\tcontributors may be used to endorse or promote products derived\n\t//\t\tfrom this software without specific prior written permission.\n\t//\n\t// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ``AS IS\\'\\' AND ANY\n\t// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n\t// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR\n\t// PURPOSE ARE DISCLAIMED.\tIN NO EVENT SHALL THE COPYRIGHT OWNER OR\n\t// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,\n\t// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,\n\t// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n\t// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY\n\t// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n\t// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n\t// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n\t//\n\t//----------------------------------------------------------------------------------\n\n\t/* glsl */`\n\n\t\tprecision highp float;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tuniform vec2 resolution;\n\n\t\tvarying vec2 vUv;\n\n\t\t#define FXAA_PC 1\n\t\t#define FXAA_GLSL_100 1\n\t\t#define FXAA_QUALITY_PRESET 12\n\n\t\t#define FXAA_GREEN_AS_LUMA 1\n\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_PC_CONSOLE\n\t\t\t\t//\n\t\t\t\t// The console algorithm for PC is included\n\t\t\t\t// for developers targeting really low spec machines.\n\t\t\t\t// Likely better to just run FXAA_PC, and use a really low preset.\n\t\t\t\t//\n\t\t\t\t#define FXAA_PC_CONSOLE 0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_GLSL_120\n\t\t\t\t#define FXAA_GLSL_120 0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_GLSL_130\n\t\t\t\t#define FXAA_GLSL_130 0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_HLSL_3\n\t\t\t\t#define FXAA_HLSL_3 0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_HLSL_4\n\t\t\t\t#define FXAA_HLSL_4 0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_HLSL_5\n\t\t\t\t#define FXAA_HLSL_5 0\n\t\t#endif\n\t\t/*==========================================================================*/\n\t\t#ifndef FXAA_GREEN_AS_LUMA\n\t\t\t\t//\n\t\t\t\t// For those using non-linear color,\n\t\t\t\t// and either not able to get luma in alpha, or not wanting to,\n\t\t\t\t// this enables FXAA to run using green as a proxy for luma.\n\t\t\t\t// So with this enabled, no need to pack luma in alpha.\n\t\t\t\t//\n\t\t\t\t// This will turn off AA on anything which lacks some amount of green.\n\t\t\t\t// Pure red and blue or combination of only R and B, will get no AA.\n\t\t\t\t//\n\t\t\t\t// Might want to lower the settings for both,\n\t\t\t\t//\t\tfxaaConsoleEdgeThresholdMin\n\t\t\t\t//\t\tfxaaQualityEdgeThresholdMin\n\t\t\t\t// In order to insure AA does not get turned off on colors\n\t\t\t\t// which contain a minor amount of green.\n\t\t\t\t//\n\t\t\t\t// 1 = On.\n\t\t\t\t// 0 = Off.\n\t\t\t\t//\n\t\t\t\t#define FXAA_GREEN_AS_LUMA 0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_EARLY_EXIT\n\t\t\t\t//\n\t\t\t\t// Controls algorithm\\'s early exit path.\n\t\t\t\t// On PS3 turning this ON adds 2 cycles to the shader.\n\t\t\t\t// On 360 turning this OFF adds 10ths of a millisecond to the shader.\n\t\t\t\t// Turning this off on console will result in a more blurry image.\n\t\t\t\t// So this defaults to on.\n\t\t\t\t//\n\t\t\t\t// 1 = On.\n\t\t\t\t// 0 = Off.\n\t\t\t\t//\n\t\t\t\t#define FXAA_EARLY_EXIT 1\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_DISCARD\n\t\t\t\t//\n\t\t\t\t// Only valid for PC OpenGL currently.\n\t\t\t\t// Probably will not work when FXAA_GREEN_AS_LUMA = 1.\n\t\t\t\t//\n\t\t\t\t// 1 = Use discard on pixels which don\\'t need AA.\n\t\t\t\t//\t\t For APIs which enable concurrent TEX+ROP from same surface.\n\t\t\t\t// 0 = Return unchanged color on pixels which don\\'t need AA.\n\t\t\t\t//\n\t\t\t\t#define FXAA_DISCARD 0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_FAST_PIXEL_OFFSET\n\t\t\t\t//\n\t\t\t\t// Used for GLSL 120 only.\n\t\t\t\t//\n\t\t\t\t// 1 = GL API supports fast pixel offsets\n\t\t\t\t// 0 = do not use fast pixel offsets\n\t\t\t\t//\n\t\t\t\t#ifdef GL_EXT_gpu_shader4\n\t\t\t\t\t\t#define FXAA_FAST_PIXEL_OFFSET 1\n\t\t\t\t#endif\n\t\t\t\t#ifdef GL_NV_gpu_shader5\n\t\t\t\t\t\t#define FXAA_FAST_PIXEL_OFFSET 1\n\t\t\t\t#endif\n\t\t\t\t#ifdef GL_ARB_gpu_shader5\n\t\t\t\t\t\t#define FXAA_FAST_PIXEL_OFFSET 1\n\t\t\t\t#endif\n\t\t\t\t#ifndef FXAA_FAST_PIXEL_OFFSET\n\t\t\t\t\t\t#define FXAA_FAST_PIXEL_OFFSET 0\n\t\t\t\t#endif\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_GATHER4_ALPHA\n\t\t\t\t//\n\t\t\t\t// 1 = API supports gather4 on alpha channel.\n\t\t\t\t// 0 = API does not support gather4 on alpha channel.\n\t\t\t\t//\n\t\t\t\t#if (FXAA_HLSL_5 == 1)\n\t\t\t\t\t\t#define FXAA_GATHER4_ALPHA 1\n\t\t\t\t#endif\n\t\t\t\t#ifdef GL_ARB_gpu_shader5\n\t\t\t\t\t\t#define FXAA_GATHER4_ALPHA 1\n\t\t\t\t#endif\n\t\t\t\t#ifdef GL_NV_gpu_shader5\n\t\t\t\t\t\t#define FXAA_GATHER4_ALPHA 1\n\t\t\t\t#endif\n\t\t\t\t#ifndef FXAA_GATHER4_ALPHA\n\t\t\t\t\t\t#define FXAA_GATHER4_ALPHA 0\n\t\t\t\t#endif\n\t\t#endif\n\n\n\t\t/*============================================================================\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tFXAA QUALITY - TUNING KNOBS\n\t\t------------------------------------------------------------------------------\n\t\tNOTE the other tuning knobs are now in the shader function inputs!\n\t\t============================================================================*/\n\t\t#ifndef FXAA_QUALITY_PRESET\n\t\t\t\t//\n\t\t\t\t// Choose the quality preset.\n\t\t\t\t// This needs to be compiled into the shader as it effects code.\n\t\t\t\t// Best option to include multiple presets is to\n\t\t\t\t// in each shader define the preset, then include this file.\n\t\t\t\t//\n\t\t\t\t// OPTIONS\n\t\t\t\t// -----------------------------------------------------------------------\n\t\t\t\t// 10 to 15 - default medium dither (10=fastest, 15=highest quality)\n\t\t\t\t// 20 to 29 - less dither, more expensive (20=fastest, 29=highest quality)\n\t\t\t\t// 39\t\t\t - no dither, very expensive\n\t\t\t\t//\n\t\t\t\t// NOTES\n\t\t\t\t// -----------------------------------------------------------------------\n\t\t\t\t// 12 = slightly faster then FXAA 3.9 and higher edge quality (default)\n\t\t\t\t// 13 = about same speed as FXAA 3.9 and better than 12\n\t\t\t\t// 23 = closest to FXAA 3.9 visually and performance wise\n\t\t\t\t//\t_ = the lowest digit is directly related to performance\n\t\t\t\t// _\t= the highest digit is directly related to style\n\t\t\t\t//\n\t\t\t\t#define FXAA_QUALITY_PRESET 12\n\t\t#endif\n\n\n\t\t/*============================================================================\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t FXAA QUALITY - PRESETS\n\n\t\t============================================================================*/\n\n\t\t/*============================================================================\n\t\t\t\t\t\t\t\t\t\t\t\t FXAA QUALITY - MEDIUM DITHER PRESETS\n\t\t============================================================================*/\n\t\t#if (FXAA_QUALITY_PRESET == 10)\n\t\t\t\t#define FXAA_QUALITY_PS 3\n\t\t\t\t#define FXAA_QUALITY_P0 1.5\n\t\t\t\t#define FXAA_QUALITY_P1 3.0\n\t\t\t\t#define FXAA_QUALITY_P2 12.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 11)\n\t\t\t\t#define FXAA_QUALITY_PS 4\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 3.0\n\t\t\t\t#define FXAA_QUALITY_P3 12.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 12)\n\t\t\t\t#define FXAA_QUALITY_PS 5\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 4.0\n\t\t\t\t#define FXAA_QUALITY_P4 12.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 13)\n\t\t\t\t#define FXAA_QUALITY_PS 6\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 4.0\n\t\t\t\t#define FXAA_QUALITY_P5 12.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 14)\n\t\t\t\t#define FXAA_QUALITY_PS 7\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 4.0\n\t\t\t\t#define FXAA_QUALITY_P6 12.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 15)\n\t\t\t\t#define FXAA_QUALITY_PS 8\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 2.0\n\t\t\t\t#define FXAA_QUALITY_P6 4.0\n\t\t\t\t#define FXAA_QUALITY_P7 12.0\n\t\t#endif\n\n\t\t/*============================================================================\n\t\t\t\t\t\t\t\t\t\t\t\t FXAA QUALITY - LOW DITHER PRESETS\n\t\t============================================================================*/\n\t\t#if (FXAA_QUALITY_PRESET == 20)\n\t\t\t\t#define FXAA_QUALITY_PS 3\n\t\t\t\t#define FXAA_QUALITY_P0 1.5\n\t\t\t\t#define FXAA_QUALITY_P1 2.0\n\t\t\t\t#define FXAA_QUALITY_P2 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 21)\n\t\t\t\t#define FXAA_QUALITY_PS 4\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 22)\n\t\t\t\t#define FXAA_QUALITY_PS 5\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 23)\n\t\t\t\t#define FXAA_QUALITY_PS 6\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 24)\n\t\t\t\t#define FXAA_QUALITY_PS 7\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 3.0\n\t\t\t\t#define FXAA_QUALITY_P6 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 25)\n\t\t\t\t#define FXAA_QUALITY_PS 8\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 2.0\n\t\t\t\t#define FXAA_QUALITY_P6 4.0\n\t\t\t\t#define FXAA_QUALITY_P7 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 26)\n\t\t\t\t#define FXAA_QUALITY_PS 9\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 2.0\n\t\t\t\t#define FXAA_QUALITY_P6 2.0\n\t\t\t\t#define FXAA_QUALITY_P7 4.0\n\t\t\t\t#define FXAA_QUALITY_P8 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 27)\n\t\t\t\t#define FXAA_QUALITY_PS 10\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 2.0\n\t\t\t\t#define FXAA_QUALITY_P6 2.0\n\t\t\t\t#define FXAA_QUALITY_P7 2.0\n\t\t\t\t#define FXAA_QUALITY_P8 4.0\n\t\t\t\t#define FXAA_QUALITY_P9 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 28)\n\t\t\t\t#define FXAA_QUALITY_PS 11\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 2.0\n\t\t\t\t#define FXAA_QUALITY_P6 2.0\n\t\t\t\t#define FXAA_QUALITY_P7 2.0\n\t\t\t\t#define FXAA_QUALITY_P8 2.0\n\t\t\t\t#define FXAA_QUALITY_P9 4.0\n\t\t\t\t#define FXAA_QUALITY_P10 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 29)\n\t\t\t\t#define FXAA_QUALITY_PS 12\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 2.0\n\t\t\t\t#define FXAA_QUALITY_P6 2.0\n\t\t\t\t#define FXAA_QUALITY_P7 2.0\n\t\t\t\t#define FXAA_QUALITY_P8 2.0\n\t\t\t\t#define FXAA_QUALITY_P9 2.0\n\t\t\t\t#define FXAA_QUALITY_P10 4.0\n\t\t\t\t#define FXAA_QUALITY_P11 8.0\n\t\t#endif\n\n\t\t/*============================================================================\n\t\t\t\t\t\t\t\t\t\t\t\t FXAA QUALITY - EXTREME QUALITY\n\t\t============================================================================*/\n\t\t#if (FXAA_QUALITY_PRESET == 39)\n\t\t\t\t#define FXAA_QUALITY_PS 12\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.0\n\t\t\t\t#define FXAA_QUALITY_P2 1.0\n\t\t\t\t#define FXAA_QUALITY_P3 1.0\n\t\t\t\t#define FXAA_QUALITY_P4 1.0\n\t\t\t\t#define FXAA_QUALITY_P5 1.5\n\t\t\t\t#define FXAA_QUALITY_P6 2.0\n\t\t\t\t#define FXAA_QUALITY_P7 2.0\n\t\t\t\t#define FXAA_QUALITY_P8 2.0\n\t\t\t\t#define FXAA_QUALITY_P9 2.0\n\t\t\t\t#define FXAA_QUALITY_P10 4.0\n\t\t\t\t#define FXAA_QUALITY_P11 8.0\n\t\t#endif\n\n\n\n\t\t/*============================================================================\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAPI PORTING\n\n\t\t============================================================================*/\n\t\t#if (FXAA_GLSL_100 == 1) || (FXAA_GLSL_120 == 1) || (FXAA_GLSL_130 == 1)\n\t\t\t\t#define FxaaBool bool\n\t\t\t\t#define FxaaDiscard discard\n\t\t\t\t#define FxaaFloat float\n\t\t\t\t#define FxaaFloat2 vec2\n\t\t\t\t#define FxaaFloat3 vec3\n\t\t\t\t#define FxaaFloat4 vec4\n\t\t\t\t#define FxaaHalf float\n\t\t\t\t#define FxaaHalf2 vec2\n\t\t\t\t#define FxaaHalf3 vec3\n\t\t\t\t#define FxaaHalf4 vec4\n\t\t\t\t#define FxaaInt2 ivec2\n\t\t\t\t#define FxaaSat(x) clamp(x, 0.0, 1.0)\n\t\t\t\t#define FxaaTex sampler2D\n\t\t#else\n\t\t\t\t#define FxaaBool bool\n\t\t\t\t#define FxaaDiscard clip(-1)\n\t\t\t\t#define FxaaFloat float\n\t\t\t\t#define FxaaFloat2 float2\n\t\t\t\t#define FxaaFloat3 float3\n\t\t\t\t#define FxaaFloat4 float4\n\t\t\t\t#define FxaaHalf half\n\t\t\t\t#define FxaaHalf2 half2\n\t\t\t\t#define FxaaHalf3 half3\n\t\t\t\t#define FxaaHalf4 half4\n\t\t\t\t#define FxaaSat(x) saturate(x)\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_GLSL_100 == 1)\n\t\t\t#define FxaaTexTop(t, p) texture2D(t, p, 0.0)\n\t\t\t#define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), 0.0)\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_GLSL_120 == 1)\n\t\t\t\t// Requires,\n\t\t\t\t//\t#version 120\n\t\t\t\t// And at least,\n\t\t\t\t//\t#extension GL_EXT_gpu_shader4 : enable\n\t\t\t\t//\t(or set FXAA_FAST_PIXEL_OFFSET 1 to work like DX9)\n\t\t\t\t#define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)\n\t\t\t\t#if (FXAA_FAST_PIXEL_OFFSET == 1)\n\t\t\t\t\t\t#define FxaaTexOff(t, p, o, r) texture2DLodOffset(t, p, 0.0, o)\n\t\t\t\t#else\n\t\t\t\t\t\t#define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)\n\t\t\t\t#endif\n\t\t\t\t#if (FXAA_GATHER4_ALPHA == 1)\n\t\t\t\t\t\t// use #extension GL_ARB_gpu_shader5 : enable\n\t\t\t\t\t\t#define FxaaTexAlpha4(t, p) textureGather(t, p, 3)\n\t\t\t\t\t\t#define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)\n\t\t\t\t\t\t#define FxaaTexGreen4(t, p) textureGather(t, p, 1)\n\t\t\t\t\t\t#define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)\n\t\t\t\t#endif\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_GLSL_130 == 1)\n\t\t\t\t// Requires \"#version 130\" or better\n\t\t\t\t#define FxaaTexTop(t, p) textureLod(t, p, 0.0)\n\t\t\t\t#define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)\n\t\t\t\t#if (FXAA_GATHER4_ALPHA == 1)\n\t\t\t\t\t\t// use #extension GL_ARB_gpu_shader5 : enable\n\t\t\t\t\t\t#define FxaaTexAlpha4(t, p) textureGather(t, p, 3)\n\t\t\t\t\t\t#define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)\n\t\t\t\t\t\t#define FxaaTexGreen4(t, p) textureGather(t, p, 1)\n\t\t\t\t\t\t#define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)\n\t\t\t\t#endif\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_HLSL_3 == 1)\n\t\t\t\t#define FxaaInt2 float2\n\t\t\t\t#define FxaaTex sampler2D\n\t\t\t\t#define FxaaTexTop(t, p) tex2Dlod(t, float4(p, 0.0, 0.0))\n\t\t\t\t#define FxaaTexOff(t, p, o, r) tex2Dlod(t, float4(p + (o * r), 0, 0))\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_HLSL_4 == 1)\n\t\t\t\t#define FxaaInt2 int2\n\t\t\t\tstruct FxaaTex { SamplerState smpl; Texture2D tex; };\n\t\t\t\t#define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)\n\t\t\t\t#define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_HLSL_5 == 1)\n\t\t\t\t#define FxaaInt2 int2\n\t\t\t\tstruct FxaaTex { SamplerState smpl; Texture2D tex; };\n\t\t\t\t#define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)\n\t\t\t\t#define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)\n\t\t\t\t#define FxaaTexAlpha4(t, p) t.tex.GatherAlpha(t.smpl, p)\n\t\t\t\t#define FxaaTexOffAlpha4(t, p, o) t.tex.GatherAlpha(t.smpl, p, o)\n\t\t\t\t#define FxaaTexGreen4(t, p) t.tex.GatherGreen(t.smpl, p)\n\t\t\t\t#define FxaaTexOffGreen4(t, p, o) t.tex.GatherGreen(t.smpl, p, o)\n\t\t#endif\n\n\n\t\t/*============================================================================\n\t\t\t\t\t\t\t\t\t\t\t GREEN AS LUMA OPTION SUPPORT FUNCTION\n\t\t============================================================================*/\n\t\t#if (FXAA_GREEN_AS_LUMA == 0)\n\t\t\t\tFxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.w; }\n\t\t#else\n\t\t\t\tFxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }\n\t\t#endif\n\n\n\n\n\t\t/*============================================================================\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t FXAA3 QUALITY - PC\n\n\t\t============================================================================*/\n\t\t#if (FXAA_PC == 1)\n\t\t/*--------------------------------------------------------------------------*/\n\t\tFxaaFloat4 FxaaPixelShader(\n\t\t\t\t//\n\t\t\t\t// Use noperspective interpolation here (turn off perspective interpolation).\n\t\t\t\t// {xy} = center of pixel\n\t\t\t\tFxaaFloat2 pos,\n\t\t\t\t//\n\t\t\t\t// Used only for FXAA Console, and not used on the 360 version.\n\t\t\t\t// Use noperspective interpolation here (turn off perspective interpolation).\n\t\t\t\t// {xy_} = upper left of pixel\n\t\t\t\t// {_zw} = lower right of pixel\n\t\t\t\tFxaaFloat4 fxaaConsolePosPos,\n\t\t\t\t//\n\t\t\t\t// Input color texture.\n\t\t\t\t// {rgb_} = color in linear or perceptual color space\n\t\t\t\t// if (FXAA_GREEN_AS_LUMA == 0)\n\t\t\t\t//\t\t {__a} = luma in perceptual color space (not linear)\n\t\t\t\tFxaaTex tex,\n\t\t\t\t//\n\t\t\t\t// Only used on the optimized 360 version of FXAA Console.\n\t\t\t\t// For everything but 360, just use the same input here as for \"tex\".\n\t\t\t\t// For 360, same texture, just alias with a 2nd sampler.\n\t\t\t\t// This sampler needs to have an exponent bias of -1.\n\t\t\t\tFxaaTex fxaaConsole360TexExpBiasNegOne,\n\t\t\t\t//\n\t\t\t\t// Only used on the optimized 360 version of FXAA Console.\n\t\t\t\t// For everything but 360, just use the same input here as for \"tex\".\n\t\t\t\t// For 360, same texture, just alias with a 3nd sampler.\n\t\t\t\t// This sampler needs to have an exponent bias of -2.\n\t\t\t\tFxaaTex fxaaConsole360TexExpBiasNegTwo,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Quality.\n\t\t\t\t// This must be from a constant/uniform.\n\t\t\t\t// {x_} = 1.0/screenWidthInPixels\n\t\t\t\t// {_y} = 1.0/screenHeightInPixels\n\t\t\t\tFxaaFloat2 fxaaQualityRcpFrame,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Console.\n\t\t\t\t// This must be from a constant/uniform.\n\t\t\t\t// This effects sub-pixel AA quality and inversely sharpness.\n\t\t\t\t//\t Where N ranges between,\n\t\t\t\t//\t\t N = 0.50 (default)\n\t\t\t\t//\t\t N = 0.33 (sharper)\n\t\t\t\t// {x__} = -N/screenWidthInPixels\n\t\t\t\t// {_y_} = -N/screenHeightInPixels\n\t\t\t\t// {_z_} =\tN/screenWidthInPixels\n\t\t\t\t// {__w} =\tN/screenHeightInPixels\n\t\t\t\tFxaaFloat4 fxaaConsoleRcpFrameOpt,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Console.\n\t\t\t\t// Not used on 360, but used on PS3 and PC.\n\t\t\t\t// This must be from a constant/uniform.\n\t\t\t\t// {x__} = -2.0/screenWidthInPixels\n\t\t\t\t// {_y_} = -2.0/screenHeightInPixels\n\t\t\t\t// {_z_} =\t2.0/screenWidthInPixels\n\t\t\t\t// {__w} =\t2.0/screenHeightInPixels\n\t\t\t\tFxaaFloat4 fxaaConsoleRcpFrameOpt2,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Console.\n\t\t\t\t// Only used on 360 in place of fxaaConsoleRcpFrameOpt2.\n\t\t\t\t// This must be from a constant/uniform.\n\t\t\t\t// {x__} =\t8.0/screenWidthInPixels\n\t\t\t\t// {_y_} =\t8.0/screenHeightInPixels\n\t\t\t\t// {_z_} = -4.0/screenWidthInPixels\n\t\t\t\t// {__w} = -4.0/screenHeightInPixels\n\t\t\t\tFxaaFloat4 fxaaConsole360RcpFrameOpt2,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Quality.\n\t\t\t\t// This used to be the FXAA_QUALITY_SUBPIX define.\n\t\t\t\t// It is here now to allow easier tuning.\n\t\t\t\t// Choose the amount of sub-pixel aliasing removal.\n\t\t\t\t// This can effect sharpness.\n\t\t\t\t//\t 1.00 - upper limit (softer)\n\t\t\t\t//\t 0.75 - default amount of filtering\n\t\t\t\t//\t 0.50 - lower limit (sharper, less sub-pixel aliasing removal)\n\t\t\t\t//\t 0.25 - almost off\n\t\t\t\t//\t 0.00 - completely off\n\t\t\t\tFxaaFloat fxaaQualitySubpix,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Quality.\n\t\t\t\t// This used to be the FXAA_QUALITY_EDGE_THRESHOLD define.\n\t\t\t\t// It is here now to allow easier tuning.\n\t\t\t\t// The minimum amount of local contrast required to apply algorithm.\n\t\t\t\t//\t 0.333 - too little (faster)\n\t\t\t\t//\t 0.250 - low quality\n\t\t\t\t//\t 0.166 - default\n\t\t\t\t//\t 0.125 - high quality\n\t\t\t\t//\t 0.063 - overkill (slower)\n\t\t\t\tFxaaFloat fxaaQualityEdgeThreshold,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Quality.\n\t\t\t\t// This used to be the FXAA_QUALITY_EDGE_THRESHOLD_MIN define.\n\t\t\t\t// It is here now to allow easier tuning.\n\t\t\t\t// Trims the algorithm from processing darks.\n\t\t\t\t//\t 0.0833 - upper limit (default, the start of visible unfiltered edges)\n\t\t\t\t//\t 0.0625 - high quality (faster)\n\t\t\t\t//\t 0.0312 - visible limit (slower)\n\t\t\t\t// Special notes when using FXAA_GREEN_AS_LUMA,\n\t\t\t\t//\t Likely want to set this to zero.\n\t\t\t\t//\t As colors that are mostly not-green\n\t\t\t\t//\t will appear very dark in the green channel!\n\t\t\t\t//\t Tune by looking at mostly non-green content,\n\t\t\t\t//\t then start at zero and increase until aliasing is a problem.\n\t\t\t\tFxaaFloat fxaaQualityEdgeThresholdMin,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Console.\n\t\t\t\t// This used to be the FXAA_CONSOLE_EDGE_SHARPNESS define.\n\t\t\t\t// It is here now to allow easier tuning.\n\t\t\t\t// This does not effect PS3, as this needs to be compiled in.\n\t\t\t\t//\t Use FXAA_CONSOLE_PS3_EDGE_SHARPNESS for PS3.\n\t\t\t\t//\t Due to the PS3 being ALU bound,\n\t\t\t\t//\t there are only three safe values here: 2 and 4 and 8.\n\t\t\t\t//\t These options use the shaders ability to a free *|/ by 2|4|8.\n\t\t\t\t// For all other platforms can be a non-power of two.\n\t\t\t\t//\t 8.0 is sharper (default!!!)\n\t\t\t\t//\t 4.0 is softer\n\t\t\t\t//\t 2.0 is really soft (good only for vector graphics inputs)\n\t\t\t\tFxaaFloat fxaaConsoleEdgeSharpness,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Console.\n\t\t\t\t// This used to be the FXAA_CONSOLE_EDGE_THRESHOLD define.\n\t\t\t\t// It is here now to allow easier tuning.\n\t\t\t\t// This does not effect PS3, as this needs to be compiled in.\n\t\t\t\t//\t Use FXAA_CONSOLE_PS3_EDGE_THRESHOLD for PS3.\n\t\t\t\t//\t Due to the PS3 being ALU bound,\n\t\t\t\t//\t there are only two safe values here: 1/4 and 1/8.\n\t\t\t\t//\t These options use the shaders ability to a free *|/ by 2|4|8.\n\t\t\t\t// The console setting has a different mapping than the quality setting.\n\t\t\t\t// Other platforms can use other values.\n\t\t\t\t//\t 0.125 leaves less aliasing, but is softer (default!!!)\n\t\t\t\t//\t 0.25 leaves more aliasing, and is sharper\n\t\t\t\tFxaaFloat fxaaConsoleEdgeThreshold,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Console.\n\t\t\t\t// This used to be the FXAA_CONSOLE_EDGE_THRESHOLD_MIN define.\n\t\t\t\t// It is here now to allow easier tuning.\n\t\t\t\t// Trims the algorithm from processing darks.\n\t\t\t\t// The console setting has a different mapping than the quality setting.\n\t\t\t\t// This only applies when FXAA_EARLY_EXIT is 1.\n\t\t\t\t// This does not apply to PS3,\n\t\t\t\t// PS3 was simplified to avoid more shader instructions.\n\t\t\t\t//\t 0.06 - faster but more aliasing in darks\n\t\t\t\t//\t 0.05 - default\n\t\t\t\t//\t 0.04 - slower and less aliasing in darks\n\t\t\t\t// Special notes when using FXAA_GREEN_AS_LUMA,\n\t\t\t\t//\t Likely want to set this to zero.\n\t\t\t\t//\t As colors that are mostly not-green\n\t\t\t\t//\t will appear very dark in the green channel!\n\t\t\t\t//\t Tune by looking at mostly non-green content,\n\t\t\t\t//\t then start at zero and increase until aliasing is a problem.\n\t\t\t\tFxaaFloat fxaaConsoleEdgeThresholdMin,\n\t\t\t\t//\n\t\t\t\t// Extra constants for 360 FXAA Console only.\n\t\t\t\t// Use zeros or anything else for other platforms.\n\t\t\t\t// These must be in physical constant registers and NOT immediates.\n\t\t\t\t// Immediates will result in compiler un-optimizing.\n\t\t\t\t// {xyzw} = float4(1.0, -1.0, 0.25, -0.25)\n\t\t\t\tFxaaFloat4 fxaaConsole360ConstDir\n\t\t) {\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat2 posM;\n\t\t\t\tposM.x = pos.x;\n\t\t\t\tposM.y = pos.y;\n\t\t\t\t#if (FXAA_GATHER4_ALPHA == 1)\n\t\t\t\t\t\t#if (FXAA_DISCARD == 0)\n\t\t\t\t\t\t\t\tFxaaFloat4 rgbyM = FxaaTexTop(tex, posM);\n\t\t\t\t\t\t\t\t#if (FXAA_GREEN_AS_LUMA == 0)\n\t\t\t\t\t\t\t\t\t\t#define lumaM rgbyM.w\n\t\t\t\t\t\t\t\t#else\n\t\t\t\t\t\t\t\t\t\t#define lumaM rgbyM.y\n\t\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t#endif\n\t\t\t\t\t\t#if (FXAA_GREEN_AS_LUMA == 0)\n\t\t\t\t\t\t\t\tFxaaFloat4 luma4A = FxaaTexAlpha4(tex, posM);\n\t\t\t\t\t\t\t\tFxaaFloat4 luma4B = FxaaTexOffAlpha4(tex, posM, FxaaInt2(-1, -1));\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\t\tFxaaFloat4 luma4A = FxaaTexGreen4(tex, posM);\n\t\t\t\t\t\t\t\tFxaaFloat4 luma4B = FxaaTexOffGreen4(tex, posM, FxaaInt2(-1, -1));\n\t\t\t\t\t\t#endif\n\t\t\t\t\t\t#if (FXAA_DISCARD == 1)\n\t\t\t\t\t\t\t\t#define lumaM luma4A.w\n\t\t\t\t\t\t#endif\n\t\t\t\t\t\t#define lumaE luma4A.z\n\t\t\t\t\t\t#define lumaS luma4A.x\n\t\t\t\t\t\t#define lumaSE luma4A.y\n\t\t\t\t\t\t#define lumaNW luma4B.w\n\t\t\t\t\t\t#define lumaN luma4B.z\n\t\t\t\t\t\t#define lumaW luma4B.x\n\t\t\t\t#else\n\t\t\t\t\t\tFxaaFloat4 rgbyM = FxaaTexTop(tex, posM);\n\t\t\t\t\t\t#if (FXAA_GREEN_AS_LUMA == 0)\n\t\t\t\t\t\t\t\t#define lumaM rgbyM.w\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\t\t#define lumaM rgbyM.y\n\t\t\t\t\t\t#endif\n\t\t\t\t\t\t#if (FXAA_GLSL_100 == 1)\n\t\t\t\t\t\t\tFxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0, 1.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 0.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0,-1.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 0.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\tFxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t#endif\n\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat maxSM = max(lumaS, lumaM);\n\t\t\t\tFxaaFloat minSM = min(lumaS, lumaM);\n\t\t\t\tFxaaFloat maxESM = max(lumaE, maxSM);\n\t\t\t\tFxaaFloat minESM = min(lumaE, minSM);\n\t\t\t\tFxaaFloat maxWN = max(lumaN, lumaW);\n\t\t\t\tFxaaFloat minWN = min(lumaN, lumaW);\n\t\t\t\tFxaaFloat rangeMax = max(maxWN, maxESM);\n\t\t\t\tFxaaFloat rangeMin = min(minWN, minESM);\n\t\t\t\tFxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;\n\t\t\t\tFxaaFloat range = rangeMax - rangeMin;\n\t\t\t\tFxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);\n\t\t\t\tFxaaBool earlyExit = range < rangeMaxClamped;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tif(earlyExit)\n\t\t\t\t\t\t#if (FXAA_DISCARD == 1)\n\t\t\t\t\t\t\t\tFxaaDiscard;\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\t\treturn rgbyM;\n\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t#if (FXAA_GATHER4_ALPHA == 0)\n\t\t\t\t\t\t#if (FXAA_GLSL_100 == 1)\n\t\t\t\t\t\t\tFxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0,-1.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 1.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0,-1.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 1.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\tFxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t#endif\n\t\t\t\t#else\n\t\t\t\t\t\tFxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, -1), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\tFxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));\n\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat lumaNS = lumaN + lumaS;\n\t\t\t\tFxaaFloat lumaWE = lumaW + lumaE;\n\t\t\t\tFxaaFloat subpixRcpRange = 1.0/range;\n\t\t\t\tFxaaFloat subpixNSWE = lumaNS + lumaWE;\n\t\t\t\tFxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;\n\t\t\t\tFxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat lumaNESE = lumaNE + lumaSE;\n\t\t\t\tFxaaFloat lumaNWNE = lumaNW + lumaNE;\n\t\t\t\tFxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;\n\t\t\t\tFxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat lumaNWSW = lumaNW + lumaSW;\n\t\t\t\tFxaaFloat lumaSWSE = lumaSW + lumaSE;\n\t\t\t\tFxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);\n\t\t\t\tFxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);\n\t\t\t\tFxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;\n\t\t\t\tFxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;\n\t\t\t\tFxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;\n\t\t\t\tFxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;\n\t\t\t\tFxaaFloat lengthSign = fxaaQualityRcpFrame.x;\n\t\t\t\tFxaaBool horzSpan = edgeHorz >= edgeVert;\n\t\t\t\tFxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tif(!horzSpan) lumaN = lumaW;\n\t\t\t\tif(!horzSpan) lumaS = lumaE;\n\t\t\t\tif(horzSpan) lengthSign = fxaaQualityRcpFrame.y;\n\t\t\t\tFxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat gradientN = lumaN - lumaM;\n\t\t\t\tFxaaFloat gradientS = lumaS - lumaM;\n\t\t\t\tFxaaFloat lumaNN = lumaN + lumaM;\n\t\t\t\tFxaaFloat lumaSS = lumaS + lumaM;\n\t\t\t\tFxaaBool pairN = abs(gradientN) >= abs(gradientS);\n\t\t\t\tFxaaFloat gradient = max(abs(gradientN), abs(gradientS));\n\t\t\t\tif(pairN) lengthSign = -lengthSign;\n\t\t\t\tFxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat2 posB;\n\t\t\t\tposB.x = posM.x;\n\t\t\t\tposB.y = posM.y;\n\t\t\t\tFxaaFloat2 offNP;\n\t\t\t\toffNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;\n\t\t\t\toffNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;\n\t\t\t\tif(!horzSpan) posB.x += lengthSign * 0.5;\n\t\t\t\tif( horzSpan) posB.y += lengthSign * 0.5;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat2 posN;\n\t\t\t\tposN.x = posB.x - offNP.x * FXAA_QUALITY_P0;\n\t\t\t\tposN.y = posB.y - offNP.y * FXAA_QUALITY_P0;\n\t\t\t\tFxaaFloat2 posP;\n\t\t\t\tposP.x = posB.x + offNP.x * FXAA_QUALITY_P0;\n\t\t\t\tposP.y = posB.y + offNP.y * FXAA_QUALITY_P0;\n\t\t\t\tFxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;\n\t\t\t\tFxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));\n\t\t\t\tFxaaFloat subpixE = subpixC * subpixC;\n\t\t\t\tFxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tif(!pairN) lumaNN = lumaSS;\n\t\t\t\tFxaaFloat gradientScaled = gradient * 1.0/4.0;\n\t\t\t\tFxaaFloat lumaMM = lumaM - lumaNN * 0.5;\n\t\t\t\tFxaaFloat subpixF = subpixD * subpixE;\n\t\t\t\tFxaaBool lumaMLTZero = lumaMM < 0.0;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tlumaEndN -= lumaNN * 0.5;\n\t\t\t\tlumaEndP -= lumaNN * 0.5;\n\t\t\t\tFxaaBool doneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\tFxaaBool doneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;\n\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;\n\t\t\t\tFxaaBool doneNP = (!doneN) || (!doneP);\n\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;\n\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tif(doneNP) {\n\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;\n\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;\n\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;\n\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 3)\n\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;\n\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;\n\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;\n\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 4)\n\t\t\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;\n\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;\n\t\t\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;\n\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 5)\n\t\t\t\t\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;\n\t\t\t\t\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 6)\n\t\t\t\t\t\t\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 7)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t#if (FXAA_QUALITY_PS > 8)\n\t\t\t\tif(doneNP) {\n\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;\n\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;\n\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;\n\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 9)\n\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;\n\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;\n\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;\n\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 10)\n\t\t\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;\n\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;\n\t\t\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;\n\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 11)\n\t\t\t\t\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;\n\t\t\t\t\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 12)\n\t\t\t\t\t\t\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t}\n\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t}\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat dstN = posM.x - posN.x;\n\t\t\t\tFxaaFloat dstP = posP.x - posM.x;\n\t\t\t\tif(!horzSpan) dstN = posM.y - posN.y;\n\t\t\t\tif(!horzSpan) dstP = posP.y - posM.y;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;\n\t\t\t\tFxaaFloat spanLength = (dstP + dstN);\n\t\t\t\tFxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;\n\t\t\t\tFxaaFloat spanLengthRcp = 1.0/spanLength;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaBool directionN = dstN < dstP;\n\t\t\t\tFxaaFloat dst = min(dstN, dstP);\n\t\t\t\tFxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;\n\t\t\t\tFxaaFloat subpixG = subpixF * subpixF;\n\t\t\t\tFxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;\n\t\t\t\tFxaaFloat subpixH = subpixG * fxaaQualitySubpix;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;\n\t\t\t\tFxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);\n\t\t\t\tif(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;\n\t\t\t\tif( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;\n\t\t\t\t#if (FXAA_DISCARD == 1)\n\t\t\t\t\t\treturn FxaaTexTop(tex, posM);\n\t\t\t\t#else\n\t\t\t\t\t\treturn FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);\n\t\t\t\t#endif\n\t\t}\n\t\t/*==========================================================================*/\n\t\t#endif\n\n\t\tvoid main() {\n\t\t\tgl_FragColor = FxaaPixelShader(\n\t\t\t\tvUv,\n\t\t\t\tvec4(0.0),\n\t\t\t\ttDiffuse,\n\t\t\t\ttDiffuse,\n\t\t\t\ttDiffuse,\n\t\t\t\tresolution,\n\t\t\t\tvec4(0.0),\n\t\t\t\tvec4(0.0),\n\t\t\t\tvec4(0.0),\n\t\t\t\t0.75,\n\t\t\t\t0.166,\n\t\t\t\t0.0833,\n\t\t\t\t0.0,\n\t\t\t\t0.0,\n\t\t\t\t0.0,\n\t\t\t\tvec4(0.0)\n\t\t\t);\n\n\t\t\t// TODO avoid querying texture twice for same texel\n\t\t\tgl_FragColor.a = texture2D(tDiffuse, vUv).a;\n\t\t}`\n\n};\n\nexport { FXAAShader };\n","import { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader'\nimport { threeObj } from './index'\nimport { Object3D, Raycaster, Vector2 } from 'three'\nimport { RenderPass } from 'three/examples/jsm/postprocessing/RenderPass'\nimport { OutlinePass } from 'three/examples/jsm/postprocessing/OutlinePass'\nimport { ShaderPass } from 'three/examples/jsm/postprocessing/ShaderPass'\nimport { FXAAShader } from 'three/examples/jsm/shaders/FXAAShader'\nimport type { Intersection } from 'three'\n\nconst loadGlb = (\n  url: string,\n  position?: [x: number, y: number, z: number],\n  scale?: [x: number, y: number, z: number]\n) => {\n  const gltfLoader = new GLTFLoader()\n  gltfLoader.load(url, (gltf) => {\n    const model = gltf.scene\n    scale && model.scale.set(...scale)\n    position && model.position.set(...position)\n    threeObj.scene.add(gltf.scene)\n  })\n}\n\nconst checkIntersection = (event: PointerEvent, callback: (params: Object3D) => void) => {\n  const rayCaster = new Raycaster()\n  const pointer = new Vector2()\n  pointer.x = (event.clientX / window.innerWidth) * 2 - 1\n  pointer.y = -(event.clientY / window.innerHeight) * 2 + 1\n  rayCaster.setFromCamera(pointer, threeObj.camera)\n  const intersects = rayCaster.intersectObjects(threeObj.scene.children)\n  if (intersects.length > 0) {\n    const model = intersects[0].object\n    if (\n      model &&\n      (model.name === '水泵' ||\n        model.name === '水泵_1' ||\n        model.name === '水泵_2' ||\n        model.name === '水泵_3')\n    ) {\n      callback(model)\n      IntersectionOutline(intersects)\n    }\n  }\n}\n\nconst IntersectionOutline = (intersects: Array<Intersection<Object3D>>) => {\n  const renderPass = new RenderPass(threeObj.scene, threeObj.camera)\n  threeObj.outlinePass = new OutlinePass(\n    new Vector2(window.innerWidth, window.innerHeight),\n    threeObj.scene,\n    threeObj.camera\n  )\n  const effectFXAA = new ShaderPass(FXAAShader)\n  effectFXAA.uniforms['resolution'].value.set(1 / window.innerWidth, 1 / window.innerHeight)\n  threeObj.outlinePass.renderToScreen = true\n  threeObj.outlinePass.edgeStrength = 5 //粗\n  threeObj.outlinePass.edgeGlow = 1 //发光\n  threeObj.outlinePass.edgeThickness = 2 //光晕粗\n  threeObj.outlinePass.pulsePeriod = 0 //闪烁\n  threeObj.outlinePass.usePatternTexture = false //是否使用贴图\n  threeObj.outlinePass.visibleEdgeColor.set('#ffffff') // 设置显示的颜色\n  threeObj.outlinePass.hiddenEdgeColor.set('#190a05')\n  threeObj.composer.addPass(renderPass)\n  threeObj.composer.addPass(effectFXAA)\n  threeObj.composer.addPass(threeObj.outlinePass)\n  threeObj.outlinePass.selectedObjects = [intersects[0].object]\n}\nexport { loadGlb, checkIntersection }\n","import { AmbientLight, Color, DirectionalLight, Vector3 } from 'three'\nimport { threeObj } from './index'\ninterface DirectionalLightType {\n  position: Vector3\n  color: Color | string | number\n  intensity: number\n}\n/**\n * 封装\n * @param list\n */\nconst directionArrLight = (list: DirectionalLightType[]) => {\n  list.forEach((item) => {\n    const directionLight = new DirectionalLight(item.color, item.intensity)\n    directionLight.position.set(item.position.x, item.position.y, item.position.z)\n    threeObj.scene.add(directionLight)\n  })\n}\n\nconst ambientLight = () => {\n  const ambientLight = new AmbientLight(0xffffff, 0.6)\n  threeObj.scene.add(ambientLight)\n}\n\nexport { directionArrLight, ambientLight }\nexport type { DirectionalLightType }\n","import { Scene } from 'three'\nimport { threeObj } from './index'\nimport { CSS3DObject, CSS3DRenderer } from 'three/examples/jsm/renderers/CSS3DRenderer'\nimport { TrackballControls } from 'three/examples/jsm/controls/TrackballControls'\n\nconst tagRender = (\n  element: HTMLElement,\n  position: [x: number, y: number, z: number],\n  ratation: [x: number, y: number, z: number]\n) => {\n  threeObj.cssScene = new Scene()\n  threeObj.tag = new CSS3DObject(element)\n  threeObj.tag.position.set(...position)\n  threeObj.tag.rotation.set(...ratation)\n  threeObj.tag.scale.set(1, 1, 1)\n  threeObj.cssScene.add(threeObj.tag)\n  threeObj.cssRender = new CSS3DRenderer()\n  threeObj.cssRender.setSize(threeObj.dom.offsetWidth, threeObj.dom.offsetHeight)\n  threeObj.cssRender.domElement.style.position = 'absolute'\n  threeObj.cssRender.domElement.style.top = '0'\n  threeObj.dom.appendChild(threeObj.cssRender.domElement)\n  threeObj.trackBallControls = new TrackballControls(threeObj.camera, threeObj.cssRender.domElement)\n  const fn = () => {\n    requestAnimationFrame(fn)\n    threeObj.cssRender.render(threeObj.cssScene, threeObj.camera)\n    threeObj.renderer.render(threeObj.scene, threeObj.camera)\n    threeObj.camera.updateMatrixWorld(true)\n    threeObj.trackBallControls.update()\n    threeObj.composer.render()\n  }\n  fn()\n}\n\nexport { tagRender }\n","import BaseThree from './BaseThree'\nimport { Vector3 } from 'three'\nexport { loadGlb, checkIntersection } from './LoadGlb'\nexport { directionArrLight, ambientLight, type DirectionalLightType } from './Light'\nexport { tagRender } from './CssRender'\n\nlet threeObj: BaseThree\nconst initThree = (position: Vector3, ele: HTMLElement) => {\n  threeObj = new BaseThree(position, ele)\n  threeObj.initScene()\n}\n\nexport { threeObj, initThree }\n"],"names":["_position","Vector3","_quaternion","Quaternion","_scale","CSS3DObject","Object3D","element","object","source","recursive","CSS3DSprite","_matrix","Matrix4","_matrix2","CSS3DRenderer","parameters","_this","_width","_height","_widthHalf","_heightHalf","cache","domElement","cameraElement","scene","camera","fov","tx","ty","style","epsilon","getCameraCSSMatrix","renderObject","width","height","value","matrix","elements","getObjectCSSMatrix","cameraCSSMatrix","visible","cachedObject","objectData","i","l","_changeEvent","_startEvent","_endEvent","TrackballControls","EventDispatcher","scope","STATE","MOUSE","EPS","lastPosition","lastZoom","_state","_keyState","_touchZoomDistanceStart","_touchZoomDistanceEnd","_lastAngle","_eye","_movePrev","Vector2","_moveCurr","_lastAxis","_zoomStart","_zoomEnd","_panStart","_panEnd","_pointers","_pointerPositions","box","d","getMouseOnScreen","vector","pageX","pageY","getMouseOnCircle","axis","quaternion","eyeDirection","objectUpDirection","objectSidewaysDirection","moveDirection","angle","factor","mouseChange","objectUp","pan","scale_x","scale_y","onPointerDown","event","onPointerMove","onPointerUp","addPointer","onTouchStart","onMouseDown","onTouchMove","onMouseMove","onTouchEnd","onMouseUp","removePointer","onPointerCancel","keydown","keyup","state","onMouseWheel","trackPointer","dx","dy","x","y","position","getSecondPointerPosition","contextmenu","pointer","_raycaster","Raycaster","_tempVector","_tempVector2","_tempQuaternion","_unit","_mouseDownEvent","_mouseUpEvent","_objectChangeEvent","TransformControls","_gizmo","TransformControlsGizmo","_plane","TransformControlsPlane","defineProperty","propName","defaultValue","propValue","worldPosition","worldPositionStart","worldQuaternion","worldQuaternionStart","cameraPosition","cameraQuaternion","pointStart","pointEnd","rotationAxis","rotationAngle","eye","getPointer","onPointerHover","intersect","intersectObjectWithRay","planeIntersect","mode","space","ROTATION_SPEED","child","translationSnap","rotationSnap","scaleSnap","size","rect","raycaster","includeInvisible","allIntersections","_tempEuler","Euler","_alignVector","_zeroVector","_lookAtMatrix","_tempQuaternion2","_identityQuaternion","_dirVector","_tempMatrix","_unitX","_unitY","_unitZ","_v1","_v2","_v3","gizmoMaterial","MeshBasicMaterial","gizmoLineMaterial","LineBasicMaterial","matInvisible","matHelper","matRed","matGreen","matBlue","matRedTransparent","matGreenTransparent","matBlueTransparent","matWhiteTransparent","matYellowTransparent","matGray","arrowGeometry","CylinderGeometry","scaleHandleGeometry","BoxGeometry","lineGeometry","BufferGeometry","Float32BufferAttribute","lineGeometry2","CircleGeometry","radius","arc","geometry","TorusGeometry","TranslateHelperGeometry","gizmoTranslate","Mesh","OctahedronGeometry","pickerTranslate","helperTranslate","Line","gizmoRotate","helperRotate","pickerRotate","SphereGeometry","gizmoScale","pickerScale","helperScale","setupGizmo","gizmoMap","gizmo","name","rotation","scale","tag","tempGeometry","force","handles","handle","a","PlaneGeometry","DoubleSide","ch2","durl","c","cwk","u","wk","id","msg","transfer","cb","w","e","u8","u16","u32","fleb","fdeb","clim","freb","eb","start","b","r","j","_a","fl","revfl","_b","fd","revfd","rev","hMap","cd","mb","s","le","co","rvb","sv","r_1","v","m","flt","fdt","flm","flrm","fdm","fdrm","max","bits","p","o","bits16","shft","slc","inflt","dat","buf","st","sl","noBuf","noSt","cbuf","bl","nbuf","final","pos","bt","lm","dm","lbt","dbt","tbts","type","hLit","hcLen","tl","ldt","clt","clb","clbmsk","clm","n","lt","dt","t","lms","dms","lpos","sym","add","dsym","end","wbits","wbits16","hTree","t2","et","i0","i1","i2","maxSym","tr","mbt","ln","lft","cst","i2_1","i2_2","i2_3","lc","cl","cli","cln","cls","clen","cf","wfblk","out","wblk","syms","lf","df","li","bs","dlt","mlb","ddt","mdb","_c","lclt","nlc","_d","lcdt","ndc","lcfreq","_e","lct","mlcb","nlcc","flen","ftlen","dtlen","ll","dl","llm","lcts","it","clct","len","dst","deo","dflt","lvl","plvl","pre","post","lst","opt","msk_1","prev","head","bs1_1","bs2_1","hsh","lc_1","wi","hv","imod","pimod","rem","ch_1","dif","maxn","maxd","ml","nl","mmd","md","ti","pti","lin","din","crct","k","crc","cr","adler","dopt","mrg","wcln","fn","fnStr","td","ks","st_1","spInd","ch","cbfs","wrkr","fns","init","td_1","bInflt","inflateSync","pbf","gu8","bDflt","deflateSync","gze","gzh","gzhl","wbytes","guze","gzs","gzl","zle","zlh","zule","zlv","cbify","opts","err","astrm","strm","ev","astrmify","f","b2","b4","b8","flg","zs","lv","AsyncCmpStrm","Deflate","chunk","AsyncDeflate","deflate","data","Inflate","bts","AsyncInflate","inflate","Gzip","raw","AsyncGzip","gzip","gzipSync","Gunzip","AsyncGunzip","gunzip","gunzipSync","Zlib","AsyncZlib","zlib","zlibSync","Unzlib","AsyncUnzlib","unzlib","unzlibSync","Decompress","_this_1","AsyncDecompress","decompress","decompressSync","fltn","val","te","tds","dutf8","DecodeUTF8","np","EncodeUTF8","strToU8","str","latin1","ar_1","ar","ai","strFromU8","ext","dbf","slzh","zh","z","fnl","es","z64e","sc","su","off","exfl","ex","wzh","ce","col","exl","exf","wzf","ZipPassThrough","filename","ZipDeflate","AsyncZipDeflate","Zip","file","com","hl","header","chks","pAll","_i","chks_1","chk","ind","uf","nxt","dd","zip","tot","slft","files","term","tAll","cbf","oe","cdl","badd","loc","_loop_1","ms","compression","cbl","zipSync","UnzipPassThrough","UnzipInflate","AsyncUnzipInflate","_","sz","Unzip","toAdd","is","oc","_loop_2","sig","this_1","bf","cmp_1","chks_2","sc_1","su_1","fn_1","d_1","file_1","ctr","chks_3","state_1","decoder","unzip","_loop_3","c_1","no","infl","unzipSync","c_2","findSpan","U","low","high","mid","calcBasisFunctions","span","N","left","right","saved","rv","temp","calcBSplinePoint","P","C","Vector4","point","Nj","wNj","calcBasisFunctionDerivatives","zeroArr","ders","ndu","s1","s2","rk","pk","j1","j2","calcBSplineDerivatives","nd","du","CK","nders","Pw","calcKoverI","nom","denom","calcRationalCurveDerivatives","Pders","Aders","wders","calcNURBSDerivatives","NURBSCurve","Curve","degree","knots","controlPoints","startKnot","endKnot","optionalTarget","hpoint","NURBSUtils.calcBSplinePoint","tangent","NURBSUtils.calcNURBSDerivatives","fbxTree","connections","sceneGraph","FBXLoader","Loader","manager","url","onLoad","onProgress","onError","path","LoaderUtils","loader","FileLoader","buffer","FBXBuffer","isFbxFormatBinary","BinaryParser","FBXText","convertArrayBufferToString","isFbxFormatASCII","getFbxVersion","TextParser","textureLoader","TextureLoader","FBXTreeParser","images","textures","materials","deformers","geometryMap","GeometryParser","connectionMap","rawConnection","fromID","toID","relationship","parentRelationship","childRelationship","blobs","videoNodes","nodeID","videoNode","arrayBufferContent","base64Content","image","content","fileName","extension","array","textureMap","textureNodes","texture","textureNode","wrapModeU","wrapModeV","valueU","valueV","RepeatWrapping","ClampToEdgeWrapping","values","currentPath","children","Texture","materialMap","materialNodes","material","materialNode","ID","MeshPhongMaterial","MeshLambertMaterial","Color","sRGBEncoding","EquirectangularReflectionMapping","skeletons","morphTargets","DeformerNodes","deformerNode","relationships","skeleton","morphTarget","deformerNodes","rawBones","boneNode","rawBone","rawMorphTargets","morphTargetNode","rawMorphTarget","Group","modelMap","modelNodes","model","modelNode","connection","parent","node","transform","generateTransform","animations","AnimationParser","Bone","PropertyBinding","bone","subBone","cameraAttribute","attr","nearClippingPlane","farClippingPlane","aspect","focalLength","PerspectiveCamera","OrthographicCamera","lightAttribute","color","intensity","distance","decay","PointLight","DirectionalLight","MathUtils","penumbra","SpotLight","SkinnedMesh","geo","transformData","getEulerOrder","lookAtTarget","bindMatrices","geoID","geoConnParent","Skeleton","BindPoseNode","poseNodes","poseNode","ambientColor","g","AmbientLight","geoNodes","geoNode","preTransform","geoInfo","buffers","positionAttribute","Uint16BufferAttribute","normalMatrix","Matrix3","normalAttribute","uvBuffer","prevMaterialIndex","startIndex","currentIndex","lastGroup","lastIndex","index","polygonIndex","faceLength","displayedWeightsWarning","facePositionIndexes","faceNormals","faceColors","faceUVs","faceWeights","faceWeightIndices","vertexIndex","polygonVertexIndex","materialIndex","endOfFace","weightIndices","weights","getData","wt","wIndex","Weight","weight","weightIndex","currentWeight","comparedWeight","comparedWeightIndex","comparedWeightArray","tmp","uv","parentGeo","parentGeoNode","rawTarget","morphGeoNode","vertexIndices","morphPositionsSparse","indices","length","morphPositions","morphIndex","morphGeoInfo","morphBuffers","NormalNode","mappingType","referenceType","indexBuffer","UVNode","ColorNode","MaterialNode","materialIndexBuffer","materialIndices","order","pointsValues","points","animationClips","rawClips","key","rawClip","clip","curveNodesMap","layersMap","rawCurveNodes","rawCurveNode","curveNode","rawCurves","animationCurve","convertFBXTimeToSeconds","animationCurveID","animationCurveRelationship","rawLayers","layerCurveNodes","modelID","rawModel","deformerID","morpherID","rawStacks","layer","tracks","rawTracks","AnimationClip","initialPosition","initialRotation","initialScale","positionTrack","rotationTrack","scaleTrack","morphTrack","modelName","curves","initialValue","times","VectorKeyframeTrack","preRotation","postRotation","eulerOrder","euler","quaternionValues","QuaternionKeyframeTrack","morphNum","NumberKeyframeTrack","targetIndex","lastValue","currentValue","prevValue","xIndex","yIndex","zIndex","time","xValue","yValue","zValue","curve","valuesSpan","absoluteSpan","numSubIntervals","step","nextValue","initialTime","interval","nextTime","interpolatedTimes","interpolatedValues","inject","text","FBXTree","split","line","matchComment","matchEmpty","matchBeginning","matchProperty","matchEnd","property","nodeName","nodeAttrs","attrs","currentNode","contentLine","connProps","from","to","rest","elem","append","parseNumberArray","props","prop","innerPropName","innerPropType1","innerPropType2","innerPropFlag","innerPropValue","reader","BinaryReader","version","allNodes","endOffset","numProperties","nameLen","propertyList","attrName","attrType","subNode","arrayLength","encoding","compressedLength","fflate","fflate.unzlibSync","reader2","littleEndian","nullByte","CORRECT","cursor","read","offset","result","versionRegExp","match","dataArray","infoObject","slice","tempEuler","tempVec","lTranslationM","lPreRotationM","lRotationM","lPostRotationM","lScalingM","lScalingPivotM","lScalingOffsetM","lRotationOffsetM","lRotationPivotM","lParentGX","lParentLX","lGlobalT","inheritType","lLRM","lParentGRM","lParentTM","lParentGRSM","lParentGSM","lLSM","lGlobalRS","lParentLSM_inv","lParentGSM_noLocal","lRotationPivotM_inv","lScalingPivotM_inv","lTransform","lLocalTWithAllPivotAndOffsetInfo","lGlobalTranslation","enums","a1","a2","GLTFLoader","parser","GLTFMaterialsClearcoatExtension","GLTFTextureBasisUExtension","GLTFTextureWebPExtension","GLTFMaterialsSheenExtension","GLTFMaterialsTransmissionExtension","GLTFMaterialsVolumeExtension","GLTFMaterialsIorExtension","GLTFMaterialsSpecularExtension","GLTFLightsExtension","GLTFMeshoptCompression","resourcePath","_onError","gltf","dracoLoader","ktx2Loader","meshoptDecoder","callback","extensions","plugins","BINARY_EXTENSION_HEADER_MAGIC","EXTENSIONS","GLTFBinaryExtension","error","json","GLTFParser","plugin","extensionName","extensionsRequired","GLTFMaterialsUnlitExtension","GLTFMaterialsPbrSpecularGlossinessExtension","GLTFDracoMeshCompressionExtension","GLTFTextureTransformExtension","GLTFMeshQuantizationExtension","resolve","reject","GLTFRegistry","objects","nodeDefs","nodeIndex","nodeLength","nodeDef","lightIndex","cacheKey","dependency","lightDef","lightNode","range","self","light","materialParams","materialDef","pending","metallicRoughness","MeshPhysicalMaterial","colorArray","textureIndex","textureDef","handler","isSupported","bufferView","extensionDef","res","byteOffset","byteLength","count","stride","BINARY_EXTENSION_HEADER_LENGTH","BINARY_EXTENSION_CHUNK_TYPES","headerView","chunkContentsLength","chunkView","chunkIndex","chunkLength","chunkType","contentArray","primitive","bufferViewIndex","gltfAttributeMap","threeAttributeMap","attributeNormalizedMap","attributeTypeMap","attributeName","threeAttributeName","ATTRIBUTES","accessorDef","componentType","WEBGL_COMPONENT_TYPES","attribute","normalized","GLTFMeshStandardSGMaterial","MeshStandardMaterial","params","specularMapParsFragmentChunk","glossinessMapParsFragmentChunk","specularMapFragmentChunk","glossinessMapFragmentChunk","lightPhysicalFragmentChunk","uniforms","shader","uniformName","pbrSpecularGlossiness","specGlossMapDef","TangentSpaceNormalMap","GLTFCubicSplineInterpolant","Interpolant","parameterPositions","sampleValues","sampleSize","resultBuffer","valueSize","t0","t1","stride2","stride3","pp","ppp","offset1","offset0","s3","s0","p0","m0","p1","m1","_q","GLTFCubicSplineQuaternionInterpolant","WEBGL_CONSTANTS","WEBGL_FILTERS","NearestFilter","LinearFilter","NearestMipmapNearestFilter","LinearMipmapNearestFilter","NearestMipmapLinearFilter","LinearMipmapLinearFilter","WEBGL_WRAPPINGS","MirroredRepeatWrapping","WEBGL_TYPE_SIZES","PATH_PROPERTIES","INTERPOLATION","InterpolateLinear","InterpolateDiscrete","ALPHA_MODES","createDefaultMaterial","FrontSide","addUnknownExtensionsToUserData","knownExtensions","objectDef","assignExtrasToUserData","gltfDef","addMorphTargets","targets","hasMorphPosition","hasMorphNormal","il","target","pendingPositionAccessors","pendingNormalAccessors","pendingAccessor","accessors","morphNormals","updateMorphTargets","mesh","meshDef","targetNames","createPrimitiveKey","primitiveDef","dracoExtension","geometryKey","createAttributesKey","attributes","attributesKey","keys","getNormalizedComponentScale","constructor","options","ImageBitmapLoader","dependencies","skinDefs","meshDefs","skinIndex","skinLength","joints","ref","updateMappings","original","clone","mappings","func","defs","def","bufferIndex","bufferDef","bufferViewDef","accessorIndex","pendingBufferViews","bufferViews","itemSize","TypedArray","elementBytes","itemBytes","byteStride","bufferAttribute","ibSlice","ibCacheKey","ib","InterleavedBuffer","InterleavedBufferAttribute","BufferAttribute","itemSizeIndices","TypedArrayIndices","byteOffsetIndices","byteOffsetValues","sparseIndices","sparseValues","URL","sourceURI","isObjectURL","blob","promise","imageBitmap","sampler","mapName","mapDef","gltfReference","useDerivativeTangents","useVertexColors","useFlatShading","pointsMaterial","PointsMaterial","Material","lineMaterial","cachedMaterial","materialType","materialExtensions","sgExtension","kmuExtension","alphaMode","originalName","sanitizedName","primitives","createDracoPrimitive","addPrimitiveAttributes","cached","geometryPromise","meshIndex","results","geometries","meshes","toTrianglesDrawMode","TriangleStripDrawMode","TriangleFanDrawMode","LineSegments","LineLoop","Points","group","cameraIndex","cameraDef","skinDef","skinEntry","accessor","animationIndex","animationDef","pendingNodes","pendingInputAccessors","pendingOutputAccessors","pendingSamplers","pendingTargets","channel","input","output","nodes","inputAccessors","outputAccessors","samplers","inputAccessor","outputAccessor","TypedKeyframeTrack","targetName","interpolation","outputArray","scaled","jl","track","interpolantType","meshPromise","sceneIndex","sceneDef","nodeIds","buildNodeHierarchy","reduceAssociations","reducedAssociations","nodeId","parentObject","skin","pendingJoints","jointNodes","bones","boneInverses","jointNode","mat","computeBounds","Box3","min","boxScale","maxDisplacement","sphere","Sphere","assignAttributeAccessor","gltfAttributeName","drawMode","numberOfTriangles","newIndices","newGeometry","CopyShader","Pass","_camera","_geometry","FullScreenQuad","renderer","ShaderPass","textureID","ShaderMaterial","UniformsUtils","writeBuffer","readBuffer","MaskPass","context","writeValue","clearValue","ClearMaskPass","EffectComposer","renderTarget","RGBAFormat","WebGLRenderTarget","Clock","pass","passIndex","deltaTime","currentRenderTarget","maskActive","stencil","effectiveWidth","effectiveHeight","pixelRatio","OutlinePass","resolution","selectedObjects","pars","resx","resy","MeshDepthMaterial","RGBADepthPacking","NoBlending","replaceDepthToViewZ","MAX_EDGE_THICKNESS","MAX_EDGE_GLOW","copyShader","string","bVisible","gatherSelectedMeshesCallBack","selectedMeshes","VisibilityChangeCallBack","bFound","visibility","oldAutoClear","currentBackground","scalar","maxRadius","AdditiveBlending","ThreeInit","dom","__publicField","Scene","WebGLRenderer","ambientLight","directionalZPositiveLight","axesHelper","AxesHelper","vertexShader","fragmentShader","planeGeometry","planeMaterial","plane","hemiLight","HemisphereLight","skyGeo","skyMat","BackSide","cssObject0","cssObject1","cssObject2","cssObject3","cssObject4","cssObject5","CustomCurve","tz","TubeGeometry","onUpPosition","onDownPosition","transformControl","intersects","tilesRuntime","Loader3DTiles","PointCloudColoring","runtime","clock","render","RenderPass","overrideMaterial","clearColor","clearAlpha","oldClearAlpha","oldOverrideMaterial","FXAAShader","loadGlb","threeObj","checkIntersection","rayCaster","IntersectionOutline","renderPass","effectFXAA","directionArrLight","list","item","directionLight","tagRender","ratation","initThree","ele","BaseThree"],"mappings":"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A;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAA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","x_google_ignoreList":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,15,16]}